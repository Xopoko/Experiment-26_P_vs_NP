import Paperproof

/-!

# P vs NP — исследовательские шаги 16.122–16.152 (Tseitin/Grid: Q39 — bounded‑depth Frege gap)

Главный индекс: `P_vs_NP.md`.

### 16.122. Исследовательский шаг: «Gaussian elimination» как (пока) отсутствующий upper‑шаг для bounded‑depth Frege на grid

- `Линза:` Эквивалентность.
- `Утверждение:` В Håstad–Risse (2022/2025) §1.2 (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`)
  явным образом выделен «потенциальный» путь к upper bound для Tseitin(Grid) в bounded‑depth Frege:
  пытаться симулировать суммирование линейных уравнений (Gaussian elimination по модулю 2) в языке формул глубины $d$.
  Авторы показывают, как **представлять** промежуточные паритетные уравнения в виде небольших depth‑$d$ формул,
  но подчёркивают, что **не знают**, как синтаксически переводить один шаг Gaussian elimination в ограниченное число шагов доказательства,
  т.е. получают «representation of partial results», а не proof.
- `Доказательство/ссылка:` Håstad–Risse, §1.2 “Constructing small proofs” (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`):
  1) (p. 3; PDF p. 5) “If we are allowed to reason with linear equations modulo two then the Tseitin contradiction has efficient refutations.”
  2) (p. 4; PDF p. 6) “We do not know how to syntactically translate a Gaussian elimination step to some proof steps in this representation and thus we do not actually get a proof, only a representation of the partial results.”
- `Toy‑тест:` пусть максимальный размер строки $M=n^{O(1)}$, тогда $\\log M=\\Theta(\\log n)$.
  Если (как в эвристике HR §1.2) временно считать, что глубина‑$d$ **представление** паритета допускает блок
  $m\\approx(\\log M)^{d-1}$, то
  При $d=\\Theta(\\log n/\\log\\log n)$ имеем $m=\\exp(\\Theta(\\log n))=n^{\\Theta(1)}\\ge n$, т.е. представление паритета на $n$ переменных возможно при polynomial $M$;
  остаётся ровно «нехватающий» шаг: вывести из таких представлений следующее XOR‑уравнение внутри Frege.
  (Для растущей глубины и **формул** нужно аккуратно учитывать разницу «схемы vs формулы», см. §16.147–§16.152.)
- `Статус:` известный факт (точная ссылка; формализует, где именно ломается наивный upper‑подход).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` формализовать как лемму‑цель: «в bounded‑depth Frege можно (p‑)выводить представление $L_1\\oplus L_2=b_1\\oplus b_2$ из представлений $L_1=b_1$ и $L_2=b_2$ с контролем по глубине/размеру», либо найти источник, где это уже сделано.

### 16.123. Исследовательский шаг: исправление про «representation PARITY» — наивная DNF‑индукция даёт $M^{\\Theta(d)}$, а нужный факт явно заявлен в Håstad–Risse §1.2

- `Линза:` Трейд‑офф.
- `Утверждение:` Рассмотрим утверждение из §16.122: «формулы глубины $d$ размера $M$ могут представлять паритет на $m:=(\\log M)^{d-1}$ переменных» (для растущей $d$ см. caveat §16.147–§16.152).
  1) Наивная конструкция через DNF‑разложение $\\mathrm{PARITY}_{\\lceil\\log_2 M\\rceil}$ и подстановку по глубине действительно даёт depth $O(d)$, но лишь размер $M^{\\Theta(d)}$,
     поэтому **не** выводит polynomial‑size для $d=\\Theta(\\log n/\\log\\log n)$ при $M=\\mathrm{poly}(n)$ (получается quasi‑poly).
  2) Сам «representation»‑факт в нужной (для Q39) форме **известен** и прямо сформулирован в Håstad–Risse (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, §1.2):
     они утверждают, что при группировке по блокам размера $(\\log M)^{d-1}$ можно «write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity».
- `Доказательство/ссылка:`
  1) (Почему DNF‑индукция не годится при растущей $d$.) Пусть $g:=\\lceil\\log_2 M\\rceil$ и $m:=g^{d-1}$.
     База $d=2$: DNF для $\\mathrm{PARITY}_g$ имеет $2^{g-1}$ термов, т.е. размер $\\Theta(2^g\\cdot g)=\\Theta(M\\log M)$.
     Шаг $d\\to d+1$: подстановка формулы размера $S_d$ в каждое вхождение переменной в этой DNF даёт
     $$S_{d+1}=\\Theta(2^g\\cdot g\\cdot S_d)=\\Theta(M\\log M\\cdot S_d),$$
     откуда $S_d=(M\\log M)^{\\Theta(d)}=M^{\\Theta(d)}$ (лог‑факторы поглощаются в $M^{o(d)}$).
     При $M=n^C$ и $d=\\Theta(\\log n/\\log\\log n)$ это даёт $S_d=n^{\\Theta(\\log n/\\log\\log n)}$ (quasi‑poly), а не $n^{O(1)}$.
  2) (Корректный источник representation.) Håstad–Risse, §1.2, абзац начиная с “Let us consider proofs that contain formulas of depth d …”:
     “… divide the variables in to groups of size $(\\log M)^{d−1}$ and write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity …”.
- `Toy‑тест:` возьмём $M=n^{10}$ и $d=\\lfloor\\log n/\\log\\log n\\rfloor$. Тогда $m=(\\Theta(\\log n))^{\\Theta(\\log n/\\log\\log n)}=n^{\\Theta(1)}$,
  и representation из Håstad–Risse допускает формулы размера $M=\\mathrm{poly}(n)$; но DNF‑индукция выше дала бы только quasi‑poly размер.
- `Статус:` контрпример к прежнему выводу «DNF‑индукция ⇒ poly‑size при $d=\\Theta(\\log n/\\log\\log n)$»; representation‑лемма закрыта точной ссылкой (Håstad–Risse §1.2).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` теперь, когда representation опирается на источник, вернуть фокус на missing step из §16.122: найти/доказать (или барьерно опровергнуть) синтаксическую симуляцию одного шага $L_1=b_1,\\ L_2=b_2\\Rightarrow L_1\\oplus L_2=b_1\\oplus b_2$ в bounded‑depth Frege без экспоненциального blow‑up.

### 16.124. Исследовательский шаг: на пороге $d\\approx\\log n/\\log\\log n$ representation XOR‑уравнения ширины $O(n)$ становится константной; Q39 сводится к 1‑шаговой XOR‑симуляции

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $n\\to\\infty$, $M=n^{O(1)}$ и $d:=\\lceil\\log_2 n/\\log_2\\log_2 n\\rceil+1$.
  Тогда $(\\log_2 M)^{d-1}\\ge n$, а значит (в терминах §16.122–§16.123) паритетное уравнение на $m=O(n)$ переменных можно представлять **как один блок**:
  в bounded‑depth Frege линии «$\\sum x_i=b$» и «$\\neg(\\sum x_i=b)$» допускают depth‑$d$ формулы размера $\\mathrm{poly}(n)$, и representation‑overhead $2^{m/(\\log M)^{d-1}}$ становится $2^{O(1)}$.
  Следовательно, потенциальный upper‑подход через Gaussian elimination на grid (ширина каждого промежуточного уравнения $O(n)$ и $O(n)$ шагов) упирается не в представимость уравнений, а только в возможность синтаксически симулировать **один** шаг $L_1=b_1,\\ L_2=b_2\\Rightarrow L_1\\oplus L_2=b_1\\oplus b_2$ в bounded‑depth Frege.
- `Доказательство:` так как $M=n^{O(1)}$, существует константа $C\\ge 1$ такая, что $\\log_2 M\\ge C\\log_2 n\\ge \\log_2 n$ для больших $n$.
  По определению $d$ имеем $d-1\\ge \\log_2 n/\\log_2\\log_2 n$.
  Тогда
  $$(\\log_2 M)^{d-1}\\ \\ge\\ (\\log_2 n)^{\\log_2 n/\\log_2\\log_2 n}\\ =\\ 2^{(\\log_2 n/\\log_2\\log_2 n)\\cdot\\log_2\\log_2 n}\\ =\\ 2^{\\log_2 n}\\ =\\ n.$$
  Подстановка в счёт $2^{m/(\\log M)^{d-1}}$ даёт $2^{O(n)/\\Omega(n)}=2^{O(1)}$.
- `Toy‑тест:` пусть $n=2^{16}$, $M=n^{10}$ и $d=\\lceil 16/4\\rceil+1=5$.
  Тогда $\\log_2 M=160$ и $(\\log_2 M)^{d-1}=160^4>10^8\\gg n$, так что $m=n$ попадает в один блок.
- `Статус:` доказано (количественная редукция Q39: на пороговой глубине representation‑стоимость константна).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать/формализовать либо (i) p‑выводимость правила XOR‑сложения двух уравнений в bounded‑depth Frege с контролем по глубине/размеру, либо (ii) известный lower‑bound/барьер, запрещающий такое правило при $d=\\Theta(\\log n/\\log\\log n)$.

### 16.125. Исследовательский шаг: формальная редукция Q39 к p‑выводимости одного XOR‑шага (Gaussian elimination) в bounded‑depth Frege

- `Линза:` Эквивалентность.
- `Утверждение:` Зафиксируем $n\\to\\infty$, пусть $G$ — $n\\times n$ grid, а $F_n=\\mathrm{TseitinCNF}(G,\\chi)$ (с $\\bigoplus_v\\chi(v)=1$) — 3‑CNF из §16.85.
  Предположим, что для каждого $m=O(n)$ существует uniform family depth‑$d(n)$ Frege‑выводов полиномиального размера для следующего «XOR‑шага»:
  из двух представлений линейных уравнений по модулю 2,
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2),$$
  где $S_i$ — множества переменных $\\{x_e\\}$ размера $\\le m$, $\\triangle$ — симм. разность, а каждое $E(S,b)$ записано depth‑$d(n)$ формулой размера $\\mathrm{poly}(n)$ (representation из §16.123–§16.124).
  Тогда существует polynomial‑size depth‑$O(d(n))$ Frege‑рефутация $F_n$.
- `Доказательство:` возьмём линейно‑алгебраическую стратегию из Håstad–Risse §1.2:
  (i) суммирование всех уравнений одной колонки даёт уравнение ширины $O(n)$; (ii) прибавление соседней колонки сохраняет ширину $O(n)$;
  (iii) после прохода по всем колонкам получается противоречие $0=1$, и нигде не используется уравнение шире $O(n)$.
  Стандартная 3‑CNF кодировка вершины (4 клаузы для степени 3/4) имеет константный Frege‑вывод эквивалентной XOR‑формулы
  $(\\bigoplus_{e\\ni v} x_e)\\leftrightarrow\\chi(v)$ (см. схему в §16.88), так что мы можем начать с representation всех вершинных уравнений.
  Далее каждый линейный шаг суммирования/сокращения общих переменных — это ровно применение указанного XOR‑правила к двум уравнениям ширины $O(n)$,
  причём по §16.124 каждое промежуточное уравнение можно держать одним representation‑блоком (size $\\mathrm{poly}(n)$, depth $d(n)$).
  Число линейных шагов полиномиально (можно суммировать вершины по очереди внутри колонки и затем колонки по очереди), а каждая подстановка XOR‑правила имеет размер $\\mathrm{poly}(n)$ по предположению,
  значит суммарный размер Frege‑рефутации остаётся $\\mathrm{poly}(n)$ (а значит $\\mathrm{poly}(|F_n|)$).
- `Toy‑тест:` при $n=4$ суммирование 4 вершин одной колонки убивает внутренние вертикальные рёбра (каждое появляется дважды) и оставляет только рёбра, пересекающие границу колонки;
  ширина остаётся $O(n)$, и этот шаблон повторяется при добавлении следующей колонки.
- `Статус:` доказано (условная редукция: закрытие Q39 эквивалентно наличию poly‑size bounded‑depth симуляции одного Gaussian‑elimination шага на XOR‑уравнениях ширины $O(n)$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти точный источник/результат про (не)существование такого XOR‑правила в bounded‑depth Frege (возможно через известные lower bounds для AC$^0$‑Frege на «линейно‑алгебраических» тавтологиях).

### 16.126. Исследовательский шаг: «один XOR‑шаг» = Tseitin на 3‑вершинном (мульти)графе

- `Линза:` Эквивалентность.
- `Утверждение:` Зафиксируем множества переменных $S_1,S_2\\subseteq X$ и биты $b_1,b_2\\in\\{0,1\\}$.
  Тогда правило из §16.125
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2)$$
  (где $E(S,b)$ — «XOR‑уравнение по модулю 2» над переменными из $S$) эквивалентно refutation’у Tseitin‑противоречия на графе из трёх вершин, в котором каждое ребро соответствует одной переменной из $X$.
- `Доказательство:`
  1) (**Граф.**) Построим мультиграф $H(S_1,S_2)$ с вершинами $A,B,C$ и рёбрами:
     - для каждого $x\\in S_1\\cap S_2$ добавим ребро $(A,B)$, помеченное $x$;
     - для каждого $x\\in S_1\\setminus S_2$ добавим ребро $(A,C)$, помеченное $x$;
     - для каждого $x\\in S_2\\setminus S_1$ добавим ребро $(B,C)$, помеченное $x$.
     Тогда инцидентные $A$ рёбра — ровно переменные из $S_1$, инцидентные $B$ — из $S_2$, а инцидентные $C$ — из $S_1\\triangle S_2$.
  2) (**Tseitin‑система.**) Положим заряды $\\chi(A)=b_1$, $\\chi(B)=b_2$, $\\chi(C)=1\\oplus b_1\\oplus b_2$.
     Тогда Tseitin($H,\\chi$) есть система трёх XOR‑уравнений
     $$E(S_1,b_1),\\quad E(S_2,b_2),\\quad E(S_1\\triangle S_2,\\ 1\\oplus b_1\\oplus b_2).$$
     Поскольку $b_1\\oplus b_2\\oplus(1\\oplus b_1\\oplus b_2)=1$, сумма зарядов нечётна, и по инварианту из §16.85 система невыполнима.
  3) (**Импликация ↔ refutation.**) Невыполнимость тройки уравнений равносильна тавтологии
     $$E(S_1,b_1)\\wedge E(S_2,b_2)\\ \\to\\ \\neg E(S_1\\triangle S_2,\\ 1\\oplus b_1\\oplus b_2).$$
     Но $\\neg E(S,1\\oplus b)$ тождественно $E(S,b)$, значит это ровно $E(S_1,b_1)\\wedge E(S_2,b_2)\\to E(S_1\\triangle S_2,b_1\\oplus b_2)$.
     Поэтому polynomial‑size bounded‑depth Frege refutation Tseitin($H,\\chi$) (при фиксированном способе записи $E$) даёт polynomial‑size bounded‑depth доказательство XOR‑шага и наоборот (с точностью до $O(1)$ по глубине).
- `Toy‑тест:` если $S_1=\\{x,y\\}$, $S_2=\\{y,z\\}$, то рёбра: $y$ между $(A,B)$, $x$ между $(A,C)$, $z$ между $(B,C)$.
  Уравнения: $x\\oplus y=b_1$, $y\\oplus z=b_2$, $x\\oplus z=1\\oplus b_1\\oplus b_2$ — явное противоречие.
- `Статус:` доказано (переформулировка «missing step» как частного Tseitin).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать (не)известные оценки на bounded‑depth Frege для этой 3‑вершинной Tseitin‑семьи при ширине $|S_1|,|S_2|=\\Theta(n)$ и глубине $d=\\Theta(\\log n/\\log\\log n)$ (это и есть «один Gaussian‑elimination шаг»).

### 16.127. Исследовательский шаг: XOR‑сложение уравнений тривиально в EF, но перевод в bounded‑depth Frege даёт лишь $O(\\log n)$ по глубине

- `Линза:` Трейд‑офф.
- `Утверждение:` Семейство «одного XOR‑шага» (эквивалентное 3‑вершинному Tseitin из §16.126) имеет polynomial‑size refutation в Extended Frege (EF),
  поскольку EF может вводить abbreviation‑переменные и симулировать Gaussian elimination. Однако стандартные приёмы перевода/балансировки дают
  для обычного Frege только верхнюю оценку глубины $O(\\log n)$ (а не $O(\\log n/\\log\\log n)$), так что это не закрывает Q39.
- `Доказательство/пояснение:`
  1) EF‑верхняя оценка: см. §16.88 (каркас EF‑доказательства Tseitin через XOR‑переменные) и замечание «EF легко симулирует Gaussian elimination»
     (Bonet–Buss–Pitassi 2002, `../../resources/downloads/bonet_buss_pitassi_2002_hard_examples_frege.pdf`, p. 7).
     Для 3‑вершинного Tseitin (и вообще для линейных систем над $\\mathbb F_2$) EF может хранить промежуточные XOR‑уравнения в extension‑переменных и выполнять шаги сложения строк.
  2) Переход к bounded‑depth Frege: даже если есть polynomial‑size (E)Frege‑доказательство, известная универсальная балансировка формул (Spira/Brent) даёт глубину лишь
     $O(\\log m)$ для формул размера $m$ (см. §16.94), а в нашем режиме $m=\\mathrm{poly}(n)$ это $O(\\log n)$.
     Именно поэтому «есть EF‑доказательство Gaussian elimination» не означает «есть depth‑$\\Theta(\\log n/\\log\\log n)$ Frege‑доказательство одного XOR‑шага».
- `Toy‑тест:` для паритета на $n$ переменных балансировка даёт глубину $O(\\log n)$ для явной XOR‑деревянной формулы, но Q39 требует глубину порядка $\\log n/\\log\\log n$.
- `Статус:` доказано (локальный барьер: стандартный EF→Frege+балансировка не даёт нужной глубины).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать технику, которая уменьшает глубину вывода XOR‑шага ниже $O(\\log n)$ (например, через специальные depth‑$d$ представления паритета из Håstad–Risse и доказательства их линейности), либо источник, что такой сдвиг невозможен.

### 16.128. Исследовательский шаг: Claim‑28 upper (GIRS’19) не сертифицирует polynomial‑size даже для «локального» 3‑вершинного Tseitin при $d\\approx\\log n/\\log\\log n$

- `Линза:` Трейд‑офф.
- `Утверждение:` Рассмотрим семейство 3‑вершинных Tseitin‑противоречий из §16.126, где $|S_1|,|S_2|=\\Theta(n)$ (значит число переменных $\\Theta(n)$).
  Тогда общий upper bound из GIRS’19 (Claim 28 → Thm. 27; см. §16.115–§16.121) гарантирует polynomial‑size refutation лишь при глубине
  $$d=\\Omega(\\log n),$$
  и потому не может закрыть Q39 в режиме $d=\\Theta(\\log n/\\log\\log n)$ даже на одном Gaussian‑elimination шаге.
- `Доказательство:` пусть $H=H(S_1,S_2)$ — мультиграф на вершинах $A,B,C$ из §16.126.
  1) $\\Delta(H)=\\max\\{|S_1|,|S_2|,|S_1\\triangle S_2|\\}=\\Theta(n)$.
  2) По определению tree‑partition width из GIRS’19 §4.3 можно взять одно множество $\\{A,B,C\\}$ как единственную часть tree‑partition, значит
     $$\\mathrm{tpw}(H)\\le 3.$$
     Следовательно, $X:=\\Delta(H)\\,\\mathrm{tpw}(H)=\\Theta(n)$.
  3) Применяя явный unconditional upper из §16.120,
     $$\\mathrm{size}\\le \\mathrm{poly}(|T|)\\cdot 2^{O\\bigl(d\\cdot X^{2/d}\\bigr)},$$
     и лемму‑оптимизацию §16.121 (polynomial‑size возможно только при $d=\\Omega(\\log X)$), получаем требование $d=\\Omega(\\log n)$.
- `Toy‑тест:` если $d=\\lfloor\\log n/\\log\\log n\\rfloor$, то $X^{2/d}=\\exp(2\\log n/d)=(\\log n)^{\\Theta(1)}$ и
  $$2^{O(d\\cdot X^{2/d})}=2^{\\mathrm{polylog}(n)}=n^{\\mathrm{polylog}(n)}$$
  (quasi‑poly), а не $n^{O(1)}$.
- `Статус:` доказано (локальный «барьер техники»: tree‑partition upper из GIRS’19 не достигает пороговой глубины даже для 3‑вершинного шага).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать приём, который использует специальную структуру grid/representation (Håstad–Risse) и обходится без параметра $X=\\Delta\\,\\mathrm{tpw}$ (или доказать, что для 3‑вершинного Tseitin при $d=\\Theta(\\log n/\\log\\log n)$ неизбежна quasi‑poly нижняя оценка).

### 16.129. Исследовательский шаг: «компактное представление паритета» в GIRS’19 (Lemma 21) = DNF‑индукция и имеет размер $\\exp(\\Theta(d\\,n^{1/d}))$ ⇒ при $d\\approx\\log n/\\log\\log n$ это quasi‑poly

- `Линза:` Сжатие/канонизация.
- `Утверждение:` В GIRS’19, §4.1 (Lemma 20–21) «компактное представление» $\\mathrm{PARITY}$ строится через $(t_1,\\dots,t_d)$‑refinement и даёт формулу глубины $\\le 3d+1$ и размера
  $$\\mathrm{size}=\\prod_{i=1}^d (2^{t_i+1}t_i).$$
  При условии $\\prod_{i=1}^d t_i\\ge n$ (Lemma 20) лучшая возможная оценка для **этого** построения имеет вид
  $$2^{\\Omega(d\\,n^{1/d})}\\ \\le\\ \\mathrm{size}\\ \\le\\ 2^{O(d\\,n^{1/d})}\\cdot\\mathrm{poly}(n).$$
  В частности, при $d=\\Theta(\\log n/\\log\\log n)$ получаем $\\mathrm{size}=n^{\\Theta(\\log n/\\log\\log n)}$ (quasi‑poly), т.е. ровно тот же «лишний множитель $d$ в экспоненте», что и в §16.123.
- `Доказательство/ссылка:`
  1) (Размер/глубина формулы.) GIRS’19, Lemma 21 (в `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`): при $(t_1,\\dots,t_d)$‑refinement формула для $\\mathrm{PARITY}$ имеет глубину $\\le 3d+1$ и размер $\\prod_{i=1}^d (2^{t_i+1}t_i)$.
  2) (Нижняя оценка для этого построения.) Так как $\\prod_{i=1}^d (2^{t_i+1}t_i)\\ge \\prod_i 2^{t_i}=2^{\\sum_i t_i}$, достаточно оценить сумму.
     По AM–GM: если $t_i\\ge 1$ и $\\prod_i t_i\\ge n$, то $\\frac1d\\sum_i t_i\\ge (\\prod_i t_i)^{1/d}\\ge n^{1/d}$, значит $\\sum_i t_i\\ge d\\,n^{1/d}$ и
     $$\\mathrm{size}\\ge 2^{\\sum_i t_i}\\ge 2^{d\\,n^{1/d}}.$$
  3) (Верхняя оценка.) Возьмём $t_i:=\\lceil n^{1/d}\\rceil$. Тогда $\\prod_i t_i\\ge n$, и
     $$\\mathrm{size}=\\prod_i (2^{t_i+1}t_i)=2^{O(d\\,n^{1/d})}\\cdot (n^{1/d}+1)^d=2^{O(d\\,n^{1/d})}\\cdot\\mathrm{poly}(n).$$
  4) (Порог $d\\approx\\log n/\\log\\log n$.) Тогда $n^{1/d}=2^{(\\log_2 n)/d}=2^{\\Theta(\\log\\log n)}=\\mathrm{polylog}(n)$, и экспонента
     $$d\\,n^{1/d}=\\Theta\\Bigl(\\frac{\\log n}{\\log\\log n}\\cdot\\log n\\Bigr)=\\Theta\\Bigl(\\frac{\\log^2 n}{\\log\\log n}\\Bigr),$$
     т.е. $\\mathrm{size}=2^{\\Theta(\\log^2 n/\\log\\log n)}=n^{\\Theta(\\log n/\\log\\log n)}$ (quasi‑poly).
- `Toy‑тест:` пусть $n=2^{256}$, $d=\\lfloor 256/8\\rfloor=32$. Тогда $n^{1/d}=2^8=256$ и нижняя оценка даёт $\\mathrm{size}\\ge 2^{32\\cdot 256}=2^{8192}$, тогда как любой $n^C$ имеет вид $2^{256C}$.
- `Статус:` доказано (ограничение техники: GIRS’19 Lemma 21/Claim 28 используют parity‑представление размера $\\exp(\\Theta(d\\,n^{1/d}))$, что не достигает порога $d\\approx\\log n/\\log\\log n$ без новых идей).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` выяснить, существует ли в литературе «доказуемое в bounded‑depth Frege» представление паритета без множителя $d$ в экспоненте (в духе Håstad–Risse §1.2), или есть известный lower bound/барьер, запрещающий синтаксическую симуляцию XOR‑сложения на глубине $\\Theta(\\log n/\\log\\log n)$.

### 16.130. Исследовательский шаг: XOR‑сложение уравнений становится лёгким, если все уравнения записаны как паритет по $k$ «блок‑паритетам» одного фиксированного разбиения

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть множество переменных $X$ разбито на непересекающиеся блоки $X=\\biguplus_{i=1}^k B_i$.
  Для каждого $i$ пусть $P_i(x_{B_i})$ — формула глубины $\\le d_0$ и размера $\\mathrm{poly}(n)$, вычисляющая паритет на $B_i$ (т.е. $P_i=1\\iff \\bigoplus_{x\\in B_i}x=1$).
  Для $I\\subseteq[k]$ и $b\\in\\{0,1\\}$ обозначим
  $$E^{\\mathrm{blk}}(I,b)\\ :=\\ \\Bigl(\\bigoplus_{i\\in I} y_i=b\\Bigr)$$
  как **DNF‑формулу** на абстрактных переменных $y_1,\\dots,y_k$ (полная DNF паритета на $I$, размера $\\Theta(2^{|I|-1}|I|)$).
  Тогда для любых $I_1,I_2\\subseteq[k]$ и $b_1,b_2\\in\\{0,1\\}$ существует bounded‑depth Frege‑вывод глубины $O(1)$ и размера $2^{O(k)}$, доказывающий
  $$E^{\\mathrm{blk}}(I_1,b_1)\\wedge E^{\\mathrm{blk}}(I_2,b_2)\\ \\to\\ \\ E^{\\mathrm{blk}}(I_1\\triangle I_2,\\ b_1\\oplus b_2).$$
  Подстановкой $y_i\\mapsto P_i$ получаем polynomial‑size depth‑$O(d_0)$ Frege‑вывод XOR‑шага для уравнений, которые являются **объединениями блоков** одного и того же разбиения:
  $$E(S_{I_1},b_1),\\ E(S_{I_2},b_2)\\ \\vdash\\ E(S_{I_1\\triangle I_2},\\ b_1\\oplus b_2),\\qquad S_I:=\\bigcup_{i\\in I} B_i.$$
  В частности, если $k=O(\\log n)$ и $|P_i|=\\mathrm{poly}(n)$, то один XOR‑шаг имеет polynomial‑size bounded‑depth Frege‑доказательство.
- `Доказательство:`
  1) На уровне $y$‑переменных импликация — тавтология (линейность паритета по $\\mathbb F_2$). По Lemma 4 (GIRS’19, `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`, p. 4),
     если формула зависит от $k$ переменных, то из семантической импликации следует derivation размера $\\le 2^k\\bigl(|\\psi_1|^2+|\\psi_2|^2\\bigr)=2^{O(k)}$ при той же глубине.
  2) Подстановка: в любой Frege‑системе, где аксиомы/правила заданы как схемы, подстановка $y_i\\mapsto P_i$ в каждую строку доказательства даёт доказательство подстановочной формулы.
     Глубина увеличивается на $O(d_0)$, а суммарный размер — не более чем на множитель $O(\\max_i |P_i|)$ (каждое вхождение $y_i$ заменяется формулой $P_i$).
- `Toy‑тест:` $k=3$, $I_1=\\{1,2\\}$, $I_2=\\{2,3\\}$: из $y_1\\oplus y_2=b_1$ и $y_2\\oplus y_3=b_2$ следует $y_1\\oplus y_3=b_1\\oplus b_2$ (cимм. разность убирает $y_2$).
- `Статус:` доказано (условный «easy case»: XOR‑шаг тривиализуется при фиксированном блок‑разбиении и малом $k$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` понять, можно ли для column‑summing стратегии на grid держать все промежуточные уравнения в виде union‑of‑blocks одного разбиения с $k=\\mathrm{polylog}(n)$ (и при этом выводить сами блок‑паритеты без «скрытого» Gaussian elimination), или это ломается и требует переходов между разбиениями.

### 16.131. Исследовательский шаг: фиксированный «block‑basis» не может покрыть column‑summing на grid при $k=\\mathrm{polylog}(n)$ (ранг $=\\Omega(n)$)

- `Линза:` Коммуникация/ранг.
- `Утверждение:` Рассмотрим $n\\times n$ grid и пусть $H_j$ — множество из $n$ горизонтальных рёбер между колонками $j$ и $j+1$ (для $j=1,\\dots,n-1$).
  Тогда множества $H_1,\\dots,H_{n-1}$ линейно независимы в $\\mathbb F_2^{E}$ (как характеристические векторы), и поэтому:
  если фиксирован набор $k$ подмножеств рёбер $B_1,\\dots,B_k\\subseteq E$, то одновременно представить **все** $H_j$ как симметрические разности
  $$H_j=\\bigtriangleup_{i\\in I_j} B_i$$
  возможно только при $k\\ge n-1$.
  В частности, попытка применить §16.130 к column‑summing с одним фиксированным block‑representation требует $k=\\Omega(n)$ и потому не даёт polynomial‑size (так как $2^{O(k)}$ становится экспоненциальным).
- `Доказательство:` так как множества $H_j$ попарно непересекаются, они независимы:
  если $\\bigtriangleup_{j\\in J} H_j=\\varnothing$, то для любого $e\\in H_{j_0}$ (где $j_0\\in J$) этот $e$ встречается в симм. разности ровно один раз (только из $H_{j_0}$), противоречие. Значит $J=\\varnothing$ и $\\{H_j\\}$ независимы.
  Следовательно, подпространство $\\langle H_1,\\dots,H_{n-1}\\rangle\\subseteq\\mathbb F_2^{E}$ имеет размерность $n-1$.
  Если же каждый $H_j$ лежит в линейной оболочке $\\langle B_1,\\dots,B_k\\rangle$, то
  $$n-1=\\dim\\langle H_1,\\dots,H_{n-1}\\rangle\\le \\dim\\langle B_1,\\dots,B_k\\rangle\\le k,$$
  откуда $k\\ge n-1$.
- `Toy‑тест:` при $n=4$ есть три непересекающихся сета $H_1,H_2,H_3$; значит любой фиксированный набор $B_1,\\dots,B_k$, порождающий все $H_j$, должен иметь $k\\ge 3$.
- `Статус:` контрпример к наивной идее «закрыть Q39 через один фиксированный block‑basis + §16.130» (нужны переходы между разбиениями/базисами).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` формализовать, какой именно «base‑change» требуется в стратегии Håstad–Risse, и свести его к синтаксической задаче: доказать/опровергнуть возможность эффективно переводить bounded‑depth представления паритета между двумя (существенно разными) разбиениями при глубине $\\Theta(\\log n/\\log\\log n)$.

### 16.132. Исследовательский шаг: наивный base‑change через общее уточнение двух разбиений даёт blow‑up $k\\mapsto k^2$ ⇒ при $k=\\Theta(\\log n)$ получается quasi‑poly

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $U$ — множество переменных (или рёбер), а $\\mathcal P,\\mathcal Q$ — разбиения $U$ на $k$ блоков каждое.
  Рассмотрим «block‑representation» из §16.130: формулы для паритетов блоков и уравнения вида «паритет на объединении некоторых блоков равен $b$».
  Тогда любой «перевод» между представлениями относительно $\\mathcal P$ и $\\mathcal Q$ можно свести к общему уточнению
  $$\\mathcal R:=\\{P\\cap Q:\\ P\\in\\mathcal P,\\ Q\\in\\mathcal Q,\\ P\\cap Q\\ne\\varnothing\\},$$
  причём $|\\mathcal R|\\le k^2$ и каждое множество, являющееся объединением блоков $\\mathcal P$ (или $\\mathcal Q$), автоматически является объединением блоков $\\mathcal R$.
  Следовательно, если пытаться реализовать base‑change исключительно через §16.130 (т.е. через «абстрактное» доказательство размера $2^{O(|\\mathcal R|)}$ на переменных $y_R$ и подстановку $y_R\\mapsto \\mathrm{PARITY}(R)$), то базовый верхний предел на стоимость такого шага имеет вид
  $$2^{O(|\\mathcal R|)}\\le 2^{O(k^2)}.$$
  В частности, при $k=\\Theta(\\log n)$ это уже $2^{\\Theta(\\log^2 n)}=n^{\\Theta(\\log n)}$ (quasi‑poly), так что «универсальный» base‑change через уточнение не сохраняет polynomial‑size.
- `Доказательство:`
  1) (Общее уточнение.) Для любых разбиений $\\mathcal P,\\mathcal Q$ семейство $\\mathcal R$ выше — разбиение $U$ (на непустые попарно непересекающиеся множества), и по определению каждый блок $P\\in\\mathcal P$ раскладывается в дизъюнктное объединение блоков $P\\cap Q$ при $Q\\in\\mathcal Q$; аналогично для каждого $Q\\in\\mathcal Q$.
  2) (Оценка числа блоков.) Так как пар $P\\cap Q$ не больше, чем $k\\cdot k$, получаем $|\\mathcal R|\\le k^2$.
  3) (Худший случай достигается.) Пусть $U=[k]\\times[k]$. Возьмём $\\mathcal P$ как разбиение по строкам $P_i:=\\{i\\}\\times[k]$ и $\\mathcal Q$ как разбиение по столбцам $Q_j:=[k]\\times\\{j\\}$. Тогда каждое пересечение $P_i\\cap Q_j$ — одноточечное множество, значит $|\\mathcal R|=k^2$.
  4) (Стоимость «через §16.130».) В §16.130 абстрактный XOR‑вывод на $k$ блок‑переменных оценивается как $2^{O(k)}$ (по сути, перебор таблицы истинности). Если наивно привести две несовместимые block‑representations к общей $\\mathcal R$ и дальше работать абстрактно, то количество блок‑переменных становится $|\\mathcal R|$, и оценка превращается в $2^{O(|\\mathcal R|)}\\le 2^{O(k^2)}$.
- `Toy‑тест:` если $k=\\lfloor\\log_2 n\\rfloor$, то $2^{O(k^2)}=2^{O(\\log^2 n)}=n^{O(\\log n)}$, т.е. даже один «универсальный» base‑change такого типа уже может уничтожить цель $n^{O(1)}$.
- `Статус:` доказано (барьер метода: динамические разбиения действительно нужны, но «перевод через общее уточнение» в худшем случае квадратично раздувает число блоков и приводит к quasi‑poly при $k=\\Theta(\\log n)$).
- `Барьер‑чек:` r — неприменимо (вопрос о синтаксической цене внутри Frege, не оракулы), NP — неприменимо (не про алгоритмы решения SAT), alg — неприменимо (не про арифметизацию/алгебраизацию моделей).
- `Следующий шаг:` найти «структурный» base‑change, который для нужных промежуточных разбиений на grid избегает blow‑up $k\\to k^2$ (например, цепочка контролируемых refinement/coarsening, где каждое преобразование имеет поддержку $O(1)$ или $O(\\log n)$ на абстрактном уровне), или показать, что в стратегии Håstad–Risse неизбежно появляются пары разбиений с $|\\mathcal P\\wedge\\mathcal Q|=\\Omega(k^2)$.

### 16.133. Исследовательский шаг: для interval‑partition на $[m]$ общее уточнение имеет размер $\\le k_1+k_2-1$ (нет квадратичного blow‑up)

- `Линза:` Инвариант.
- `Утверждение:` Пусть $U=[m]=\\{1,\\dots,m\\}$ с фиксированным порядком. Назовём разбиение $\\mathcal P$ **interval‑partition**, если каждый блок — отрезок $[a,b]\\cap\\mathbb Z$.
  Тогда для любых двух interval‑partition $\\mathcal P,\\mathcal Q$ с $|\\mathcal P|=k_1$, $|\\mathcal Q|=k_2$ их общее уточнение удовлетворяет
  $$|\\mathcal P\\wedge\\mathcal Q|\\le k_1+k_2-1.$$
  Следовательно, «универсальный» base‑change из §16.132 через общее уточнение даёт лишь линейный рост числа блоков, если все разбиения совместимы с одним и тем же 1‑мерным порядком.
- `Доказательство:` interval‑partition однозначно задаётся множеством разрезов
  $$C(\\mathcal P)\\subseteq\\{1,\\dots,m-1\\},\\qquad i\\in C(\\mathcal P)\\iff i,i+1\\text{ лежат в разных блоках }\\mathcal P.$$
  Тогда $|\\mathcal P|=|C(\\mathcal P)|+1$.
  Для двух interval‑partition общее уточнение $\\mathcal P\\wedge\\mathcal Q$ имеет разрезы ровно в точках
  $$C(\\mathcal P\\wedge\\mathcal Q)=C(\\mathcal P)\\cup C(\\mathcal Q),$$
  потому что новое разбиение должно резать везде, где режет хотя бы одно из исходных, и больше нигде (иначе нарушится максимальность блоков‑отрезков).
  Значит
  $$|\\mathcal P\\wedge\\mathcal Q|=|C(\\mathcal P)\\cup C(\\mathcal Q)|+1\\le |C(\\mathcal P)|+|C(\\mathcal Q)|+1=(k_1-1)+(k_2-1)+1=k_1+k_2-1.$$
- `Toy‑тест:` пусть $m=6$, $\\mathcal P=(\\{1,2\\},\\{3,4\\},\\{5,6\\})$ ($k_1=3$) и $\\mathcal Q=(\\{1\\},\\{2,3\\},\\{4,5\\},\\{6\\})$ ($k_2=4$).
  Тогда $|\\mathcal P\\wedge\\mathcal Q|=6=k_1+k_2-1$ (граница точна).
- `Статус:` доказано (позитивный «structural case»: квадратичный blow‑up из §16.132 возникает только при «поперечных» разбиениях; для 1D‑совместимых разбиений уточнение линейно).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли в стратегии Håstad–Risse для grid выбрать все необходимые block‑representations так, чтобы разбиения были (приближённо) 1D‑совместимы с одним порядком на рёбрах/переменных; иначе найти место, где неизбежно требуется «поперечный» переход типа row↔column (и тогда §16.132 снова даёт quasi‑poly барьер).

### 16.134. Исследовательский шаг: в column‑summing на grid промежуточные XOR‑уравнения соответствуют границе прямоугольника и разбиваются на $O(1)$ row‑interval сегментов (поэтому $k^2$‑барьер §16.132 локально не срабатывает)

- `Линза:` Эквивалентность.
- `Утверждение:` Рассмотрим $n\\times n$ grid с вершинами $(i,j)$, $1\\le i,j\\le n$, и переменными $x_e$ на рёбрах.
  Зафиксируем внутреннюю колонку $2\\le j\\le n-1$ и для $t\\in[n]$ обозначим
  $$R_{j,t}:=\\{(i,j):1\\le i\\le t\\}$$
  (первые $t$ вершин колонки $j$) и $\\delta(R_{j,t})$ — множество рёбер, имеющих ровно один конец в $R_{j,t}$.
  Тогда XOR‑сумма вершинных Tseitin‑уравнений по вершинам $R_{j,t}$ равна одному уравнению
  $$E\\bigl(\\delta(R_{j,t}),\\ \\bigoplus_{v\\in R_{j,t}}\\chi(v)\\bigr).$$
  Более того, $\\delta(R_{j,t})$ раскладывается в дизъюнктное объединение не более чем четырёх «row‑interval» сегментов:
  - $L_{j,t}$: горизонтальные рёбра между колонками $j-1$ и $j$ на строках $1..t$,
  - $H_{j,t}$: горизонтальные рёбра между колонками $j$ и $j+1$ на строках $1..t$,
  - $T_{j}$: одно вертикальное ребро над $(1,j)$ (если $(1,j)$ не на верхней границе),
  - $B_{j,t}$: одно вертикальное «фронтирное» ребро между $(t,j)$ и $(t+1,j)$ (если $t<n$).
  Следовательно, в этой конкретной линейной стратегии все промежуточные уравнения имеют представление как паритет по $k=O(1)$ disjoint‑блокам, согласованным с одним 1D‑порядком по строкам.
- `Доказательство:`
  1) (Граница как XOR‑сумма.) При XOR‑суммировании вершинных уравнений по $R_{j,t}$ каждое внутреннее ребро (оба конца в $R_{j,t}$) входит в левую часть ровно два раза и сокращается по модулю 2, а каждое ребро с ровно одним концом в $R_{j,t}$ входит ровно один раз. Поэтому левая часть равна паритету по $\\delta(R_{j,t})$, а правая часть равна $\\bigoplus_{v\\in R_{j,t}}\\chi(v)$.
  2) (Геометрия $\\delta(R_{j,t})$.) Для множества вершин «префикса колонки» возможные рёбра, выходящие из $R_{j,t}$, бывают трёх типов:
     - горизонтальные влево/вправо из строк $1..t$ (дают два row‑interval сегмента $L_{j,t},H_{j,t}$);
     - вертикальные вверх из вершины $(1,j)$ и вниз из вершины $(t,j)$ (дают $\\le 2$ отдельных ребра $T_j,B_{j,t}$).
     Других рёбер, инцидентных вершинам $R_{j,t}$, нет.
- `Toy‑тест:` $n=4$, $j=2$, $t=2$.
  Тогда $\\delta(R_{2,2})$ состоит из двух горизонтальных сегментов длины 2 (между (i,1)-(i,2) и (i,2)-(i,3) для $i=1,2$) и одного вертикального ребра (2,2)-(3,2) (плюс верхнее, если считать внешнюю «рамку»).
- `Статус:` доказано (уточнение: для самой column‑summing стратегии множества переменных не создают «поперечных» разбиений; технический узел — не combinatorial $k^2$‑blow‑up, а синтаксическая возможность переходить между формулами паритета для растущих сегментов).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` выделить минимальную «локальную» подзадачу: для row‑interval $I=[1..t]$ понять, можно ли в bounded‑depth Frege при $d=\\Theta(\\log n/\\log\\log n)$ полиномиально доказывать корректность склейки
  $$\\mathrm{PARITY}(I\\cup\\{e\\})\\leftrightarrow \\bigl(\\mathrm{PARITY}(I)\\oplus x_e\\bigr)$$
  (и аналогично для сдвига фронтира), т.е. base‑change между формулами паритета для соседних интервалов.

### 16.135. Исследовательский шаг: даже для 1D‑префиксов фиксированный block‑basis требует $k=\\Omega(n)$ (ранг $n$)

- `Линза:` Коммуникация/ранг.
- `Утверждение:` Пусть $e_1,\\dots,e_n$ — попарно различные переменные (например, горизонтальные рёбра между фиксированными колонками $j$ и $j+1$ на строках $1..n$).
  Для $t\\in[n]$ обозначим префиксное множество
  $$L_t:=\\{e_1,\\dots,e_t\\}.$$
  Тогда в $\\mathbb F_2^{\\{e_1,\\dots,e_n\\}}$ множества $L_1,\\dots,L_n$ линейно независимы, а значит:
  если фиксирован набор $k$ подмножеств $B_1,\\dots,B_k$ и каждый $L_t$ представим как симметрическая разность
  $$L_t=\\bigtriangleup_{i\\in I_t} B_i,$$
  то обязательно $k\\ge n$.
  В частности, любая попытка держать в column‑summing один фиксированный малый базис «segment blocks», покрывающий **все** префиксы $[1..t]$, обречена (даже в 1D), и base‑change/динамические разбиения неизбежны.
- `Доказательство:` рассмотрим характеристические векторы $\\mathbf 1_{L_t}\\in\\mathbb F_2^n$ относительно базиса $e_1,\\dots,e_n$.
  Имеем тождество
  $$\\{e_t\\}=L_t\\triangle L_{t-1}\\qquad (t\\ge 2),$$
  и $\\{e_1\\}=L_1$. Следовательно, линейная оболочка $\\langle L_1,\\dots,L_n\\rangle$ содержит все одноэлементные множества $\\{e_t\\}$, значит имеет размерность $n$.
  Так как векторов $L_t$ ровно $n$, они линейно независимы.
  Отсюда, если все $L_t$ лежат в $\\langle B_1,\\dots,B_k\\rangle$, то
  $$n=\\dim\\langle L_1,\\dots,L_n\\rangle\\le \\dim\\langle B_1,\\dots,B_k\\rangle\\le k.$$
- `Toy‑тест:` $n=3$: $L_1=(1,0,0)$, $L_2=(1,1,0)$, $L_3=(1,1,1)$ — независимы (матрица верхнетреугольная с единицами на диагонали).
- `Статус:` доказано (барьер: «фиксированный малый базис для всех префиксов» невозможен уже в 1D; значит даже при структуре §16.134 узел остаётся в динамическом base‑change, а не в выборе единого базиса).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` разбирать base‑change не как «общий перевод между двумя произвольными разбиениями», а как локальные операции на границе (добавить/удалить один $e_t$) и искать, может ли bounded‑depth Frege реализовать такую локальную трансформацию на формулах паритета без накапливания глубины/квази‑поли blow‑up.

### 16.136. Исследовательский шаг: каноническая dyadic‑разбивка префикса $[t]$ даёт $\\le \\lfloor\\log_2 t\\rfloor+1$ блоков и обновляется за $O(\\log n)$ слияниями

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Для каждого $t\\in[n]$ существует разбиение префикса $[t]=\\{1,\\dots,t\\}$ на попарно непересекающиеся интервалы
  $$[t]=I_1\\uplus I_2\\uplus\\cdots\\uplus I_r,$$
  где каждый $I_j$ имеет длину степень двойки, и
  $$r\\le \\lfloor\\log_2 t\\rfloor+1.$$
  Более того, можно выбрать **каноническую** такую разбивку (через двоичную запись $t$), обладающую свойством обновления:
  переход $t\\mapsto t+1$ преобразует разбивку $[t]$ в разбивку $[t+1]$ последовательностью операций
  «добавить singleton $[t+1,t+1]$» и затем $\\le \\lfloor\\log_2 n\\rfloor+1$ раз применить
  $$J\\uplus J'\\mapsto J\\cup J'$$
  к двум соседним интервалам одинаковой длины (слияние в интервал вдвое большей длины).
- `Доказательство:`
  1) (Существование и оценка на $r$.) Запишем $t$ в двоичном виде
     $$t=\\sum_{a\\in A}2^a,\\qquad A\\subseteq\\{0,1,\\dots,\\lfloor\\log_2 t\\rfloor\\}.$$
     Переберём $a\\in A$ по убыванию и последовательно положим
     $$I_1=[1,2^{a_1}],\\ I_2=[2^{a_1}+1,2^{a_1}+2^{a_2}],\\ \\dots$$
     Тогда интервалы попарно не пересекаются, их объединение равно $[t]$, а $r=|A|\\le \\lfloor\\log_2 t\\rfloor+1$.
  2) (Каноничность и обновление.) Добавление 1 к двоичному числу $t$ меняет суффикс вида $\\underbrace{11\\cdots 1}_{s}\\mapsto 0\\cdots 0$ и увеличивает следующий бит.
     В терминах разбивки это означает: при переходе $t\\to t+1$ сначала добавляется новый интервал длины 1, а затем для каждого «переноса»
     сливаются две соседние dyadic‑части одинаковой длины в одну часть удвоенной длины. Число переносов равно числу подряд идущих единиц в конце двоичной записи $t$,
     поэтому не превосходит $\\lfloor\\log_2 n\\rfloor+1$.
- `Toy‑тест:` $t=13=8+4+1$: $[13]=[1,8]\\uplus[9,12]\\uplus[13,13]$.
  Тогда $t+1=14=8+4+2$: добавляем $[14,14]$ и сливаем $[13,13]$ с $[14,14]$ в $[13,14]$, получая
  $[14]=[1,8]\\uplus[9,12]\\uplus[13,14]$.
- `Статус:` доказано (канонический способ держать префиксы с $O(\\log n)$ блоками и локальными merge‑операциями).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` свести «локальный base‑change» для row‑interval’ов к одному типу операции: показать/опровергнуть, что bounded‑depth Frege может полиномиально выводить корректность merge
  $$\\mathrm{PARITY}(J)=b_1,\\ \\mathrm{PARITY}(J')=b_2\\ \\vdash\\ \\mathrm{PARITY}(J\\cup J')=b_1\\oplus b_2$$
  для двух соседних дизъюнктных интервалов одинаковой длины (и затем итеративно поддерживать префиксную стратегию).

### 16.137. Исследовательский шаг: merge‑правило для дизъюнктных блоков сводится к «easy case» §16.130, если принять representation паритета на каждом блоке как атом

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть множество переменных $X$ разбито на дизъюнктные блоки $B_1\\uplus\\cdots\\uplus B_k$.
  Для каждого $i$ пусть $P_i(x_{B_i})$ — формула, вычисляющая паритет на $B_i$ (то есть $P_i=1\\iff\\bigoplus_{x\\in B_i}x=1$), и считаем, что обе полярности доступны как $P_i$ и $\\neg P_i$.
  Тогда для любых дизъюнктных объединений блоков
  $$S_{I}:=\\bigcup_{i\\in I}B_i\\qquad (I\\subseteq[k])$$
  и любых $I_1,I_2\\subseteq[k]$ имеем polynomial‑size bounded‑depth Frege‑вывод
  $$E(S_{I_1},b_1),\\ E(S_{I_2},b_2)\\ \\vdash\\ E(S_{I_1\\triangle I_2},\\ b_1\\oplus b_2)$$
  размера $2^{O(k)}$ и глубины $O(\\max_i\\depth(P_i))$.
  В частности, для merge двух соседних интервалов одинаковой длины (dyadic‑merge из §16.136) достаточно взять $k=2$ и получить константный по $k$ вывод:
  $$\\mathrm{PARITY}(J)=b_1,\\ \\mathrm{PARITY}(J')=b_2\\ \\vdash\\ \\mathrm{PARITY}(J\\cup J')=b_1\\oplus b_2.$$
- `Доказательство:` это прямое применение §16.130:
  1) На абстрактных переменных $y_1,\\dots,y_k$, где $y_i$ означает «паритет блока $B_i$ равен 1», формулы $E^{\\mathrm{blk}}(I,b)$ (полная DNF на $y$) зависят только от $k$ переменных и семантически реализуют линейность XOR.
     Поэтому тавтология
     $$E^{\\mathrm{blk}}(I_1,b_1)\\wedge E^{\\mathrm{blk}}(I_2,b_2)\\to E^{\\mathrm{blk}}(I_1\\triangle I_2,b_1\\oplus b_2)$$
     имеет bounded‑depth Frege‑вывод размера $2^{O(k)}$ (Lemma 4 из GIRS’19, как в §16.130).
  2) Подстановкой $y_i\\mapsto P_i$ получаем вывод на исходных переменных. Так как блоки дизъюнктны, семантически
     $$\\bigoplus_{i\\in I} y_i\\ =\\ \\bigoplus_{x\\in S_I} x,$$
     то подстановочная формула действительно представляет уравнение $E(S_I,b)$.
- `Toy‑тест:` $k=2$: из $y_1=b_1$ и $y_2=b_2$ следует $y_1\\oplus y_2=b_1\\oplus b_2$; подстановка даёт merge для двух дизъюнктных блоков.
- `Статус:` частично (локальная формализация: merge становится «лёгким», если **уже есть** формулы $P_i$ для паритетов блоков и мы разрешаем представлять уравнения как DNF по этим $P_i$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` закрыть разрыв «representation vs proof»: в стратегии Håstad–Risse паритеты блоков $P_i$ существуют (как small depth‑$d$ формулы), но нужен способ **переиспользовать** их в последовательности шагов без накопления базы/без роста числа блоков; формально: можно ли держать все промежуточные уравнения как $E^{\\mathrm{blk}}(I,b)$ над текущим набором блок‑паритетов так, чтобы каждый шаг менял $k$ лишь на $O(1)$ и сохранял $2^{O(k)}=\\mathrm{poly}(n)$?

### 16.138. Исследовательский шаг: в Schoenfield‑Frege подстановка фиксирует отрицание синтаксически ($\\sigma(\\neg p)=\\neg\\sigma(p)$), поэтому «две отдельные OR‑формулы для паритета и его отрицания» не образуют пару литералов

- `Линза:` Сжатие/канонизация.
- `Утверждение:` В Schoenfield‑Frege (Håstad–Risse’25, §2.1; `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`) применение правила — это подстановка $\\sigma$ в схему вывода,
  и для любой переменной $p$ выполняется тождество **синтаксической** подстановки
  $$\\sigma(\\neg p)=\\neg\\sigma(p).$$
  Следовательно, нельзя «встроить» в одно применение правила пару формул $P(x),N(x)$ так, чтобы $P$ играла роль литерала $p$, а $N$ — роль литерала $\\neg p$, если только $N$ **буквально** не равна $\\neg P$ как формула.
  Это проясняет разрыв в Håstad–Risse’25, §1.2: там «PARITY и $\\neg$PARITY» на блоке представлены **двумя** малыми depth‑$d$ формулами с выходным $\\vee$,
  но сами правила Frege обращаются с отрицанием только как с *синтаксическим* $\\neg$ (а не как с «любым эквивалентным представителем отрицания»), поэтому такая пара не даёт автоматически Cut/резольвинг на уровне блоков без потери глубины.
- `Доказательство:` по определению (Håstad–Risse’25, §2.1) если в схеме правила встречаются одновременно $p$ и $\\neg p$, то после подстановки получаем одновременно $\\sigma(p)$ и $\\sigma(\\neg p)=\\neg\\sigma(p)$.
  Поэтому если хотим реализовать «$p\\mapsto P$ и $\\neg p\\mapsto N$», необходимо $N=\\neg P$ как формула. Для произвольной пары семантически противоположных формул это неверно.
- `Toy‑тест:` для 1‑переменной $P(x)=x$ и $N(x)=\\neg x$ имеем $N=\\neg P$, и подстановка действительно согласует обе полярности.
  Но уже для 2‑переменной паритетной пары можно взять
  $P(x,y)=(x\\wedge\\neg y)\\vee(\\neg x\\wedge y)$ и $N(x,y)=(x\\wedge y)\\vee(\\neg x\\wedge\\neg y)$ (оба с выходным $\\vee$);
  тогда $N\\not\\equiv_{\\text{synt}} \\neg P$, и одной подстановкой нельзя заставить $N$ играть роль «$\\neg P$» в экземплярах правил.
- `Статус:` доказано (точная «синтаксическая» причина, почему representation «PARITY + $\\neg$PARITY как две OR‑формулы» не автоматически даёт возможность делать Cut‑шаги на этих представителях без выхода за глубину).
- `Барьер‑чек:` r — неприменимо (это чисто синтаксическое свойство Frege‑правил), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли для конкретных HR‑представителей PARITY построить в bounded‑depth Frege **полиномиальные** доказательства эквивалентностей вида $N\\leftrightarrow\\neg P$ без выхода за глубину $d$ (или зафиксировать, что такой «negation‑normalization» сам стоит quasi‑poly и тем самым объясняет, почему §1.2 даёт лишь representation).

### 16.139. Исследовательский шаг: если для block‑паритетов доказуема «согласованность полярностей» $N_i\\leftrightarrow\\neg P_i$, то «representation» Håstad–Risse превращается в реальный подстановочный Frege‑шаг

- `Линза:` Двойственность/комплементы.
- `Утверждение:` Пусть $X=\\biguplus_{i=1}^k B_i$ — разбиение на дизъюнктные блоки, и заданы формулы $P_i(x_{B_i})$ и $N_i(x_{B_i})$ глубины $\\le d_0$, такие что семантически $N_i\\equiv\\neg P_i$.
  Предположим, что в bounded‑depth Frege (глубины $O(d_0)$) существует polynomial‑size вывод **согласованности**
  $$\\mathrm{Cons}_i:\\qquad N_i\\leftrightarrow\\neg P_i\\qquad (i\\in[k]).$$
  Тогда любой «абстрактный» вывод на переменных $y_1,\\dots,y_k$ (где $y_i$ означает «паритет $B_i$ равен 1») можно реализовать на исходных переменных так, чтобы
  положительная полярность $y_i$ интерпретировалась как $P_i$, а отрицательная $\\neg y_i$ — как $N_i$, с полиномиальным blow‑up по размеру и без выхода за глубину $O(d_0)$.
  В частности, tautология из §16.130 (и «easy case» merge из §16.137) остаётся polynomial‑size выводимой при такой dual‑rail интерпретации.
- `Доказательство:` берём bounded‑depth Frege‑вывод $\\pi$ tautологии на $y$‑переменных из §16.130:
  $$E^{\\mathrm{blk}}(I_1,b_1)\\wedge E^{\\mathrm{blk}}(I_2,b_2)\\to E^{\\mathrm{blk}}(I_1\\triangle I_2,b_1\\oplus b_2).$$
  1) Подстановкой $y_i\\mapsto P_i$ получаем вывод $\\pi'$ той же импликации, но с отрицательными литералами в виде $\\neg P_i$ (см. §16.130).
  2) Для каждого $i$ из $\\mathrm{Cons}_i$ и правила «замены эквивалентных» (локально: из $A\\leftrightarrow B$ выводимо $\\neg A\\leftrightarrow\\neg B$ и $(A\\vee C)\\leftrightarrow (B\\vee C)$; эти тавтологии зависят от $O(1)$ атомов и потому имеют константные bounded‑depth Frege‑выводы, как в §16.130) получаем, что можно **внутри любой формулы‑контекста** заменить каждое вхождение $\\neg P_i$ на $N_i$, сохраняя выводимость и увеличивая размер не более чем полиномиально от размера контекста.
  Применяя это ко всем литералам в $E^{\\mathrm{blk}}$ (размер $2^{O(k)}$), получаем требуемый вывод с полярностями $(P_i,N_i)$.
- `Toy‑тест:` $k=1$. Абстрактный шаг: из $y=0$ выводится $\\neg y=1$ (и наоборот) — это просто исключённое третье. После подстановки получаем $P_1=0\\vdash \\neg P_1=1$, а затем по $\\mathrm{Cons}_1$ можно заменить $\\neg P_1$ на $N_1$.
- `Статус:` доказано (редукция: центральный узел — цена доказательства $N_i\\leftrightarrow\\neg P_i$; без неё «двухформульное» representation из HR §1.2 не становится подстановочной симуляцией).
- `Барьер‑чек:` r — неприменимо (свойство синтаксической симуляции в фиксированном proof system), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для HR‑конструкции PARITY/$\\neg$PARITY на блоке попытаться либо (a) построить poly‑size bounded‑depth вывод $N\\leftrightarrow\\neg P$ (т.е. «consistency axiom»), либо (b) выявить место, где такой вывод должен стоить quasi‑poly и тем самым объясняет «representation, not proof» из §1.2.

### 16.140. Исследовательский шаг: «запас по глубине» убирает нужду в отдельной OR‑формуле для $\\neg\\mathrm{PARITY}$ — можно использовать синтаксическое $\\neg P$ (и при желании OR‑выход через добавление $\\bot$)

- `Линза:` Трейд‑офф.
- `Утверждение:` В Schoenfield‑языке $\\{\\vee,\\neg\\}$ (Håstad–Risse’25, §2.1) глубина формулы — число чередований $\\vee/\\neg$ на пути.
  Тогда для любой формулы $A$ выполняется
  $$\\depth(\\neg A)\\le \\depth(A)+1.$$
  Следовательно, если в bounded‑depth Frege мы умеем представлять block‑паритет формулой $P$ глубины $\\le d-1$, то обе полярности доступны **синтаксически** в глубине $\\le d$ как $P$ и $\\neg P$, и подстановочные шаги типа §16.130–§16.137 не требуют отдельной формулы $N$ и отдельного вывода $N\\leftrightarrow\\neg P$.
  Если же для конкретного «клауза‑стиля» нужно, чтобы литерал имел выход $\\vee$, можно заменить $\\neg P$ на
  $$N:=\\neg P\\vee\\bot,$$
  и тогда $N$ имеет выход $\\vee$, а тавтология $N\\leftrightarrow\\neg P$ имеет константный Frege‑вывод (по подстановке в схему $(\\neg p\\vee\\bot)\\leftrightarrow\\neg p$).
  Цена по глубине при таком «OR‑обёртывании» — $\\depth(N)\\le \\depth(P)+2$.
- `Доказательство:` добавление одного верхнего $\\neg$ к формуле либо добавляет один новый блок чередования (если корень $A$ — $\\vee$), либо не меняет число чередований (если корень $A$ — $\\neg$), поэтому $\\depth(\\neg A)\\le\\depth(A)+1$.
  Для $N:=\\neg P\\vee\\bot$ глубина увеличивается ещё максимум на 1 из‑за верхнего $\\vee$.
  Эквивалентность $N\\leftrightarrow\\neg P$ — экземпляр фиксированной тавтологии на одном атоме, значит имеет bounded‑depth Frege‑вывод размера $O(1)$, а подстановка даёт вывод для произвольного $P$.
- `Toy‑тест:` $A=p\\vee q$ имеет $\\depth(A)=1$, а $\\neg A$ имеет $\\depth=2$.
  Если $A=\\neg p$, то $\\neg A=\\neg\\neg p$ и число чередований не растёт.
- `Статус:` доказано (формально: «негативная полярность» не требует отдельной HR‑формулы, если можно позволить себе константный запас по глубине для явного $\\neg$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, позволяет ли HR‑representability для PARITY на одном блоке ($n$ переменных) с глубиной $d\\approx\\log n/\\log\\log n$ «съесть» константный запас (например, строить $P$ глубины $d-2$ размера $\\mathrm{poly}(n)$), чтобы отрицательные литералы в §16.130–§16.137 реализовывались как $\\neg P$ (или $\\neg P\\vee\\bot$) без выхода за целевую глубину.

### 16.141. Исследовательский шаг: константный «запас по глубине» совместим с порогом $d\\approx\\log n/\\log\\log n$ для representability PARITY при $M=\\mathrm{poly}(n)$

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть выполнен representation‑факт Håstad–Risse’25, §1.2: при ограничении «каждая строка имеет depth $d$ и size $M$» можно выписать формулу,
  представляющую $\\mathrm{PARITY}$ на блоке из
  $$m=(\\log M)^{d-1}$$
  переменных (и аналогично для отрицания).
  Тогда при $d=\\Theta(\\log n/\\log\\log n)$ константная потеря глубины не мешает покрыть блок ширины $n$ при polynomial $M$:
  существует константа $C>1$ такая, что при $M:=n^C$ и $d:=\\left\\lceil\\frac{\\log n}{\\log\\log n}\\right\\rceil+2$ выполняется
  $$(\\log M)^{(d-1)-1}=(\\log M)^{d-2}\\ge n.$$
  В частности, можно выбрать представителя паритета $P$ глубины $\\le d-1$ и размера $\\mathrm{poly}(n)$, а его отрицание брать как синтаксическое $\\neg P$ глубины $\\le d$ (см. §16.140).
- `Доказательство:` положим $M=n^C$, тогда $\\log M=C\\log n$ и нужно доказать $(C\\log n)^{d-2}\\ge n$, т.е.
  $$ (d-2)\\,\\log(C\\log n)\\ \\ge\\ \\log n.$$
  При $d=\\left\\lceil\\frac{\\log n}{\\log\\log n}\\right\\rceil+2$ имеем $d-2\\ge \\frac{\\log n}{\\log\\log n}$, поэтому
  $$(d-2)\\log(C\\log n)\\ \\ge\\ \\frac{\\log n}{\\log\\log n}\\cdot\\bigl(\\log\\log n+\\log C\\bigr)\\ =\\ \\log n+\\frac{\\log C}{\\log\\log n}\\,\\log n\\ \\ge\\ \\log n.$$
  Отсюда $(C\\log n)^{d-2}\\ge 2^{\\log n}=n$.
- `Toy‑тест:` $n=2^{64}$, $C=4$, $d=\\lceil 64/6\\rceil+2=13$.
  Тогда $\\log M=4\\log n=256$ и $(\\log M)^{d-2}=256^{11}=2^{88}>2^{64}=n$.
- `Статус:` доказано (арифметика параметров: использование $\\neg P$ в §16.140 требует лишь $O(1)$ запаса по глубине, и этот запас совместим с порогом $d\\approx\\log n/\\log\\log n$ при $M=\\mathrm{poly}(n)$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` зафиксировать точную формулировку representation‑факта из HR’25 §1.2 как отдельную «известную лемму» (какие именно глубина/база/выходной символ допускаются), чтобы не было скрытого +O(1) к глубине; затем вернуться к основному узлу: синтаксическая симуляция XOR‑сложения (Gaussian elimination step) внутри bounded‑depth Frege.

### 16.142. Исследовательский шаг: точная формулировка HR’25 §1.2 “representing parity” и стандартный upper bound для PARITY (Håstad’86, Remark 6)

- `Линза:` Эквивалентность.
- `Утверждение:` В Håstad–Risse’25, §1.2 (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`) representation‑шаг формулируется в модели Schoenfield‑Frege (§2.1: база $\\{\\vee,\\neg\\}$, глубина = число чередований $\\vee/\\neg$), и содержит конкретную параметрику:
  для уравнения паритета на $m$ переменных и ограничения «line size $\\le M$, line depth $\\le d$» авторы пишут:
  «divide the variables into groups of size $(\\log M)^{d-1}$ and write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity of each group… assume output gate is an or»
  (см. §1.2, абзац начиная с “Let us consider proofs that contain formulas of depth d…”).
  Это согласуется со стандартным (известным) upper bound для схем PARITY: Håstad’86, Remark 6 (`../../resources/downloads/hastad_1986.pdf`, p. 10) отмечает, что PARITY имеет depth‑$k$ схемы размера вида
  $$\\mathrm{size}\\ \\le\\ n\\cdot 2^{\\,O\\bigl(n^{1/(k-1)}\\bigr)}\\ =\\ \\exp\\bigl(O(n^{1/(k-1)})\\bigr).$$
  Инверсия даёт именно блок‑размер $n=\\Theta((\\log M)^{k-1})$ при заданном лимите $M$ (с точностью до констант в $O(\\cdot)$), то есть HR‑параметрика $(\\log M)^{d-1}$ — стандартная “solve $M=\\exp(O(n^{1/(d-1)}))$”.
- `Доказательство:` из Håstad’86 Remark 6 берём existence upper bound $\\mathrm{size}\\le \\exp(C\\,n^{1/(k-1)})$ для некоторой константы $C$ (при фиксированной глубине $k$).
  Положим $n:=\\bigl(\\tfrac{\\log M}{2C}\\bigr)^{k-1}$. Тогда $C\\,n^{1/(k-1)}=\\tfrac12\\log M$, и размер удовлетворяет
  $$\\mathrm{size}\\le \\exp(C\\,n^{1/(k-1)})\\le \\exp(\\tfrac12\\log M)=\\sqrt M\\le M.$$
  Следовательно, существует depth‑$k$ формула размера $\\le M$, вычисляющая PARITY на $\\Omega((\\log M)^{k-1})$ переменных. Для HR‑потребности «выход $\\vee$» можно применить OR‑обёртку $A\\mapsto A\\vee\\bot$ (см. §16.140) с константным overhead по глубине/размеру.
- `Toy‑тест:` если $k=3$, то bound имеет вид $\\exp(O(\\sqrt n))$; инверсия даёт $n=\\Theta((\\log M)^2)$, что совпадает с HR‑формулой $(\\log M)^{d-1}$ при $d=3$.
- `Статус:` известно/зафиксировано (точная ссылка + формальный вывод параметрики; теперь «representability PARITY на $(\\log M)^{d-1}$» не висит на неформальном “write down formulas”).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` вернуться к ядру Q39: даже при доступности формул $P$ для промежуточных уравнений нужен poly‑size bounded‑depth Frege‑вывод шага XOR‑сложения (Gaussian elimination) **между** такими представлениями; попытаться формализовать/убить toy‑случай «одна общая переменная пересечения» по аналогии с резолюцией из HR §1.2.

### 16.143. Исследовательский шаг: toy‑случай XOR‑шага при пересечении в одной переменной редуцируется к §16.130 с $k\\le k_1+k_2+1$ (если обе строки уже записаны как паритет по блокам)

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Пусть есть два XOR‑уравнения на множествах переменных $S_1,S_2\\subseteq X$ с
  $$S_1\\cap S_2=\\{x\\}.$$
  Предположим, что каждое уравнение уже записано в «block‑форме» из §16.130:
  существуют разбиения на непересекающиеся блоки
  $$S_1=\\biguplus_{i=1}^{k_1}B_i,\\qquad S_2=\\biguplus_{j=1}^{k_2}C_j,$$
  и для каждого блока есть формулы, представляющие его паритет (и отрицание), так что строки $E(S_1,b_1)$ и $E(S_2,b_2)$ реализуются как XOR по блок‑паритетам.
  Тогда существует разбиение $S_1\\cup S_2=\\biguplus_{t=1}^k D_t$ с
  $$k\\le k_1+k_2+1,$$
  относительно которого **обе** строки становятся объединениями блоков одного и того же разбиения, и потому один XOR‑шаг
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2)$$
  имеет bounded‑depth Frege‑вывод размера $2^{O(k)}$ (и, в частности, polynomial‑size при $k_1,k_2=O(\\log n)$).
- `Доказательство:`
  1) Обозначим через $B_{i^*}$ и $C_{j^*}$ единственные блоки, содержащие $x$ (существуют и единственны по непересечаемости разбиений).
  2) Построим совместное разбиение $\\mathcal D$ множества $S_1\\cup S_2$ так: оставим все блоки $B_i$ при $i\\ne i^*$ и все блоки $C_j$ при $j\\ne j^*$, а пересекающиеся в $x$ блоки «разрежем»:
     $$B_{i^*}=\\{x\\}\\uplus (B_{i^*}\\setminus\\{x\\}),\\qquad C_{j^*}=\\{x\\}\\uplus (C_{j^*}\\setminus\\{x\\}).$$
     Тогда семейство блоков
     $$\\mathcal D:=\\{\\{x\\},\\ B_{i^*}\\setminus\\{x\\},\\ C_{j^*}\\setminus\\{x\\}\\}\\ \\cup\\ \\{B_i:i\\ne i^*\\}\\ \\cup\\ \\{C_j:j\\ne j^*\\}$$
     (выкидывая пустые множества) состоит из попарно непересекающихся подмножеств и покрывает $S_1\\cup S_2$.
     По счёту блоков получаем $k\\le (k_1-1)+(k_2-1)+3=k_1+k_2+1$.
  3) Каждое из $S_1,S_2$ является объединением блоков из $\\mathcal D$ (блоки вне соответствующего множества просто не берутся), поэтому оба уравнения можно рассматривать как XOR по одному фиксированному набору блок‑паритетов $\\{P_{D_t}\\}_{t\\in[k]}$.
     Тогда требуемый XOR‑шаг — тавтология на $k$ «атомах» (блок‑паритетах), и именно этот случай покрывает §16.130.
- `Toy‑тест:` $S_1=\\{x,a,b,c\\}$, $S_2=\\{x,d,e\\}$.
  Пусть $S_1$ разбито как $B_1=\\{x,a,b\\}$, $B_2=\\{c\\}$ ($k_1=2$), а $S_2$ как $C_1=\\{x,d\\}$, $C_2=\\{e\\}$ ($k_2=2$).
  Тогда $\\mathcal D=\\{\\{x\\},\\{a,b\\},\\{c\\},\\{d\\},\\{e\\}\\}$ и $k=5=k_1+k_2+1$, после чего XOR‑шаг сводится к §16.130 с $k=5$.
- `Статус:` частично (toy‑случай «пересечение = 1 переменная» не создаёт $k^2$‑взрыва при приведении двух block‑записей к общему разбиению; оставшаяся трудность Q39 — обеспечить саму block‑форму и её поддержание при динамическом base‑change).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить на реальной стратегии для grid, можно ли устроить вывод так, чтобы *каждый* локальный шаг обновления границы (добавление вершины/малого уравнения) имел пересечение $O(1)$ и при этом обе строки были записаны как XOR по $O(\\log n)$ блокам одного «текущего» разбиения; если нет — найти минимальное место, где неизбежно возникает пересечение по многим переменным или «поперечный» переход между несовместимыми разбиениями (и тогда снова включается барьер §16.132).

### 16.144. Исследовательский шаг: в column‑summing каждый локальный переход $t\\to t+1$ — XOR‑шаг с пересечением ровно в одном ребре (вершинное уравнение пересекает границу по одному ребру)

- `Линза:` Инвариант.
- `Утверждение:` Пусть $G$ — граф, $A\\subseteq V(G)$ и $v\\notin A$.
  Обозначим $E(v)$ — множество рёбер, инцидентных $v$, и $\\delta(A)$ — рёбра, имеющие ровно один конец в $A$.
  Тогда
  $$\\delta(A\\cup\\{v\\})\\ =\\ \\delta(A)\\triangle E(v).$$
  Более того, если у $v$ ровно один сосед в $A$, то $\\delta(A)\\cap E(v)$ состоит ровно из одного ребра.
  В частности, для стратегии из §16.134 на grid, где $A=R_{j,t}$ и $v=(t+1,j)$, имеем
  $$\\delta(R_{j,t+1})=\\delta(R_{j,t})\\triangle E(v),\\qquad |\\delta(R_{j,t})\\cap E(v)|=1,$$
  поэтому переход $t\\to t+1$ в «Gaussian elimination по модулю 2» реализуется как XOR‑шаг между одним промежуточным уравнением ширины $\\Theta(n)$ и одним вершинным уравнением постоянной ширины.
- `Доказательство:`
  1) Для любого ребра $e=uw$ неинцидентного $v$ принадлежность $e$ множеству $\\delta(A)$ и $\\delta(A\\cup\\{v\\})$ совпадает, так как статусы принадлежности концов к $A$ не меняются.
  2) Пусть $e$ инцидентно $v$, т.е. $e=vu$.
     Тогда $e\\in\\delta(A)$ эквивалентно условию $u\\in A$ (поскольку $v\\notin A$), а $e\\in\\delta(A\\cup\\{v\\})$ эквивалентно $u\\notin A\\cup\\{v\\}$, т.е. $u\\notin A$.
     Следовательно, для рёбер из $E(v)$ принадлежность к границе **инвертируется** при добавлении $v$, то есть именно рёбра $E(v)$ переключают членство в $\\delta$.
     Это и означает $\\delta(A\\cup\\{v\\})=\\delta(A)\\triangle E(v)$.
  3) Если у $v$ ровно один сосед $u\\in A$, то ровно одно ребро $vu$ из $E(v)$ имеет другой конец в $A$, и именно оно лежит в $\\delta(A)$.
     Значит $|\\delta(A)\\cap E(v)|=1$.
  4) Для grid и $A=R_{j,t}$ из §16.134 вершина $v=(t+1,j)$ имеет ровно одного соседа в $A$ (вершина $(t,j)$), поэтому применимы пункты 1–3.
  5) На уровне XOR‑уравнений это ровно правило сложения строк по модулю 2:
     XOR‑сумма уравнения по $\\delta(R_{j,t})$ и вершинного уравнения по $E(v)$ даёт уравнение по $\\delta(R_{j,t+1})$, а правая часть обновляется как $b_{t+1}=b_t\\oplus \\chi(v)$.
- `Toy‑тест:` $n=4$, $j=2$, $t=1$. Тогда $A=\\{(1,2)\\}$, $v=(2,2)$.
  Граница $\\delta(A)$ содержит ребро $(1,2)-(2,2)$, а остальные рёбра из $E(v)$ выходят наружу, поэтому $\\delta(A)\\cap E(v)=\\{(1,2)-(2,2)\\}$ и $\\delta(A\\cup\\{v\\})=\\delta(A)\\triangle E(v)$.
- `Статус:` доказано (геометрический факт: «локальные» шаги column‑summing всегда имеют пересечение $O(1)$, причём в простейшем варианте — ровно 1 ребро).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` совместить это с §16.143 и dyadic‑обновлением §16.136: выписать явную схему, как держать уравнения $\\delta(R_{j,t})$ в block‑форме с $k=O(\\log n)$ так, чтобы каждый локальный шаг $t\\to t+1$ требовал только (i) XOR‑шаг «пересечение=1» и (ii) $O(\\log n)$ disjoint‑merge операций; затем найти, где в стратегии для **всего** grid неизбежно появляется «поперечный» переход (и включается барьер §16.132), либо подтвердить, что можно обойтись одним 1D‑порядком.

### 16.145. Исследовательский шаг: «протокол» поддержания block‑формы для $\\delta(R_{j,t})$ с $k=O(\\log n)$ в column‑summing (локальный XOR‑шаг + $O(\\log n)$ dyadic‑merge)

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Зафиксируем внутреннюю колонку $2\\le j\\le n-1$ и множества $R_{j,t}$ из §16.134.
  Обозначим через $L_{j,t}$ и $H_{j,t}$ два горизонтальных сегмента границы (слева/справа) и через $B_{j,t}$ вертикальное «фронтирное» ребро (если $t<n$), так что
  $$\\delta(R_{j,t})\\ =\\ L_{j,t}\\uplus H_{j,t}\\uplus \\{B_{j,t}\\}\\qquad (t<n)$$
  (см. §16.134; верхнего ребра нет для обычного $n\\times n$ grid).
  Тогда существует каноническое разбиение $\\mathcal P_{j,t}$ множества $\\delta(R_{j,t})$ на
  $$k_t\\le 2\\lfloor\\log_2 n\\rfloor+3$$
  дизъюнктных блоков (dyadic‑интервалы по строкам внутри $L_{j,t}$ и $H_{j,t}$ из §16.136, плюс singleton $\\{B_{j,t}\\}$),
  и переход $t\\to t+1$ можно реализовать без $k^2$‑взрыва:
  1) (XOR‑шаг.) По §16.144 имеем $\\delta(R_{j,t+1})=\\delta(R_{j,t})\\triangle E(v)$ для $v=(t+1,j)$ и $|\\delta(R_{j,t})\\cap E(v)|=1$.
     Если $E(\\delta(R_{j,t}),b_t)$ и $E(E(v),\\chi(v))$ записаны в block‑форме относительно разбиений $\\mathcal P_{j,t}$ и singleton‑разбиения $E(v)$,
     то по §16.143 XOR‑шаг выводит $E(\\delta(R_{j,t+1}),b_t\\oplus\\chi(v))$ в polynomial‑size при $k_t=O(\\log n)$.
  2) (Dyadic‑merge.) Чтобы поддерживать канонический вид $\\mathcal P_{j,t+1}$, достаточно отдельно для $L$ и $H$ выполнить dyadic‑обновление префикса $t\\mapsto t+1$ из §16.136:
     «добавить singleton новой строки» и затем сделать $O(\\log n)$ слияний соседних равных интервалов.
     Каждое такое слияние — disjoint‑merge и потому сводится к «easy case» §16.137 (то есть к §16.130 с $k=2$).
  Следовательно, в column‑summing поддержание block‑формы для всех $t$ сводится к $n$ локальным XOR‑шагам с пересечением 1 и $O(n\\log n)$ disjoint‑merge операциям,
  причём на каждом шаге число блоков остаётся $O(\\log n)$ (и base‑change происходит только между interval‑partition, где refinement линейный по §16.133).
- `Доказательство:`
  1) (Канонические блоки.) Отождествим рёбра $L_{j,t}$ с позициями $[t]$ по строковому порядку (аналогично для $H_{j,t}$).
     Применим §16.136 к каждому из двух префиксов длины $t$, получая dyadic‑разбиения на $\\le\\lfloor\\log_2 t\\rfloor+1\\le\\lfloor\\log_2 n\\rfloor+1$ интервалов.
     Добавив singleton $\\{B_{j,t}\\}$, получаем разбиение $\\mathcal P_{j,t}$ и оценку $k_t\\le 2(\\lfloor\\log_2 n\\rfloor+1)+1$.
  2) (XOR‑обновление границы.) По §16.144
     $$\\delta(R_{j,t+1})=\\delta(R_{j,t})\\triangle E(v),\\qquad |\\delta(R_{j,t})\\cap E(v)|=1,$$
     где $v=(t+1,j)$, а общим ребром является $B_{j,t}$.
     Так как $B_{j,t}$ в $\\mathcal P_{j,t}$ — singleton, а $E(v)$ можно разбить на singleton‑блоки (их $\\le 4$), XOR‑шаг попадает в условия §16.143
     с общим refinement‑разбиением размера $\\le k_t+O(1)=O(\\log n)$.
  3) (Dyadic‑нормализация.) После XOR‑шага в множествах $L,H$ появляется по одному новому ребру (строка $t+1$), то есть их префиксы увеличиваются на 1.
     Каноническое dyadic‑разбиение $[t+1]$ получается из разбиения $[t]$ добавлением singleton и затем $O(\\log n)$ merge‑операциями (§16.136).
     Каждая merge‑операция склеивает два дизъюнктных интервала и потому имеет polynomial‑size bounded‑depth Frege‑симуляцию по §16.137.
     Так как все разбиения — interval‑partition одного порядка, их уточнения не дают $k^2$‑взрыва (§16.133).
- `Toy‑тест:` $n=8$, $t=5$.
  Dyadic‑разбиение $[5]=[1,4]\\uplus[5,5]$, а $[6]=[1,4]\\uplus[5,6]$ получается добавлением singleton $[6,6]$ и merge $[5,5]\\uplus[6,6]\\mapsto[5,6]$.
  Для $\\delta(R_{j,5})$ это означает: на каждой из двух сторон добавляется одно ребро и делается один disjoint‑merge; затем XOR с вершиной $v=(6,j)$ меняет $B_{j,5}$ на $B_{j,6}$, имея пересечение ровно в $B_{j,5}$.
- `Статус:` доказано (редукция: внутри column‑summing нет необходимости в «поперечном» base‑change; поддержание $k=O(\\log n)$ сводится к пересечению‑1 XOR и dyadic‑merge).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` перейти от одного столбца к «суммированию столбцов» как у Håstad–Risse §1.2: понять, можно ли выбрать block‑формы для граничных уравнений двух соседних столбцов так, чтобы их большая общая часть (полоса из $n$ рёбер) уже была синхронизирована теми же dyadic‑блоками, и тогда XOR‑сложение столбцов станет прямым «easy case» §16.130 (без k^2); либо зафиксировать место, где неизбежна несогласованность разбиений (row↔column) и снова включается барьер §16.132.

### 16.146. Исследовательский шаг: сложение соседних столбцов в HR‑стратегии сводится к «easy case» §16.130 при фиксированном dyadic‑разбиении полос $S_j$

- `Линза:` Эквивалентность.
- `Утверждение:` Для $1\\le j\\le n-1$ обозначим через $S_j$ множество из $n$ горизонтальных рёбер между колонками $j$ и $j+1$ (упорядоченных по строкам).
  Пусть для каждой полосы $S_j$ фиксировано dyadic‑разбиение на $r=O(\\log n)$ дизъюнктных row‑interval блоков (каноническое из §16.136 для $[n]$),
  и доступно block‑представление (в смысле §16.130) уравнений вида $E(S_j,b)$ как XOR по блок‑паритетам этих $r$ блоков.
  Тогда «добавление соседнего столбца» в схеме Håstad–Risse §1.2 реализуется одним XOR‑шагом в «easy case»:
  если
  $$E(S_j,\\,b)\\qquad\\text{и}\\qquad E(S_j\\uplus S_{j+1},\\,c)$$
  записаны как XOR по блокам одного общего разбиения $S_j\\uplus S_{j+1}$ (объединение dyadic‑блоков на $S_j$ и на $S_{j+1}$), то bounded‑depth Frege выводит
  $$E(S_{j+1},\\,b\\oplus c)$$
  polynomial‑size (при глубине, контролируемой глубинами блок‑паритетов), поскольку
  $$(S_j)\\triangle(S_j\\uplus S_{j+1})=S_{j+1}.$$
  То есть большое пересечение размера $|S_j|=n$ не приводит к $k^2$‑base‑change: оно «схлопывается» на уровне общих блок‑атомов.
- `Доказательство:`
  1) (Симметрическая разность.) Так как $S_j\\cap S_{j+1}=\\varnothing$, имеем
     $$(S_j)\\triangle(S_j\\uplus S_{j+1})=((S_j\\triangle S_j)\\triangle S_{j+1})=\\varnothing\\triangle S_{j+1}=S_{j+1}.$$
  2) (Общее разбиение и параметр $k$.) Полосы $S_j$ и $S_{j+1}$ дизъюнктны, поэтому объединение их dyadic‑разбиений даёт разбиение
     $$S_j\\uplus S_{j+1}=\\biguplus_{t=1}^{k} D_t$$
     с $k\\le 2r=O(\\log n)$.
     Тогда оба уравнения $E(S_j,b)$ и $E(S_j\\uplus S_{j+1},c)$ являются объединениями блоков одного и того же разбиения $\\{D_t\\}$.
  3) (XOR‑шаг как «easy case».) По §16.130 для такого фиксированного block‑базиса существует bounded‑depth Frege‑вывод размера $2^{O(k)}=\\mathrm{poly}(n)$,
     доказывающий
     $$E(S_j,b)\\wedge E(S_j\\uplus S_{j+1},c)\\to E(S_{j+1},b\\oplus c).$$
  4) (Связь с HR §1.2.) Уравнение $E(S_j\\uplus S_{j+1},c)$ — это «уравнение столбца $j+1$» (граница полного столбца; частный случай §16.134 при $t=n$),
     а $E(S_j,b)$ — «уравнение полосы из первых $j$ столбцов» (граница вертикальной полосы).
     Следовательно, шаг «прибавить следующий столбец» в линейном рассуждении по модулю 2 редуцируется к одному XOR‑шагу в режиме §16.130.
- `Toy‑тест:` $n=6$.
  Каноническая dyadic‑разбивка $[6]=[1,4]\\uplus[5,6]$ задаёт по два блока на каждой полосе $S_j$.
  Тогда $E(S_j,b)$ использует два блока полосы $S_j$, а $E(S_j\\uplus S_{j+1},c)$ использует четыре блока на $S_j\\uplus S_{j+1}$.
  Их XOR‑сложение отменяет оба блока на $S_j$ и оставляет ровно два блока на $S_{j+1}$.
- `Статус:` доказано (соседние столбцы не требуют «поперечного» base‑change: достаточно фиксировать одинаковые dyadic‑блоки на общей полосе $S_j$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` уточнить оставшийся узел Q39: в §16.145–§16.146 базисная часть Gaussian elimination на grid редуцировалась к «easy case» на $k=O(\\log n)$ блок‑атомах;
  теперь надо либо (a) формально контролировать глубину блок‑паритетов при всех необходимых dyadic‑merge (чтобы не вылезти в $O(\\log n)$), либо (b) выделить место в полном HR‑выводе, где всё же требуется base‑change между несовместимыми разбиениями (и тогда возвращается барьер §16.132).

### 16.147. Исследовательский шаг: caveat — Håstad’86, Remark 6 говорит про **схемы**, а для Frege‑линий нужны **формулы**; наивная «развёртка» схемы в формулу даёт blow‑up $M^{\\Theta(d)}$

- `Линза:` Модельный стресс‑тест.
- `Утверждение:` Ссылка Håstad’86, Remark 6 (`../../resources/downloads/hastad_1986.pdf`) даёт upper bound для PARITY в модели **depth‑$d$ схем**.
  Но в Schoenfield‑Frege строки — это **формулы** (деревья), и общий перевод «схема → эквивалентная формула той же глубины» может раздувать размер до $M^{O(d)}$.
  В частности, если единственное обоснование representability‑параметрики $(\\log M)^{d-1}$ опирается на Remark 6, то на пороговой глубине $d\\approx \\log n/\\log\\log n$ при $M=\\mathrm{poly}(n)$ развёртка даёт лишь quasi‑poly размер и не закрывает нужный режим.
- `Доказательство:`
  Пусть $C$ — булева схема размера $S$ и глубины $d$ (один выход).
  Построим эквивалентную формулу $F$ «развёрткой DAG в дерево»: корень — выход схемы; для узла‑вхождения гейта $g$ добавляем в формулу соответствующий символ и рекурсивно разворачиваем его входы, **копируя** подформулы при каждом новом использовании $g$.
  Тогда глубина $F$ равна глубине $C$.
  Оценим размер: каждое вхождение гейта в развёртке соответствует некоторому пути в схеме, идущему от этого гейта к выходу.
  Длина пути $\\le d$, и на каждом шаге можно перейти не более чем в один из $\\le S$ гейтов следующего уровня, значит число различных путей от любого гейта к выходу грубо ограничено $S^{d}$.
  Следовательно, каждый из $S$ гейтов может появиться в развёртке не более чем $S^{d}$ раз, и
  $$|F|\\ \\le\\ S\\cdot S^{d}\\ =\\ S^{d+1}\\ =\\ S^{O(d)}.$$
  Подстановка $S:=M=n^C$ и $d:=\\Theta(\\log n/\\log\\log n)$ даёт
  $$|F|\\ \\le\\ n^{C(d+1)}\\ =\\ 2^{\\Theta(\\log^2 n/\\log\\log n)},$$
  то есть quasi‑poly, а не polynomial.
- `Toy‑тест:` $n=2^{64}$, $M=n^4=2^{256}$, $d=13$.
  Тогда даже грубая оценка развёртки даёт $|F|\\le M^{14}=2^{3584}$.
- `Статус:` выявлен точный провал: Remark 6 сам по себе не обосновывает «формульную» representability‑часть в режиме $d\\approx\\log n/\\log\\log n$ (развёртка даёт именно тот $M^{\\Theta(d)}$, который HR отмечают как недостаточный).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти (или вывести) **формульный** upper bound для PARITY в нужной модели (глубина как у HR, база $\\{\\vee,\\neg\\}$, OR‑выход), дающий размер $M$ на блоке $(\\log M)^{d-1}$; затем вернуться к узлу Q39 про контроль глубины при dyadic‑merge без накопления $O(\\log n)$.

### 16.148. Исследовательский шаг: явный конструктивный upper bound для $\\mathrm{PARITY}$ формулами глубины $d$ даёт лишь $\\log \\mathrm{size}=O((d-1)\\,m^{1/(d-1)})$ (DNF‑композиция) — этого недостаточно на пороге

- `Линза:` Трейд‑офф.
- `Утверждение:` Для целых $d\\ge 2$ и $t\\ge 2$ положим $m:=t^{d-1}$.
  Тогда существуют формулы (в De Morgan виде, с OR‑выходом) глубины $d$ и размера
  $$\\mathrm{size}\\ \\le\\ \\mathrm{poly}(m)\\cdot 2^{\\,O((d-1)\\,t)}\\ =\\ \\exp\\bigl(O((d-1)\\,m^{1/(d-1)})\\bigr),$$
  вычисляющие $\\mathrm{PARITY}_m$ и $\\neg\\mathrm{PARITY}_m$.
  Инверсия даёт: чтобы уложиться в размер $\\le M$, из этого конструктивного bound’а следует лишь
  $$m\\ \\le\\ \\left(\\Theta\\!\\left(\\frac{\\log M}{d-1}\\right)\\right)^{d-1},$$
  то есть на пороге $d\\approx\\log n/\\log\\log n$ при $M=\\mathrm{poly}(n)$ такой подход покрывает только $n^{o(1)}$ переменных и не оправдывает целевой блок $(\\log M)^{d-1}\\ge n$.
- `Доказательство:`
  1) (Композиция блоков.) Для $m=t^{d-1}$ разобьём переменные на $t$ блоков по $t^{d-2}$ переменных.
     Пусть $P_{d-1}$ и $N_{d-1}$ — формулы глубины $d-1$, вычисляющие паритет/непаритет на $t^{d-2}$ переменных.
     Тогда $\\mathrm{PARITY}_m$ можно выписать как DNF по $t$ «литералам‑блокам»:
     $$\\bigvee_{a\\in\\{0,1\\}^t:\\ \\oplus_i a_i=1}\\ \\bigwedge_{i=1}^t L_i(a),\\qquad L_i(a):=\\begin{cases}P_{d-1}(\\text{block }i),&a_i=1\\\\N_{d-1}(\\text{block }i),&a_i=0.\\end{cases}$$
     Аналогично для $\\neg\\mathrm{PARITY}_m$ (берём $\\oplus_i a_i=0$). OR‑выход сохранён.
  2) (Рекурсия на размере.) Обозначим через $S(d,m)$ размер такого построения.
     Тогда при $m=t^{d-1}$ имеем
     $$S(d,\\,t^{d-1})\\ \\le\\ 2^{t}\\cdot O(t)\\cdot S(d-1,\\,t^{d-2}).$$
     База $d=2$: DNF для паритета на $t$ переменных имеет $2^{t-1}$ термов и размер $S(2,t)\\le 2^{t}\\cdot O(t)$.
     Индукцией получаем $S(d,t^{d-1})\\le 2^{(d-1)t}\\cdot \\mathrm{poly}(t)\\le \\mathrm{poly}(m)\\cdot 2^{O((d-1)t)}$.
  3) (Инверсия.) Если $S(d,m)\\le M$, то из $\\log M\\ge \\Omega((d-1)\\,m^{1/(d-1)})$ следует
     $m\\le (\\Theta((\\log M)/(d-1)))^{d-1}$.
     При $d=\\Theta(\\log n/\\log\\log n)$ и $M=n^{O(1)}$ имеем $(\\log M)/(d-1)=\\Theta(\\log\\log n)$, значит
     $$m\\ \\le\\ (\\Theta(\\log\\log n))^{\\Theta(\\log n/\\log\\log n)}\\ =\\ n^{o(1)}\\ll n.$$
- `Toy‑тест:` $n=2^{64}$, $M=n^4$ (так что $\\log M=256$), $d=13$ (то есть $d-1=12$).
  Тогда оценка даёт максимум
  $$m\\ \\lesssim\\ (256/12)^{12}\\ \\approx\\ 21^{12}\\ \\approx\\ 2^{53}\\ <\\ 2^{64}=n.$$
- `Статус:` получен честный «слишком слабый» формульный upper bound: DNF‑композиция действительно даёт ровно тот тип blow‑up по $d$, который делает representability на пороге недоказанной.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти (или опровергнуть) существенно более сильный **формульный** upper bound для $\\mathrm{PARITY}$ глубины $d\\approx\\log n/\\log\\log n$ (в духе схемного bound Håstad’86 без множителя $(d-1)$ в показателе); иначе representation‑редукция Q39 может быть заблокирована уже на уровне «PARITY в одном блоке».

### 16.149. Исследовательский шаг: множитель $d$ в экспоненте для PARITY‑формул **неустраним** (Rossman’16) ⇒ блок $(\\log M)^{d-1}$ при size $M$ невозможен для формул при растущем $d$

- `Линза:` Ссылка/барьер (закрыть «фольклор» точным фактом).
- `Утверждение:` Для unbounded fan-in De Morgan‑формул (деревьев) глубины $D\\ge 2$ функция $\\mathrm{PARITY}_n$ требует размера
  $$\\mathrm{size}\\ \\ge\\ 2^{\\,\\Omega\\bigl((D-1)\\,(n^{1/(D-1)}-1)\\bigr)}$$
  (Rossman’16, Thm. 3; см. `../../resources/downloads/rossman_2016_average_sensitivity_bounded_depth_formulas.pdf`).
  Следовательно, если формула глубины $D$ имеет размер $\\le M$ и вычисляет $\\mathrm{PARITY}_n$, то неизбежно
  $$n\\ \\le\\ \\left(\\Theta\\!\\left(\\frac{\\log M}{D-1}\\right)\\right)^{D-1}.$$
  В частности, при растущем $D$ нельзя иметь «representability‑блок» размера $(\\log M)^{D-1}$ при размере $M$ (как в эвристике HR §1.2): такой блок требует размера $\\ge M^{\\Omega(D)}$.
- `Доказательство:`
  1) (Lower bound.) Rossman’16, Thm. 3 утверждает для глубины $d+1$:
     $$\\mathrm{size}\\ge 2^{\\Omega(d(n^{1/d}-1))}.$$
     Положив $D:=d+1$, получаем stated bound $2^{\\Omega((D-1)(n^{1/(D-1)}-1))}$.
  2) (Инверсия.) Из $M\\ge 2^{\\Omega((D-1)(n^{1/(D-1)}-1))}$ следует
     $n^{1/(D-1)}\\le O((\\log M)/(D-1))+1$, то есть $n\\le (\\Theta((\\log M)/(D-1)))^{D-1}$ (для $n$ сверх констант).
  3) (Сопоставление с §16.148.) Верхняя оценка §16.148 даёт
     $$\\log\\mathrm{size}=O\\bigl((D-1)\\,n^{1/(D-1)}\\bigr),$$
     т.е. вместе с Rossman’16 множитель $(D-1)$ в показателе получается tight (с точностью до констант).
  4) (Провал блока $(\\log M)^{D-1}$.) Если взять $n:=(\\log M)^{D-1}$, то $n^{1/(D-1)}=\\log M$ и lower bound даёт
     $$\\mathrm{size}\\ge 2^{\\Omega((D-1)\\log M)}=M^{\\Omega(D-1)},$$
     что при растущем $D$ существенно больше $M$.
- `Toy‑тест:` $M=n^4$, $D=13$.
  Тогда «желанный» блок $n=(\\log M)^{12}=256^{12}=2^{96}$ потребовал бы по Rossman’16 размера $\\ge 2^{\\Omega(12\\cdot 256)}=2^{\\Omega(3072)}\\gg M=2^{256}$.
- `Статус:` закрыто как известный факт: для формул (fan-out 1) сильный upper bound без множителя $(D-1)$ невозможен; representability‑узел Q39 действительно «ломается» уже на уровне PARITY‑блоков при пороговой глубине.
- `Барьер‑чек:` r — неприменимо (без оракулов), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` пересобрать формулировку Q39: либо (a) HR §1.2 должен трактовать «size» не как tree‑size формулы (а как DAG/схема, что в Frege не строки), либо (b) для bounded‑depth Frege представление промежуточных XOR‑уравнений действительно требует quasi‑poly размера уже из-за PARITY‑формул, и тогда «gap по глубине» не сводится к одному XOR‑шагу.

### 16.150. Исследовательский шаг: глубина HR (= чередования $\\vee/\\neg$) сводится к De Morgan‑глубине $\\Theta(d)$ без потери размера ⇒ оценка Rossman’16 применима к строкам bounded‑depth Frege

- `Линза:` Эквивалентность.
- `Утверждение:` В HR’22 (Schoenfield‑Frege) формулы строятся над базой $\\{\\vee,\\neg\\}$; размер = число связок, глубина = число чередований $\\vee/\\neg$ на пути (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, §2.1, определения после строки “The size of a formula…”).
  Для любой такой формулы $A$ существует эквивалентная De Morgan‑формула $A^{\\mathrm{NNF}}$ (внутренние гейты $\\vee/\\wedge$, отрицания только на листьях) такая, что
  1) $|A^{\\mathrm{NNF}}|\\le |A|$ (с точностью до констант в выборе метрики размера),
  2) $\\mathrm{depth}_{\\wedge/\\vee}(A^{\\mathrm{NNF}})\\le \\lfloor d/2\\rfloor+1$, где $d:=\\mathrm{altdepth}_{\\vee/\\neg}(A)$.
  Следовательно, нижняя оценка Rossman’16 для PARITY‑**формул** по глубине (см. `../../resources/downloads/rossman_2016_average_sensitivity_bounded_depth_formulas.pdf`, Thm. 3) напрямую ограничивает representability в bounded‑depth Frege: при фиксированном $d$ и размере строки $\\le M$ паритет нельзя покрыть на блоке размера $(\\log M)^{d-1}$; максимум лишь $\\bigl(\\Theta((\\log M)/d)\\bigr)^{\\Theta(d)}$ (совпадает с §16.148–§16.149).
- `Доказательство:`
  1) (NNF‑перевод без blow‑up.) Определим $A^{\\mathrm{NNF}}$ рекурсией “push‑negation”:
     $$(\\neg B)^{\\mathrm{NNF}}:=\\mathrm{push}(\\neg,B),\\qquad (B_1\\vee\\cdots\\vee B_k)^{\\mathrm{NNF}}:=B_1^{\\mathrm{NNF}}\\vee\\cdots\\vee B_k^{\\mathrm{NNF}},$$
     а функция $\\mathrm{push}(s,\\cdot)$ для полярности $s\\in\\{+,-\\}$ задаётся правилами
     $$\\mathrm{push}(+,x)=x,\\ \\mathrm{push}(-,x)=\\neg x,$$
     $$\\mathrm{push}(+,\\neg C)=\\mathrm{push}(-,C),\\ \\mathrm{push}(-,\\neg C)=\\mathrm{push}(+,C),$$
     $$\\mathrm{push}(+,C_1\\vee\\cdots\\vee C_k)=\\bigvee_i \\mathrm{push}(+,C_i),\\qquad \\mathrm{push}(-,C_1\\vee\\cdots\\vee C_k)=\\bigwedge_i \\mathrm{push}(-,C_i).$$
     Это стандартный перевод в negation normal form: отрицания уходят на листья, а $\\vee$ под нечётной полярностью становится $\\wedge$. Размер при этом не растёт (каждый исходный узел $\\vee$ остаётся одним узлом $\\vee$ или $\\wedge$; двойные отрицания сокращаются).
  2) (Связь глубин.) Рассмотрим любой путь в $A$.
     Каждый новый внутренний гейт ($\\vee$ в $A^{\\mathrm{NNF}}$ или $\\wedge$) на этом пути соответствует некоторому исходному $\\vee$‑узлу на пути в $A$.
     Между двумя различными $\\vee$‑узлами на пути в $A$ должен встречаться хотя бы один $\\neg$ (иначе их можно слить ассоциативностью $\\vee$ без увеличения alternation depth).
     Поэтому число $\\vee$‑узлов на любом пути $\\le \\lfloor d/2\\rfloor+1$.
     Так как $\\mathrm{depth}_{\\wedge/\\vee}(A^{\\mathrm{NNF}})$ — это максимум числа $\\vee/\\wedge$‑узлов на пути, получаем заявленную оценку.
  3) (Применение Rossman’16.) Если строка bounded‑depth Frege имеет alternation depth $\\le d$ и size $\\le M$, то $A^{\\mathrm{NNF}}$ имеет De Morgan‑глубину $D\\le \\lfloor d/2\\rfloor+1$ и size $\\le O(M)$.
     Тогда по §16.149 (Rossman’16, Thm. 3 в терминах De Morgan‑глубины $D$) паритет на $n$ переменных требует
     $$M\\ \\ge\\ 2^{\\Omega\\bigl((D-1)(n^{1/(D-1)}-1)\\bigr)},$$
     что при инверсии даёт $n\\le (\\Theta((\\log M)/(D-1)))^{D-1}$, то есть $n\\le (\\Theta((\\log M)/d))^{\\Theta(d)}$.
- `Toy‑тест:` пусть $M=n^4$ и $d:=\\lceil\\log n/\\log\\log n\\rceil$.
  Тогда $(\\log M)/d=\\Theta(\\log\\log n)$ и bound $n\\le (\\Theta((\\log M)/d))^{\\Theta(d)}$ даёт лишь $n^{o(1)}$ переменных в одном PARITY‑блоке, в то время как $(\\log M)^{d-1}\\ge n$ — чисто арифметически; значит именно representability‑предпосылка ломается.
- `Статус:` доказано (сведение HR‑глубины к De Morgan‑глубине делает применение Rossman’16 к bounded‑depth Frege строкам формально корректным).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` перечитать HR §1.2 в исходном PDF: не используют ли они неявно **схемы**/DAG вместо tree‑формул при слове “formulas of size $M$”; если нет, то в Q39 следует считать representability‑часть закрытым препятствием и искать другой upper‑подход (не через широкие паритеты).

### 16.151. Исследовательский шаг: HR §1.2 “группы размера $(\\log M)^{d-1}$ и формулы размера $M$” — это лишь константно‑глубинная эвристика (с подавленным множителем $d$); при tree‑размере корректный блок $\\le \\bigl(\\Theta((\\log M)/(d-1))\\bigr)^{d-1}$, иначе нужен размер $\\ge M^{\\Omega(d)}$

- `Линза:` Уточнение формулировки (параметры/модель).
- `Утверждение:` В HR’22 формулы — **деревья**: “The size of a formula is the number of connectives … when A is viewed as a tree” (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, §2.1).
  В §1.2 они пишут: разбить переменные на группы размера $(\\log M)^{d-1}$ и “write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity of each group” (там же, §1.2, абзац начиная с “Let us consider proofs…”).
  При этом в терминах их же меры (tree‑size + alternation depth) такая фраза совместима с известными bounds только если понимать “size $M$” с полиномиальной оговоркой (напр. $M^{\\Theta(d)}$) или считать $d$ константой и подавлять множитель $(d-1)$: для size $\\le M$ максимальный блок
  $$m\\ \\le\\ \\bigl(\\Theta((\\log M)/(d-1))\\bigr)^{d-1}$$
  (см. §16.148–§16.150), а для $m=(\\log M)^{d-1}$ требуется size $\\ge M^{\\Omega(d)}$ (см. §16.149).
- `Доказательство:`
  1) HR’22 фиксируют tree‑размер и глубину как alternations $\\vee/\\neg$ (§2.1), т.е. это именно формулы fan‑out 1.
  2) По §16.150 любую такую формулу глубины $d$ можно перевести в De Morgan‑формулу глубины $\\Theta(d)$ без увеличения размера, поэтому к строкам HR‑Frege применим lower bound Rossman’16 (Thm. 3), см. §16.149.
  3) Инверсия Rossman’16 даёт: если строка имеет size $\\le M$, то паритет можно покрыть лишь на $m\\le \\bigl(\\Theta((\\log M)/(d-1))\\bigr)^{d-1}$ переменных; подстановка $m=(\\log M)^{d-1}$ в §16.149 даёт необходимый размер $\\ge M^{\\Omega(d)}$.
- `Toy‑тест:` $M=n^4$, $d=13$ (так что $\\log M=256$).
  Тогда корректный блок $m\\lesssim(256/12)^{12}\\approx 2^{53}$, а “$(\\log M)^{12}$” дал бы $m=2^{96}$ и потребовал бы размера $\\ge M^{\\Omega(12)}$.
- `Статус:` уточнено: в HR §1.2 не скрыт DAG‑шэринг (они сами определяют tree‑формулы); “$(\\log M)^{d-1}$ при size $M$” следует читать как константно‑глубинную эвристику/подавление полиномиального фактора и не использовать при растущем $d$ в Q39.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` переформулировать Q39 как проблему **формул vs схем**: проверить, где именно в Håstad’20/HR’22 нижняя оценка опирается на fan‑out 1 (формулы), и даёт ли она тот же порог для “circuit‑Frege” (строки‑схемы).

### 16.152. Исследовательский шаг: блок $(\\log M)^{d-1}$ естественен для **схем** (fan‑out $>1$) из‑за sharing; для **формул** множитель $(d-1)$ в экспоненте неизбежен

- `Линза:` Трейд‑офф (size vs depth; формулы vs схемы).
- `Утверждение:` Пусть $d\\ge 2$, $t\\in\\mathbb N$, $m:=t^{d-1}$.
  Тогда существует unbounded fan-in De Morgan‑**схема** глубины $d$ размера $\\le \\mathrm{poly}(t)\\cdot 2^{O(t)}$, вычисляющая $\\mathrm{PARITY}_m$ (и аналогично $\\neg\\mathrm{PARITY}_m$).
  Следовательно, при размере $\\le M$ можно покрыть блок $m=(\\Theta(\\log M))^{d-1}$ — это ровно та зависимость, что стоит в HR §1.2.
  Для De Morgan‑**формул** же (fan‑out $=1$) та же “DNF‑композиция” даёт $\\mathrm{size}\\le 2^{\\Theta((d-1)t)}\\cdot\\mathrm{poly}(t)$ (см. §16.148), и Rossman’16 показывает, что множитель $(d-1)$ в экспоненте tight (§16.149).
- `Доказательство:`
  1) (База $d=2$.) $\\mathrm{PARITY}_t$ и $\\neg\\mathrm{PARITY}_t$ имеют DNF/CNF с $2^{t-1}$ термами/клауза́ми (полный перебор по значениям с нужным паритетом), т.е. схема глубины 2 размера $2^{O(t)}$.
  2) (Индукция по $d$; ключ: sharing.) Разобьём $m=t^{d-1}$ переменных на $t$ блоков по $t^{d-2}$.
     Пусть $P_{d-1}$ и $N_{d-1}$ — схемы глубины $d-1$, вычисляющие паритет/непаритет блока, размера $S_{d-1}$.
     Возьмём depth‑2 DNF для $\\mathrm{PARITY}$ на $t$ “литералах” $y_1,\\dots,y_t$:
     $$\\bigvee_{a\\in\\{0,1\\}^t:\\ \\oplus a=1}\\ \\bigwedge_{i=1}^t \\ell_i(a),\\qquad \\ell_i(a):=\\begin{cases}y_i,&a_i=1\\\\ \\neg y_i,&a_i=0.\\end{cases}$$
     и подставим $y_i:=P_{d-1}(\\text{block }i)$, $\\neg y_i:=N_{d-1}(\\text{block }i)$.
     В **схеме** каждый $P_{d-1}(\\text{block }i)$ и $N_{d-1}(\\text{block }i)$ вычисляется один раз и fan‑out’ится во все $2^{t-1}$ термов, поэтому
     $$S_d\\ \\le\\ t\\cdot( S_{d-1}+S_{d-1})\\ +\\ 2^{O(t)}\\cdot\\mathrm{poly}(t)\\ =\\ O(t)\\,S_{d-1}+2^{O(t)}\\mathrm{poly}(t).$$
     Индукцией из $S_2=2^{O(t)}$ получаем $S_d\\le 2^{O(t)}\\mathrm{poly}(t)$ (доминирует верхний уровень).
  3) (Следствие для блок‑размера.) Из $S_d\\le M$ следует $t=O(\\log M)$, значит $m=t^{d-1}=(\\Theta(\\log M))^{d-1}$.
  4) (Контраст с формулами.) В формуле тот же шаг требует копировать подформулу блока внутри каждого терма, давая множитель $2^{t}$ на каждом уровне и итог $2^{\\Theta((d-1)t)}$ (§16.148); это и есть «потерянный» множитель $(d-1)$ по сравнению со схемами.
- `Toy‑тест:` $M=n^4$, $d=13$ (так что $\\log M=256$, $t=\\Theta(256)$).
  Схемный bound допускает блок $m=t^{12}\\approx (256)^{12}=2^{96}$ при размере $\\approx 2^{O(256)}=n^{O(1)}$, тогда как для формул такой блок требует размера $\\ge M^{\\Omega(12)}$ (§16.149).
- `Статус:` доказано: HR‑зависимость $m=(\\log M)^{d-1}$ объясняется именно **sharing** (fan‑out) и соответствует схемному, а не формульному режиму.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` зафиксировать, какому proof system соответствует “circuit‑Frege” (строки‑схемы) и p‑эквивалентно ли оно EF; затем проверить, распространяется ли lower bound Håstad’20 на такой усиленный режим.

### 16.153. Исследовательский шаг (toy computation): фиксированное 2×2 row‑разбиение блокирует одношаговый column‑summing

- `Линза:` Инвариант.
- `Утверждение:` Рассмотрим $4\\times 4$ grid и колонку $j=2$. Пусть
  $$S_2:=\\{e_i:=((i,2),(i,3))\\mid i=1,2,3,4\\}$$
  — горизонтальные рёбра между колонками $2$ и $3$.
  Зафиксируем row‑блоки $B_{\\mathrm{top}}:=\\{e_1,e_2\\}$ и $B_{\\mathrm{bot}}:=\\{e_3,e_4\\}$,
  а все остальные рёбра считаем singleton‑блоками. Назовём XOR‑уравнение **совместимым** с этим
  разбиением, если его поддержка — объединение целых блоков. Тогда любое совместимое уравнение
  пересекает $S_2$ в $0$, $2$ или $4$ ребра (чётность $|S_2\\cap \\mathrm{supp}|$ равна $0$ и
  сохраняется под XOR). Но промежуточное уравнение $E(\\delta(R_{2,1}),b)$ из column‑summing
  имеет $|S_2\\cap \\delta(R_{2,1})|=1$, значит оно несовместимо. Следовательно, последовательность
  Gaussian‑elimination шагов $t\\to t+1$ не может оставаться совместимой с фиксированным 2×2
  row‑разбиением; требуется base‑change (уточнение блоков хотя бы до синглтонов на $S_2$).
- `Toy‑тест:` $R_{2,1}=\\{(1,2)\\}$, поэтому
  $$\\delta(R_{2,1})=\\{(1,2)-(1,1),\\ (1,2)-(1,3),\\ (1,2)-(2,2)\\}.$$
  Пересечение с $S_2$ равно $\\{(1,2)-(1,3)\\}=\\{e_1\\}$, то есть это **половина** блока $B_{\\mathrm{top}}$.
- `Статус:` частично (toy computation: локальный инвариант показывает вынужденный base‑change на 4×4).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обобщить инвариант: для $n\\times n$ и разбиения по 2‑строчным блокам
  показать, что все префиксы нечётной длины $R_{j,t}$ несовместимы с фиксированным разбиением;
  далее проверить, может ли «батчинг» по чётным $t$ обойти эту обструкцию без смены разбиений.

### 16.154. Исследовательский шаг (proof): нечётный префикс несовместим с фиксированным 2‑строчным разбиением

- `Линза:` Инвариант.
- `Утверждение:` Пусть $G$ — $n\\times n$ grid, $1\\le j\\le n-1$, $S_j$ — горизонтальные рёбра между
  колонками $j$ и $j+1$, и $R_{j,t}=\\{(i,j):1\\le i\\le t\\}$ (как в §16.134). Зафиксируем разбиение
  $\\mathcal P$ рёбер, в котором каждое пересечение блока с $S_j$ имеет чётный размер (в частности,
  разбиение $S_j$ на пары по строкам $\\{e_{2r-1},e_{2r}\\}$ и синглтоны вне $S_j$). Тогда для любого
  нечётного $t$ множество $\\delta(R_{j,t})$ не является объединением блоков $\\mathcal P$.
  Следовательно, при column‑summing нельзя оставаться совместимым с фиксированным 2‑строчным
  разбиением для всех шагов $t\\to t+1$; нужен base‑change (или уточнение до синглтонов на $S_j$).
- `Доказательство:` Для каждого $1\\le i\\le t$ ребро $((i,j),(i,j+1))\\in S_j$ имеет ровно один конец
  в $R_{j,t}$, значит $S_j\\cap\\delta(R_{j,t})=\\{((i,j),(i,j+1)):1\\le i\\le t\\}$ и
  $|S_j\\cap\\delta(R_{j,t})|=t$. Если $\\delta(R_{j,t})$ было бы объединением блоков $\\mathcal P$,
  то $|S_j\\cap\\delta(R_{j,t})|$ был бы чётным, поскольку каждый блок пересекает $S_j$ по чётному
  числу рёбер. При нечётном $t$ получаем противоречие, значит совместимость невозможна.
- `Toy‑тест:` $n=6$, $t=3$ или $t=5$: пересечение с $S_j$ равно 3 или 5 рёбер, т.е. нечётно.
- `Статус:` доказано (общий инвариант по чётности пересечения с $S_j$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, может ли «батчинг» по чётным $t$ (Q39.S9) обойти эту обструкцию.
- `StepID:` Q39.S8-generalize-block-invariant.
- `InfoGain:` 1.

### 16.155. Исследовательский шаг (counterexample): even‑batching не избегает несовместимой строки при фиксированном 2‑строчном разбиении

- `Линза:` Эквивалентность.
- `Утверждение:` Рассмотрим «батчинг» $t\\to t+2$ через двухстрочную полосу
  $$B_{t+1,t+2}:=\\{(t+1,j),(t+2,j)\\}.$$
  Если фиксировать 2‑строчное разбиение полосы $S_j$ на пары $\\{e_{2r-1},e_{2r}\\}$ (и синглтоны вне $S_j$),
  то можно надеяться, что уравнение $E(\\delta(B_{t+1,t+2}),\\chi_{t+1}\\oplus\\chi_{t+2})$ совместимо и
  позволяет обойти нечётные префиксы $R_{j,t+1}$. Toy‑проверка ниже показывает, что это **не** устраняет
  несовместимые строки: чтобы получить $\\delta(B_{t+1,t+2})$, нужно использовать по отдельности
  два вершинных уравнения, каждое из которых нарушает фиксированное разбиение.
- `Toy‑тест:` $n=4$, $j=2$. Пусть
  $$S_2=\\{e_i:=((i,2),(i,3))\\mid i=1,2,3,4\\},\\qquad
  B_{\\mathrm{top}}=\\{e_1,e_2\\},\\ B_{\\mathrm{bot}}=\\{e_3,e_4\\}.$$
  Рассмотрим вершины $v_1=(1,2)$ и $v_2=(2,2)$.
  Вершинные уравнения $E(E(v_1),\\chi(v_1))$ и $E(E(v_2),\\chi(v_2))$ имеют пересечение с $S_2$
  ровно в $\\{e_1\\}$ и $\\{e_2\\}$ соответственно, то есть **не** являются объединениями блоков
  $\\{B_{\\mathrm{top}},B_{\\mathrm{bot}}\\}$.
  Их XOR‑сумма равна
  $$E(E(v_1)\\triangle E(v_2),\\chi(v_1)\\oplus\\chi(v_2))
    =E(\\delta(B_{1,2}),\\chi(v_1)\\oplus\\chi(v_2)),$$
  и здесь $S_2\\cap\\delta(B_{1,2})=\\{e_1,e_2\\}=B_{\\mathrm{top}}$, то есть итоговая строка совместима.
  Однако любой вывод через XOR использует **обе** исходные строки, а уже первая «частичная сумма»
  (одна из вершинных строк) несовместима с фиксированным 2‑строчным разбиением.
- `Статус:` контрпример (toy): even‑batching $t\\to t+2$ не позволяет обходить несовместимые строки без
  base‑change, поскольку сами вершинные уравнения разрезают 2‑строчные блоки.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить в общий инвариант: при фиксированном 2‑строчном разбиении любая линейная
  комбинация вершинных уравнений, добавляющая две строки за раз, всё равно требует промежуточной строки,
  нарушающей разбиение (Q39.S10).
- `StepID:` Q39.S9-even-batching-construct.
- `InfoGain:` 1.

### 16.156. Исследовательский шаг (toy computation): XOR‑дерево для $\\delta(B_{1,2})$ содержит несовместимую вершину

- `Линза:` Инвариант.
- `Утверждение:` Зафиксируем $n=4$, $j=2$ и 2‑строчное разбиение $S_2$ на блоки
  $B_{\\mathrm{top}}=\\{e_1,e_2\\}$, $B_{\\mathrm{bot}}=\\{e_3,e_4\\}$ (синглтоны вне $S_2$).
  Пусть XOR‑дерево выводит строку $\\delta(B_{1,2})$ из вершинных уравнений.
  Тогда в дереве существует вершина, чья поддержка пересекает $S_2$ по одному ребру
  (то есть строка несовместима с фиксированным разбиением).
- `Toy‑тест:` Рассмотрим проекцию на $B_{\\mathrm{top}}$ (две переменные $e_1,e_2$),
  кодируя её как вектор из $\\{00,10,01,11\\}\\subset\\mathbb F_2^2$.
  Для вершинных уравнений возможны только $00$ (вершины вне $S_2$) и $10$ или $01$
  (вершины, инцидентные одному из $e_1,e_2$), а корень равен $11$, поскольку
  $S_2\\cap\\delta(B_{1,2})=\\{e_1,e_2\\}$. В бинарном XOR‑дереве с корнем $11$
  рассмотрим детей корня: их XOR даёт $11$, значит либо пара $(10,01)$ (и нужная
  вершина найдена), либо $(11,00)$ (или $(00,11)$). В последнем случае спускаемся
  к ребёнку с меткой $11$. Поскольку листья не могут быть $11$, процесс
  останавливается на вершине с меткой $10$ или $01$, что и означает
  $|S_2\\cap\\mathrm{supp}|=1$.
- `Статус:` частично (toy computation на $4\\times4$: несовместимая строка неизбежна).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обобщить дерево‑аргумент на произвольные $t,j$ и доказать, что
  при фиксированном 2‑строчном разбиении любой XOR‑вывод $\\delta(B_{t+1,t+2})$
  из вершинных уравнений обязан проходить через строку с нечётным пересечением
  с некоторым 2‑строчным блоком (формальный инвариант base‑change).
- `StepID:` Q39.S10-block-parity-invariant.
- `InfoGain:` 1.

### 16.157. Исследовательский шаг (proof): XOR‑дерево для $\\delta(B_{t+1,t+2})$ разрезает 2‑строчный блок

- `Линза:` Инвариант.
- `Утверждение:` Пусть $G$ — $n\\times n$ grid, $1\\le j\\le n-1$, $1\\le t\\le n-2$,
  $S_j=\\{e_i:=((i,j),(i,j+1))\\mid 1\\le i\\le n\\}$, и фиксирован 2‑строчный блок
  $B_{t+1,t+2}=\\{e_{t+1},e_{t+2}\\}\\subset S_j$. Рассмотрим XOR‑дерево, выводящее строку
  $E(\\delta(B_{t+1,t+2}),\\chi_{t+1}\\oplus\\chi_{t+2})$ из вершинных уравнений $E(E(v),\\chi(v))$.
  Тогда в дереве существует вершина, чья поддержка пересекает $B_{t+1,t+2}$ ровно в одном ребре
  (то есть строка несовместима с фиксированным 2‑строчным разбиением).
- `Доказательство:` Рассмотрим проекцию $\\pi$ на координаты $e_{t+1},e_{t+2}$, т.е. векторы из
  $\\mathbb F_2^2$ с кодировкой $00,10,01,11$. Каждый вершинный лист пересекает $S_j$ не более чем в одном
  ребре, поэтому $\\pi$‑метки листьев лежат в $\\{00,10,01\\}$ (метка $11$ невозможна).
  Для корня имеем $S_j\\cap\\delta(B_{t+1,t+2})=\\{e_{t+1},e_{t+2}\\}$, значит $\\pi(\\text{root})=11$.
  Возьмём вершину $u$ с меткой $11$, ближайшую к корню. Её дети $u_1,u_2$ удовлетворяют
  $\\pi(u_1)\\oplus\\pi(u_2)=11$. По выбору $u$ ни один ребёнок не имеет метки $11$, поэтому
  $\\{\\pi(u_1),\\pi(u_2)\\}=\\{10,01\\}$. Следовательно, один из узлов $u_1,u_2$ имеет метку $10$ или $01$,
  что и означает пересечение поддержки с $B_{t+1,t+2}$ ровно в одном ребре.
- `Toy‑тест:` $n=6$, $j=2$, $t=3$. Проекция на $\\{e_3,e_4\\}$ даёт корень $11$, листья в
  $\\{00,10,01\\}$, поэтому внутри дерева неизбежен узел с меткой $10$ или $01$.
- `Статус:` доказано (общий XOR‑инвариант для любого $t,j$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, сохраняется ли обструкция при even‑batching по $2k$ строкам
  (Q39.S11b).
- `StepID:` Q39.S11-xortree-projection-general.
- `InfoGain:` 1.

### 16.158. Исследовательский шаг (counterexample): even‑batching по $2k$ строкам не даёт XOR‑дерево только из $\\pi$‑совместимых линий (toy $k=2$)

- `Линза:` Модельный стресс‑тест.
- `Утверждение:` Возьмём $n=6$, фиксируем внутреннюю колонку $j$ и полосу
  $$S_j=\\{e_i:=((i,j),(i,j+1))\\mid i=1,\\dots,6\\}.$$
  Пусть $\\pi$ — разбиение, где $S_j$ разбито на пары
  $\\{e_1,e_2\\}$, $\\{e_3,e_4\\}$, $\\{e_5,e_6\\}$ (все прочие рёбра — синглтоны).
  Рассмотрим полосу из $2k=4$ строк
  $$B_{3..6}:=\\{(i,j):i=3,4,5,6\\}.$$
  Тогда строка $E(\\delta(B_{3..6}),\\bigoplus_{i=3}^6\\chi(i,j))$ $\\pi$‑совместима
  (пересечение с $S_j$ равно $\\{e_3,e_4,e_5,e_6\\}$ — объединение двух блоков),
  но в любом XOR‑дереве, выводящем её из вершинных уравнений, присутствует несовместимая линия:
  каждое вершинное уравнение $E(E((i,j)),\\chi(i,j))$ при $i\\in\\{3,4,5,6\\}$
  пересекает $S_j$ ровно в одном ребре $e_i$, а значит не является объединением блоков $\\pi$.
- `Toy‑тест:` Проекция на координаты $e_3,e_4,e_5,e_6$ даёт у корня вектор $1111$.
  Единственные аксиомы с единицей в координате $e_i$ — вершинные уравнения в вершинах $(i,j)$,
  поэтому каждое из них должно входить в XOR‑дерево нечётное число раз; значит в дереве неизбежно
  есть несовместимые листья.
- `Статус:` контрпример (toy, $k=2$): требование «все линии $\\pi$‑совместимы» невыполнимо,
  несовместимость появляется уже на листьях.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить до внутреннего узла: проверить, может ли существовать XOR‑дерево,
  где все *внутренние* узлы $\\pi$‑совместимы (листья нет), и если да — искать ранговую/проекционную
  обструкцию для $2k$.
- `StepID:` Q39.S12-evenbatch-2k-counterexample.
- `InfoGain:` 1.

### 16.159. Исследовательский шаг (counterexample): внутренние узлы могут быть $\\pi$‑совместимы при $k=2$

- `Линза:` Инвариант.
- `Утверждение:` В toy‑режиме $k=2$ можно потребовать, чтобы **все внутренние узлы** XOR‑дерева,
  выводящего $\\delta(B_{3..6})$, были $\\pi$‑совместимы (т.е. пересекали $S_j$ по объединению блоков
  $\\{e_3,e_4\\}$ и $\\{e_5,e_6\\}$). Следовательно, инвариант «в дереве обязательно есть внутренний узел
  с нечётностью в блоке» неверен уже на $k=2$.
- `Контрпример:` Возьмём листьями четыре вершинных уравнения
  $$E(E((3,j)),\\chi(3,j)),\\ E(E((4,j)),\\chi(4,j)),\\ E(E((5,j)),\\chi(5,j)),\\ E(E((6,j)),\\chi(6,j)),$$
  и соберём бинарное дерево как
  $$\\big(E(E((3,j)),\\chi(3,j))\\oplus E(E((4,j)),\\chi(4,j))\\big)
    \\oplus\\big(E(E((5,j)),\\chi(5,j))\\oplus E(E((6,j)),\\chi(6,j))\\big).$$
  Внутренние узлы отвечают множествам вершин $U_1=\\{(3,j),(4,j)\\}$ и $U_2=\\{(5,j),(6,j)\\}$.
  Их границы удовлетворяют
  $$S_j\\cap\\delta(U_1)=\\{e_3,e_4\\},\\qquad S_j\\cap\\delta(U_2)=\\{e_5,e_6\\},$$
  то есть обе линии $\\pi$‑совместимы (пересечение с $S_j$ — ровно блок). Корень даёт
  $\\delta(U_1\\triangle U_2)=\\delta(B_{3..6})$ и тоже $\\pi$‑совместим. Следовательно,
  все внутренние узлы могут быть $\\pi$‑совместимыми, несмотря на несовместимые листья.
- `Статус:` контрпример (toy, $k=2$): блок‑cut‑инвариант для внутренних узлов не работает.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` перейти к более сильному ограничению (например, ранговой/проекционной обструкции
  или геометрическому ограничению на допустимые подмножества вершин в внутренних узлах).
- `StepID:` Q39.S13-2k-block-cut-invariant.
- `InfoGain:` 1.

### 16.160. Исследовательский шаг (counterexample): проекционный ранг внутренних $\\pi$‑совместимых линий уже равен 2 при $k=2$

- `Линза:` Коммуникация/ранг.
- `Утверждение (попытка):` Пусть $\\pi$ разбивает $S_j$ на блоки $B_1=\\{e_3,e_4\\}$ и
  $B_2=\\{e_5,e_6\\}$ (прочие рёбра — синглтоны). Для XOR‑дерева, где все внутренние узлы
  $\\pi$‑совместимы, проекция пространства внутренних линий на $B_1\\sqcup B_2$
  должна иметь ранг $\\le 1$; тогда дерево для $\\delta(B_{3..6})$ невозможно.
- `Контрпример:` Возьмём дерево из Q39.S13 с внутренними узлами
  $U_1=\\{(3,j),(4,j)\\}$ и $U_2=\\{(5,j),(6,j)\\}$.
  Их границы дают проекции на $(B_1,B_2)$:
  $$p(\\delta(U_1))=(11,00),\\qquad p(\\delta(U_2))=(00,11),$$
  а корень $\\delta(U_1\\triangle U_2)=\\delta(B_{3..6})$ даёт $p=(11,11)$.
  Векторы $(11,00)$ и $(00,11)$ линейно независимы в $\\mathbb F_2^{B_1}\\oplus\\mathbb F_2^{B_2}$,
  поэтому проекционный ранг внутренних узлов равен 2, хотя все они $\\pi$‑совместимы.
- `Статус:` контрпример (toy, $k=2$): наивная ранговая обструкция «rank$\\le 1$»
  не работает даже при полном $\\pi$‑совпадении внутренних узлов.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить инвариант, добавив геометрию подмножеств (например, требование,
  что внутренние узлы соответствуют объединению интервалов по строкам), и проверить,
  даёт ли это реальную ранговую обструкцию на $k=2$.
- `StepID:` Q39.S14-2k-projection-rank-obstruction.
- `InfoGain:` 1.

### 16.161. Исследовательский шаг (counterexample): interval‑геометрия не снижает проекционный ранг при $k=2$

- `Линза:` Инвариант.
- `Утверждение (попытка):` Если потребовать от внутренних узлов XOR‑дерева, чтобы пересечение
  $S_j\\cap\\delta(U)$ было одним row‑interval (непрерывный по строкам сегмент),
  то проекция внутренних линий на блоки $B_1=\\{e_3,e_4\\}$ и $B_2=\\{e_5,e_6\\}$ должна иметь ранг $\\le 1$.
- `Контрпример:` Возьмём дерево из Q39.S13 с внутренними узлами
  $U_1=\\{(3,j),(4,j)\\}$ и $U_2=\\{(5,j),(6,j)\\}$.
  Тогда
  $$S_j\\cap\\delta(U_1)=\\{e_3,e_4\\},\\qquad S_j\\cap\\delta(U_2)=\\{e_5,e_6\\},$$
  и оба пересечения — row‑interval’ы (по строковому порядку на $S_j$). Тем не менее проекции на
  $(B_1,B_2)$ равны
  $$p(\\delta(U_1))=(11,00),\\qquad p(\\delta(U_2))=(00,11),$$
  а значит ранг проекции внутренних узлов равен 2.
- `Toy‑тест:` $n=6$, любая внутренняя колонка $j$, $S_j=\\{e_1,\\dots,e_6\\}$ по строкам.
  Интервалы $\\{e_3,e_4\\}$ и $\\{e_5,e_6\\}$ непрерывны, но дают независимые проекции на $B_1\\sqcup B_2$.
- `Статус:` контрпример (toy, $k=2$): даже при условии «row‑interval» проекционный ранг внутренних узлов равен 2.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` уточнить геометрическое ограничение: например, требовать, чтобы внутренние узлы
  соответствовали связным областям с монотонной границей в обеих координатах (а не только интервалы на $S_j$),
  и проверить, даёт ли это реальную ранговую обструкцию при $k=2$.
- `StepID:` Q39.S15-2k-interval-rank-obstruction.
- `InfoGain:` 1.

### 16.162. Исследовательский шаг (counterexample): монотонная (prefix/suffix) геометрия не снижает проекционный ранг при $k=2$

- `Линза:` Модельный стресс‑тест.
- `Утверждение (попытка):` Если потребовать от внутренних узлов XOR‑дерева, чтобы пересечение
  $S_j\\cap\\delta(U)$ было **монотонным** по строкам (то есть префиксом или суффиксом в порядке
  $e_1,\\dots,e_m$), то проекция внутренних линий на блоки $B_1,B_2$ должна иметь ранг $\\le 1$.
- `Контрпример:` Возьмём $n=4$ и внутреннюю колонку $j$. Пусть
  $$S_j=\\{e_1,e_2,e_3,e_4\\}$$
  — горизонтальные рёбра между колонками $j$ и $j+1$ (в порядке строк), а разбиение $\\pi$ задаётся
  блоками $B_1=\\{e_1,e_2\\}$ (верхний префикс) и $B_2=\\{e_3,e_4\\}$ (нижний суффикс).
  Рассмотрим внутренние узлы
  $$U_1=\\{(1,j),(2,j)\\},\\qquad U_2=\\{(3,j),(4,j)\\}.$$
  Тогда
  $$S_j\\cap\\delta(U_1)=B_1,\\qquad S_j\\cap\\delta(U_2)=B_2,$$
  и оба пересечения монотонны (префикс/суффикс). Однако их проекции на $(B_1,B_2)$ равны
  $$p(\\delta(U_1))=(11,00),\\qquad p(\\delta(U_2))=(00,11),$$
  то есть линейно независимы; ранг проекции внутренних узлов равен 2.
- `Toy‑тест:` $n=4$, $j=2$; корень $\\delta(U_1\\triangle U_2)$ имеет пересечение $S_j\\cap\\delta(U_1\\triangle U_2)=B_1\\cup B_2$,
  а внутренние узлы $U_1,U_2$ дают монотонные префикс/суффикс.
- `Статус:` контрпример (toy, $k=2$): даже при монотонной (prefix/suffix) геометрии
  проекционный ранг внутренних узлов равен 2.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить геометрию: требовать, чтобы внутренние узлы соответствовали связным областям
  с монотонной границей **в обеих координатах** (например, прямоугольники/ступенчатые области),
  и проверить, даёт ли это реальную ранговую обструкцию при $k=2$.
- `StepID:` Q39.S16-2k-monotone-geometry-obstruction.
- `InfoGain:` 1.

### 16.163. Исследовательский шаг (counterexample): прямоугольная геометрия не снижает проекционный ранг при $k=2$

- `Линза:` Инвариант.
- `Утверждение (попытка):` Если потребовать от внутренних узлов XOR‑дерева, чтобы они
  соответствовали осево‑параллельным прямоугольникам в grid (связным областям с монотонной
  границей в обеих координатах), то проекция внутренних линий на блоки $B_1,B_2$ должна иметь
  ранг $\\le 1$.
- `Контрпример:` Возьмём $n=4$ и внутреннюю колонку $j$. Пусть
  $$S_j=\\{e_1,e_2,e_3,e_4\\}$$
  — горизонтальные рёбра между колонками $j$ и $j+1$ (в порядке строк), а разбиение $\\pi$ задаётся
  блоками $B_1=\\{e_1,e_2\\}$ (верхний прямоугольник) и $B_2=\\{e_3,e_4\\}$ (нижний прямоугольник).
  Рассмотрим внутренние узлы
  $$U_1=\\{(1,j),(2,j)\\},\\qquad U_2=\\{(3,j),(4,j)\\}.$$
  Тогда $U_1,U_2$ и корень $U_1\\triangle U_2$ — осевые прямоугольники (1×2 и 1×4),
  а пересечения с $S_j$ равны $B_1$ и $B_2$. Их проекции на $(B_1,B_2)$:
  $$p(\\delta(U_1))=(11,00),\\qquad p(\\delta(U_2))=(00,11),$$
  линейно независимы, так что проекционный ранг внутренних узлов равен 2.
- `Toy‑тест:` $n=4$, $j=2$: корень соответствует прямоугольнику $\\{(1,j),\\dots,(4,j)\\}$, а внутренние
  узлы — двум прямоугольникам по две строки; все пересечения с $S_j$ — прямоугольные блоки.
- `Статус:` контрпример (toy, $k=2$): даже при прямоугольной геометрии проекционный ранг = 2.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить геометрию: требовать «anchored»/ступенчатые области
  (монотонные в обеих координатах и привязанные к границе), и проверить, даёт ли это реальную
  ранговую обструкцию при $k=2$.
- `StepID:` Q39.S17-2k-rectangular-geometry-obstruction.
- `InfoGain:` 1.

### 16.164. Исследовательский шаг (counterexample): anchored‑staircase геометрия не снижает проекционный ранг при $k=2$

- `Линза:` Модельный стресс‑тест.
- `Утверждение (попытка):` Если потребовать от внутренних узлов XOR‑дерева, чтобы они были
  «anchored‑staircase» областями (например, в каждой колонке множество строк — префикс от верхней границы),
  то проекция внутренних линий на блоки $B_1,B_2$ должна иметь ранг $\\le 1$.
- `Контрпример:` Возьмём $n=4$ и внутреннюю колонку $j$. Пусть
  $$S_j=\\{e_1,e_2,e_3,e_4\\}$$
  — горизонтальные рёбра между колонками $j$ и $j+1$ (в порядке строк), а разбиение $\\pi$ задаётся
  блоками $B_1=\\{e_1,e_2\\}$ и $B_2=\\{e_3,e_4\\}$.
  Рассмотрим XOR‑дерево, суммирующее вершины колонки сверху вниз:
  $$((v_1\\oplus v_2)\\oplus v_3)\\oplus v_4,$$
  где $v_i=(i,j)$. Его внутренние узлы отвечают множествам
  $$U_1=\\{(1,j),(2,j)\\},\\qquad U_2=\\{(1,j),(2,j),(3,j)\\},\\qquad U_3=\\{(1,j),\\dots,(4,j)\\}.$$
  Все $U_1,U_2,U_3$ — anchored‑staircase (префиксы по строкам). При этом
  $$S_j\\cap\\delta(U_1)=\\{e_1,e_2\\},\\qquad S_j\\cap\\delta(U_2)=\\{e_1,e_2,e_3\\},$$
  и их проекции на $(B_1,B_2)$ равны
  $$p(\\delta(U_1))=(11,00),\\qquad p(\\delta(U_2))=(11,10),$$
  что линейно независимо. Следовательно, проекционный ранг внутренних узлов равен 2.
- `Toy‑тест:` $n=4$, $j=2$; дерево «сверху вниз» имеет внутренние узлы‑префиксы $\\{1,2\\}$ и $\\{1,2,3\\}$,
  дающие независимые проекции на два блока.
- `Статус:` контрпример (toy, $k=2$): anchored‑staircase (префикс‑по‑строкам) не снижает ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить ограничение: требовать, чтобы внутренние узлы были anchored‑staircase
  **и** имели “одноступенчатую” границу (например, без длинных префиксных фронтов),
  и проверить, даёт ли это реальную ранговую обструкцию при $k=2$.
- `StepID:` Q39.S18-2k-staircase-geometry-obstruction.
- `InfoGain:` 1.

### 16.165. Исследовательский шаг (counterexample): «короткий фронтир» на $S_j$ не снижает проекционный ранг при $k=2$

- `Линза:` Коммуникация/ранг.
- `Утверждение (попытка):` Если потребовать от внутренних узлов XOR‑дерева, чтобы
  пересечение $S_j\\cap\\delta(U)$ имело размер $\\le 2$ (короткий фронтир на полосе $S_j$),
  то проекция внутренних линий на блоки $B_1,B_2$ должна иметь ранг $\\le 1$.
- `Контрпример:` Возьмём $n=4$ и внутреннюю колонку $j$. Пусть
  $$S_j=\\{e_1,e_2,e_3,e_4\\}$$
  — горизонтальные рёбра между колонками $j$ и $j+1$ (в порядке строк), а разбиение $\\pi$ задаётся
  блоками $B_1=\\{e_1,e_2\\}$ и $B_2=\\{e_3,e_4\\}$.
  Рассмотрим внутренние узлы
  $$U_1=\\{(1,j),(2,j)\\},\\qquad U_2=\\{(3,j),(4,j)\\}.$$
  Тогда $|S_j\\cap\\delta(U_1)|=|S_j\\cap\\delta(U_2)|=2$, т.е. фронтир короткий, а
  $$p(\\delta(U_1))=(11,00),\\qquad p(\\delta(U_2))=(00,11)$$
  линейно независимы. Следовательно, проекционный ранг внутренних узлов равен 2.
- `Toy‑тест:` $n=4$, $j=2$: узлы $U_1,U_2$ имеют фронтир из 2 рёбер на $S_j$, но дают независимые
  проекции на $B_1\\sqcup B_2$.
- `Статус:` контрпример (toy, $k=2$): ограничение «короткий фронтир» на $S_j$ не снижает ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить условие: требовать, чтобы внутренние узлы имели **единичный** фронтир на $S_j$
  (|$S_j\\cap\\delta(U)$|=1) или аналогичное ограничение по обеим полосам, и проверить,
  даёт ли это реальную ранговую обструкцию при $k=2$.
- `StepID:` Q39.S19-2k-short-frontier-obstruction.
- `InfoGain:` 1.

### 16.166. Исследовательский шаг (proof): единичный фронтир невозможен для цели с $\\ge 3$ рёбрами на $S_j$

- `Линза:` Инвариант.
- `Утверждение (попытка):` Можно ли навязать инвариант: все **внутренние** узлы XOR‑дерева
  имеют $|S_j\\cap\\delta(U)|\\le 1$ (единичный фронтир на полосе $S_j$), чтобы контролировать ранг?
- `Доказательство (обструкция):` Пусть XOR‑дерево выводит строку с
  $$|S_j\\cap\\delta(U_{\\mathrm{root}})|\\ge 3,$$
  например $U_{\\mathrm{root}}=B_{3..6}$ (тогда пересечение с $S_j$ имеет 4 ребра).
  Листья — вершинные уравнения, и каждый лист пересекает $S_j$ не более чем в одном ребре.
  Рассмотрим любой внутренний узел $w$ с детьми $w_1,w_2$. Тогда
  $$S_j\\cap\\delta(w)=\\bigl(S_j\\cap\\delta(w_1)\\bigr)\\triangle\\bigl(S_j\\cap\\delta(w_2)\\bigr),$$
  поэтому
  $$|S_j\\cap\\delta(w)|\\le |S_j\\cap\\delta(w_1)|+|S_j\\cap\\delta(w_2)|.$$
  Если бы все внутренние узлы удовлетворяли $|S_j\\cap\\delta(\\cdot)|\\le 1$, то для корня получилось бы
  $|S_j\\cap\\delta(U_{\\mathrm{root}})|\\le 2$ — противоречие.
  Более того, из $|S_j\\cap\\delta(U_{\\mathrm{root}})|\\ge 3$ следует, что хотя бы один из двух детей
  корня имеет пересечение размера $\\ge 2$, а значит существует **не‑корневой** внутренний узел с
  фронтиром $\\ge 2$. Поэтому инвариант «единичный фронтир для всех внутренних узлов (кроме корня)»
  невозможен уже для цели $|S_j\\cap\\delta(U_{\\mathrm{root}})|\\ge 3$.
- `Toy‑тест:` $n=6$, $U_{\\mathrm{root}}=B_{3..6}$: $|S_j\\cap\\delta(U_{\\mathrm{root}})|=4$,
  значит в любом XOR‑дереве есть внутренний узел с пересечением $\\ge 2$.
- `Статус:` доказано (обструкция: «единичный фронтир» несовместим с целевой строкой ширины $\\ge 3$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужен контроль фронтира, то ослаблять инвариант: разрешить пересечение
  $\\le 2$ на одном из детей корня, либо вводить ограничение по **двум** полосам одновременно
  (например, на $S_j$ и $S_{j+1}$), и проверить, даёт ли это ранговую обструкцию при $k=2$.
- `StepID:` Q39.S20-2k-single-frontier-obstruction.
- `InfoGain:` 1.

-/

/-!
### 16.167. Исследовательский шаг (toy): двухполосный фронтир ≤2 не снижает проекционный ранг при $k=2$

- `Линза:` Коммуникация/ранг.
- `Утверждение (попытка):` Если требовать, чтобы для каждого внутреннего узла XOR‑дерева
  выполнялось $|S_j\\cap\\delta(U)|\\le 2$ и $|S_{j+1}\\cap\\delta(U)|\\le 2$, то проекционный ранг
  на разбиение $\\pi$ с двумя блоками падает до $\\le 1$.
- `Контрпример (toy):` Пусть $n=4$ и $j=1$. Обозначим горизонтальные рёбра между колонками
  $j$ и $j+1$ через $S_j=\\{e_1,\\dots,e_4\\}$ (в порядке строк), а между $j+1$ и $j+2$ —
  $S_{j+1}=\\{f_1,\\dots,f_4\\}$. Возьмём разбиение
  $$B_1=\\{e_1,e_2,f_1,f_2\\},\\qquad B_2=\\{e_3,e_4,f_3,f_4\\}.$$
  Рассмотрим внутренние узлы
  $$U_1=\\{(1,j+1),(2,j+1)\\},\\qquad U_2=\\{(3,j+1),(4,j+1)\\}.$$
  Тогда $|S_j\\cap\\delta(U_i)|=|S_{j+1}\\cap\\delta(U_i)|=2$ для $i\\in\\{1,2\\}$, но
  $$p(\\delta(U_1))=(1111,0000),\\qquad p(\\delta(U_2))=(0000,1111),$$
  что линейно независимо. Следовательно, проекционный ранг равен 2.
- `Toy‑тест:` $n=4$, $j=1$: узлы $U_1,U_2$ имеют фронтир по 2 ребра на каждой из двух полос,
  но дают независимые проекции на $B_1\\sqcup B_2$.
- `Статус:` контрпример (toy, $k=2$): двухполосное ограничение по размеру фронтира не снижает ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить условие: требовать интервальности фронтира на обеих полосах
  или ограничить совместную структуру фронтира на $S_j$ и $S_{j+1}$ (например, одинаковые строки),
  и проверить, даёт ли это реальную ранговую обструкцию при $k=2$.
- `StepID:` Q39.S23-2k-two-strip-rank-toy.
- `InfoGain:` 1.
-/

/-!
### 16.168. Исследовательский шаг (counterexample): двухполосные row-interval пересечения не снижают проекционный ранг при $k=2$

- `Линза:` Коммуникация/ранг.
- `Утверждение (попытка):` Если требовать, чтобы для каждого внутреннего узла XOR-дерева
  пересечения $S_j\\cap\\delta(U)$ и $S_{j+1}\\cap\\delta(U)$ были row-interval'ами
  (непрерывные по строкам сегменты), то проекционный ранг на разбиение $\\pi$
  с двумя блоками падает до $\\le 1$.
- `Контрпример (toy):` Возьмём конструкцию из §16.167 с $n=4$, $j=1$ и блоками
  $B_1=\\{e_1,e_2,f_1,f_2\\}$, $B_2=\\{e_3,e_4,f_3,f_4\\}$.
  Для внутренних узлов $U_1=\\{(1,j+1),(2,j+1)\\}$ и $U_2=\\{(3,j+1),(4,j+1)\\}$
  пересечения с $S_j$ и $S_{j+1}$ — это row-interval'ы
  ($\\{e_1,e_2\\}$, $\\{f_1,f_2\\}$ и $\\{e_3,e_4\\}$, $\\{f_3,f_4\\}$), но
  $$p(\\delta(U_1))=(1111,0000),\\qquad p(\\delta(U_2))=(0000,1111),$$
  что линейно независимо.
- `Toy‑тест:` $n=4$, $j=1$: оба пересечения на двух полосах — непрерывные сегменты,
  но проекционный ранг внутренних узлов равен 2.
- `Статус:` контрпример (toy, $k=2$): двухполосная row-interval геометрия не снижает ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить условие связности: требовать согласованности интервалов
  между $S_j$ и $S_{j+1}$ (например, одинаковые множества строк), и проверить,
  даёт ли это ранговую обструкцию при $k=2$.
- `StepID:` Q39.S27-2k-two-strip-interval-rank-bound.
- `InfoGain:` 1.
-/

/-!
### 16.169. Исследовательский шаг (counterexample): linked row-intervals на двух полосах не снижают проекционный ранг при $k=2$

- `Линза:` Инвариант.
- `Утверждение (попытка):` Если требовать, чтобы для каждого внутреннего узла XOR-дерева
  пересечения $S_j\\cap\\delta(U)$ и $S_{j+1}\\cap\\delta(U)$ были row-interval'ами
  **и** соответствовали одним и тем же строкам (linked intervals),
  то проекционный ранг на разбиение $\\pi$ с двумя блоками падает до $\\le 1$.
- `Контрпример (toy):` Возьмём ту же конструкцию, что в §16.167–§16.168:
  $n=4$, $j=1$, блоки $B_1=\\{e_1,e_2,f_1,f_2\\}$ и $B_2=\\{e_3,e_4,f_3,f_4\\}$,
  внутренние узлы $U_1=\\{(1,j+1),(2,j+1)\\}$ и $U_2=\\{(3,j+1),(4,j+1)\\}$.
  Тогда
  $$S_j\\cap\\delta(U_1)=\\{e_1,e_2\\},\\quad S_{j+1}\\cap\\delta(U_1)=\\{f_1,f_2\\},$$
  $$S_j\\cap\\delta(U_2)=\\{e_3,e_4\\},\\quad S_{j+1}\\cap\\delta(U_2)=\\{f_3,f_4\\},$$
  то есть на каждой полосе интервалы и они связаны одинаковыми строками.
  Но проекции
  $$p(\\delta(U_1))=(1111,0000),\\qquad p(\\delta(U_2))=(0000,1111)$$
  линейно независимы.
- `Toy‑тест:` $n=4$, $j=1$: linked row-interval'ы на обеих полосах, но проекционный ранг внутренних узлов равен 2.
- `Статус:` контрпример (toy, $k=2$): linked-условие по строкам не снижает ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить геометрию: требовать, чтобы $U$ на двухколоночной полосе
  был **прямоугольным** набором вершин (оба столбца, один row-interval),
  и проверить, даёт ли это ранговую обструкцию при $k=2$.
- `StepID:` Q39.S28-2k-two-strip-linked-intervals.
- `InfoGain:` 1.
-/

/-!
### 16.170. Исследовательский шаг (counterexample): двухполосная прямоугольная геометрия (двухколоночная полоса) не снижает проекционный ранг при $k=2$

- `Линза:` Коммуникация/ранг.
- `Утверждение (попытка):` Если требовать, чтобы каждый внутренний узел XOR-дерева соответствовал
  прямоугольнику в двухколоночной полосе (две соседние колонки, один row-interval по строкам),
  то проекционный ранг на двух внешних полосах должен быть $\\le 1$.
- `Контрпример (toy):` Возьмём $n=4$ и две соседние колонки $j$ и $j+1$ (например, $j=2$).
  Обозначим внешние полосы как $S_{\\mathrm{left}}$ (между колонками $j-1$ и $j$)
  и $S_{\\mathrm{right}}$ (между колонками $j+1$ и $j+2$).
  Разбиение $\\pi$ зададим блоками
  $$B_1=\\{e_1,e_2,f_1,f_2\\},\\qquad B_2=\\{e_3,e_4,f_3,f_4\\},$$
  где $e_i$ — рёбра на $S_{\\mathrm{left}}$, $f_i$ — рёбра на $S_{\\mathrm{right}}$ (в порядке строк).
  Возьмём внутренние узлы
  $$U_1=\\{(1,j),(2,j),(1,j+1),(2,j+1)\\},\\qquad
    U_2=\\{(3,j),(4,j),(3,j+1),(4,j+1)\\}.$$
  Тогда $U_1,U_2$ — прямоугольники $2\\times 2$ в двухколоночной полосе, а пересечения
  с $S_{\\mathrm{left}}$ и $S_{\\mathrm{right}}$ — linked row-interval'ы по тем же строкам.
  Однако
  $$p(\\delta(U_1))=(1111,0000),\\qquad p(\\delta(U_2))=(0000,1111),$$
  что линейно независимо.
- `Toy‑тест:` $n=4$, $j=2$: две прямоугольные области в двухколоночной полосе дают ранг 2 на $B_1\\sqcup B_2$.
- `Статус:` контрпример (toy, $k=2$): прямоугольники на двухколоночной полосе не снижают ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить условие: требовать anchored-прямоугольники (например, строки $[1..t]$)
  в двухколоночной полосе или явную замкнутость относительно XOR, и проверить,
  даёт ли это ранговую обструкцию при $k=2$.
- `StepID:` Q39.S29-2k-two-strip-rectangular-geometry.
- `InfoGain:` 1.
-/

/-!
### 16.171. Исследовательский шаг (counterexample): anchored-прямоугольники в двухколоночной полосе не снижают проекционный ранг при $k=2$

- `Линза:` Инвариант.
- `Утверждение (попытка):` Если требовать, чтобы каждый внутренний узел XOR-дерева
  соответствовал anchored-прямоугольнику в двухколоночной полосе (две соседние колонки,
  строки $[1..t]$ для некоторого $t$), то проекционный ранг на двух внешних полосах
  должен быть $\\le 1$.
- `Контрпример (toy):` Пусть $n=4$ и рассмотрим две соседние колонки $j$ и $j+1$.
  Обозначим внешние полосы $S_{j-1}$ (между $j-1$ и $j$) и $S_{j+1}$ (между $j+1$ и $j+2$),
  а их рёбра по строкам как $S_{j-1}=\\{e_1,\\dots,e_4\\}$ и $S_{j+1}=\\{f_1,\\dots,f_4\\}$.
  Разбиение $\\pi$ зададим блоками
  $$B_1=\\{e_1,e_2,f_1,f_2\\},\\qquad B_2=\\{e_3,e_4,f_3,f_4\\}.$$
  Возьмём внутренние узлы
  $$U_1=\\{(1,j),(2,j),(1,j+1),(2,j+1)\\},\\qquad
    U_2=\\{(1,j),\\dots,(4,j),(1,j+1),\\dots,(4,j+1)\\}.$$
  Тогда $U_1$ и $U_2$ — anchored-прямоугольники (строки $[1..2]$ и $[1..4]$),
  а проекции дают
  $$p(\\delta(U_1))=(1111,0000),\\qquad p(\\delta(U_2))=(1111,1111),$$
  что линейно независимо.
- `Toy‑тест:` $n=4$, $j=2$: два anchored-прямоугольника в двухколоночной полосе дают ранг 2 на $B_1\\sqcup B_2$.
- `Статус:` контрпример (toy, $k=2$): anchored-прямоугольники не снижают ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить условие: требовать, чтобы дерево было **prefix-цепочкой**
  (каждый внутренний узел добавляет ровно одну строку) и проверить,
  остаётся ли ранг $\\ge 2$ в этом режиме.
- `StepID:` Q39.S30-2k-two-strip-anchored-rectangles.
- `InfoGain:` 1.
-/

/-!
### 16.172. Исследовательский шаг (counterexample): prefix-цепочка anchored-прямоугольников не снижает проекционный ранг при $k=2$

- `Линза:` Трейд‑офф.
- `Утверждение (попытка):` Если ограничить XOR-дерево режимом **prefix-цепочки**:
  каждый внутренний узел получается добавлением ровно одной новой строки (anchored-прямоугольники
  с рядами $[1..t]$), то проекционный ранг на двух внешних полосах должен быть $\\le 1$.
- `Контрпример (toy):` Возьмём $n=4$ и две соседние колонки $j$ и $j+1$.
  Обозначим внешние полосы $S_{j-1}=\\{e_1,\\dots,e_4\\}$ и $S_{j+1}=\\{f_1,\\dots,f_4\\}$ (по строкам).
  Разбиение $\\pi$ зададим блоками $B_1=\\{e_1,e_2,f_1,f_2\\}$ и $B_2=\\{e_3,e_4,f_3,f_4\\}$.
  Рассмотрим prefix-цепочку прямоугольников
  $$U_t=\\{(1,j),\\dots,(t,j),(1,j+1),\\dots,(t,j+1)\\},\\qquad t=1,2,3,4.$$
  Тогда каждое $U_t$ — anchored-прямоугольник, а переход $U_t\\to U_{t+1}$ добавляет ровно одну строку.
  При этом проекции:
  $$p(\\delta(U_2))=(1111,0000),\\qquad p(\\delta(U_4))=(1111,1111)$$
  линейно независимы. Следовательно, ранг внутренних узлов цепочки равен 2.
- `Toy‑тест:` $n=4$, $j=2$: цепочка $U_1\\subset U_2\\subset U_3\\subset U_4$ даёт ранг 2 на $B_1\\sqcup B_2$.
- `Статус:` контрпример (toy, $k=2$): prefix-цепочка anchored-прямоугольников не снижает ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попробовать ограничение на **чередование полос**: требовать, чтобы
  каждое добавление строки меняло только одну из двух полос (левую или правую), и проверить,
  появляется ли ранговая обструкция при $k=2$.
- `StepID:` Q39.S31-2k-two-strip-prefix-chain.
- `InfoGain:` 1.
-/

/-!
### 16.173. Исследовательский шаг (counterexample): чередование полос в XOR‑шаге не снижает проекционный ранг при $k=2$

- `Линза:` Коммуникация/ранг.
- `Утверждение (попытка):` Пусть для каждого XOR‑шага выполняется условие **чередования полос**:
  для родителя $U$ и его детей $U',U''$ пересечения с двумя внешними полосами
  удовлетворяют
  $$S_{j-1}\\cap\\delta(U)=S_{j-1}\\cap\\delta(U')\\quad\\text{и}\\quad
    S_{j+1}\\cap\\delta(U)=S_{j+1}\\cap\\delta(U'').$$
  То есть при переходе от $U$ к каждому ребёнку изменяется только **одна** полоса.
  Кажется, что такой режим должен подавлять независимость на двух полосах.
- `Контрпример (toy):` Возьмём $n=4$ и две соседние колонки $j$ и $j+1$ (например, $j=2$).
  Обозначим внешние полосы $S_{j-1}=\\{e_1,\\dots,e_4\\}$ и $S_{j+1}=\\{f_1,\\dots,f_4\\}$ (по строкам),
  а блоки $B_1=\\{e_1,e_2,f_1,f_2\\}$ и $B_2=\\{e_3,e_4,f_3,f_4\\}$.
  Рассмотрим два узла:
  $$U_L=\\{(1,j),(2,j)\\}\\quad\\text{(левая колонка, строки 1–2)},$$
  $$U_R=\\{(1,j+1),(2,j+1)\\}\\quad\\text{(правая колонка, строки 1–2)}.$$
  Тогда $S_{j-1}\\cap\\delta(U_L)=\\{e_1,e_2\\}$ и $S_{j+1}\\cap\\delta(U_L)=\\varnothing$,
  а $S_{j-1}\\cap\\delta(U_R)=\\varnothing$ и $S_{j+1}\\cap\\delta(U_R)=\\{f_1,f_2\\}$.
  Для родителя $U=U_L\\triangle U_R$ получаем
  $$S_{j-1}\\cap\\delta(U)=\\{e_1,e_2\\},\\qquad S_{j+1}\\cap\\delta(U)=\\{f_1,f_2\\},$$
  то есть условие «чередования полос» выполнено (левая полоса совпадает с $U_L$, правая — с $U_R$).
  Но проекции
  $$p(\\delta(U_L))=(1100,0000),\\qquad p(\\delta(U_R))=(0011,0000)$$
  линейно независимы, и ранг внутренних узлов равен 2.
- `Toy‑тест:` $n=4$, $j=2$: XOR‑шаг с чередованием полос оставляет два независимых вектора на $B_1\\sqcup B_2$.
- `Статус:` контрпример (toy, $k=2$): чередование полос на XOR‑шаге не снижает ранг.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` усилить условие: требовать, чтобы каждый ребёнок совпадал с родителем
  на **обеих** полосах, кроме ровно одной строки (строгое «одно‑строчное» изменение),
  и проверить, удаётся ли тогда получить ранговую обструкцию при $k=2$.
- `StepID:` Q39.S32-2k-two-strip-alternating-strip.
- `InfoGain:` 1.
-/
