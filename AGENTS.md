# AGENTS.md
# P vs NP — Verified-First Research Notebook

## Миссия

Цель проекта — доказать или опровергнуть гипотезу **P ≠ NP** в стандартной модели вычислений
(полиномиальное время на детерминированной Тьюринг‑машине vs недетерминированной),
с приведением результата к **строго проверяемому ядру**.

**Критерий “решено”:**
- В репозитории существует главный формальный файл (см. `formal/`) с теоремой вида:
  - `theorem P_ne_NP : P ≠ NP` (или `P_eq_NP : P = NP`),
  - которая **компилируется** в proof assistant’е (Lean/Coq/Isabelle — выбрать один),
  - и зависит только от лемм, которые:
    1) доказаны формально в этом же дереве, или
    2) импортированы из официальной стандартной библиотеки (mathlib/Coq stdlib/…).

Markdown‑текст (`docs/`) — это **читаемая навигация и объяснение**, но **истина — в `formal/`**.
Doc‑comments в `formal/Notes/*.lean` — это **заметки**, не формальные доказательства.

---

## Репозиторий: минимальная структура

- `P_vs_NP.md` — короткий статус и ссылки (не более 1–2 экранов).
- `docs/`
  - `roadmap.md` — выбранные треки и “дерево зависимостей”.
  - `open_questions.md` — активный backlog микро‑вопросов (с NextStepID).
  - `agent_brief.md` — оперативная память проекта (с Do-not-repeat).
  - `sources.md` — ровно те источники, на которые реально опираемся.
- `formal/`
  - `PvNP/` — определения и доказательства.
  - `Notes/` — длинные исследовательские заметки в Lean (doc‑comments, Lean-first).
- `scripts/`
  - `verify_notebook.py` — проверка структуры md (если есть).
  - `verify_all.sh` — общий CI‑гейт: markdown + формализация.
- `agent/logs/` — логи прогонов (опционально).

---

## Модель доверия

Любой артефакт типа `Proof` считается “принятым”, только если:
- есть Lean‑доказательство (формально компилируется), либо
- это тривиальный шаг, который можно проверить компилятором (например, рефактор определения).

Внешние утверждения фиксируются **только** как точные ссылки в `docs/sources.md`
и/или в заметках `formal/Notes/*.lean` (без добавления аксиом).

---

## Роль: WORKER

В каждом запуске ты — WORKER.
Делаешь **ровно 1 исследовательский шаг** и доводишь до проверяемого артефакта
(см. “Артефакты”).

Обязательные действия:
- обновить один пункт `docs/open_questions.md` (статус + NextStepID),
- обновить `docs/agent_brief.md` (коротко, без роста),
- прогнать `scripts/verify_all.sh`,
- сделать 1 commit с осмысленным сообщением.

Примечание: активные вопросы в `docs/open_questions.md` обязаны иметь `LeanTarget:`
для привязки Proof‑шагов к конкретному Lean‑файлу.

---

## Режим исследования: 1 запуск = 1 артефакт

### Шаги WORKER (строгий протокол)

0) Прочитай `docs/agent_brief.md` и проверь Do-not-repeat.
1) Выбери 1 активный пункт из `docs/open_questions.md`.
2) Выбери **одну** линзу (см. ниже) — не повторяй линзу 2 прогона подряд.
3) Сформулируй **формальное утверждение** (определения + кванторы).
4) Сделай toy‑тест/ограниченный случай и сначала попробуй **убить** идею:
   - контрпример,
   - сведение к известному,
   - упор в барьер.
5) Если выжило: доведи до одного артефакта (ниже).
6) Обязательный barrier‑протокол: relativization / natural proofs / algebrization (не словами, а по шаблону).
7) Обнови `open_questions.md` и `agent_brief.md`.
8) `scripts/verify_all.sh` → commit.

Примечание: если не можешь добавить Lean‑код, выбирай артефакт **не Proof**.

---

## Артефакты (ровно один на запуск)

Выбери один тип и произведи его полностью.

### 1) Proof
- Обязательно содержит **реальный Lean‑код** (не только текст в doc‑comments).
- Добавь или измени `def`/`theorem` в `formal/PvNP/*.lean` (или другом ядре `formal/`).
- Файл компилируется, `scripts/verify_all.sh` проходит.
- В `docs/` добавь краткий “человеческий” комментарий на 5–15 строк и ссылку на файл.

### 2) Counterexample
- Явный контрпример/оракул/конструкция.
- Если возможно — формализуй как маленький лемматический факт или хотя бы toy‑код.
- В `docs/` фиксируй: что именно опровергнуто, какие условия нужны.

### 3) Exact citation
- Не переписывай “фольклор”.
- Дай точный первоисточник: авторы, год, название, **номер теоремы/леммы/страница**.
- В `docs/` добавь 2–6 строк: как это закрывает/исправляет пункт open_questions.

### 4) Toy computation
- Малый эксперимент/перебор/скрипт, который проверяет ограниченный случай.
- Результат должен быть воспроизводимым (фиксированный seed, входы сохранены).

### 5) Reduction/Equivalence (Exact)
- Формально записанная редукция/эквивалентность между утверждениями.
- Идеально: формализована как теорема.
- В `docs/` — ровно 5–10 строк смысла + зависимости.

### 6) Barrier certificate
- Короткий документ, что выбранная линия неизбежно упирается в барьер при данных предпосылках.
- Обязательно: точный источник (Exact citation) и явная привязка к вашему шагу.

---

## Линзы (выбери одну)

1) Эквивалентность (перевод в другой объект/формулировку)
2) Сжатие/канонизация (эффективная нормализация)
3) Инвариант (монотонный параметр)
4) Двойственность (NP vs coNP, search vs decision)
5) Трейд‑офф (time–space, depth–size, randomness–advice)
6) Коммуникация/ранг (матрицы, протоколы, lower bounds)
7) Алгебраизация (IPS/PC, арифметизация, идеалы)
8) Модельный стресс‑тест (оракулы/релятивизация)

---

## Барьер‑протокол (обязательный, по шаблону)

В конце каждого шага (в заметке шага в `formal/Notes/*.lean` или кратко в `docs/open_questions.md`) заполни:

### A) Relativization check
- `Relativizes?` да/нет/не уверен.
- Если “нет”: укажи **конкретный шаг**, который ломается при добавлении оракула (что именно использует “нерелятивизирующую” информацию).
- Если “да/не уверен”: попробуй сформулировать оракульный вариант и проверь,
  не появляется ли известный оракул‑контрпример.

### B) Natural proofs check
Если шаг касается **схемных нижних оценок через свойство функций**, оцени:
- `Largeness`: свойство имеет плотность ≥ 2^{-poly(n)}? (или “редкое”?)
- `Constructivity`: распознаётся за poly(2^n) по таблице истинности?
- `Usefulness`: отделяет ли класс схем C от случайной функции?
И укажи: **где именно вы выходите** из рамок natural proofs (если выходите).

### C) Algebrization check
Если используется арифметизация/полиномиальные расширения:
- Укажи, является ли метод “алгебраизирующим”.
- Если нет: объясни конкретно, что не сохраняется при “extension oracle”.
- Если да/не уверен: попробуй свести к известному барьеру.

---

## Стратегия (обязательна: выбираем трек и держимся его)

Проект выбирает **1 основной трек** и максимум **1 вспомогательный**.
Это фиксируется в `docs/roadmap.md` и кратко в `docs/agent_brief.md`.

Рекомендуемые треки (пример):
- Трек A: Circuit lower bounds (NP ⊄ P/poly) + обход natural proofs
- Трек B: Proof complexity / IPS / lower bounds → перенос на схемы
- Трек C: Алгоритмический подход “из P=NP вывести неожиданно быстрые алгоритмы”
- Трек D: Алгебраическая сложность / GCT (если есть компетенция)

**Правило:** 80% шагов должны быть в основном треке. Иначе — дрейф и нет прогресса.

---

## Контрольные задачи (чтобы убедиться, что конвейер работает)

До “настоящего прорыва” обязателен прогон на 3 известных фактах:
1) Релятивизация: оформить как Barrier certificate + Exact citation.
2) Natural proofs: оформить определения + барьер как Exact citation и краткий вывод.
3) Algebrization: оформить как Exact citation + toy‑пример “почему арифметизация не спасает”.

Эти 3 должны быть верифицированы пайплайном (verify_all + понятные ссылки).

---

## Политика источников и поиск

- Любое “известно” → либо `Exact citation`, либо не писать.
- Ссылки должны быть первоисточниками (статья/книга), не блогами, если возможно.
- Web-поиск/скачивание — только под конкретный пункт open_questions.
- Каждый реально используемый источник фиксируется в `docs/sources.md`
  и (если есть) кладётся в `resources/` с manifest’ом.

---

## Политика текста (чтобы репозиторий не раздувался)

- `P_vs_NP.md` — очень короткий, только статус и ссылки на ключевые файлы.
- В `docs/` пишем только новое математическое содержание.
- Длинные рассуждения — в `formal/Notes/<Topic>.lean` (doc‑comments).
- Если файл > 4000 строк или > 300KB — дробим по темам.

---

## Anti-loop & progress gate

Каждый прогон заканчивается:
- `StepID: Qxx.Sy.slug` (уникален)
- `InfoGain: 0/1/2`
- и ровно одним артефактом.

Запрещено:
- повторять StepID из `Do-not-repeat` в `docs/agent_brief.md`,
- делать “косметические” правки без артефакта,
- делать 2 артефакта за прогон.

Если не получилось:
- пометь пункт как `BLOCKED`,
- запиши 1 строку “blocker”,
- назначь новый NextStepID,
- остановись.

---

## Git и CI

Перед коммитом:
- `scripts/verify_all.sh`

Коммит‑сообщение:
- `<StepID>: <тип артефакта> — <суть в 1 строке>`

PR/merge (если используете):
- не мержить, пока CI не зелёный.

---
