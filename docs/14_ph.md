## 14. Полиномиальная иерархия (PH): определения и базовые коллапсы

Полиномиальная иерархия — это «надстройка» над NP/coNP,
получающаяся из чередования кванторов (или эквивалентно — из оракульных машин).

### 14.1. Определения через оракулы

Напомним: в оракульной модели машина может за один шаг спрашивать принадлежность строки оракулу.

**Определение.** Положим $\Sigma_0^p=\Pi_0^p:=\mathrm{P}$. Для $k\ge 0$ определим рекурсивно:

- $\Sigma_{k+1}^p := \mathrm{NP}^{\Sigma_k^p}$,
- $\Pi_{k+1}^p := \mathrm{coNP}^{\Sigma_k^p}$,
- $\mathrm{PH} := \bigcup_{k\ge 0} \Sigma_k^p$.

**Лемма 14.1.** $\Sigma_1^p=\mathrm{NP}$ и $\Pi_1^p=\mathrm{coNP}$.

*Доказательство.* По определению $\Sigma_1^p=\mathrm{NP}^{\Sigma_0^p}=\mathrm{NP}^{\mathrm{P}}$.
Покажем, что $\mathrm{NP}^{\mathrm{P}}=\mathrm{NP}$: оракульная NP‑машина
делает полиномиально много запросов к оракулу из $\mathrm{P}$
и работает полиномиальное время.
Каждый запрос можно вычислить детерминированно за полиномиальное время
«внутри» той же ветви недетерминированного вычисления, поэтому суммарное
время остаётся полиномиальным; значит $\mathrm{NP}^{\mathrm{P}}\subseteq\mathrm{NP}$.
Обратное включение тривиально (не делать запросов).
Аналогично $\Pi_1^p=\mathrm{coNP}^{\mathrm{P}}=\mathrm{coNP}$. $\square$

### 14.2. Кванторная характеристика (для дальнейших доказательств)

Эквивалентно оракульному определению, уровни PH можно задавать
через фиксированное число чередований кванторов над полиномиально
проверяемым предикатом.

**Определение (кванторная форма).** Язык $L$ принадлежит $\Sigma_k^p$ (для $k\ge 1$), если
существует полином $p$ и детерминированная полиномиальная машина $V$ такие, что
$$x\in L \iff \exists y_1\in\{0,1\}^{p(|x|)}\ \forall y_2\in\{0,1\}^{p(|x|)}\ \exists y_3\cdots Q_k y_k:\ V(x,y_1,\dots,y_k)=1,$$
где кванторы чередуются и $Q_k$ равен $\exists$ при нечётном $k$
и $\forall$ при чётном $k$.

Аналогично, $L\in\Pi_k^p$ если формула начинается с $\forall$ и далее чередуется.

**Лемма 14.2.** Кванторная форма эквивалентна оракульному определению уровней PH.

*Комментарий.* Это стандартная теорема; подробное доказательство — Arora–Barak
(разделы про PH). Ниже мы используем кванторную форму только для
доказательства коллапса (Теорема 14.4).

### 14.3. Базовые факты о коллапсах

**Теорема 14.3.** Если $\mathrm{P}=\mathrm{NP}$, то $\mathrm{PH}=\mathrm{P}$.

*Доказательство.* Докажем по индукции, что для всех $k\ge 0$
выполняется $\Sigma_k^p=\mathrm{P}$.

База: $\Sigma_0^p=\mathrm{P}$ по определению.

Переход: пусть $\Sigma_k^p=\mathrm{P}$. Тогда
$$\Sigma_{k+1}^p=\mathrm{NP}^{\Sigma_k^p}=\mathrm{NP}^{\mathrm{P}}=\mathrm{NP}.$$
При предположении $\mathrm{P}=\mathrm{NP}$ получаем $\Sigma_{k+1}^p=\mathrm{P}$.
Следовательно, все уровни равны $\mathrm{P}$, а значит и $\mathrm{PH}=\mathrm{P}$. $\square$

**Теорема 14.4 (коллапс на уровне $k$, классическая).** Если для некоторого
$k\ge 1$ выполнено $\Sigma_k^p=\Pi_k^p$, то $\mathrm{PH}=\Sigma_k^p$.

*Доказательство.* Достаточно показать, что $\Sigma_{k+1}^p\subseteq\Sigma_k^p$
и $\Pi_{k+1}^p\subseteq\Sigma_k^p$, после чего по индукции получим включение
всех более высоких уровней в $\Sigma_k^p$.

Возьмём $L\in\Sigma_{k+1}^p$ и воспользуемся кванторной формой.
Тогда существует полином $p$ и полиномиальный предикат $V$ такие, что
$$x\in L\iff \exists y\in\{0,1\}^{p(|x|)}:\ \Psi(x,y),$$
где $\Psi(x,y)$ — формула с $k$ чередованиями, начинающаяся с $\forall$
(то есть язык $L':=\{\langle x,y\rangle:\ \Psi(x,y)\}$ лежит в $\Pi_k^p$).

По предположению коллапса $\Pi_k^p=\Sigma_k^p$, значит $L'\in\Sigma_k^p$. Тогда
$$L=\{x:\ \exists y\ \langle x,y\rangle\in L'\}$$
является *экзистенциальной проекцией* языка из $\Sigma_k^p$. Такая проекция
добавляет один ведущий квантор $\exists$, но если $k\ge 1$, то добавление
ведущего $\exists$ к $\Sigma_k^p$ не увеличивает уровень: оно поглощается
первым квантором $\exists$ уже имеющейся $\Sigma_k$‑формулы для $L'$.
(Можно объединить два экзистенциальных блока в один, увеличив полином
на длину свидетеля.)

Следовательно, $L\in\Sigma_k^p$, то есть $\Sigma_{k+1}^p\subseteq\Sigma_k^p$.

Аналогично для $L\in\Pi_{k+1}^p$ имеем представление
$x\in L\iff \forall y\ \Theta(x,y)$, где $\Theta$ задаёт язык из $\Sigma_k^p$.
Перепишем как дополнение:
$$x\in L\iff \neg\exists y:\ \neg\Theta(x,y).$$
Язык $\{\langle x,y\rangle:\ \neg\Theta(x,y)\}$ лежит в $\Pi_k^p=\Sigma_k^p$,
а далее тем же аргументом получаем $L\in\Pi_k^p=\Sigma_k^p$.

Итак, уровни $k+1$ (и, следовательно, все выше) лежат в $\Sigma_k^p$,
а тривиально $\Sigma_k^p\subseteq\mathrm{PH}$.
Значит $\mathrm{PH}=\Sigma_k^p$. $\square$

### 14.4. Karp–Lipton: NP ⊆ P/poly ⇒ коллапс PH

Напомним: $\mathrm{P/poly}$ — языки, распознаваемые семейством булевых схем полиномиального размера (неравномерная модель).

**Лемма 14.5 (поиск из решения для SAT).** Если $\mathrm{SAT}\in\mathrm{P/poly}$,
то существует семейство схем $\{W_m\}$ полиномиального размера, которое
по коду выполнимой SAT‑формулы $\varphi$ возвращает удовлетворяющее присваивание.

*Доказательство.* Пусть $\{C_m\}$ — семейство схем полиномиального размера, решающее SAT на формулах длины $m$.

Используем стандартную self‑reduction: фиксируем переменные по одной.
Для $i=1,\dots,t$ (где $t$ — число переменных в $\varphi$) проверяем
выполнимость формулы с добавленной фиксацией $u_i=0$; если выполнима —
ставим $u_i:=0$, иначе $u_i:=1$.
Если $\varphi$ выполнима, этот процесс построит удовлетворяющее присваивание
за полиномиальное число вызовов SAT.

Заменяя каждый вызов SAT схемой $C_m$ и разворачивая последовательные
вычисления в схему, получаем $W_m$ размера
$\mathrm{poly}(m)\cdot|C_m|=\mathrm{poly}(m)$. $\square$

**Теорема 14.6 (Karp–Lipton, классическая).** Если $\mathrm{NP}\subseteq\mathrm{P/poly}$, то $\mathrm{PH}=\Sigma_2^p$.

*Доказательство.* Достаточно показать $\Pi_2^p\subseteq\Sigma_2^p$
и применить Теорему 14.4 при $k=2$.

Пусть $L\in\Pi_2^p$. По кванторной форме существует полиномиальный
предикат $R$ и полином $p$ такие, что
$$x\in L \iff \forall y\in\{0,1\}^{p(|x|)}\ \exists z\in\{0,1\}^{p(|x|)}:\ R(x,y,z)=1.$$ 

Рассмотрим язык
$$A:=\{\langle x,y\rangle:\ \exists z\ R(x,y,z)=1\}.$$ 
Тогда $A\in\mathrm{NP}$, а значит по предположению $A\in\mathrm{P/poly}$.

По Cook–Levin (цитируется, в верификаторной форме) из отношения
$\exists z\ R(x,y,z)$ можно полиномиально построить SAT‑формулу $\varphi_{x,y}$,
такая что $\varphi_{x,y}$ выполнима тогда и только тогда, когда существует
подходящий $z$; и более того, из любого удовлетворяющего присваивания
$\varphi_{x,y}$ можно полиномиально извлечь такой $z$.

Так как $\mathrm{SAT}\in\mathrm{P/poly}$, по Лемме 14.5 существует
полиномиальная witness‑схема для SAT. Композицией
(построение $\varphi_{x,y}$ → witness для $\varphi_{x,y}$ → извлечение $z$)
получаем: для каждого фиксированного $x$ существует полиномиальная схема $W_x$,
которая по входу $y$ выдаёт некоторый свидетель $z=W_x(y)$, удовлетворяющий
$R(x,y,z)$, если такой существует.

Тогда
$$x\in L \iff \exists W_x\ \forall y:\ R(x,y,W_x(y))=1,$$
что является $\Sigma_2^p$‑описанием. Следовательно, $\Pi_2^p\subseteq\Sigma_2^p$,
значит $\Sigma_2^p=\Pi_2^p$ и по Теореме 14.4 имеем
$\mathrm{PH}=\Sigma_2^p$. $\square$
