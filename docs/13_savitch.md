## 13. Теорема Сэвича: NSPACE ⊆ SPACE (полное доказательство)

**Определение (SPACE/NSPACE).** Для функции $s(n)$ класс
$\mathrm{SPACE}(s(n))$ — языки, решаемые детерминированной МТ,
использующей $O(s(n))$ рабочих ячеек на входе длины $n$.
Аналогично $\mathrm{NSPACE}(s(n))$ — для недетерминированной МТ.

Рабочая память не включает входную ленту (вход только читается).

**Теорема 13.1 (Savitch).** Для любой $s(n)\ge \log n$ верно
$$\mathrm{NSPACE}(s(n))\subseteq\mathrm{SPACE}(s(n)^2).$$

*Доказательство.* Пусть язык $L$ распознаётся недетерминированной МТ $N$
с использованием $s(n)$ памяти. Зафиксируем вход $x$ длины $n$.

Рассмотрим **граф конфигураций** $G_x$: вершины — конфигурации $N$
на входе $x$ (содержимое рабочих лент, позиции головок, состояние),
а ребро $c\to c'$ существует, если $N$ может за один шаг перейти из $c$ в $c'$.

Так как память ограничена $s(n)$, длина описания конфигурации равна
$O(s(n))$, а число конфигураций ограничено
$$|V(G_x)|\le 2^{O(s(n))}=:M.$$

Вход $x$ принимается тогда и только тогда, когда в $G_x$ существует путь
из стартовой конфигурации $c_{\mathrm{start}}$ в некоторую принимающую
конфигурацию $c_{\mathrm{acc}}$.

Ключевой подалгоритм — процедура $\mathrm{REACH}(c_1,c_2,\ell)$:
существует ли путь из $c_1$ в $c_2$ длины $\le \ell$.

- База: $\ell=0$ — ответ «да» тогда и только тогда, когда $c_1=c_2$.
- Переход: для $\ell>0$ положим $m=\lceil \ell/2\rceil$ и проверим
$$\exists c\in V(G_x):\ \mathrm{REACH}(c_1,c,m)\ \wedge\ \mathrm{REACH}(c,c_2,m).$$

Если путь длины $\le \ell$ существует, то на его середине есть вершина $c$,
разбивающая путь на две части длины $\le m$.
Обратно, если существуют обе половины, их конкатенация даёт путь длины
$\le 2m\ge\ell$.

Чтобы решить достижимость в $G_x$, достаточно проверить
$\mathrm{REACH}(c_{\mathrm{start}},c_{\mathrm{acc}},M)$ для всех $c_{\mathrm{acc}}$.

**Оценка памяти.** Одна конфигурация кодируется $O(s(n))$ битами.
В каждом рекурсивном вызове храним $(c_1,c_2,\ell)$ и текущего кандидата $c$ —
это $O(s(n))$ памяти. Глубина рекурсии равна $O(\log M)=O(s(n))$,
значит суммарная память $O(s(n)\cdot s(n))=O(s(n)^2)$.

Таким образом, достижимость в $G_x$ решается детерминированно в
$O(s(n)^2)$ памяти, и значит $L\in\mathrm{SPACE}(s(n)^2)$. $\square$

**Следствие 13.2.** $\mathrm{NPSPACE}=\mathrm{PSPACE}$.

*Доказательство.* Очевидно $\mathrm{PSPACE}\subseteq\mathrm{NPSPACE}$.
Обратно, применяем Теорему 13.1 к $s(n)=n^k$ и получаем
$\mathrm{NPSPACE}\subseteq\mathrm{PSPACE}$. $\square$

**Следствие 13.3.** $\mathrm{NP}\subseteq\mathrm{PSPACE}$.

*Доказательство.* $\mathrm{NP}\subseteq\mathrm{NPSPACE}$
(недетерминированное полиномиальное время использует не больше
полиномиальной памяти), а затем Следствие 13.2. $\square$
