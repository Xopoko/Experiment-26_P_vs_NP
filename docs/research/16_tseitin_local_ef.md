# P vs NP — исследовательские шаги 16.153–16.221 (flat local‑EF(s): Q41–Q43)

Этот файл — часть `docs/research/` (см. [index](index.md)).
Главный файл: `P_vs_NP.md`.

[Открыть главный ноутбук](../../P_vs_NP.md)

### 16.153. Исследовательский шаг: «строки‑схемы» = extension variables ⇒ circuit‑Frege p‑симулируется EF (и наоборот), так что спасение representability через sharing фактически переводит Q39 в EF‑режим

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $C$ — De Morgan‑**схема** (DAG) размера $S$ и глубины $d$ над входами $x_1,\\dots,x_m$.
  Тогда существует расширение переменных $\\{p_g\\}_{g\\in\\mathrm{Gates}(C)}$ и набор extension‑аксиом (по одной на гейт)
  $$p_g\\ \\leftrightarrow\\ \\mathrm{op}_g\\bigl(p_{g_1},\\dots,p_{g_k}\\bigr)$$
  такой, что в EF можно “представлять” значение схемы формулой размера $O(S)$ и глубины $O(d)$: выходная переменная $p_{\\mathrm{out}}$ играет роль результата $C(x)$.
  Следовательно, любой proof system, в котором линии разрешены как схемы (sharing), по сути совпадает (p‑эквивалентен) с EF: sharing ↔ abbreviations через extension variables (см. также Buss’97, §5.1 для мотивации).
- `Доказательство:`
  1) (Кодирование схемы extension‑переменными.) Для каждого входного литерала положим $p_{x_i}:=x_i$, $p_{\\neg x_i}:=\\neg x_i$.
     Для каждого внутреннего гейта $g$ схемы с детьми $g_1,\\dots,g_k$ вводим свежую переменную $p_g$ и добавляем extension‑формулу
     $$p_g\\leftrightarrow (p_{g_1}\\vee\\cdots\\vee p_{g_k})\\quad\\text{или}\\quad p_g\\leftrightarrow (p_{g_1}\\wedge\\cdots\\wedge p_{g_k})$$
     (или $p_g\\leftrightarrow\\neg p_{g_1}$, если $g$ — NOT‑гейт). Эти формулы имеют размер $O(k)$ и константную alternation‑глубину.
  2) (Почему это “представление”.) После добавления всех extension‑формул получаем, что каждый $p_g$ (под любым назначением $x$) равен значению под‑схемы $C_g(x)$; в частности, $p_{\\mathrm{out}}$ вычисляет $C(x)$.
     В терминах “representing parity” из HR §1.2 это означает: если паритет вычислим схемой глубины $d$ и размера $M$, то он автоматически представим EF‑линией размера $O(M)$ и глубины $O(d)$ (за счёт extension variables, т.е. DAG‑шеринга).
  3) (Связь с circuit‑Frege.) “Frege‑линии как схемы” можно рассматривать как Frege с разрешённым DAG‑шэрингом внутри строки; заменяя каждый общий под‑узел схемы на extension‑переменную, получаем EF‑режим с полиномиальным overhead по размеру.
     Обратное направление тривиально: EF‑линия уже есть формула с extension‑переменными, а значит вычисляет некоторую DAG‑схему (где extension‑переменные играют роль узлов с fan‑out $>1$).
- `Toy‑тест:` схемы из §16.152 для $\\mathrm{PARITY}_{t^{d-1}}$ глубины $d$ и размера $2^{O(t)}\\mathrm{poly}(t)$ превращаются в EF‑представления того же размера, т.е. при $t=\\Theta(\\log M)$ дают “блок” $(\\log M)^{d-1}$ без противоречия с Rossman’16 (потому что Rossman — про **формулы** без sharing).
- `Статус:` доказано: “починить” representability переходом от формул к схемам означает перейти к EF/circuit‑Frege (abbreviations); значит следующий вопрос Q39 — применимы ли LB Håstad’20/HR’22 к такому усиленному режиму.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` в Håstad’20/HR’22 найти точку, где требуется fan‑out 1 (дерево) в switching/evaluation‑аргументе, и решить: (a) LB распространяется на circuit‑Frege/EF‑вариант, или (b) именно здесь нужен нерелятивизирующий/не‑natural шаг.

### 16.154. Исследовательский шаг: EF даёт polynomial‑size refutation Tseitin(Grid) уже при $O(1)$‑глубине (в терминах $\\vee/\\neg$), поэтому LB Håstad’20 принципиально не распространяется на EF/circuit‑Frege

- `Линза:` Модельный стресс‑тест (что ломается при усилении модели).
- `Утверждение:` Для любого ограниченного по степени графа $G$ и заряда $\\chi$ с $\\bigoplus_{v\\in V}\\chi(v)=1$ существует EF‑рефутация
  $F:=\\mathrm{TseitinCNF}(G,\\chi)$ полиномиального размера, в которой **каждая строка имеет константную глубину** в смысле HR/Håstad (чередования $\\vee/\\neg$).
  В частности, для grid это даёт poly‑size refutation при глубине $O(1)$.
  Следовательно, любая попытка распространить нижнюю оценку Håstad’20 (Cor. 6.6) с bounded‑depth Frege на “circuit‑Frege”/EF невозможна: EF уже обходит порог $\\Omega(\\log N/\\log\\log N)$.
- `Доказательство:`
  1) (EF‑каркас.) См. §16.88: вводим extension‑переменные $p_v$ для XOR‑уравнений у вершин и переменную $P:=\\bigoplus_v p_v$.
     Из эквивалентности клауз ↔ XOR‑уравнений получаем $p_v\\leftrightarrow\\chi(v)$, откуда $P\\leftrightarrow\\bigoplus_v\\chi(v)=1$ и, значит, $P$.
     С другой стороны, раскрывая определения $p_v$ и перегруппировывая XOR (ассоц./коммутативность + сокращение $x\\oplus x\\leftrightarrow 0$), получаем
     $$P\\leftrightarrow\\bigoplus_{v\\in V}\\ \\bigoplus_{e\\ni v} x_e\\leftrightarrow\\bigoplus_{e\\in E}(x_e\\oplus x_e)\\leftrightarrow 0,$$
     то есть $\\neg P$. Противоречие.
  2) (Почему глубина $O(1)$.) Каждый extension‑шаг задаётся формулой константной глубины:
     бинарный XOR $a\\oplus b$ — константная формула в базисе $\\{\\vee,\\neg\\}$ (через $\\wedge:=\\neg(\\neg\\cdot\\vee\\neg\\cdot)$), а extension‑аксиомы имеют вид $p\\leftrightarrow\\varphi$ с $\\varphi$ константной глубины.
     Ассоциативность/коммутативность/сокращение XOR в §16.88 — это тавтологии на константном числе переменных, значит их инстанцирования в EF можно делать, не увеличивая глубину строк (линии содержат только переменные $p_*$, $x_*$ и константы).
  3) (Связь с circuit‑Frege.) По §16.153 любая “строка‑схема/sharing” p‑эквивалентна EF через extension variables, так что схемный режим действительно даёт тот же эффект: глубина строк может оставаться константой, скрывая большую схемную глубину в abbreviations.
- `Toy‑тест:` для 3‑регулярного $G$ формулы $p_v\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$ и шаги XOR‑перегруппировки используют лишь константные шаблоны (§16.88), а число введённых extension‑переменных $O(|V|+|E|)$.
- `Статус:` доказано (stress‑тест показывает: пороговая LB Håstad’20 — по сути про **формулы** fan‑out 1; в EF/circuit‑Frege глубина не является ограничением).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` в Håstad’20 явно указать, что доказательство работает только для Frege без extension variables, и локализовать в switching/evaluation‑аргументе место, где попытка включить extension‑переменные рушится (нужно “согласованно” рестриктить новые переменные, т.е. вычислять скрытую схему).

### 16.155. Исследовательский шаг: точка, где Håstad’20 жёстко использует “variables = edges” (fan‑out 1 по сути) — локальность через $\\mathrm{supp}(\\alpha)\\subseteq V$; extension variables ломают эту локальность и потому не входят в switching/evaluation‑framework

- `Линза:` Модельный стресс‑тест (локализовать зависимость от модели).
- `Утверждение:` В Håstad’20 локальная техника (restrictions + evaluations) опирается на то, что **каждая переменная соответствует ребру** и потому “затрагивает” лишь два конца ребра: для частичного присваивания $\\alpha$ определён
  $$\\mathrm{supp}(\\alpha)\\subseteq V\\quad\\text{как множество вершин, смежных с присвоенными переменными}$$
  (Håstad’20, §3: определения “complete assignment”, “support”, “locally consistent”, см. `../../resources/downloads/hastad_2020_small_depth_frege_tseitin_grids.pdf`, абзац начиная с “On a set $X$ of nodes …” и Definition 3.1).
  Из этого следует ключевой инвариант: путь decision‑tree глубины $t$, читающий только edge‑переменные, задаёт присваивание с
  $$|\\mathrm{supp}(\\alpha)|\\le 2t.$$
  Поэтому “малая глубина” автоматически означает “малая геометрическая поддержка” на grid, и можно говорить про giant component и замыкание $\\mathrm{cl}(X)$.
  Для EF/circuit‑Frege extension‑переменные $p$ не являются edge‑переменными: если трактовать $p$ как сокращение глобальной функции от многих рёбер (например, PARITY большого блока), то у неё нет малой поддержки, и инвариант $|\\mathrm{supp}(\\alpha)|\\le O(t)$ для глубины $t$ ломается уже при одном запросе $p$.
  Поэтому Håstad‑техника (в текущем виде) **не предназначена** для EF/circuit‑Frege: либо $p$ считается “свободной” переменной без поддержки (тогда теряется смысл extension‑аксиом), либо $\\mathrm{supp}(p)$ становится большим и рушит локальные леммы.
- `Доказательство:`
  1) (Локальность edge‑переменных.) В Tseitin(G) каждая переменная $x_e$ соответствует ребру $e=\\{u,v\\}$, значит при присваивании $x_e:=b$ в поддержку добавляются только $u,v$.
     Поэтому если decision tree спрашивает $t$ разных $x_e$, то множество затронутых вершин имеет размер $\\le 2t$.
  2) (Где это используется.) В §3 Håstad’20 рассматривает частичные присваивания с $|X|\\le 2n/3$ (где $X=\\mathrm{supp}(\\alpha)$) и выводит существование “giant component” в дополнении $X^c$ и корректность понятия $\\mathrm{cl}(X)$; это фундаментально для “locally consistent” и для того, чтобы evaluations работали с деревьями малой глубины.
  3) (Контр‑пример с extension variable.) Пусть в EF введена extension‑переменная $p\\leftrightarrow\\bigoplus_{e\\in E'} x_e$ для множества рёбер $E'$ размера $\\Theta(n)$ (например, граница большого прямоугольника).
     Если пытаться включить $p$ в ту же геометрию, естественно положить $\\mathrm{supp}(p):=\\bigcup_{e\\in E'}\\mathrm{supp}(x_e)$, что имеет размер $\\Theta(n)$.
     Тогда один запрос $p$ (глубина 1) уже порождает $|\\mathrm{supp}(\\alpha)|=\\Theta(n)$, и связка “глубина ⇒ малая поддержка” исчезает.
     Если же объявить $\\mathrm{supp}(p)=\\varnothing$ (чтобы сохранить $|\\mathrm{supp}(\\alpha)|\\le 2t$), то “locally consistent” перестаёт контролировать согласованность $p$ с рёбрами и extension‑аксиомами: значение $p$ можно выбирать независимо от $x$ без увеличения поддержки, что именно и даёт EF‑обход (§16.154).
- `Toy‑тест:` глобальная переменная $P$ из §16.88 (XOR всех вершинных $p_v$) в “поддержке‑по‑смыслу” затрагивает всю сетку, но как атомарная переменная имеет глубину 1; это несовместимо с инвариантом $|\\mathrm{supp}(\\alpha)|\\le 2t$.
- `Статус:` доказано как локализация: точка “fan‑out 1 / variables=edges” встроена в саму геометрию support/closure; потому Håstad‑LB не переносится на EF/circuit‑Frege без новой техники.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попробовать сформулировать промежуточную модель “local‑EF”: разрешать extension‑переменные только с $|\\mathrm{supp}(p)|\\le \\mathrm{polylog}(n)$, и проверить, остаётся ли возможным EF‑доказательство глубины $o(\\log n/\\log\\log n)$ или техника Håstad’20 начинает работать.

### 16.156. Исследовательский шаг: “local‑EF(s)” (extension‑переменные с ограниченной геометрической поддержкой) и факт: EF‑опровержение Tseitin через глобальный XOR неизбежно вводит переменную с поддержкой $\\Omega(|V|)$

- `Линза:` Инвариант (геометрическая поддержка).
- `Определение (support формулы):` Для Tseitin на графе $G=(V,E)$ и формулы $\\varphi$ над edge‑переменными $\\{x_e\\}_{e\\in E}$ положим
  $$\\mathrm{supp}(\\varphi):=\\bigcup\\{\\{u,v\\}: e=\\{u,v\\}\\in E\\text{ и }x_e\\text{ встречается в }\\varphi\\}\\ \\subseteq V.$$
- `Определение (local‑EF(s)):` Назовём EF‑доказательство $s$‑локальным, если для каждого extension‑шага $p\\leftrightarrow\\varphi$ выполняется
  $$|\\mathrm{supp}(\\varphi)|\\le s.$$
  (Т.е. сокращать разрешено только “локальные” подформулы по вершинам графа.)
- `Утверждение:` EF‑рефутация Tseitin(Grid) из §16.88/§16.154 **не** является $s$‑локальной ни для какого $s=o(|V|)$:
  в ней неизбежно появляется extension‑переменная $P$ с $|\\mathrm{supp}(P)|=\\Omega(|V|)$.
- `Доказательство:`
  1) В §16.88 вводится переменная $P\\leftrightarrow\\bigoplus_{v\\in V} p_v$, где каждое $p_v$ кодирует локальный паритет инцидентных рёбер вершины $v$.
  2) Для grid каждая вершина имеет константную степень, значит $|\\mathrm{supp}(p_v)|=O(1)$, но
     $$\\mathrm{supp}(P)=\\bigcup_{v\\in V}\\mathrm{supp}(p_v)=V,$$
     поскольку каждое $p_v$ зависит от рёбер, инцидентных $v$.
     Следовательно, $|\\mathrm{supp}(P)|=|V|=\\Theta(n^2)$.
  3) Значит для этого EF‑доказательства требуется $s\\ge |V|$; при $s=\\mathrm{polylog}(n)$ оно не попадает в local‑EF(s).
- `Toy‑тест:` для torus‑grid $|V|=n^2$: даже если все локальные $p_v$ имеют поддержку $\\le 5$, переменная $P$ имеет поддержку $n^2$.
- `Статус:` доказано (локальный вариант EF исключает “глобальный XOR”‑обход).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` понять, можно ли обойтись без глобальной переменной типа $P$ в local‑EF($\\mathrm{polylog}(n)$), или же любая poly‑size рефутация должна где‑то “раздуть” поддержку; попробовать адаптировать поддержку‑ориентированную версию evaluation‑метода Håstad’20 к local‑EF(s).

### 16.157. Исследовательский шаг: в local‑EF(s) локальность восстанавливается с потерей $\\times s$: decision tree глубины $t$ даёт присваивание с $|\\mathrm{supp}|\\le O(s\\,t)$ (если поддержка extension‑переменных определена через их формулы)

- `Линза:` Инвариант.
- `Утверждение:` Рассмотрим proof‑линию/формулу над edge‑переменными $\\{x_e\\}$ и extension‑переменными $\\{p_i\\}$, где каждый $p_i$ введён правилом extension $p_i\\leftrightarrow\\varphi_i(x)$ и $|\\mathrm{supp}(\\varphi_i)|\\le s$ (то есть мы находимся в local‑EF(s) по §16.156).
  Определим поддержку переменных как
  $$\\mathrm{supp}(x_{\\{u,v\\}}):=\\{u,v\\},\\qquad \\mathrm{supp}(p_i):=\\mathrm{supp}(\\varphi_i).$$
  Тогда любой decision tree $T$ глубины $t$, который спрашивает только переменные из $\\{x_e\\}\\cup\\{p_i\\}$, порождает по любому пути частичное присваивание $\\alpha$ с
  $$|\\mathrm{supp}(\\alpha)|\\le (2+s)\\,t.$$
  Следовательно, для $s=\\mathrm{polylog}(n)$ инвариант “малая глубина $\\Rightarrow$ малая геометрическая поддержка” (из Håstad’20/HR’22, §3) переносится на local‑EF(s) с потерей множителя $s$.
- `Доказательство:` Пусть путь в $T$ содержит $t$ запросов.
  Каждый запрос edge‑переменной $x_e$ добавляет в поддержку не более 2 вершин.
  Каждый запрос extension‑переменной $p_i$ по определению добавляет не более $|\\mathrm{supp}(\\varphi_i)|\\le s$ вершин.
  Поэтому суммарно по подаддитивности
  $$|\\mathrm{supp}(\\alpha)|\\le 2\\cdot(\\#\\text{edge‑запросов})+s\\cdot(\\#\\text{ext‑запросов})\\le (2+s)t.$$
- `Toy‑тест:` если $s=5$ и $t=100$, то $|\\mathrm{supp}(\\alpha)|\\le 700$, т.е. такая ветвь “видит” лишь локальный фрагмент grid и остаётся в режиме giant component/closure при больших $n$.
- `Статус:` доказано (это первый формальный мост “evaluation‑метод + локальные extension‑переменные”: локальность не исчезает, а деградирует на множитель $s$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться переписать Definition 2.11 (t‑evaluation) HR’22 с поддержкой, учитывающей extension‑переменные, и проверить, сохраняются ли ключевые леммы “locally consistent” при условии $|\\mathrm{supp}(\\varphi_i)|\\le s$ (параметры должны меняться как $t\\mapsto t\\cdot s$).

### 16.158. Исследовательский шаг: устранение запросов extension‑переменных в decision tree (local‑EF(s) ⇒ edge‑only DT с глубиной $O(s\\,t)$)

- `Линза:` Эквивалентность (модель запросов: $x$ vs $(x,p)$).
- `Утверждение:` Пусть $G=(V,E)$ — граф максимальной степени $\\Delta$ (для grid: $\\Delta\\le 4$).
  Рассмотрим переменные рёбер $\\{x_e\\}_{e\\in E}$ и extension‑переменные $\\{p_i\\}$, где для каждого $i$ задан extension‑шаг
  $$p_i\\leftrightarrow\\varphi_i(x)\\qquad\\text{и}\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s.$$
  Обозначим через $\\mathrm{vars}(\\varphi_i)$ множество **различных** edge‑переменных, встречающихся в $\\varphi_i$, и положим
  $$m:=\\max_i |\\mathrm{vars}(\\varphi_i)|\\le \\Delta s/2.$$
  Тогда для любого decision tree $T$ глубины $t$, который может спрашивать переменные из $\\{x_e\\}\\cup\\{p_i\\}$, существует decision tree $T_x$ над одними edge‑переменными $\\{x_e\\}$ глубины $\\le (1+m)\\,t$ такое, что для любого полного присваивания $a\\in\\{0,1\\}^E$ выполнено
  $$T_x(a)\\ =\\ T\\bigl(a,\\ (\\varphi_i(a))_i\\bigr),$$
  т.е. $T_x$ симулирует $T$ на **согласованных** присваиваниях, где $p_i=\\varphi_i(x)$.
  В частности, на grid глубина увеличивается не более чем до $(1+2s)\\,t=O(s\\,t)$.
- `Доказательство:`
  1) (Оценка $m$.) Каждая переменная $x_{\\{u,v\\}}$ добавляет в $\\mathrm{supp}(\\varphi_i)$ вершины $u,v$, поэтому все рёбра из $\\mathrm{vars}(\\varphi_i)$ лежат внутри индуцированного подграфа на $\\mathrm{supp}(\\varphi_i)$.
     При степени $\\le\\Delta$ число рёбер в таком подграфе не превосходит $\\Delta|\\mathrm{supp}(\\varphi_i)|/2\\le \\Delta s/2$, откуда $|\\mathrm{vars}(\\varphi_i)|\\le \\Delta s/2$.
  2) (Локальная замена запроса $p_i$.) Зафиксируем порядок переменных из $\\mathrm{vars}(\\varphi_i)$.
     Построим decision tree $D_i$ глубины $|\\mathrm{vars}(\\varphi_i)|$, который последовательно спрашивает эти edge‑переменные и в листе вычисляет значение булевой формулы $\\varphi_i$ на собранных значениях.
     Тогда запрос $p_i$ в $T$ (на согласованных присваиваниях) эквивалентен прохождению $D_i$ с последующим переходом в соответствующего сына (“$p_i=0$” или “$p_i=1$”).
  3) (Глобальная симуляция.) Заменим в $T$ каждый внутренний узел, спрашивающий $p_i$, на копию $D_i$ со склейкой листьев по предыдущему пункту.
     Получаем дерево $T_x$, спрашивающее только edge‑переменные. По глубине: каждый исходный запрос edge‑переменной даёт +1, каждый запрос $p_i$ даёт +$|\\mathrm{vars}(\\varphi_i)|\\le m$, значит для любого пути
     $$\\mathrm{depth}_{T_x}\\le (\\#\\text{edge‑запросов})+m\\cdot(\\#\\text{ext‑запросов})\\le (1+m)\\,t.$$
     Корректность на $a$ следует из индукции по структуре дерева: в узле $p_i$ новая развилка выбирает ветвь ровно по $\\varphi_i(a)$.
- `Toy‑тест:` если $p\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$ (локальный XOR на 3 рёбрах), то запрос $p$ заменяется тремя запросами $x_{e_1},x_{e_2},x_{e_3}$ и вычислением паритета в листе; это и есть $D_i$ при $|\\mathrm{vars}(\\varphi)|=3$.
- `Статус:` доказано (модель запросов к $p$ “сворачивается” в модель запросов к $x$ с мультипликативной потерей $O(s)$ на bounded‑degree графах).
- `Барьер‑чек:` r — применимо (чисто синтаксическая симуляция, релятивизируется), NP — неприменимо (не «natural property»), alg — неприменимо (нет арифметизации).
- `Следующий шаг:` применить это как технический лемматизатор при попытке перенести HR’22: разрешить в определении $t$‑evaluation запросы $p_i$ (для local‑EF(s)), затем заменить их на edge‑запросы и отследить, что все пороги в леммах “locally consistent/closure” сохраняются при $t\\mapsto O(s\\,t)$.

### 16.159. Исследовательский шаг: черновик “HR‑evaluation для local‑EF(s)” через расширенную поддержку и $s$‑стоимость запросов

- `Линза:` Инвариант (геометрическая поддержка = “видимая область”).
- `Утверждение (черновик‑патч к HR’22, §2.4–2.7):` Пусть $X=\\{x_e\\}$ — edge‑переменные $\\mathrm{Tseitin}(G_n)$ на grid, и в доказательстве разрешены extension‑переменные $P=\\{p_i\\}$ с аксиомами
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $\\mathrm{supp}(\\varphi)$ — множество вершин, инцидентных рёбрам, чьи переменные встречаются в $\\varphi$ (как в HR’22: $\\mathrm{supp}(x_{\\{u,v\\}})=\\{u,v\\}$).
  Тогда естественное обобщение HR’22 Definition 2.2 / Cor. 2.7 такое:

  1) (**Расширенная поддержка присваивания.**) Для частичного присваивания $\\alpha$ на $X\\cup P$ положим
     $$\\mathrm{supp}_s(\\alpha):=\\mathrm{supp}(\\alpha\\!\upharpoonright_X)\\ \\cup\\ \\bigcup_{p_i\\in\\mathrm{dom}(\\alpha)}\\mathrm{supp}(\\varphi_i).$$

  2) (**$s$‑локальная согласованность.**) $\\alpha$ называется $s$‑locally consistent, если при $U=\\mathrm{supp}_s(\\alpha)$ существует $\\beta$ на $X$, *complete on* $\\mathrm{closure}(U)$ (в смысле HR: присваивает все edge‑переменные, инцидентные $\\mathrm{closure}(U)$), такая что:
     (i) $\\beta$ расширяет $\\alpha\\!\upharpoonright_X$; (ii) удовлетворяет всем parity‑constraints на $\\mathrm{closure}(U)$; (iii) для всех присвоенных $p_i$ выполнено $\\alpha(p_i)=\\varphi_i(\\beta)$.

  3) (**Стоимость ветви/дерева.**) Для ветви $\\tau$ decision tree (на переменных $X\\cup P$) положим
     $$\\mathrm{cost}_s(\\tau):=2\\cdot\\#(x\\text{‑запросов в }\\tau)+\\sum_{p_i\\in\\mathrm{dom}(\\tau)}|\\mathrm{supp}(\\varphi_i)|,$$
     и $\\mathrm{cost}_s(T):=\\max_{\\tau\\in T}\\mathrm{cost}_s(\\tau)$, так что грубо $\\mathrm{cost}_s(T)\\le (s+2)\\,\\mathrm{depth}(T)$.

  4) (**Ожидаемый аналог HR Cor. 2.7.**) Если $\\alpha$ $s$‑locally consistent и
     $$|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2,$$
     то “trimmed restriction” $T\\lceil\\alpha$ (как у HR, но с pairwise $s$‑local consistency) корректен и снова $s$‑locally consistent.

  В таком виде можно попытаться перенести HR’22 Definition 2.11 (t‑evaluation) на local‑EF(s), при замене всех порогов вида
  $|\\mathrm{supp}(\\alpha)|+2\\,\\mathrm{depth}(T)\\le n/2$ на $|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2$ (или грубее $t\\mapsto O(s\\,t)$).
- `Toy‑тест:` если $p\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$, то запрос $p$ “стоит” 3 ребра/6 концов; это согласовано с §16.158 (запрос $p$ разворачивается в 3 edge‑запроса).
- `Статус:` черновик (нужна аккуратная проверка: где именно в доказательствах HR’22 используется, что переменные *именно edges*, и что добавление запроса $p_i$ корректно “оплачивается” локальным witness на $\\mathrm{closure}(\\mathrm{supp}_s)$).
- `Барьер‑чек:` r — применимо (вся схема support/closure/DT релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q41: (a) выбрать точную модель local‑EF(s) (запрещаем $\\varphi_i(P)$ или считаем $\\mathrm{supp}(p_i)$ как поддержку полностью развёрнутой формулы), (b) формально доказать (или найти контрпример) пункт (4) как аналог Cor. 2.7, и только после этого пытаться переносить Lemma 2.13 (порог $t\\le n/16$ станет $t\\le \\Theta(n/s)$).

### 16.160. Исследовательский шаг: контрпример — “nested extension” без полного разворачивания поддержки делает local‑EF(s) бессодержательной

- `Линза:` Модельный стресс‑тест.
- `Утверждение (контрпример к «naive nested‑locality»):`
  Пусть разрешены extension‑аксиомы вида $p\\leftrightarrow\\varphi(X,P_{<p})$, и “наивная поддержка” шага измеряется только по *синтаксически встречающимся edge‑переменным* в $\\varphi$ (extension‑переменные считаются атомами и не разворачиваются в $X$).
  Тогда существует цепочка extension‑шагов, где **каждый** шаг имеет поддержку $\\le 2$ (одна edge‑переменная), но итоговая переменная вычисляет XOR от $m$ edge‑переменных и потому имеет “истинную” поддержку $\\Theta(m)$.
  Следовательно, без запрета nesting или без разворачивания поддержки определение local‑EF(s) перестаёт контролировать геометрию (и не может служить базой для $\\mathrm{supp}_s/\\mathrm{cost}_s$‑версии Cor. 2.7).
- `Доказательство (явная конструкция):`
  Возьмём попарно различные edge‑переменные $x_{e_1},\\dots,x_{e_m}$ и введём extension‑переменные $p_1,\\dots,p_m$:
  $$p_1\\leftrightarrow x_{e_1},\\qquad p_i\\leftrightarrow (p_{i-1}\\oplus x_{e_i})\\ \\ (2\\le i\\le m).$$
  (Операция $\\oplus$ выражается формулой константного размера в базисе $\\vee,\\wedge,\\neg$.)
  Тогда по индукции $p_i\\equiv\\bigoplus_{j\\le i}x_{e_j}$.
  При наивном подсчёте поддержки каждый $\\varphi_i$ содержит **ровно одну** edge‑переменную $x_{e_i}$, поэтому $|\\mathrm{supp}(\\varphi_i)|=2$ для всех $i$.
  Но “развёрнутая” формула для $p_m$ содержит все $x_{e_1},\\dots,x_{e_m}$, так что
  $$\\mathrm{supp}(p_m)=\\bigcup_{j\\le m}\\mathrm{supp}(x_{e_j}).$$
  В частности, если выбрать рёбра $e_j$ попарно без общих концов, то $|\\mathrm{supp}(p_m)|=2m$.
- `Toy‑тест:` на $n\\times n$ grid можно взять $m=\\lfloor n^2/2\\rfloor$ попарно непересекающихся рёбер (matching); тогда “naive” $s=2$, но $|\\mathrm{supp}(p_m)|=\\Theta(n^2)$.
- `Статус:` контрпример (фиксирует выбор модели: либо flat $\\varphi_i(X)$, либо $\\mathrm{supp}(p_i)$ считается по полностью развёрнутой формуле в $X$).
- `Барьер‑чек:` r — применимо (чисто синтаксический трюк), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q41 принять “flat” (запрет $\\varphi_i(P)$) или “unfolded‑support” модель и уже в ней доказывать/опровергать аналог HR Cor. 2.7 для $\\mathrm{supp}_s/\\mathrm{cost}_s$.

### 16.161. Исследовательский шаг: доказательство аналога HR Cor. 2.7 для **flat** local‑EF(s) через $\\mathrm{supp}_s/\\mathrm{cost}_s$

- `Линза:` Инвариант.
- `Утверждение (Q41.S3-proof-cor27-analogue-flat):`
  Работаем в **flat**‑модели: extension‑аксиомы имеют вид
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $X$ — edge‑переменные Tseitin($G_n$), а $\\varphi_i$ не содержит extension‑переменных.
  Используем определения $\\mathrm{supp}_s(\\alpha)$, $s$‑local consistency и $\\mathrm{cost}_s(T)$ из §16.159.
  Тогда выполняется прямой аналог HR’22 Cor. 2.7 (p. 8; PDF p. 10) с заменой $|\\mathrm{supp}(\\alpha)|+2\\,\\mathrm{depth}(T)$ на
  $|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)$:
  если $T$ — (обычный) decision tree над переменными $X\\cup P$ и $\\alpha$ $s$‑locally consistent, и
  $$|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2,$$
  то “trimmed restriction” $T\\lceil\\alpha$ (как у HR, но по pairwise $s$‑local consistency) корректен и является $s$‑locally consistent decision tree
  (в частности, $T\\lceil\\alpha\\ne\\varnothing$).
- `Доказательство:`
  Достаточно показать, что существует хотя бы одна ветвь $\\tau$ дерева $T$, такая что $\\alpha\\cup\\tau$ $s$‑locally consistent.
  Построим её жадно, спускаясь от корня к листу.
  На шаге имеем частичное присваивание
  $$\\gamma:=\\alpha\\cup\\tau_{\\le k}$$
  (префикс ветви), которое $s$‑locally consistent, и положим $U:=\\mathrm{supp}_s(\\gamma)$.
  Для любой вершины дерева $T$ любой префикс ветви имеет $\\mathrm{cost}_s(\\tau_{\\le k})\\le \\mathrm{cost}_s(T)$, поэтому по условию
  $$|U|\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(\\tau_{\\le k})\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2.$$
  Рассмотрим следующую переменную запроса в $T$ (в текущем узле) и выберем значение, сохраняющее $s$‑локальную согласованность.
  1) **Edge‑запрос $x_e$.**
     Из $s$‑local consistency для $\\gamma$ существует witness $\\beta$ на $X$, complete on $\\mathrm{closure}(U)$, удовлетворяющий parity‑constraints на $\\mathrm{closure}(U)$ и согласованный со всеми присвоенными $p_j$.
     Обозначим через $E_P$ множество edge‑переменных, встречающихся в $\\varphi_j$ для всех $p_j\\in\\mathrm{dom}(\\gamma)$.
     Расширим $\\gamma\\!\upharpoonright_X$ до частичного присваивания $\\delta$ на $X$, присвоив все переменные из $E_P$ так, как в $\\beta$.
     Тогда $\\mathrm{supp}(\\delta)\\subseteq U$, и $\\delta$ локально согласовано в смысле HR Definition 2.2 (witness — та же $\\beta$).
     По HR Lemma 2.3 (p. 6; PDF p. 8) существует локально согласованное $\\delta'\\supseteq\\delta$ с $x_e$ в домене.
     Пусть $b:=\\delta'(x_e)$. Тогда $\\gamma':=\\gamma\\cup\\{x_e\\mapsto b\\}$ $s$‑locally consistent:
     все ранее присвоенные $p_j$ остаются совместимыми, т.к. их формулы $\\varphi_j$ используют только переменные из $E_P$, уже зафиксированные в $\\delta$ и потому неизменные в $\\delta'$.
  2) **Extension‑запрос $p_i$.**
     Пусть $E_i:=\\mathrm{vars}(\\varphi_i)$ — множество edge‑переменных в $\\varphi_i$.
     Начнём с той же $\\delta$ (фиксирует $E_P$ по witness $\\beta$) и последовательно применим HR Lemma 2.3, добавляя в домен $\\delta$ переменные из $E_i$.
     По построению на каждом шаге поддержка остаётся в $U\\cup\\mathrm{supp}(\\varphi_i)$, а
     $$|U\\cup\\mathrm{supp}(\\varphi_i)|\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(\\tau_{\\le k})+|\\mathrm{supp}(\\varphi_i)|\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(\\tau_{\\le k+1})\\le n/2,$$
     так что лемма применима.
     Получаем локально согласованное $\\delta'$ на $X$, которое присваивает все переменные из $E_P\\cup E_i$.
     Положим $b:=\\varphi_i(\\delta')$ и $\\gamma':=\\gamma\\cup\\{p_i\\mapsto b\\}$.
     Тогда $\\gamma'$ $s$‑locally consistent: witness задаётся completion’ом $\\delta'$ на $\\mathrm{closure}(U\\cup\\mathrm{supp}(\\varphi_i))$,
     а равенство $p_i=\\varphi_i(X)$ выполнено по определению $b$.
  В обоих случаях мы нашли значение для следующего запроса, сохранив $s$‑local consistency и инвариант $|\\mathrm{supp}_s(\\gamma')|\\le n/2$.
  Продолжая до листа, получаем ветвь $\\tau$ с $\\alpha\\cup\\tau$ $s$‑locally consistent.
  Значит множество ветвей, pairwise $s$‑locally consistent с $\\alpha$, непусто, и “trimmed restriction” $T\\lceil\\alpha$ определён и $s$‑locally consistent (по определению).
- `Toy‑тест:` если $p\\leftrightarrow x_e$ (поддержка 2), то случай “extension‑запрос” буквально сводится к HR Lemma 2.3 для $x_e$.
- `Статус:` доказано (в flat‑модели; снимает главный риск в §16.159: ограничение “ветка мала ⇒ closure‑witness существует” переносится на local‑EF(s) при замене $2\\,\\mathrm{depth}$ на $\\mathrm{cost}_s$).
- `Барьер‑чек:` r — применимо (аргумент целиком про support/closure/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` используя этот аналог Cor. 2.7, переписать HR Definition 2.11 (t‑evaluation) для flat local‑EF(s) и проверить, где в Lemma 2.13 требуется точнее контролировать порог (ожидаемо $t\\le\\Theta(n/s)$).

### 16.162. Исследовательский шаг: flat local‑EF(s) — “t‑evaluation” и перенос HR Lemma 2.13 с порогом $t\\le\\Theta(n/s)$

- `Линза:` Эквивалентность.
- `Определение (cost‑t evaluation, flat local‑EF(s)):` Зафиксируем $n\\times n$ grid $G_n$, edge‑переменные $X$ и extension‑переменные $P$ с аксиомами
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $\\varphi_i$ не содержит переменных из $P$ (flat).
  Скажем, что множество формул $\\Gamma$ имеет **cost‑$t$‑evaluation** $\\phi$, если $\\phi$ отображает каждую формулу $F\\in\\Gamma$ в $s$‑locally consistent decision tree $\\phi(F)$ с
  $$\\mathrm{cost}_s(\\phi(F))\\le t,$$
  и выполняются Properties 1–4 из HR’22 Definition 2.11 (PDF p. 11), но с “locally consistent” заменённым на “$s$‑locally consistent”.
- `Утверждение (аналог HR Lemma 2.13):`
  Пусть $t\\le n/16$ и существует Frege‑вывод формулы $A$ из Tseitin($G_n$) (и, при желании, flat extension‑аксиом) такой, что **каждая** строка имеет cost‑$t$‑evaluation, и все эти evaluations попарно функционально эквивалентны (как в HR’22 Definition 2.12).
  Тогда каждая строка вывода отображается в 1‑tree; в частности, нельзя вывести $\\bot$.
- `Доказательство (сведение к HR):`
  Доказательство HR’22 Lemma 2.13 (Appendix A.1, paper p. 47–48; PDF p. 50–51) переносится дословно, потому что использует только:
  (i) Properties 1–4 evaluation,
  (ii) функциональную эквивалентность evaluations,
  (iii) факт, что все ограничения вида $T\\lceil\\alpha$ и $T\\lceil(\\alpha\\cup\\tau)$ корректно определены и дают (s‑)locally consistent деревья.

  В HR пункт (iii) обеспечивается Cor. 2.7 при $t\\le n/16$; в flat local‑EF(s) он обеспечивается §16.161, поскольку для любой ветви $\\tau$ дерева $T$ имеем
  $$|\\mathrm{supp}_s(\\tau)|\\le \\mathrm{cost}_s(\\tau)\\le \\mathrm{cost}_s(T)\\le t,$$
  и потому для любого другого дерева $T'$ с $\\mathrm{cost}_s(T')\\le t$:
  $$|\\mathrm{supp}_s(\\tau)|+\\mathrm{cost}_s(T')\\le 2t\\le n/2.$$
  Аналогично, если в Cut‑случае нужно ограничивать по $\\tau\\cup\\tau'$, то
  $|\\mathrm{supp}_s(\\tau\\cup\\tau')|\\le |\\mathrm{supp}_s(\\tau)|+|\\mathrm{supp}_s(\\tau')|\\le 2t$ и
  $|\\mathrm{supp}_s(\\tau\\cup\\tau')|+\\mathrm{cost}_s(T'')\\le 3t\\le 3n/16<n/2$,
  так что §16.161 применим.
  Значит все restricted trees, используемые в индукции HR, корректны, и вывод “нельзя получить 0‑ветвь на новой строке” сохраняется.
- `Следствие (порог $t\\le\\Theta(n/s)$ в терминах глубины):`
  В flat‑модели любой decision tree глубины $d$ удовлетворяет $\\mathrm{cost}_s(T)\\le (s+2)\\,d$ (см. §16.159),
  поэтому “depth‑$d$ evaluation” имплицирует cost‑$t$ evaluation с $t:=(s+2)d$.
  В частности, условие $t\\le n/16$ эквивалентно $d\\le n/(16(s+2))=\\Theta(n/s)$.
- `Toy‑тест:` при $s=0$ (нет extension‑переменных) имеем $\\mathrm{cost}_0=2\\,\\mathrm{depth}$, так что условие $t\\le n/16$ соответствует $\\mathrm{depth}\\le n/32$ (константы не оптимизировались; важен масштаб $\\Theta(n)$).
- `Статус:` доказано (flat‑модель; даёт явный “gatekeeper”: весь evaluation‑каркас переносится с заменой $t\\mapsto (s+2)t$).
- `Барьер‑чек:` r — применимо (вся конструкция support/closure/DT релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если пытаться использовать это для lower bounds, нужно показать: (a) почему poly‑size flat local‑EF(s) вывод *индуцирует* depth‑$d$ evaluations с $d=\\mathrm{polylog}(n)$, или (b) где именно multi‑switching/representation ломается в присутствии extension‑переменных даже в flat‑режиме.

### 16.163. Исследовательский шаг: точная цитата — где HR’22 строят t‑evaluation индукцией по глубине (Proof of Thm. 4.1)

- `Линза:` Инвариант.
- `Утверждение:` В HR’22 явно выписано *индуктивное определение* t‑evaluation для всех подформул “короткого и мелкого” Frege‑доказательства (после применения последовательности full restrictions); единственное нетривиальное расширение домена происходит в случае дизъюнкции и делается через switching lemma.
- `Доказательство/ссылка:` Håstad–Risse, `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`:
  1) (paper p. 15; PDF p. 17) “For the total size lower bound we in fact do not create distinct t-evaluations per line but rather a single one, used on each line.”
  2) (paper p. 16; PDF p. 18) в доказательстве Theorem 4.1 после формулы (4) дано определение $\\phi_{i+1}$ по случаям (цитата):
     > “Consider any such formula $F\\in\\Gamma$. We define $\\phi_{i+1}$ as follows.
     > 1. If $F$ is of depth at most $\\mathrm{depth}(F)\\le i$, then we let $\\phi_{i+1}(F\\!\upharpoonright\\!\\sigma_i^*)=\\phi_i(F\\!\upharpoonright\\!\\sigma_i^{*\\! -1})\\!\upharpoonright\\!\\sigma_i$. By Lemma 3.4 the restricted $t_i$-evaluation $\\phi_i\\!\upharpoonright\\!\\sigma_i$ is defined on such formulas.
     > 2. If $F=\\neg F'$ is of depth $i+1$, then $\\phi_{i+1}(F\\!\upharpoonright\\!\\sigma_i^*)$ is defined in terms of $\\phi_{i+1}(F'\\!\\upharpoonright\\!\\sigma_i^*)$ by negating all the leaf labels.
     > 3. If $F=\\bigvee_j F_j$ is of depth $i+1$ and each $F_j$ is of depth at most $\\mathrm{depth}(F_j)\\le i$, then we appeal to Lemma 4.2 to obtain a decision tree $T$ … representing $\\bigvee_j T_j$ for $T_j=\\phi_i(F_j\\!\\upharpoonright\\!\\sigma_i^{*\\! -1})$.”
- `Toy‑тест:` извлечение текста `pdftotext -f 18 -l 18` показывает пункты 1–3 выше дословно (проверка “где именно строится evaluation”).
- `Статус:` известный факт (точная ссылка на конструкцию evaluations).
- `Барьер‑чек:` r — неприменимо (на этом шаге только локализация цитаты), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 локализовать аналогичное “построчное” построение (functionally equivalent $t(\\eta)$‑evaluations) в доказательстве Theorem 4.3/Lemma 4.5 и отметить, где в этом месте появление extension‑переменных может ломать switching/representation.

### 16.164. Исследовательский шаг: точная цитата — построчное построение functionally equivalent $t(\\eta)$‑evaluations (Theorem 4.3 / Lemma 4.5)

- `Линза:` Эквивалентность.
- `Утверждение:` В доказательстве HR’22 Theorem 4.3 явно поддерживаются (i) для каждой строки $\\nu$ доказательства — своё $t(\\eta)$‑evaluation $\\phi^\\eta_\\nu$ на множестве подформул $\\Gamma^\\eta_\\nu$, (ii) для каждой строки — “общий” partial decision tree $T_\\eta(\\nu)$, используемый для расширения evaluations на следующий уровень глубины. Индуктивный шаг зафиксирован как Lemma 4.5 и использует multi‑switching lemma (Lemma 4.4) на деревьях $\\phi^{\\eta-1}_\\nu(F)\\!\upharpoonright\\!\\tau$.
- `Доказательство/ссылка:` Håstad–Risse, `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`:
  1) (Theorem 4.3, PDF p. 19) “The main difference is that instead of creating a single t-evaluation for the entire proof we in fact independently create t-evaluations for each line. These t-evaluations turn out to be functionally equivalent…”.
  2) (после (6), PDF p. 19) для каждого $\\eta$ вводится
     $$\\Gamma^\\eta_\\nu:=\\{F\\!\upharpoonright\\!\\sigma^*_\\eta\\mid F\\in\\Gamma_\\nu\\ \\wedge\\ \\mathrm{depth}(F)\\le \\eta\\},\\tag{6}$$
     и требуется функциональная эквивалентность всех $\\phi^\\eta_\\nu$.
  3) (Lemma 4.5, PDF p. 20) индуктивный шаг (цитата из утверждения):
     > “Suppose that for every line $\\nu\\in[N]$ we have functionally equivalent $t(\\eta-1)$-evaluations $\\phi^{\\eta-1}_\\nu$ … Suppose that $t(\\eta)\\le n_\\eta/16$. For $\\sigma_\\eta\\sim D_k\\Sigma(n_{\\eta-1},n_\\eta)$ with probability $1-N^{-1}$, for every line $\\nu$ … there are functionally equivalent $t(\\eta)$-evaluations $\\phi^\\eta_\\nu$ … and a $t$-common partial decision tree $T_\\eta(\\nu)$ …”.
- `Toy‑тест:` `pdftotext -f 20 -l 20` показывает Lemma 4.5 и внутри доказательства явное определение $\\phi^\\eta_\\nu$ по случаям (depth<η / ¬ / ∨) с использованием построенного $T_\\eta(\\nu)$.
- `Статус:` известный факт (точная ссылка на “linewise evaluations” каркас HR’22).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 выделить в доказательстве Lemma 4.5 место, где используется, что деревья $\\phi^{\\eta-1}_\\nu(F)$ запрашивают *только edge‑переменные* и что full restrictions/локальная согласованность закрыты относительно этих запросов; затем проверить, сохраняется ли этот шаг при добавлении flat extension‑переменных (или зафиксировать точку поломки).

### 16.165. Исследовательский шаг: flat extensions — как убрать $P$‑запросы из decision trees (unfolding) ценой фактора $O(s)$ по глубине

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S3-check-lemma45-flat-ext-break):`
  Пусть работаем на $n\\times n$ grid и разрешены **flat** extension‑переменные $P$ с аксиомами
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $X$ — edge‑переменные.
  Тогда любой decision tree $T$ над переменными $X\\cup P$ можно преобразовать в decision tree $U$ над **только** edge‑переменными $X$ так, что:
  1) для любого присваивания $\\alpha:X\\to\\{0,1\\}$ значение $U(\\alpha)$ совпадает со значением $T(\\alpha, P=\\varphi(X))$;
  2) для любой ветви $\\tau$ дерева $T$ соответствующая ветвь $\\hat\\tau$ дерева $U$ имеет глубину
     $$\\mathrm{depth}(\\hat\\tau)\\le \\#(X\\text{‑запросов в }\\tau)+2s\\cdot\\#(P\\text{‑запросов в }\\tau)\\le (2s+1)\\,\\mathrm{depth}(\\tau).$$
  В частности, если в HR Lemma 4.5/Lemma 4.4 требуется “decision trees querying edges of the $n\\times n$ grid” глубины $\\le t$, то для flat local‑EF(s) достаточно заменить параметр $t$ на $t':=(2s+1)t$ после такого unfolding.
- `Доказательство:`
  Для каждого $p_i$ обозначим через $E_i\\subseteq X$ множество edge‑переменных, встречающихся в $\\varphi_i$.
  Так как grid имеет степень $\\le 4$, любой фиксированный набор вершин $S$ инцидентен не более чем $2|S|$ рёбрам, значит
  $$|E_i|\\le 2\\,|\\mathrm{supp}(\\varphi_i)|\\le 2s.$$
  Построим decision tree $D_i$ над $E_i$ глубины $|E_i|$ вычисляющее булеву функцию $\\varphi_i$ (например, запрашиваем все переменные из $E_i$ в фиксированном порядке и помечаем листья значением $\\varphi_i$ на соответствующем наборе).

  Теперь определим $U$ из $T$ рекурсивной заменой каждого узла‑запроса $p_i$ на дерево $D_i$:
  каждое листо $D_i$, помеченное $b\\in\\{0,1\\}$, перенаправляем в ребёнка исходного узла $p_i$ по ответу $b$.
  Тогда по индукции по структуре $T$ для любого $\\alpha$ деревья $T$ и $U$ вычисляют одно и то же значение при интерпретации $p_i:=\\varphi_i(\\alpha)$.

  По глубине: замена одного $p_i$‑запроса добавляет вдоль ветви не более $\\mathrm{depth}(D_i)=|E_i|\\le 2s$ edge‑запросов, а $X$‑запросы сохраняются.
  Отсюда
  $$\\mathrm{depth}(\\hat\\tau)\\le \\#X(\\tau)+\\sum_{p_i\\in\\mathrm{dom}_P(\\tau)}|E_i|\\le \\#X(\\tau)+2s\\cdot\\#P(\\tau).$$
- `Toy‑тест:` если $p\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$, то $|\\mathrm{supp}(\\varphi)|\\le 6$ и $|E|=3$; unfolding одного запроса $p$ даёт дерево глубины 3 на $\\{x_{e_1},x_{e_2},x_{e_3}\\}$.
- `Статус:` доказано (фиксирует, где именно в Lemma 4.5 “edge‑only” используется и как к нему вернуться ценой фактора $O(s)$ по глубине).
- `Барьер‑чек:` r — применимо (чисто комбинаторный аргумент про decision trees/поддержку и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить параметрический режим в HR Lemma 4.5: достаточно ли после замены $t\\mapsto (2s+1)t$ сохранить условия вида $t(\\eta)\\le n_\\eta/16$ и $t\\le s_\\eta\\le n' /32$; если нет — зафиксировать точную точку поломки как барьер.

### 16.166. Исследовательский шаг: параметр‑чек — как меняются условия HR Lemma 4.5 после unfolding $t\\mapsto t':=(2s+1)t$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S4-parameter-check-after-unfolding):`
  В HR’22 доказательство Theorem 4.3 использует параметры Lemma 4.4/4.5 только через величину
  $$t:=\\log M$$
  (глубина “остаточных” деревьев, уникальных для формулы после общего префикса $T_\\eta(\\nu)$).
  Поэтому после unfolding из §16.165, который заменяет каждый $P$‑запрос на $\\le 2s$ edge‑запросов и даёт
  $$t' := (2s+1)\\,t = (2s+1)\\log M,$$
  параметрическая часть HR Lemma 4.5 сохраняется *в той же форме* при замене $t\\rightsquigarrow t'$:
  - выбираем $\\ell:=t'$ в Lemma 4.4;
  - задаём рекурсию $n_\\eta:=\\lfloor n_{\\eta-1}/(A_1\\,t'\\,\\log^{c_1} n_{\\eta-1})\\rfloor$ как у HR (PDF p. 19–20), и $s_\\eta:=2^{\\eta-1}\\log N$;
  - итоговая достаточная проверка сводится к (HR, Proof of Thm. 4.3; PDF p. 19–20)
    $$t'(d)\\le 2^d\\log N + t'\\quad\\text{и}\\quad n_d\\ \\gtrsim\\ \\frac{n}{(\\log^{c_1} n\\cdot t')^d},$$
    а значит достаточно требовать
    $$\\log N\\ \\le\\ \\frac{n}{C\\,\\bigl(\\log^{c_1} n\\cdot t'\\bigr)^d}$$
    для достаточно большой абсолютной константы $C$.
  В частности, “цена” flat‑extensions в этом месте — замена $\\log M\\mapsto (2s+1)\\log M$ (то есть ухудшение нижней оценки на длину на фактор $(2s+1)^d$ в знаменателе экспоненты).
- `Доказательство:`
  Сравним с параметр‑блоком в HR’22 (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, Proof of Thm. 4.3; PDF p. 19–20):
  (i) HR выбирают $\\ell=t=\\log M$ и рекурсию $n_\\eta=\\lfloor n_{\\eta-1}/(A_1\\,t\\,\\log^{c_1} n_{\\eta-1})\\rfloor$, а также $s_\\eta=2^{\\eta-1}\\log N$ и $t(\\eta)=\\sum_{i\\le\\eta}s_i+\\log M$;
  (ii) единственная зависимость от $M$ в этом блоке проходит через $t=\\log M$ (см. строку “We choose $\\ell=t=\\log M$ …” и формулу $t(\\eta)=\\sum s_i+\\log M$);
  (iii) unfolding из §16.165 меняет глубину “уникальной части” дерева на множитель $2s+1$, то есть достаточно заменить $t$ на $t':=(2s+1)t$ во всех местах, где HR используют $t$ как bound на глубину входных decision trees в Lemma 4.4.
  Все оценки в HR для вероятности отказа/union bound используют только величины $t,\\ell,n_\\eta,s_\\eta$ (и константы), поэтому при замене $t,\\ell\\rightsquigarrow t'$ получаем те же неравенства с $t'$.
  Финальная проверка $t(d)\\le n_d/16$ в конце Proof of Thm. 4.3 (PDF p. 19) также зависит от $M$ лишь через добавку $+\\log M$, поэтому становится $t'(d)\\le n_d/16$ с $+t'$.
- `Toy‑тест:` если $M=\\mathrm{poly}(n)$ и $s=\\mathrm{polylog}(n)$, то $t'=(2s+1)\\log M=\\mathrm{polylog}(n)$, и замена $\\log M\\mapsto t'$ лишь усиливает polylog‑факторы в знаменателе экспоненты.
- `Статус:` доказано (параметрическая часть; точка, где flat‑extensions “платятся” множителем $(2s+1)$ по $t$).
- `Барьер‑чек:` r — применимо (switching‑леммы/DT‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 попытаться свести “poly‑size flat local‑EF(s) ⇒ существуют evaluations” к HR Lemma 4.5 с заменой $t\\mapsto t'$ и затем проверить, что требуемая локальная согласованность trees (для evaluation) действительно сохраняется в присутствии extension‑аксиом (или зафиксировать конкретный провал).

### 16.167. Исследовательский шаг: контрпример — наивный unfolding $P\\to X$ может нарушать локальную согласованность ветвей

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S5-check-local-consistency-after-unfolding):`
  Даже в **flat**‑режиме $p\\leftrightarrow\\varphi(X)$ и при малой поддержке $|\\mathrm{supp}(\\varphi)|=O(1)$, наивная замена $P$‑запроса на “полное вычисление $\\varphi$ по edge‑переменным” может породить decision tree с **локально несогласованными** ветвями (в смысле HR’22 Def. 2.5), и потому такую замену нельзя напрямую подставлять в HR‑определение evaluation.
- `Контрпример:`
  Рассмотрим Tseitin($G_n$) на $n\\times n$ grid с зарядами $\\alpha_v=1$ для всех вершин (как в HR’22 основной случай), и выберем внутреннюю вершину $v$ степени 4 с инцидентными рёбрами $e_1,e_2,e_3,e_4$.
  Положим
  $$\\varphi(X):= (x_{e_1}\\wedge x_{e_2})\\ \\vee\\ (x_{e_3}\\wedge x_{e_4}),$$
  и введём flat extension‑переменную $p\\leftrightarrow\\varphi(X)$ (поддержка $\\mathrm{supp}(\\varphi)$ состоит из $v$ и 4 соседей, то есть $O(1)$).

  Рассмотрим “наивный unfolding” $P\\to X$ как decision tree $D$ глубины 4, который последовательно запрашивает
  $x_{e_1},x_{e_2},x_{e_3},x_{e_4}$ и в листе помечает значение $\\varphi$ на полученных 4 битах.
  Тогда $D$ содержит ветвь
  $$\\tau:\\ x_{e_1}=0,\\ x_{e_2}=0,\\ x_{e_3}=1,\\ x_{e_4}=1,$$
  для которой $\\varphi(\\tau)=1$, но паритет в вершине $v$ равен
  $$x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3}\\oplus x_{e_4}=0\\ne 1=\\alpha_v.$$
  Поскольку ветвь $\\tau$ уже фиксирует **все** рёбра, инцидентные $v$, никакое продолжение присваивания не может исправить нарушение XOR‑ограничения в $v$.
  Значит $\\tau$ не является locally consistent assignment (HR’22 Def. 2.2), и потому $D$ не является locally consistent decision tree (HR’22 Def. 2.5).
- `Toy‑тест:` паритетная проверка в $v$ для ветви $(0,0,1,1)$ даёт 0, тогда как заряд $\\alpha_v=1$ требует 1.
- `Статус:` контрпример (фиксирует точку риска в Q43: edge‑only unfolding обязан избегать “локально подразумеваемых” запросов или применять aggressive trimming как у HR’22 перед Cor. 2.7).
- `Барьер‑чек:` r — применимо (контрпример полностью на уровне local consistency/closure/DT и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43: сформулировать и доказать правило построения edge‑only decision trees для формул $\\varphi(X)$ (с $|\\mathrm{supp}(\\varphi)|\\le s$), которое гарантирует локальную согласованность всех ветвей (например, “не запрашивать локально подразумеваемые рёбра”, HR’22 p. 7 после Def. 2.5) и оценить глубину в терминах $s$.

### 16.168. Исследовательский шаг: “locally consistent unfolding” для $\\varphi(X)$ — строим edge‑only decision tree без плохих ветвей

- `Линза:` Инвариант.
- `Утверждение (Q43.S6-construct-locally-consistent-unfolding):`
  Пусть $\\varphi$ — формула над edge‑переменными $E:=\\mathrm{vars}(\\varphi)\\subseteq X$ на $n\\times n$ grid, и $S:=\\mathrm{supp}(\\varphi)$ — множество вершин, инцидентных рёбрам из $E$ (так что $|S|\\le s$).
  Пусть $\\alpha$ — locally consistent частичное присваивание (HR’22 Def. 2.2) такое, что
  $$|\\mathrm{supp}(\\alpha)|+|S|\\le n/2.$$
  Тогда существует decision tree $T_{\\varphi,\\alpha}$, который
  1) запрашивает только переменные из $E$ и имеет глубину $\\le |E|\\le 2|S|\\le 2s$;
  2) является locally consistent (HR’22 Def. 2.5), т.е. каждая его ветвь $\\tau$ даёт locally consistent присваивание $\\alpha\\cup\\tau$;
  3) в каждом листе помечает значение $\\varphi$ на ветви (то есть $\\varphi\\!\upharpoonright\\!\\tau$ — $b$‑формула, где $b$ — метка листа).
- `Доказательство:`
  Заметим, что в $4$‑регулярном grid каждое ребро даёт две инцидентные вершины, и потому
  $$|E|\\le \\tfrac12\\sum_{v\\in S}\\deg(v)\\le 2|S|.$$
  Построим дерево по индукции, поддерживая инвариант: текущая ветвь $\\tau$ такова, что $\\beta:=\\alpha\\cup\\tau$ locally consistent и
  $|\\mathrm{supp}(\\beta)|\\le |\\mathrm{supp}(\\alpha)|+|S|\\le n/2$.
  Если $\\varphi\\!\upharpoonright\\!\\tau$ уже константа, останавливаемся и ставим соответствующую метку листа.
  Иначе выберем переменную $x_e\\in E\\setminus\\mathrm{dom}(\\tau)$, встречающуюся в $\\varphi\\!\upharpoonright\\!\\tau$.
  По HR’22 Lemma 2.3 (PDF p. 6) существует $b\\in\\{0,1\\}$, что $\\beta\\cup\\{x_e\\mapsto b\\}$ locally consistent.
  Если такой $b$ единственен, то $x_e$ locally implied by $\\beta$ (HR’22 Def. 2.4), и мы **не ветвим** по $x_e$ (как у HR’22: “disallow queries … if x is locally implied”, PDF p. 7),
  а добавляем это значение к $\\tau$ и продолжаем.
  Если же $x_e$ *не* locally implied, то из существования хотя бы одного $b$ следует, что локально согласованы обе ветви ($b=0$ и $b=1$), и мы ветвим по $x_e$ на два поддерева.
  В обоих случаях инвариант сохраняется, так как мы присваиваем лишь рёбра, инцидентные вершинам из $S$.
  Поскольку на каждом шаге мы фиксируем новую переменную из $E$, процесс завершается за $\\le |E|$ шагов, а глубина (число ветвлений) не превосходит $|E|$.
  По построению все ветви locally consistent и листья корректно помечены значением $\\varphi$ на ветви.
- `Toy‑тест:` в контрпримере §16.167, после присваиваний $x_{e_1}=x_{e_2}=0,\\ x_{e_3}=1$ ребро $e_4$ становится locally implied (иначе нарушится XOR‑ограничение в вершине $v$), поэтому ветвь $x_{e_4}=1$ отсекается и “плохая” ветвь $(0,0,1,1)$ не появляется.
- `Статус:` доказано (даёт корректный шаблон “unfolding без плохих ветвей”: строить/расширять деревья, запрещая запросы локально подразумеваемых рёбер и триммируя по local consistency).
- `Барьер‑чек:` r — применимо (вся конструкция про local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 попробовать встроить $T_{\\varphi,\\alpha}$ в замену $P$‑запросов внутри HR Lemma 4.5, проследив, что functional equivalence и multi‑switching остаются применимы при замене $t\\mapsto (2s+1)t$.

### 16.169. Исследовательский шаг: подстановка locally consistent unfolding в $P$‑запросы (путь к применению HR Lemma 4.5)

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S7-plug-lc-unfolding-into-lemma45):`
  Работая в flat‑модели $p_i\\leftrightarrow\\varphi_i(X)$ с $|\\mathrm{supp}(\\varphi_i)|\\le s$, можно заменить любой decision tree $T$ над переменными $X\\cup P$ на decision tree $U$ над **только** edge‑переменными $X$, так что:
  1) вдоль любой ветви $\\tau$ дерева $U$ значение каждого “встреченного” $p_i$ равно $\\varphi_i\\!\upharpoonright\\!\\tau$ (то есть $U$ реализует вычисление $T$ в семантике подстановки $p_i:=\\varphi_i(X)$);
  2) $U$ можно построить так, чтобы все ветви были locally consistent (HR’22 Def. 2.5), используя Lemma 2.3 + правило “не запрашивать локально подразумеваемые переменные” (HR’22, PDF p. 7);
  3) глубина увеличивается не более чем на фактор $(2s+1)$: для каждой ветви
     $$\\mathrm{depth}_X(U)\\le \\#X(\\tau_T)+2s\\cdot\\#P(\\tau_T)\\le (2s+1)\\,\\mathrm{depth}(T),$$
     где $\\tau_T$ — соответствующая ветвь в исходном дереве $T$.
  Следовательно, для использования HR multi‑switching (Lemma 4.4) внутри Lemma 4.5 достаточно заменить параметр $t=\\log M$ на $t'=(2s+1)\\log M$ *и* строить unfolding‑поддеревья локально согласованными.
- `Доказательство:`
  Строим $U$ сверху вниз, поддерживая инвариант: текущая ветвь даёт locally consistent присваивание $\\alpha$ на $X$ с $|\\mathrm{supp}(\\alpha)|\\le n/2$.
  - Если в $T$ запрашивается edge‑переменная $x_e$, то:
    *если* $x_e$ locally implied by $\\alpha$ (HR’22 Def. 2.4), то не ветвим и продолжаем по единственному locally consistent значению;
    иначе ветвим по $x_e$ на обе ветви (обе сохраняют local consistency, иначе была бы локальная импликация).
  - Если в $T$ запрашивается extension‑переменная $p_i$, то вставляем поддерево $T_{\\varphi_i,\\alpha}$ из §16.168 (глубины $\\le 2s$), которое (i) запрашивает только рёбра из $\\mathrm{vars}(\\varphi_i)$, (ii) по каждой ветви сохраняет local consistency, и (iii) в листе возвращает $b=\\varphi_i\\!\upharpoonright\\!\\tau$; затем продолжаем построение из соответствующего ребёнка узла $p_i$ (по ответу $b$).
  Повторяя рекурсивно, получаем edge‑only $U$ с locally consistent ветвями.
  Оценка глубины получается суммированием: каждый $X$‑запрос в $T$ даёт $\\le 1$ edge‑уровень в $U$, а каждый $P$‑запрос заменяется на поддерево глубины $\\le 2s$.
- `Toy‑тест:` контрпример §16.167 устраняется именно вставкой $T_{\\varphi,\\alpha}$: ветка $(0,0,1,1)$ не появляется, потому что $x_{e_4}$ locally implied после $x_{e_1}=x_{e_2}=0,\\ x_{e_3}=1$.
- `Статус:` доказано (локальная “прошивка” §16.168 в механизм HR’22: теперь остаётся проверить functional equivalence evaluations после этой замены).
- `Барьер‑чек:` r — применимо (аргумент на уровне local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить, что после такой замены сохраняется нужная функциональная эквивалентность evaluations (возможно, потребуется ослабить/переопределить её в flat local‑EF(s) контексте).

### 16.170. Исследовательский шаг: functional equivalence следует из семантической эквивалентности для locally consistent decision trees

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S8-functional-equivalence-after-unfolding):`
  Пусть $T_1,T_2$ — locally consistent decision trees (HR’22 Def. 2.5) над edge‑переменными Tseitin($G_n$) глубины $\\le n/8$.
  Если они вычисляют одну и ту же булеву функцию $f:X\\to\\{0,1\\}$ на всех полных присваиваниях $X$, то $T_1$ и $T_2$ **functionally equivalent** (HR’22 Def. 2.8).
  Следовательно, в Q43 после замены $P$‑запросов на edge‑only locally consistent unfolding (§16.169) функциональная эквивалентность evaluations сохраняется автоматически: изоморфные формулы задают одну и ту же функцию от $X$ (после подстановки $p_i:=\\varphi_i(X)$), а значит соответствующие деревья functionally equivalent.
- `Доказательство:`
  Возьмём ветвь $\\tau$ дерева $T_1$, заканчивающуюся листом с меткой $b$.
  Тогда на любом полном присваивании $\\rho:X\\to\\{0,1\\}$, согласованном с $\\tau$, имеем $T_1(\\rho)=b$, а значит по предположению $T_2(\\rho)=b$.

  Рассмотрим любую ветвь $\\tau'$ дерева $T_2$, которая pairwise locally consistent с $\\tau$ (HR’22 Def. 2.2).
  Тогда объединение $\\tau\\cup\\tau'$ — locally consistent частичное присваивание, и потому оно продолжимо до полного присваивания $\\rho$ на $X$ (вне $\\mathrm{closure}(\\mathrm{supp}(\\tau\\cup\\tau'))$ присваиваем произвольно).
  На этом $\\rho$ дерево $T_2$ проходит по ветви $\\tau'$, значит метка листа $\\tau'$ равна $T_2(\\rho)=b$.
  Следовательно, **все** ветви $T_2$, pairwise locally consistent с $\\tau$, имеют метку $b$, т.е. “trimmed restriction” $T_2\\!\upharpoonright\\!\\tau$ — $b$‑tree.
  Аналогично, для любой ветви $\\tau'$ дерева $T_2$ получаем, что $T_1\\!\upharpoonright\\!\\tau'$ — соответствующий $b$‑tree. Это и есть functional equivalence.
- `Toy‑тест:` для изоморфных $\\vee$‑формул $((A\\vee B)\\vee C)$ и $(A\\vee(B\\vee C))$ любая пара locally consistent деревьев, вычисляющих одну и ту же функцию $A\\vee B\\vee C$, автоматически functionally equivalent по лемме.
- `Статус:` доказано (functional equivalence в Q43 сводится к “вычисляют одну и ту же функцию” + local consistency).
- `Барьер‑чек:` r — применимо (аргумент на уровне local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43: после снятия functional‑equivalence риска проверить, что полученные edge‑only trees по‑прежнему удовлетворяют Properties 1–4 определения evaluation (и t‑common partial decision tree) в шаге Lemma 4.5.

### 16.171. Исследовательский шаг: “Property 1” в t‑evaluation не нужно для Lemma 2.13 (можно разрешить переменным деревья глубины $\\le t$)

- `Линза:` Инвариант.
- `Утверждение (Q43.S9-check-evaluation-properties-after-unfolding):`
  В доказательстве HR’22 Lemma 2.13 (Appendix A.1; PDF p. 50–51) не используется Property 1 из Definition 2.11 (т.е. что *переменные* обязаны отображаться в деревья глубины 1).
  Достаточно, чтобы (a) все деревья были locally consistent и глубины $\\le t$, (b) аксиомы были 1‑trees (Property 2), и выполнялись Properties 3–4 (¬ и ∨) плюс functional equivalence между строками.
  Следовательно, в Q43 можно после unfolding разрешить extension‑переменным $p_i$ отображаться в edge‑only деревья глубины $O(s)$ (например, $T_{\\varphi_i,\\alpha}$ из §16.168), не ломая “gatekeeper” Lemma 2.13.
- `Доказательство:`
  Просматриваем доказательство Lemma 2.13 у HR’22 (PDF p. 50–51): оно делает индукцию по строкам и во всех случаях использует только
  - “axioms are mapped to 1‑trees” (Property 2),
  - связь $T_{\\neg F}$ с $T_F$ (Property 3),
  - что $T_{F\\vee G}$ **represents** $T_F\\vee T_G$ (Property 4),
  - functional equivalence + Lemma 2.9,
  - и Corollary 2.7 (чтобы $T\\!\upharpoonright\\!\\tau$ был определён при глубинах $\\le n/16$).

  Нигде не требуется, чтобы дерево для атома $p$ было глубины 1: в “Excluded Middle” они обозначают $T_p:=\\phi_\\nu(p)$ и работают с ним только через Properties 3–4; в остальных правилах $p,q,r$ — произвольные формулы строк, а не обязательно атомы.
  Поэтому если заменить Property 1 на более слабое требование “каждый атом отображается в locally consistent decision tree глубины $\\le t$”, то весь вывод Lemma 2.13 остаётся дословным.
- `Toy‑тест:` если $p_i\\leftrightarrow\\varphi_i(X)$ и $|\\mathrm{supp}(\\varphi_i)|\\le s$, то после unfolding можно взять дерево для $p_i$ равным $T_{\\varphi_i,\\emptyset}$ глубины $\\le 2s$ (§16.168); при условии $2s\\le t\\le n/16$ лемма 2.13 применима без изменения.
- `Статус:` доказано (закрывает “проверку Property 1”: после unfolding не надо удерживать глубину 1 для extension‑переменных).
- `Барьер‑чек:` r — применимо (аргумент целиком про local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить оставшуюся часть “evaluation properties” в шаге Lemma 4.5: что построенные edge‑only деревья действительно дают $t$‑common partial decision tree и удовлетворяют Property 4 (representation) для ∨‑формул после unfolding.

### 16.172. Исследовательский шаг: unfolding не ломает common partial decision tree и Property 4 (representation) — инвариантность под functional equivalence

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S10-common-partial-tree-after-unfolding):`
  Пусть $T_1,\\dots,T_m$ и $T'_1,\\dots,T'_m$ — locally consistent decision trees над edge‑переменными Tseitin($G_n$) глубины $\\le n/8$ такие, что для всех $i$ деревья $T_i$ и $T'_i$ functionally equivalent (HR’22 Def. 2.8).
  Тогда:
  1) (**representation стабилен**) если decision tree $R$ represents $\\bigvee_{i=1}^m T_i$ (HR’22, абзац перед Def. 2.10), то $R$ также represents $\\bigvee_{i=1}^m T'_i$;
  2) (**common partial tree стабилен**) если partial decision tree $S$ — $\\ell$‑common partial decision tree для $T_1,\\dots,T_m$ (HR’22 Def. 2.10), то тот же $S$ является $\\ell$‑common partial decision tree для $T'_1,\\dots,T'_m$.

  В частности, в Q43 после замены $P$‑запросов на edge‑only locally consistent unfolding из §16.169 (глубина $t\\mapsto t':=(2s+1)t$ и семантическая эквивалентность в смысле подстановки $p_i:=\\varphi_i(X)$) проверка в HR’22 Lemma 4.5, что $T_\\eta(\\nu)$ — $t'$‑common partial decision tree и что Property 4 (representation) выполняется для $\\vee$‑формул, переносится без изменений (проверка идёт «по ветвям» и использует только b‑tree факты для trimmed restriction).
- `Доказательство:`
  Ключевой факт: из HR’22 Lemma 2.9 следует, что для любых functionally equivalent $T,T'$ и любого locally consistent частичного присваивания $\\alpha$ (в режиме, где все trimmed restrictions определены) выполняется эквивалентность
  $$T\\!\upharpoonright\\!\\alpha\\text{ — $b$‑tree}\\ \\Longleftrightarrow\\ T'\\!\\upharpoonright\\!\\alpha\\text{ — $b$‑tree}.$$

  1) **Stability для representation.**
     Пусть $R$ represents $\\bigvee_i T_i$.
     Возьмём ветвь $\\tau$ дерева $R$, оканчивающуюся листом с меткой $b$.
     - Если $b=0$, то по определению “represents” имеем $T_i\\!\\upharpoonright\\!\\tau=0$ для всех $i$, а значит по ключевому факту $T'_i\\!\\upharpoonright\\!\\tau=0$ для всех $i$.
     - Если $b=1$, то по определению “represents” существует $i$ с $T_i\\!\\upharpoonright\\!\\tau=1$, а значит $T'_i\\!\\upharpoonright\\!\\tau=1$.
     Это ровно означает, что $R$ represents $\\bigvee_i T'_i$.

  2) **Stability для $\\ell$‑common partial decision tree.**
     Пусть $S$ — $\\ell$‑common partial decision tree для $T_1,\\dots,T_m$.
     Тогда по HR’22 Def. 2.10 для каждого $i$ и каждой ветви $\\tau\\in S$ существует decision tree $S^{(i,\\tau)}$ глубины $\\ell$, такой что если $\\widehat S_i$ получено из $S$ подстановкой $S^{(i,\\tau)}$ в лист $\\tau$, то для любой ветви $\\tau'\\in\\widehat S_i$, оканчивающейся листом $b$, выполнено $T_i\\!\\upharpoonright\\!\\tau'=b$.
     Применяя ключевой факт к каждому такому $\\tau'$, получаем $T'_i\\!\\upharpoonright\\!\\tau'=b$.
     Значит те же witness‑деревья $S^{(i,\\tau)}$ доказывают, что $S$ — $\\ell$‑common partial decision tree и для $T'_1,\\dots,T'_m$.

  Применение к Q43: деревья, полученные локально согласованным unfolding (§16.169), вычисляют ту же функцию от $X$ (в семантике $p_i:=\\varphi_i(X)$), а потому по §16.170 автоматически functionally equivalent любому другому locally consistent edge‑only представлению той же функции.
  Следовательно, любые trees/partial trees, построенные по HR’22 Lemma 4.4 внутри Lemma 4.5 для “наивного” edge‑only представления, остаются корректными и для locally consistent unfolding, и Property 4 + common partial tree переносятся (с единственной платой в параметре глубины $t\\mapsto t'$ из §16.166).
- `Toy‑тест:` пусть $T_1$ — 1‑tree для $x_e$, а $T'_1$ — дерево глубины 2, которое сначала спрашивает $x_e$, затем (локально подразумеваемую) переменную и не ветвится; тогда $T_1$ и $T'_1$ functionally equivalent, и любое $R$, представляющее $T_1\\vee 0$, автоматически представляет $T'_1\\vee 0$ по пункту (1).
- `Статус:` доказано (закрывает “common partial tree/representation” узел в Q43: после unfolding HR Lemma 4.5 можно применять дословно при замене $t\\mapsto t'$).
- `Барьер‑чек:` r — применимо (аргумент чисто про decision trees/trimmed restriction и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 формализовать, как из poly‑size flat local‑EF(s)‑доказательства получить входные family of decision trees глубины $t'=\\mathrm{polylog}(n)$ для Lemma 4.5 (или зафиксировать, почему “индукция по строкам” не даёт таких trees без nesting/глобальной поддержки).

### 16.173. Исследовательский шаг: где именно “индуцируются” edge‑only деревья для Lemma 4.5 в flat local‑EF(s) (уникальная часть + locally consistent unfolding)

- `Линза:` Инвариант.
- `Утверждение (Q43.S11-induce-trees-from-proof):`
  Рассмотрим индуктивный шаг HR’22 Lemma 4.5 (PDF p. 20) для фиксированной строки $\\nu$ и уровня $\\eta$.
  В нём “входные” деревья, к которым применяется multi‑switching lemma (HR’22 Lemma 4.4), имеют вид
  $$\\bigl\\{\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau\\bigr\\}_i,$$
  где $\\tau$ — ветвь $t$‑common partial decision tree $T_{\\eta-1}(\\nu)$ глубины $\\sum_{j<\\eta}s_j$.

  В flat local‑EF(s) (переменные $P$ с аксиомами $p_i\\leftrightarrow\\varphi_i(X)$, $|\\mathrm{supp}(\\varphi_i)|\\le s$) эти restricted‑деревья могут запрашивать $P$.
  Тогда “индуцированные” edge‑only деревья для применения HR Lemma 4.4 получаются **точно** так:
  для каждого $i$ и каждой ветви $\\tau$ берём locally consistent unfolding
  $$U_{i,\\tau}:=\\mathrm{Unfold}_{\\varphi}(\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau)$$
  из §16.169, то есть заменяем каждый $P$‑запрос на поддерево $T_{\\varphi_j,\\alpha}$ (с текущим $\\alpha$ вдоль ветви), запрещая локально подразумеваемые edge‑запросы.
  Тогда:
  1) каждое $U_{i,\\tau}$ — locally consistent decision tree над **только** edge‑переменными $X$ (HR’22 Def. 2.5);
  2) глубина ограничена
     $$\\mathrm{depth}(U_{i,\\tau})\\le (2s+1)\\,t=:t',\\qquad t:=\\log M,$$
     поскольку в HR’22 для любой ветви $\\tau$ “общая часть” длины $\\sum_{j<\\eta}s_j$ уже зафиксирована, и остаётся только уникальная часть глубины $\\le t$ (а unfolding умножает глубину не более чем на $2s+1$, §16.165).

  Следовательно, в доказательстве Lemma 4.5 можно применять HR multi‑switching lemma (Lemma 4.4) к семействам $\\{U_{i,\\tau}\\}_i$ с параметром $t'$ вместо $t=\\log M$.
  Оставшаяся часть шага Lemma 4.5 (построение $T_\\eta(\\nu)$ и проверка Property 4 “representing $\\vee$” по ветвям $\\tau$) проходит дословно, так как использует только вывод Lemma 4.4 для этих входных деревьев.
  Это и есть формальная реализация пункта “poly‑size доказательство индуцирует нужные edge‑only деревья глубины $t'$” в Q43.
- `Доказательство:`
  В HR’22 Lemma 4.5 (PDF p. 20) к фиксированному $\\tau\\in T_{\\eta-1}(\\nu)$ применяют Lemma 4.4 к деревьям
  $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$ и используют, что их глубина $\\le t=\\log M$ (“unique part”).
  В flat local‑EF(s) мы заменяем каждое такое дерево на $U_{i,\\tau}$ по §16.169.
  По построению §16.169 ветви $U_{i,\\tau}$ locally consistent и запросы только edge‑переменные, значит $U_{i,\\tau}$ подходит под HR’22 Lemma 4.4.

  Оценка глубины: в §16.165 показано, что unfolding любого decision tree глубины $t$ (где каждый $P$‑запрос заменяется на дерево глубины $\\le 2s$) даёт edge‑only дерево глубины $\\le(2s+1)t$.
  Применяя это к $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$ глубины $\\le t$, получаем $\\mathrm{depth}(U_{i,\\tau})\\le (2s+1)t=t'$.

  Наконец, в HR’22 проверка Property 4 (и построение $T_\\eta(\\nu)$) делается **по каждой** ветви $\\tau$ отдельно:
  для фиксированного $\\tau$ именно Lemma 4.4 даёт common partial decision tree глубины $s_\\eta$, который представляет дизъюнкцию деревьев, ассоциированных с дисъюнктами.
  Поэтому если подставить в этом месте деревья $\\{U_{i,\\tau}\\}_i$ (вместо $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$), то весь шаг Lemma 4.5 проходит в той же форме при замене $t\\mapsto t'$.
- `Toy‑тест:` при $s=1$ каждый $P$‑запрос разворачивается в дерево глубины $\\le 2$, поэтому дерево уникальной части глубины $t=3$ после unfolding имеет глубину $\\le (2\\cdot 1+1)\\cdot 3=9$.
- `Статус:` доказано (закрывает “индукцию деревьев” в Q43: указано точное место в Lemma 4.5 и явная конструкция входных edge‑only деревьев глубины $t'$).
- `Барьер‑чек:` r — применимо (switching/decision trees релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 сформулировать итоговый corollary уровня HR Theorem 4.3 для depth‑$d$ flat local‑EF(s): как меняется нижняя оценка на длину/размер при подстановке $t'= (2s+1)\\log M$.

### 16.174. Исследовательский шаг: corollary — HR Theorem 4.3 переносится на depth‑$d$ flat local‑EF(s) с заменой $\\log M\\mapsto (2s+1)\\log M$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S12-corollary-thm43-flat-local-ef):`
  Пусть задана flat local‑EF(s)‑рефутация Tseitin($G_n$) на $n\\times n$ grid (odd charges в каждой вершине, как в HR’22),
  где все extension‑аксиомы имеют вид $p_i\\leftrightarrow\\varphi_i(X)$ с $|\\mathrm{supp}(\\varphi_i)|\\le s$ (flat),
  и каждая строка — формула глубины $\\le d$ и размера $\\le M$.
  Тогда число строк $N$ удовлетворяет той же форме нижней оценки, что и HR’22 Theorem 4.3, но с заменой
  $$\\log M\\ \\rightsquigarrow\\ t':=(2s+1)\\log M,$$
  то есть
  $$N\\ \\ge\\ \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{O(1)}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right).$$
- `Доказательство:`
  Повторяем доказательство HR’22 Theorem 4.3 (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, Thm. 4.3 + Proof; PDF p. 19–20), меняя ровно одно место:
  в Lemma 4.4/4.5 вместо “decision trees querying edges … of depth $t:=\\log M$” используем edge‑only locally consistent деревья глубины
  $$t':=(2s+1)\\log M.$$

  Корректность этой замены обеспечивают предыдущие шаги:
  - §16.169+§16.173: restricted уникальные части $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$ в Lemma 4.5 разворачиваются в edge‑only locally consistent деревья глубины $\\le t'$;
  - §16.166: параметрический блок Proof of Thm. 4.3 зависит от $M$ только через $t=\\log M$, значит все оценки/union bound переносятся с $t\\rightsquigarrow t'$;
  - §16.162: получив в конце $t'(d)$‑evaluation с $t'(d)\\le n_d/16$, применяем (flat) аналог HR Lemma 2.13 и получаем, что рефутации быть не может.

  Следовательно, чтобы избежать противоречия с Lemma 2.13, длина $N$ должна удовлетворять указанной экспоненциальной нижней оценке с $\\log M$ заменённым на $t'$.
- `Toy‑тест:` при $s=0$ (нет extension‑переменных) имеем $t'=\\log M$, и формула совпадает с HR’22 Theorem 4.3.
- `Статус:` доказано (условный перенос HR’22 нижней оценки на depth‑$d$ flat local‑EF(s), цена — множитель $(2s+1)^d$ в знаменателе экспоненты).
- `Барьер‑чек:` r — применимо (switching‑леммы/decision trees релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить “почти tightness”: при каких режимах $s$ и $M$ нижняя оценка остаётся $\\exp(n^{1-o(1)})$ и сравнить с известным upper $2^{O(n)}$ (резолюция).

### 16.175. Исследовательский шаг (toy computation): режимы “почти tightness” для corollary при $t'=(2s+1)\\log M$

- `Линза:` Инвариант.
- `Утверждение (Q43.S13-tightness-regime):`
  Пусть выполняется lower bound из §16.174:
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{C}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right)$$
  для некоторой абсолютной константы $C\\ge 1$.
  Тогда:
  1) если
     $$d\\cdot\\log\\bigl((\\log n)^{C}(2s+1)\\log M\\bigr)=o(\\log n),\\tag{*}$$
     то показатель экспоненты равен $n^{1-o(1)}$, то есть
     $$N\\ge \\exp\\bigl(n^{1-o(1)}\\bigr);$$
  2) в частности, если $(2s+1)\\log M\\le \\log^{O(1)}n$ и $d=o(\\log n/\\log\\log n)$, то условие $(*)$ выполнено и снова $N\\ge \\exp(n^{1-o(1)})$;
  3) при фиксированной глубине $d=O(1)$ и $(2s+1)\\log M\\le \\log^{O(1)}n$ получаем $N\\ge \\exp(\\Omega(n/\\log^{O(1)}n))$, что согласуется с известным upper $2^{O(n)}$ (резолюция).
- `Toy‑вычисление:`
  Из $(*)$ следует
  $$\\bigl((\\log n)^{C}(2s+1)\\log M\\bigr)^d=\\exp\\bigl(o(\\log n)\\bigr)=n^{o(1)}.$$
  Тогда показатель экспоненты равен
  $$\\Omega\\Bigl(\\frac{n}{n^{o(1)}}\\Bigr)=n^{1-o(1)}.$$
  Пункт (2) — частный случай, т.к. при $(2s+1)\\log M\\le \\log^{K}n$ имеем $\\log((\\log n)^C(2s+1)\\log M)=O(\\log\\log n)$, и потому
  $d\\cdot O(\\log\\log n)=o(\\log n)$ при $d=o(\\log n/\\log\\log n)$.
- `Статус:` проверено (явный критерий, когда corollary даёт $\\exp(n^{1-o(1)})$).
- `Барьер‑чек:` r — применимо (это лишь алгебра над параметрами + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 оценить “порог по $s$”: при каких $s=s(n)$ (при $M=\\mathrm{poly}(n)$ и $d=o(\\log n/\\log\\log n)$) условие $(*)$ перестаёт быть верным.

### 16.176. Исследовательский шаг (toy computation): порог по $s$ при $M=\\mathrm{poly}(n)$ и $d=o(\\log n/\\log\\log n)$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S14-threshold-in-s):`
  В режиме $M=\\mathrm{poly}(n)$ (то есть $\\log M=O(\\log n)$) и $d=o(\\log n/\\log\\log n)$ условие $(*)$ из §16.175 эквивалентно
  $$d\\cdot\\log(2s+1)=o(\\log n).\\tag{**}$$
  В частности, lower bound из §16.174 даёт $N\\ge\\exp(n^{1-o(1)})$ при любом $s$ таком, что
  $$\\log s=o(\\log n/d)\\quad\\text{(то есть)}\\quad s\\le \\exp\\bigl(o(\\log n/d)\\bigr).$$
- `Toy‑вычисление:`
  При $\\log M=O(\\log n)$ имеем $\\log\\log M=O(\\log\\log n)$, и потому
  $$\\log\\bigl((\\log n)^C(2s+1)\\log M\\bigr)=\\log(2s+1)+O(\\log\\log n).$$
  Подставляя в $(*)$ из §16.175 получаем
  $$d\\cdot\\log(2s+1)+d\\cdot O(\\log\\log n)=o(\\log n).$$
  Но при $d=o(\\log n/\\log\\log n)$ второй член автоматически $o(\\log n)$, так что остаётся ровно $(**)$.
- `Статус:` проверено (явный порог по $s$ в subcritical‑глубине).
- `Барьер‑чек:` r — применимо (чистая параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 подставить $s=n^{\\varepsilon}$ и выписать, при каких $d$ показатель в §16.174 остаётся $n^{1-o(1)}$ или хотя бы $n^{\\Omega(1)}$ (где lower bound ещё нетривиален).

### 16.177. Исследовательский шаг (toy computation): режим $s=n^{\\varepsilon}$ — когда bound из §16.174 нетривиален по глубине $d$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S15-poly-s-depth-regime):`
  Пусть $M=\\mathrm{poly}(n)$, $s=n^{\\varepsilon}$ для фиксированного $\\varepsilon\\in(0,1)$, и применим corollary §16.174:
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{O(1)}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right).$$
  Тогда показатель экспоненты имеет порядок
  $$\\Omega\\Bigl(\\frac{n^{1-\\varepsilon d}}{\\log^{O(d)} n}\\Bigr).\\tag{***}$$
  Отсюда:
  1) (**почти tightness**) $N\\ge \\exp(n^{1-o(1)})$ возможно только при $\\varepsilon d=o(1)$ (т.е. $d=o(1/\\varepsilon)$);
  2) (**нетривиальность**) $N\\ge \\exp(n^{\\Omega(1)})$ сохраняется для любой константной глубины $d$ с $\\varepsilon d<1$;
  3) при $d\\ge 1/\\varepsilon$ показатель в $(***)$ становится $n^{o(1)}$, и bound перестаёт давать сверхполиномиальную нижнюю оценку на $N$.
- `Toy‑вычисление:`
  При $s=n^{\\varepsilon}$ имеем $2s+1=\\Theta(n^{\\varepsilon})$ и при $M=\\mathrm{poly}(n)$ также $\\log M=\\Theta(\\log n)$.
  Тогда знаменатель в §16.174 равен
  $$\\bigl((\\log n)^{O(1)}(2s+1)\\log M\\bigr)^d\\ =\\ \\bigl(n^{\\varepsilon}\\,\\log^{O(1)}n\\bigr)^d\\ =\\ n^{\\varepsilon d}\\,\\log^{O(d)}n,$$
  и получаем $(***)$.
  Пункты (1)–(3) следуют из сравнения $n^{1-\\varepsilon d}$ с $n^{1-o(1)}$, $n^{\\Omega(1)}$ и $n^{o(1)}$ соответственно.
- `Статус:` проверено (явный “depth‑порог” при полиномиальных flat‑extensions).
- `Барьер‑чек:` r — применимо (параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 рассмотреть промежуточные режимы $s=\\exp((\\log n)^\\alpha)$ и сравнить порог $d\\log(2s+1)=o(\\log n)$ с $d=o(\\log n/\\log\\log n)$.

### 16.178. Исследовательский шаг (toy computation): режим $s=\\exp((\\log n)^\\alpha)$ — depth‑порог $d\\approx \\log^{1-\\alpha}n$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S16-subexp-s-regime):`
  Пусть $M=\\mathrm{poly}(n)$ и $s=\\exp((\\log n)^\\alpha)$ для некоторого $\\alpha>0$.
  Тогда показатель экспоненты в corollary §16.174 имеет вид
  $$\\Omega\\Bigl(\\frac{n\\,\\exp(-d\\,(\\log n)^\\alpha)}{\\log^{O(d)}n}\\Bigr).\\tag{****}$$
  В частности:
  1) если $0<\\alpha<1$ и $d=o(\\log^{1-\\alpha}n)$, то $N\\ge\\exp(n^{1-o(1)})$;
  2) если $0<\\alpha<1$ и $d=c\\,\\log^{1-\\alpha}n$ для константы $c\\in(0,1)$, то $N\\ge\\exp(n^{1-c-o(1)})$;
  3) если $\\alpha>1$, то уже при $d\\ge 1$ выражение $(****)$ стремится к 0, и corollary §16.174 перестаёт давать сверхполиномиальную нижнюю оценку на $N$.
- `Toy‑вычисление:`
  При $s=\\exp((\\log n)^\\alpha)$ имеем $2s+1=\\exp((\\log n)^\\alpha+O(1))$, а при $M=\\mathrm{poly}(n)$ также $\\log M=\\Theta(\\log n)$.
  Тогда знаменатель в §16.174 равен
  $$\\bigl((\\log n)^{O(1)}(2s+1)\\log M\\bigr)^d\\ =\\ \\exp(d(\\log n)^\\alpha)\\cdot\\log^{O(d)}n,$$
  что даёт $(****)$.
  Пункт (1): из $d=o(\\log^{1-\\alpha}n)$ следует $d(\\log n)^\\alpha=o(\\log n)$, а также автоматически $d=o(\\log n/\\log\\log n)$, так что $\\log^{O(d)}n=\\exp(o(\\log n))=n^{o(1)}$.
  Пункт (2): при $d=c\\log^{1-\\alpha}n$ имеем $\\exp(d(\\log n)^\\alpha)=\\exp(c\\log n)=n^c$, а $\\log^{O(d)}n=\\exp(o(\\log n))=n^{o(1)}$.
  Пункт (3): при $\\alpha>1$ уже $\\exp(d(\\log n)^\\alpha)\\gg n$, поэтому $n\\exp(-d(\\log n)^\\alpha)=o(1)$.
- `Статус:` проверено (явный “phase transition”: при $\\alpha>1$ bound тривиализируется уже на глубине 1).
- `Барьер‑чек:` r — применимо (параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 выделить “максимально допустимый” рост $s(n)$ из условия $d\\log(2s+1)=o(\\log n)$ при $d=\\Theta(\\log n/\\log\\log n)$ (граница между нетривиальным и тривиальным lower bound).

### 16.179. Исследовательский шаг (toy computation): критическая глубина $d\\asymp \\log n/\\log\\log n$ ⇒ $s=(\\log n)^{o(1)}$ для “почти tightness”

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S17-max-s-critical-depth):`
  В режиме $M=\\mathrm{poly}(n)$ и “критической” глубины
  $$d=\\Theta\\left(\\frac{\\log n}{\\log\\log n}\\right),$$
  условие $(**)$ из §16.176 (эквивалентное “почти tightness” $N\\ge\\exp(n^{1-o(1)})$) равносильно
  $$\\log(2s+1)=o(\\log\\log n),$$
  то есть
  $$s=\\exp(o(\\log\\log n))=(\\log n)^{o(1)}.$$
- `Toy‑вычисление:`
  Подставим $d=\\Theta(\\log n/\\log\\log n)$ в $(**)$ из §16.176:
  $$d\\log(2s+1)=o(\\log n)\\ \\Longleftrightarrow\\ \\frac{\\log n}{\\log\\log n}\\cdot\\log(2s+1)=o(\\log n)\\ \\Longleftrightarrow\\ \\log(2s+1)=o(\\log\\log n).$$
  Отсюда $2s+1=\\exp(o(\\log\\log n))$ и потому $s=\\exp(o(\\log\\log n))$.
  Равенство $\\exp(o(\\log\\log n))=(\\log n)^{o(1)}$ следует из $\\exp(a\\log\\log n)=(\\log n)^a$.
- `Статус:` проверено (явный максимальный рост $s(n)$ при критической глубине для сохранения $\\exp(n^{1-o(1)})$).
- `Барьер‑чек:` r — применимо (чистая параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 оценить “границу нетривиальности” при $d=\\Theta(\\log n/\\log\\log n)$: если $s=(\\log n)^c$, какой показатель $n^{1-\\Theta(1)}$ даёт corollary §16.174 (вместо $n^{1-o(1)}$).

### 16.180. Исследовательский шаг (toy computation): при $d=\\Theta(\\log n/\\log\\log n)$ и $s=(\\log n)^c$ показатель экспоненты = $n^{1-\\Theta(1)}$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S18-polylog-s-critical-depth-exponent):`
  Предположим $M=\\mathrm{poly}(n)$ и $s=(\\log n)^c$ для фиксированного $c\\ge 0$.
  Пусть глубина строк
  $$d=\\left(\\kappa+o(1)\\right)\\frac{\\log n}{\\log\\log n}$$
  для некоторой константы $\\kappa>0$.
  Тогда lower bound из §16.174 имеет показатель экспоненты вида
  $$\\Omega\\bigl(n^{1-\\kappa(C+1+c)-o(1)}\\bigr),$$
  где $C=O(1)$ — абсолютная константа из polylog‑фактора $(\\log n)^{O(1)}$ в §16.174 (унаследованного от HR’22 Thm. 4.3).
  В частности, при $\\kappa(C+1+c)<1$ получаем нетривиальный bound
  $$N\\ge \\exp\\bigl(n^{\\Omega(1)}\\bigr),$$
  а при $\\kappa(C+1+c)\\ge 1$ этот bound перестаёт давать сверхполиномиальную нижнюю оценку на $N$.
- `Toy‑вычисление:`
  В §16.174 оценка имеет вид
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{C}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right)$$
  для некоторой фиксированной $C\\ge 1$.
  При $M=\\mathrm{poly}(n)$ имеем $\\log M=\\Theta(\\log n)$, а при $s=(\\log n)^c$ имеем $2s+1=\\Theta((\\log n)^c)$.
  Тогда
  $$((\\log n)^{C}(2s+1)\\log M)^{d}=\\bigl((\\log n)^{C+1+c}\\bigr)^{d}.$$
  Подставляя $d=(\\kappa+o(1))\\log n/\\log\\log n$, получаем
  $$\\bigl((\\log n)^{C+1+c}\\bigr)^{d}=\\exp\\bigl((\\kappa+o(1))(C+1+c)\\log n\\bigr)=n^{\\kappa(C+1+c)+o(1)}.$$
  Поэтому показатель экспоненты равен
  $$\\Omega\\Bigl(\\frac{n}{n^{\\kappa(C+1+c)+o(1)}}\\Bigr)=\\Omega\\bigl(n^{1-\\kappa(C+1+c)-o(1)}\\bigr).$$
- `Статус:` проверено (критическая глубина превращает polylog‑$s$ в константную потерю в степени $n$).
- `Барьер‑чек:` r — применимо (чистая параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 извлечь/зафиксировать явную константу $C$ (в $(\\log n)^C$) из Proof of HR’22 Thm. 4.3 и сравнить порог $\\kappa<1/(C+1+c)$ с реальным диапазоном глубин.

### 16.181. Исследовательский шаг: $C$ в $(\\log n)^C$ из HR’22 Thm. 4.3 = константа $c_1$ из multi‑switching (Lemma 4.4)

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S19-pin-down-constant-C):`
  В формулировке HR’22 Theorem 4.3 polylog‑фактор $(\\log n)^{O(1)}$ можно взять равным $\\log^{c_1}n$, где $c_1$ — константа из HR’22 Lemma 4.4 (Multi-switching Lemma).
  Следовательно, в corollary §16.174 для flat local‑EF(s) можно считать
  $$C=c_1$$
  (а все остальные потери учтены отдельно через $t'=(2s+1)\\log M$).
- `Доказательство/точная ссылка:`
  В HR’22 Lemma 4.4 (PDF p. 19; `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`) параметрическая предпосылка содержит
  $$\\frac{n}{n'}\\ge A\\,t\\,\\log^{c_1}n.$$
  В Proof of Theorem 4.3 (PDF p. 19–20) они затем выбирают $\\ell=t=\\log M$ и задают рекурсию
  $$n_\\eta=\\Bigl\\lfloor\\frac{n_{\\eta-1}}{A_1\\,t\\,\\log^{c_1}n_{\\eta-1}}\\Bigr\\rfloor\\qquad(\\eta\\in[d]).$$
  Иначе говоря, единственный источник “$(\\log n)^{O(1)}$” в знаменателе экспоненты — именно множитель $\\log^{c_1}n$ из multi‑switching lemma (Lemma 4.4).
- `Toy‑тест:` если бы в Lemma 4.4 можно было взять $c_1=4$, то формула Thm. 4.3 стала бы с $(\\log n)^4$ (как в Lemma 4.2/Thm. 4.1); в тексте HR’22 $c_1$ оставлена как “absolute constant”.
- `Статус:` точная локализация константы (используем в Q43 как явный $C=c_1$).
- `Барьер‑чек:` r — применимо (switching‑леммы/decision trees релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43: в Proof of Lemma 4.4 (Section 7) попытаться извлечь явное значение/upper bound для $c_1$ (или зафиксировать, что текст не даёт численного $c_1$ без повторного анализа доказательства).

### 16.182. Исследовательский шаг (exact citation): в HR’22 Lemma 4.4 константа $c_1$ (в $\\log^{c_1}n$) не фиксируется явно

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S20-bound-c1):`
  В HR’22 Lemma 4.4 константа $c_1$ вводится только как “absolute constant” и в proof (Section 7.3) не выводится в явном виде: дополнительные издержки в инверсии отображения “absorbed by the constants $c_1$ and $c_2$”.
  Поэтому из текста HR’22 нельзя извлечь численное значение/upper bound для $c_1$ без самостоятельного трекинга констант (или замены леммы на источник с явными параметрами).
- `Точная ссылка (HR’22, text cache):`
  1) формулировка Lemma 4.4: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2570–2571` (“There are absolute constants A, c1, c2, n0 > 0 … n/n′ ≥ At log^{c1} n”);
  2) proof, Section 7.3: `…:2776–2777` (“the cost is absorbed by the constants c1 and c2”) и `…:2787–2790` (“only the index j cannot be absorbed by the constants A, c1 and c2”).
- `Toy‑тест:` поиск по шаблонам `c1=`/`choose c1` в text cache не находит явного выбора $c_1$ (только использование как “absolute constant”).
- `Статус:` exact citation (попытка “оценить $c_1$ из текста” упирается в неявные константы).
- `Барьер‑чек:` r — применимо (switching‑леммы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` либо перепройти proof Lemma 4.4 с трекингом констант и получить явный $c_1$, либо найти источник multi‑switching lemma с явно выписанным показателем у $\\log n$.

### 16.183. Исследовательский шаг (proof): PARITY имеет полиномиальные формулы глубины $O(\\log m/\\log\\log m)$ (снятие «глубинного» барьера для XOR‑строки)

- `Линза:` Трейд‑офф.
- `Утверждение (Q39.S2-parity-depth-loglog):`
  Для каждого $m\\ge 2$ существует булева формула над базисом $\\{\\wedge,\\vee,\\neg\\}$, вычисляющая $\\mathrm{PARITY}_m(x_1,\\dots,x_m)$, глубины
  $$O\\Bigl(\\frac{\\log m}{\\log\\log m}\\Bigr)$$
  и размера $\\mathrm{poly}(m)$ (например, $O(m^2)$).
  Следовательно, при глубине $d=\\Theta(\\log m/\\log\\log m)$ **само представление** большого XOR‑линейного условия (как одной строки Frege) не упирается в «нужно $\\Theta(\\log m)$ по глубине»; узел Q39 остаётся в **синтаксическом выводе** такого XOR‑шагa из предыдущих строк.
- `Доказательство (конструкция):`
  1) Для $k\\ge 1$ зададим depth‑2 DNF‑формулу паритета
  $$\\mathrm{PARITY}^{\\mathrm{DNF}}_k(x_1,\\dots,x_k)\\;:=\\;\\bigvee_{S\\subseteq[k],\\ |S|\\text{ odd}}\\ \\Bigl(\\bigwedge_{i\\in S} x_i\\ \\wedge\\ \\bigwedge_{i\\notin S}\\neg x_i\\Bigr).$$
  Она вычисляет $\\mathrm{PARITY}_k$ и имеет размер $O(k\\,2^k)$ и глубину 2.
  2) Пусть $b:=\\lceil\\log_2 m\\rceil$. Разобьём $x_1,\\dots,x_m$ на блоки длины $b$ (последний дополним константами 0).
  Пусть $y_1,\\dots,y_{\\lceil m/b\\rceil}$ — формулы, где $y_j$ есть $\\mathrm{PARITY}^{\\mathrm{DNF}}_b$ от переменных $j$‑го блока.
  Тогда
  $$\\mathrm{PARITY}_m(x)=\\mathrm{PARITY}_{\\lceil m/b\\rceil}(y_1,\\dots,y_{\\lceil m/b\\rceil}).$$
  3) Итерация: повторяем тот же шаг для $\\mathrm{PARITY}_{\\lceil m/b\\rceil}$, снова группируя входы по $b$ и применяя $\\mathrm{PARITY}^{\\mathrm{DNF}}_b$ на каждом блоке, пока число входов не станет $\\le b$ (тогда завершаем одной $\\mathrm{PARITY}^{\\mathrm{DNF}}_{\\le b}$).

  Глубина: каждый уровень добавляет 2, а число уровней $t$ удовлетворяет $m/b^t\\le b$, т.е.
  $$t\\le \\left\\lceil\\log_b(m/b)\\right\\rceil=O\\Bigl(\\frac{\\log m}{\\log\\log m}\\Bigr),$$
  значит глубина $\\le 2t+2=O(\\log m/\\log\\log m)$.
  Размер: так как $2^b\\le 2m$, имеем $|\\mathrm{PARITY}^{\\mathrm{DNF}}_b|=O(b\\,2^b)=O(m\\log m)$.
  На уровне $i$ блоков $\\le m/b^{i+1}$, поэтому вклад размера
  $$O\\Bigl(\\frac{m}{b^{i+1}}\\cdot m\\log m\\Bigr)=O\\Bigl(\\frac{m^2\\log m}{b^{i+1}}\\Bigr).$$
  Суммируя геометрический ряд по $i=0,1,\\dots,t-1$ и учитывая $b=\\Theta(\\log m)$, получаем общий размер $O(m^2)$.
- `Toy‑тест:` при $m=2^{16}$ имеем $b=16$ и уровней $t=3$ (так как $2^{16}/16^3<16$), то есть глубина $\\le 8$ при размере $O(m^2)$.
- `Статус:` доказано (явная конструкция формулы).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти/зафиксировать, существует ли **полиномиальный bounded‑depth Frege‑вывод** одной XOR‑операции (сложения двух линейных форм над $\\mathbb F_2$) при глубине $\\Theta(\\log n/\\log\\log n)$, или известен барьер/эквивалентность с моделями типа $\\mathrm{AC}^0$‑Frege с MOD2.

### 16.184. Исследовательский шаг (exact citation): GIRS’19 дают bounded‑depth вывод XOR‑шага (сложение $\\mathbb F_2$‑уравнений) для “compact representation” паритета

- `Линза:` Эквивалентность.
- `Утверждение (Q39.S3-cite-xor-step-bdfrege):`
  В Galesi–Itsykson–Riazanov–Sofronova’19 вводится “compact representation” $\\Phi^a(S,U)$ для уравнения паритета
  $$\\bigoplus_{i\\in S} x_i = a$$
  относительно фиксированного refinement $U$ множества $[n]$.
  В Section 4.2 (“Summation of linear equations”) они доказывают, что из двух таких представлений относительно **одного и того же** $U$
  можно синтаксически вывести их сумму над $\\mathbb F_2$, т.е. XOR‑шаг
  $$\\Phi^a(S,U),\\ \\Phi^b(T,U)\\ \\vdash\\ \\Phi^{a\\oplus b}(S\\triangle T, U)$$
  в bounded‑depth Frege с глубиной $3d+O(1)$ и полиномиальным (по размеру представлений) overhead.
  Это даёт положительный “XOR‑step”‑факт в литературе (но только в режиме compact‑representation+общий refinement).
- `Точная ссылка:`
  `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`, p. 11,
  Section 4.2, **Lemma 24**: “Let $U$ be a $(t_1,\\dots,t_d)$‑refinement … there exist a constant $c$ and a derivation
  $\\Phi^a(S,U),\\Phi^b(T,U)\\vdash_{3d+O(1)}\\Phi^{a\\oplus b}(S\\triangle T,U)$ of size at most $c\\cdot|\\Phi^1(\\emptyset,U)|^6$.”
- `Toy‑тест:` при $S=\\{1,2\\}$, $T=\\{2,3\\}$ получаем $S\\triangle T=\\{1,3\\}$ и именно $x_1\\oplus x_3=(x_1\\oplus x_2)\\oplus(x_2\\oplus x_3)$.
- `Статус:` exact citation (XOR‑сложение уравнений известно для compact‑representation).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо (локальный факт о bounded‑depth Frege‑выводе).
- `Следующий шаг:` сопоставить HR’22 “representing parity” (формулы depth $d$, size $M$) с compact‑representation $\\Phi^a(S,U)$: можно ли в bounded‑depth Frege переводить/поддерживать единый refinement $U$ для нужных промежуточных уравнений без blow‑up, или именно здесь “missing Gauss step” у HR остаётся.

### 16.185. Исследовательский шаг (toy computation): GIRS‑compact XOR‑step даёт лишь quasi‑poly размер в режиме глубины $\\Theta(\\log m/\\log\\log m)$

- `Линза:` Трейд‑офф.
- `Утверждение (Q39.S4-compare-hr-vs-girs-repr):`
  Если пытаться реализовать “XOR‑step” в bounded‑depth Frege через **GIRS’19 compact representation** $\\Phi^a(S,U)$ и их Lemma 24,
  то при глубине строк $D=\\Theta(\\log m/\\log\\log m)$ (где $m$ — ширина линейного уравнения) получается лишь квазиполиномиальная
  верхняя оценка на размер вывода, а не $\\mathrm{poly}(m)$.
  Поэтому наличие Lemma 24 само по себе не закрывает Q39: остаётся разрыв между “XOR‑step существует для compact‑representation” и
  “XOR‑step polynomial‑size в требуемом depth‑режиме для естественных паритет‑формул (HR §1.2)”.
- `Toy‑вычисление (по GIRS’19 Lemma 20/21/24):`
  В GIRS’19 (p. 10) Lemma 20: если $t_1\\cdots t_d\\ge m$, то существует $(t_1,\\dots,t_d)$‑refinement $U$ множества $[m]$.
  По Lemma 21 (p. 10) соответствующая compact‑формула паритета имеет глубину $\\le 3d+1$ и размер
  $$|\\Phi^1(\\emptyset,U)|\\ \\le\\ \\prod_{i=1}^d 2^{t_i+1}t_i\\ =\\ 2^{d+\\sum_i t_i}\\cdot\\prod_i t_i.$$
  Если хотим уложиться в глубину $D$, то берём $d:=\\lfloor (D-1)/3\\rfloor$.
  Чтобы минимизировать грубую оценку на размер, можно взять все $t_i$ одинаковыми: $t:=\\lceil m^{1/d}\\rceil$, тогда $t^d\\ge m$.
  Из Lemma 21 получаем
  $$|\\Phi^1(\\emptyset,U)|\\ \\le\\ (2^{t+1}t)^d\\ =\\ \\exp\\bigl(O(d\\,t)\\bigr).$$
  В режиме $D\\asymp \\log m/\\log\\log m$ имеем $d\\asymp \\log m/\\log\\log m$ и
  $$t=m^{1/d}=\\exp\\bigl(\\Theta(\\log m/d)\\bigr)=\\exp\\bigl(\\Theta(\\log\\log m)\\bigr)=\\log^{\\Theta(1)}m,$$
  так что $d\\,t=\\log^{\\Theta(1)}m$ и потому $|\\Phi^1(\\emptyset,U)|=\\exp(\\log^{\\Theta(1)}m)$ (quasi‑poly bound).
  Наконец, Lemma 24 (p. 11) даёт вывод XOR‑шага размера $\\le c\\cdot|\\Phi^1(\\emptyset,U)|^6$, то есть по этой оценке также quasi‑poly при таком $D$.
- `Статус:` проверено (параметрический разрыв: GIRS‑compact не даёт $\\mathrm{poly}(m)$ при $D\\asymp\\log m/\\log\\log m$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q39 нужно либо (a) другая “компактная” репрезентация паритета, совместимая с depth $\\Theta(\\log m/\\log\\log m)$ и $\\mathrm{poly}(m)$‑размером, для которой XOR‑step выводим, либо (b) барьер/негативный результат, что XOR‑step не может быть poly‑size в этом depth‑режиме.

### 16.186. Исследовательский шаг (proof): Håstad’20 Thm. 6.5 + XOR‑каркас ⇒ “универсальный poly XOR‑step” исключается лишь при $d=o(\\log n/\\log\\log n)$

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q39.S5-lb-xor-step-hastad20):`
  Пусть $d\\le 59\\,\\frac{\\log n}{\\log\\log n}$ (как в Håstad’20, Thm. 6.5) и рассмотрим Tseitin(Grid$_n$) с нечётной суммой зарядов.
  Если бы существовала процедура, которая для каждого XOR‑шагa, возникающего в стандартном гауссовом/column‑summing каркасе (суммирование $\\mathbb F_2$‑уравнений на границах регионов),
  строила depth‑$d$ Frege‑вывод этого шага размера $\\mathrm{poly}(n)$, то существовала бы depth‑$d$ Frege‑рефутация Tseitin(Grid$_n$) размера $\\mathrm{poly}(n)$.
  Сравнивая с Håstad’20 Thm. 6.5 (любой depth‑$d$ refutation имеет размер $\\ge \\exp(\\Omega(n^{1/(58(d+1))}))$) получаем противоречие **лишь в тех режимах $d$, где эта нижняя оценка сверхполиномиальна** (т.е. $n^{1/(58(d+1))}=\\omega(\\log n)$, эквивалентно $d=o(\\log n/\\log\\log n)$).
  В режиме $d=\\Theta(\\log n/\\log\\log n)$ сама по себе Thm. 6.5 не запрещает polynomial‑size (см. контрпример‑проверку §16.187).
- `Доказательство:`
  1) (Нижняя оценка.) По Håstad’20, Thm. 6.5 (`../../resources/downloads/hastad_2020_small_depth_frege_tseitin_grids.pdf`, p. 17 в тексте pdf‑to‑text)
  при $d\\le 59\\,\\frac{\\log n}{\\log\\log n}$ любая depth‑$d$ Frege‑рефутация Tseitin(Grid$_n$) имеет размер
  $$\\ge \\exp\\bigl(\\Omega(n^{1/(58(d+1))})\\bigr).$$
  2) (Каркас по XOR‑суммированию.) В гауссовом/column‑summing рассуждении противоречие $0=1$ получается как $\\mathbb F_2$‑линейная комбинация вершинных уравнений
  (сумма всех вершинных уравнений даёт $0=\\bigoplus_v \\chi(v)=1$).
  Любой такой вывод можно разложить на $T=\\mathrm{poly}(n)$ локальных XOR‑шагов вида
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2)$$
  (см. редукцию «XOR‑шаг ↔ 3‑вершинный Tseitin» в §16.126).
  3) (Склейка.) Если каждый из этих $T$ шагов имеет depth‑$d$ Frege‑вывод размера $\\mathrm{poly}(n)$, то их конкатенация даёт depth‑$d$ refutation размера $T\\cdot\\mathrm{poly}(n)=\\mathrm{poly}(n)$.
  4) (Когда возникает противоречие.) Конкатенация даёт refutation размера $\\mathrm{poly}(n)$, что противоречит пункту (1) **только если**
  $$\\exp\\bigl(\\Omega(n^{1/(58(d+1))})\\bigr)\\ \\text{сверхполиномиальна по }n.$$
  В этом случае в XOR‑каркасе действительно есть “плохой шаг” размера
  $$\\exp\\bigl(\\Omega(n^{1/(58(d+1))})\\bigr)/\\mathrm{poly}(n).$$
- `Toy‑тест:` если $d=o(\\log n/\\log\\log n)$, то $n^{1/(58(d+1))}=\\omega(\\log n)$ и lower bound в (1) сверхполиномиален; значит “универсальный poly XOR‑step” в таком depth‑режиме невозможен.
- `Статус:` доказано (корректная формулировка: аргумент даёт барьер лишь в режиме $d=o(\\log n/\\log\\log n)$).
- `Барьер‑чек:` r — применимо (LB Håstad’20 через switching‑лемму релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q39 уточнить класс “XOR‑шагов каркаса”: найти, можно ли держать special‑форму представления (общий partition/blocks) так, чтобы *все* шаги попадали в лёгкий режим §16.130 без base‑change, или доказать, что это невозможно.

### 16.187. Исследовательский шаг (counterexample): Thm. 6.5 не запрещает polynomial‑size при $d=\\Theta(\\log n/\\log\\log n)$

- `Линза:` Трейд‑офф.
- `Утверждение (Q39.S6-block-carcas-or-impossibility):`
  Утверждение вида «Håstad’20 Thm. 6.5 запрещает polynomial‑size refutation при $d=\\Theta(\\log n/\\log\\log n)$» неверно:
  при $d=(\\kappa+o(1))\\frac{\\log n}{\\log\\log n}$ нижняя оценка Thm. 6.5 даёт лишь
  $$\\mathrm{size}\\ \\ge\\ \\exp\\bigl(\\Omega(\\log^{1/(58\\kappa)}n)\\bigr)=n^{o(1)},$$
  что совместимо с polynomial‑size.
  Поэтому из Thm. 6.5 нельзя вывести, что “универсальный poly XOR‑step” невозможен на *критической* глубине; нужен структурный аргумент про base‑change/blocks.
- `Toy‑вычисление:`
  Подставим $d=(\\kappa+o(1))\\frac{\\log n}{\\log\\log n}$ в экспоненту Thm. 6.5:
  $$n^{1/(58(d+1))}=\\exp\\Bigl(\\frac{\\log n}{58(d+1)}\\Bigr)=\\exp\\Bigl(\\Theta\\bigl(\\tfrac{\\log\\log n}{58\\kappa}\\bigr)\\Bigr)=\\log^{\\Theta(1)}n.$$
  Отсюда $\\exp(\\Omega(n^{1/(58(d+1))}))=\\exp(\\Omega(\\log^{\\Theta(1)}n))=n^{o(1)}\\le n$ (например, при $\\kappa\\ge 1/58$).
  Следовательно, наличие refutation размера $n^{10}$ при такой глубине **не** противоречило бы Thm. 6.5.
- `Статус:` контрпример‑проверка (уточняет, где именно “LB ⇒ тяжёлый XOR‑шаг” работает).
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q39: либо найти реальный “hard” XOR‑шаг (где неизбежен base‑change между несовместимыми блок‑разбиениями), либо построить последовательность блок‑разбиений, в которой все шаги остаются в лёгком режиме §16.130.

### 16.188. Исследовательский шаг (exact citation): у HR’22 single switching‑леммы показатель polylog фиксирован (=4), а в multi‑слое новая “непоглощаемая” цена — только $M^{s/\\ell}$

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S21-cite-log4-and-Mfactor):`
  В HR’22 единственный *явно зафиксированный* polylog‑показатель в switching‑каркасе равен 4 (Lemma 4.2: предпосылка $n/n'\\ge A\\,t\\,\\log^4 n$ и хвост $(A t\\log^4 n'/(n/n'))^{s/64}$).
  Для multi‑switching (Lemma 4.4) в Proof/§7.3 авторы явно утверждают, что из “дополнительной информации” по сравнению со стандартным switching‑случаем **только** индекс $j\\in[M]$ “не поглощается” абсолютными константами и именно он порождает множитель $M^{s/\\ell}$.
  Следовательно, чтобы сделать показатель $c_1$ в Lemma 4.4 явным, достаточно трекать только места, где в §7.3 “absorbed by $c_1,c_2$” (например, идентификация доп. chosen centers на расстоянии 1), а не заново пересобирать весь single‑switching (где показатель уже равен 4).
- `Точная ссылка (HR’22, text cache):`
  1) Lemma 4.2 (Switching Lemma): `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:950–961`.
  2) Proof of Lemma 4.4, §7.3 (что именно даёт $M^{s/\\ell}$ и что “absorbed”): `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777` и `…:2787–2790`.
- `Toy‑тест:` проверка по text cache: в (1) действительно стоит $\\log^4$, а в (2) дословно выделен единственный “не‑absorbed” вклад — индекс $j$, порождающий $M^{s/\\ell}$.
- `Статус:` exact citation (локализация источников явных/неявных констант в HR’22).
- `Барьер‑чек:` r — применимо (switching/encoding‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить, что “identity of additional chosen centers” из §7.3 реально укладывается в прежний $b\\log\\Delta$‑терм (как в Lemma 6.9) и не требует увеличивать показатель у $\\log n$ сверх 4; иначе выписать явный upper bound на $c_1$ (пусть и грубый).

### 16.189. Исследовательский шаг (toy computation): доп. идентификация chosen centers в multi‑switching даёт множитель $(n/n')^{O(s)}$ и влияет только на $c_2$ (а не на $\\log^4$)

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S22-check-c1-vs-log4):`
  В HR’22 Proof of Lemma 4.4 (Multi-switching) указано, что для восстановления “additional chosen centers” на расстоянии $\\le1$ от новых exposed centers читается $\\le\\log\\Delta$ бит на центр и таких центров “at most linear in $s$”.
  Поэтому весь этот вклад даёт лишь дополнительный множитель
  $$2^{O(s\\log\\Delta)}=\\Delta^{O(s)}=(n/n')^{O(s)}$$
  в энкодинге (при $\\Delta=\\Theta(n/n')$).
  Такой множитель естественно “прячется” в константу $c_2$ в хвосте Lemma 4.4 вида
  $$(At\\,\\log^{c_1}n\\,/(n/n'))^{s/c_2},$$
  т.е. меняет только коэффициент при $\\log(n/n')$ в экспоненте, но **не порождает** нового polylog‑показателя сверх $\\log^4$ из single‑switching (Lemma 4.2).
- `Точная ссылка (HR’22, text cache):` `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777`.
- `Toy‑тест:` $\\log\\Delta$ бит на центр и $O(s)$ центров ⇒ $O(s\\log\\Delta)$ бит ⇒ $2^{O(s\\log\\Delta)}=\\Delta^{O(s)}$.
- `Статус:` toy computation (локализует, что именно может “раздуть” только $c_2$, но не показатель у $\\log n$).
- `Барьер‑чек:` r — применимо (вся энкодинг‑оценка релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужен *численный* $c_2$, оценить константу в “linear in $s$” для числа таких centers из конструкции common partial decision tree (HR’22 §7.2) и подставить в энкодинг.

### 16.190. Исследовательский шаг (toy computation): явная константа в “linear in $s$” для additional chosen centers в HR’22 Lemma 4.4 (≤ $2s$)

- `Линза:` Инвариант.
- `Утверждение (Q43.S23-bound-linear-centers):`
  В HR’22 (Lemma 4.4 / §7.2–§7.3) число chosen centers $v$, для которых в §7.3 нужно “recover the chosen centers $v$ at distance at most 1 from the newly exposed chosen centers”, можно взять не просто “$O(s)$”, а **явно** $\\le 2s$ для ветви глубины $s$ в common partial decision tree.
  Следовательно, соответствующая цена идентификации ограничена сверху $\\le 2s\\log\\Delta$ бит.
- `Доказательство (заряд по запросам):`
  Возьмём фиксированную ветвь $\\tau$ common partial decision tree $T$ глубины $s$.
  По построению (HR’22 §7.2) на каждом раунде для long branch $\\lambda^j$ вводится множество $S_{\\lambda^j}$ и $T$ расширяется запросами “all variables incident to $S_{\\lambda^j}$”.
  Поэтому для каждого chosen center $v\\in\\bigcup_j S_{\\lambda^j}$ существует хотя бы один запрос переменной на ветви $\\tau$, инцидентной $v$.
  Для каждого такого $v$ выберем **первый** (по порядку на $\\tau$) запрос переменной, инцидентной $v$.
  Но каждая переменная $y_P$ соответствует chosen path $P$, соединяющему **две** chosen centers (HR’22 §3), т.е. один запрос может быть инцидентен не более чем двум chosen centers.
  Значит, отображение $v\\mapsto$ “первый инцидентный запрос” является $\\le2$‑к‑$1$, и
  $$\\Bigl|\\bigcup_j S_{\\lambda^j}\\Bigr|\\le 2\\cdot |\\text{queries on }\\tau|=2s.$$
  Отсюда цена идентификации $\\le (2s)\\log\\Delta$ бит.
- `Точная ссылка (HR’22, text cache):`
  1) Определение $S_{\\lambda^j}$ и “querying all variables incident to $S_{\\lambda^j}$”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2724–2729`.
  2) Место, где говорится “linear in $s$”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777`.
  3) “chosen path connects two chosen centers” и ввод $y_P$: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:733–735`.
- `Toy‑тест:` при $s$ запросах можно достигать $2s$ distinct chosen centers (каждый запрос касается двух “новых” центров), так что константа 2 оптимальна для такого счёта.
- `Статус:` toy computation (явная константа для hidden “linear in $s$”).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (комбинаторный энкодинг‑аргумент релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` подставить $2s\\log\\Delta$ в оценку “absorbed by $c_2$” в proof of Lemma 4.4 (§7.3) и выписать грубый численный $c_2$ (с учётом базового $s/64$ из single‑switching).

### 16.191. Исследовательский шаг (toy computation): грубый явный $c_2$ для HR’22 Lemma 4.4 из bound $|\\bigcup_j S_{\\lambda^j}|\\le 2s$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S24-derive-numeric-c2):`
  Если в proof‑схеме HR’22 Lemma 4.4 (Multi-switching) использовать тот же “заряд по стадиям”, что и в single‑switching (Lemma 4.2 через Lemma 6.8–6.9), то можно взять **$c_2=64$** (т.е. тот же знаменатель, что в хвосте $(\\cdot)^{s/64}$), а вклад “additional chosen centers” из §7.3 лишь раздувает polylog‑часть: грубо достаточно $c_1\\le 132$.
- `Вывод (как в Lemma 6.8–6.9, с подстановкой 16.190):`
  1) В single‑switching имеем $a\\ge s/64$ (HR’22 Lemma 6.8) и оценку числа bad‑ограничений через $a\\log t+b\\log\\Delta+O(s)$ бит (HR’22 Lemma 6.9), где $b\\le 3a$ (Lemma 6.8), откуда получается $\\log^{4a}$ и хвост $(At\\,\\log^4(\\cdot)/(n/n'))^{s/64}$ (Lemma 4.2).
  2) В multi‑switching дополнительно нужно идентифицировать chosen centers из $\\bigcup_j S_{\\lambda^j}$; по §16.190 их не больше $2s$, значит вклад в энкодинг не превосходит $2s\\log\\Delta$ бит.
  3) Заряд Lemma 6.8 даёт $s\\le 64a$, поэтому $2s\\le 128a$. Следовательно, можно просто увеличить “$b$‑часть” на $128a$ и получить грубую оценку $a+b\\le a+(3a+128a)=132a$, т.е. заменить $\\log^4$ на $\\log^{132}$, сохранив знаменатель 64 в экспоненте.
- `Toy‑тест:` арифметика: $a\\ge s/64\\Rightarrow 2s\\le 128a$; при $b\\le 3a$ получаем $a+b+128a\\le 132a$.
- `Статус:` toy computation (явный, хотя и грубый, upper на константы).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (switching/encoding релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` уточнить, действительно ли “additional chosen centers” из §7.3 можно зарядить в тот же $b\\log\\Delta$‑терм с коэффициентом $O(1)$ (тогда $c_1$ может остаться $\\approx 4$), и отдельно проверить вклад “differences in values” (тоже заявлен как absorbed).

### 16.192. Исследовательский шаг (exact citation): HR’22 §7.3 — “additional chosen centers” и “differences in values” поглощаются; только индекс $j$ даёт фактор $M^{s/\\ell}$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S25-tighten-c1-charge):`
  В доказательстве Multi-switching Lemma 4.4 (HR’22) в §7.3 явно перечислены дополнительные данные, читаемые на каждом раунде инверсии:
  (i) индекс $j\\in[M]$ (log $M$ бит),
  (ii) идентичность дополнительных chosen centers на расстоянии $\\le 1$ от новых exposed centers (log $\\Delta$ бит на центр),
  (iii) “differences in values” между ответами в деревьях $T^j$ и $T$.
  HR’22 прямо утверждают, что **только** (i) не поглощается константами $A,c_1,c_2$ и именно он порождает множитель $M^{s/\\ell}$ в оценке Lemma 4.4; пункты (ii)–(iii) поглощаются константами.
- `Точная ссылка (HR’22, text cache):`
  1) (ii) + “absorbed by $c_1,c_2$”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777`.
  2) (iii) “differences in values”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2778–2783`.
  3) “only index $j$ cannot be absorbed” ⇒ фактор $M^{s/\\ell}$: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2787–2790`.
- `Toy‑тест:` проверено по text cache, что формулировки (ii)–(iii) и вывод “only the index $j$” действительно записаны в §7.3.
- `Статус:` точная ссылка (закрывает подпункт “differences in values absorbed”; остаётся распаковать “absorbed” в явные константы для $c_1$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (encoding‑аргумент релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` выписать явный верхний bound на число “differences in values” бит на раунд (в терминах $s$ или $a,b$ из Lemma 6.9) и тем самым отделить вклад, который меняет только $A$ (а не $c_1$).

### 16.193. Исследовательский шаг (toy computation): “differences in values” в HR’22 §7.3 стоят ≤ 1 бит на запрос и меняют только константу $A$

- `Линза:` Инвариант.
- `Утверждение (Q43.S26-bound-diff-values-bits):`
  В схеме инверсии Multi-switching Lemma 4.4 (HR’22, §7.3) дополнительная информация “differences in values” кодируется ≤ 1 битом на каждую булеву переменную, запрошенную на рассматриваемой ветви common decision tree $T$; следовательно, на ветви глубины $s$ суммарная цена ≤ $s$ бит.
  Так как в single‑switching имеем $a\\ge s/64$ (HR’22 Lemma 6.8), то $s\\le 64a$ и вклад ≤ $64a$ бит лишь умножает счётчик кодировок на $2^{64a}=(2^{64})^a$, т.е. поглощается увеличением константы $A$ и **не** меняет $c_1,c_2$.
- `Доказательство (счёт бит):`
  На каждом раунде HR’22 читают “difference in values of variables queried in the decision tree $T^j$ and the same variables in the common decision tree $T$” (§7.3).
  Для каждой такой переменной значение в $T^j$ и в $T$ — два бита, значит их разность определяется одним битом (XOR).
  На фиксированной ветви $\\tau$ common decision tree $T$ глубины $s$ запрошено ровно $s$ переменных, поэтому даже в худшем случае достаточно ≤ $s$ бит, чтобы задать разности для всех этих запросов (по раундам это просто разбиение запросов ветви $\\tau$).
  Используя $s\\le 64a$ (Lemma 6.8), получаем ≤ $64a$ бит сверх энкодинга Lemma 6.9; это даёт множитель $2^{64a}=(2^{64})^a$, который поглощается заменой $A\\leftarrow 2^{64}A$ в финальной оценке вероятности.
- `Toy‑тест:` на ветви из $s$ булевых запросов вектор разностей может быть произвольным в $\\{0,1\\}^s$, так что линейный по $s$ upper (и “1 бит на запрос”) асимптотически точен.
- `Статус:` toy computation (явный bound на “differences in values”, отделяющий вклад в $A$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (счёт кодировок релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` так же “раздуть” в явные константы пункт (ii) про additional chosen centers, но попытаться зарядить его в тот же $b\\log\\Delta$‑терм без роста показателя логарифма (чтобы удержать $c_1\\approx 4$).

### 16.194. Исследовательский шаг (toy computation): “additional chosen centers” в HR’22 §7.3 дают ≤ $5a$ центров (а не ≤ $2s$), улучшая грубый bound на $c_1$

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S27-charge-centers-into-b):`
  В HR’22 §7.3 (Multi-switching Lemma 4.4) дополнительная информация (ii) “identity of additional chosen centers” может быть ограничена не через глубину ветви $s$ common tree, а через параметр $a$ из single‑switching энкодинга (HR’22 Lemma 6.8): на всей ветви глубины $s$ достаточно восстановить не более чем $5a$ chosen centers из объединения $S_{\\lambda^j}$ по раундам $j$.
  Следовательно, цена пункта (ii) составляет ≤ $5a\\log\\Delta$ бит, и грубый переход “≤$2s$ центров ⇒ $c_1\\le 132$” (§16.191) можно заменить на “≤$5a$ центров ⇒ $b$ эффективно меняется на $b+5a\\le 8a$”, т.е. $c_1$ можно взять порядка 9 (в той же схеме оценки).

- `Доказательство (счёт центров):`
  В HR’22 §7.2 множество $S_{\\lambda^j}$ определяется как chosen centers на расстоянии ≤1 от *новых* exposed chosen centers на длинной ветви $\\lambda^j$ (см. `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2720–2726`).
  Пусть
  $$U_j:=(S(\\lambda^j,\\sigma)\\setminus S(\\tau,\\sigma))\\cap C_\\sigma$$
  — эти “newly exposed chosen centers”. Тогда по определению $S_{\\lambda^j}\\subseteq N_{\\le 1}(U_j)$, где соседство берётся по “adjacent sub-squares” (HR’22: “neighbors … in adjacent sub-squares”; `…:1573–1574`), и потому на решётке под‑квадратов
  $$|S_{\\lambda^j}|\\le |U_j|+4|U_j|=5|U_j|.$$
  Далее, каждый новый exposed chosen center из $U_j$ появляется в стадии $j$ как associated center некоторой переменной на соответствующей 1‑ветви (это ровно то, что считает $a_j$ в HR’22 Lemma 6.8; `…:2078–2086`), откуда $|U_j|\\le a_j$.
  Суммируя по раундам,
  $$\\Bigl|\\bigcup_j S_{\\lambda^j}\\Bigr|\\le \\sum_j |S_{\\lambda^j}|\\le 5\\sum_j a_j=5a.$$
  В §7.3 HR’22 указывают, что на восстановление каждого такого chosen center читается ≤$\\log\\Delta$ бит (`…:2774–2777`), значит общий бюджет на (ii) ≤ $5a\\log\\Delta$ бит.

- `Toy‑тест:` worst‑case на решётке: если $U_j$ — множество попарно “разнесённых” новых exposed centers, то их соседства почти не пересекаются и $|S_{\\lambda^j}|\\approx 5|U_j|$, т.е. константа 5 по порядку точна.
- `Статус:` toy computation (улучшенный счёт “additional chosen centers” через $a$, без фактора 64).
- `InfoGain:` 2.
- `Барьер‑чек:` r — применимо (encoding‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться усилить $|U_j|\\le a_j$ до “$S_{\\lambda^j}$ уже входит в $b$ из Lemma 6.9” (т.е. показать, что (ii) вообще не увеличивает показатель polylog), или найти точную точку, где это невозможно.

### 16.195. Исследовательский шаг (proof): (ii) “identity of additional chosen centers” в HR’22 §7.3 не увеличивает polylog‑показатель — она уже покрывается $b\\log\\Delta$ из Lemma 6.9

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S28-centers-already-in-b):`
  В proof of HR’22 Lemma 4.4 (Multi-switching, §7.3) дополнительный пункт (ii) “identity of additional chosen centers” для множеств $S_{\\lambda^j}$ можно зарядить в тот же $b\\log\\Delta$‑терм, что и в single‑switching Lemma 6.9: центры $v\\in S_{\\lambda^j}$ уже восстанавливаются стандартной инверсией как “неэкспонированные соседи” новых exposed chosen centers, а случаи, где нужен $\\log\\Delta$, совпадают с “other disappearing centers”, считаемыми в $b$.

- `Доказательство (по тексту HR’22):`
  В раунде $j$ multi-switching задана длинная ветвь $\\lambda^j$ и
  $$U:=(S(\\lambda^j,\\sigma)\\setminus S(\\tau,\\sigma))\\cap C_\\sigma$$
  — множество “newly exposed chosen centers” (HR’22: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2724–2729`).
  По определению $S_{\\lambda^j}$ каждый $v\\in S_{\\lambda^j}$ лежит в под‑квадрате, соседнем (в $n'\\times n'$‑решётке) некоторому $u\\in U$.
  Так как при построении $T^j$ “maintain the same invariants as in Invariants 6.1” (HR’22: `…:2698–2699`), то для каждого exposed chosen center $u$ на ветви $\\lambda^j$ запрошены **все** инцидентные переменные $y_P$ (Invariant 6.1(5); `…:1858–1861`).
  В частности, запрошена переменная выбранного пути между $u$ и соседним $v$, и в восстановимом information set присутствует information piece $\\{u,v\\}$.
  Ровно такие ситуации (edge/non-edge между exposed chosen center $u$ и неэкспонированным chosen center $v$) разбираются в proof of Lemma 6.9: Case 1–3 при восстановлении $I_j$ (`…:2518–2534`).
  В Case 1 $v$ восстанавливается позже, в Case 3 — бесплатно как alive chosen center, а в Case 2 $v$ идентифицируется за $\\log\\Delta$ бит и при этом **не** является associated center (по Property 2, Definition 6.2), то есть относится к “other disappearing centers”, оплачиваемым $b\\log\\Delta$ (`…:2531–2534`, `…:2547–2548`).
  Следовательно, (ii) не требует добавлять новый $\\log\\Delta$‑бюджет поверх Lemma 6.9 и не увеличивает polylog‑показатель по сравнению с single‑switching (за исключением отдельного фактора по индексу $j\\in[M]$).

- `Toy‑тест:` локально на решётке каждый новый exposed chosen center $u$ имеет ≤4 соседних chosen centers; по Invariant 6.1(5) они неизбежно появляются как вторые концы queried variables, а Lemma 6.9 Case 1–3 даёт готовую схему их восстановления без нового polylog.
- `Статус:` доказано (на уровне схемы инверсии HR’22; пункт (ii) не увеличивает polylog‑показатель).
- `InfoGain:` 2.
- `Барьер‑чек:` r — применимо (энкодинг‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обновить §16.191–§16.194: убрать добавку “$+5a$” как обязательную для $c_1$, зафиксировать $c_1\\approx 4$ (и отдельно вынести единственный непоглощаемый вклад $\\log M$), либо указать точное место, где “forgotten answers” ломают прямой перенос Case 1–3.

### 16.196. Исследовательский шаг (proof): в HR’22 Lemma 4.4 можно взять $c_1=4$; непоглощаемый вклад §7.3 — только индекс $j$ (даёт фактор $M^{s/\\ell}$)

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S29-propagate-c1-back-to-4):`
  В вероятностной оценке HR’22 Lemma 4.4 (Multi-switching) показатель $c_1$ при $\\log^{c_1}n$ можно выбрать равным $4$ (как в single-switching Lemma 4.2), т.е. без роста polylog‑показателя по сравнению с single‑switching.
  Все дополнительные данные, перечисленные в HR’22 §7.3, кроме индекса $j\\in[M]$, поглощаются константами $A,c_2$; единственный непоглощаемый вклад даёт фактор $M^{s/\\ell}$ (эквивалентно чтению $(s/\\ell)\\log M$ бит).

- `Доказательство (сведение к single-switching):`
  В HR’22 §7.3 на каждом раунде инверсии перечислены дополнительные данные (i)–(iii); при этом в тексте прямо сказано, что **только** (i) “cannot be absorbed by the constants $A,c_1,c_2$” и именно он порождает фактор $M^{s/\\ell}$ (см. `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2790`).
  Для (iii) “differences in values” достаточно ≤ $s$ бит на ветвь глубины $s$, значит при $a\\ge s/64$ (HR’22 Lemma 6.8) имеем $s\\le 64a$ и этот вклад даёт множитель $2^{O(a)}$, поглощаемый увеличением $A$ (см. §16.193).
  Для (ii) “identity of additional chosen centers” по §16.195 не требуется добавлять новый $\\log\\Delta$‑бюджет сверх Lemma 6.9: соответствующие центры уже восстанавливаются в Case 1–3 и (в единственном месте, где нужен $\\log\\Delta$) относятся к “other disappearing centers”, оплачиваемым тем же $b\\log\\Delta$.
  Следовательно, в части, отвечающей за polylog‑показатель $\\log^{c_1}n$, multi-switching использует тот же single‑switching энкодинг, где $c_1=4$ (Lemma 4.2), а все отличия сводятся к фактору $M^{s/\\ell}$ и перенормировке $A$.

- `Toy‑тест:` если бы (ii) или (iii) требовали увеличивать $b$ сверх $3a$ или добавлять $\\log\\Delta$‑терм “поверх” Lemma 6.9, это проявилось бы как рост показателя у $\\log n$ в предпосылке $n/n'\\ge A t\\log^{c_1}n$; после §16.193 и §16.195 остаётся только (i), дающий множитель $M^{s/\\ell}$ без изменения $c_1$.
- `Статус:` доказано (получено явное $c_1=4$ и изолирован единственный вклад $\\log M$).
- `InfoGain:` 2.
- `Барьер‑чек:` r — применимо (switching/encoding релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` в corollary‑оценках для Q43 заменить “$(\\log n)^C$ из Thm. 4.3” на явное $\\log^4 n$, оставив $\\log M$ только в параметре $t$ (и факторе $M^{s/\\ell}$), и перепроверить порог нетривиальности при $d=\\Theta(\\log n/\\log\\log n)$.

### 16.197. Исследовательский шаг (proof): явный corollary с $\\log^4 n$ при $c_1=4$ и зависимостью от $M$ только через $t'$ и $M^{s/\\ell}$

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S30-log4-into-corollary):`
  Пусть есть flat local‑EF(s)‑рефутация Tseitin($G_n$) на $n\\times n$ grid (odd charges, как в HR’22),
  и каждая строка — формула глубины $\\le d$ и размера $\\le M$.
  Тогда число строк $N$ удовлетворяет явной нижней оценке
  $$N\\ \\ge\\ \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^4\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right).$$
  При этом зависимость от $M$ в доказательстве проходит **только** через $t'=(2s+1)\\log M$ и через фактор $M^{s/\\ell}$ из multi‑switching (индекс $j\\in[M]$); других $\\log M$‑вкладов в polylog‑показатель нет.
- `Доказательство:`
  По §16.174 имеем corollary HR’22 Thm. 4.3 с заменой $t=\\log M\\mapsto t'=(2s+1)\\log M$ и polylog‑фактором $(\\log n)^{O(1)}$.
  По §16.181 этот показатель равен $\\log^{c_1}n$, где $c_1$ — константа из HR’22 Lemma 4.4,
  а по §16.196 можно взять $c_1=4$ (как в single‑switching).
  Подставляя $c_1=4$ в corollary §16.174, получаем указанную формулу с $(\\log n)^4$.

  Зависимость от $M$: параметрический блок Proof of Thm. 4.3 использует $M$ только через $t=\\log M$ (§16.166),
  а единственный непоглощаемый вклад §7.3 HR’22 — индекс $j\\in[M]$, дающий фактор $M^{s/\\ell}$ (§16.196).
  Следовательно, после unfolding зависимость от $M$ идёт лишь через $t'$ и $M^{s/\\ell}$, как утверждается.
- `Toy‑тест:` при $s=0$ получаем исходный HR’22 Thm. 4.3 с $(\\log n)^4$ (single‑switching Lemma 4.2).
- `Статус:` доказано (явная подстановка $c_1=4$ в corollary).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (switching/DT‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` при $M=\\mathrm{poly}(n)$ и $s=(\\log n)^c$ пересчитать показатель при критической глубине $d=(\\kappa+o(1))\\log n/\\log\\log n$ с явной константой $4$ (Q43.S31-critical-depth-kappa).

### 16.198. Исследовательский шаг (toy computation): критическая глубина $d=(\\kappa+o(1))\\log n/\\log\\log n$ при $s=(\\log n)^c$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S31-critical-depth-kappa):`
  Пусть $M=\\mathrm{poly}(n)$, $s=(\\log n)^c$ для фиксированного $c\\ge 0$, и
  $$d=\\left(\\kappa+o(1)\\right)\\frac{\\log n}{\\log\\log n}.$$
  Тогда corollary §16.197 даёт
  $$N\\ge\\exp\\bigl(\\Omega(n^{1-\\kappa(5+c)-o(1)})\\bigr).$$
  В частности, lower bound нетривиален ($N\\ge\\exp(n^{\\Omega(1)})$) тогда и только тогда, когда
  $$\\kappa<\\frac{1}{5+c}.$$
- `Toy‑вычисление:`
  В §16.197 имеем
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^4(2s+1)\\log M\\bigr)^d}\\right)\\right).$$
  При $M=\\mathrm{poly}(n)$ получаем $\\log M=\\Theta(\\log n)$, а при $s=(\\log n)^c$ имеем $2s+1=\\Theta((\\log n)^c)$.
  Тогда
  $$\\bigl((\\log n)^4(2s+1)\\log M\\bigr)^d=\\bigl((\\log n)^{5+c}\\bigr)^d.$$
  Подставляя $d=(\\kappa+o(1))\\log n/\\log\\log n$, получаем
  $$\\bigl((\\log n)^{5+c}\\bigr)^d=\\exp\\bigl((\\kappa+o(1))(5+c)\\log n\\bigr)=n^{\\kappa(5+c)+o(1)},$$
  и потому показатель экспоненты равен $n^{1-\\kappa(5+c)-o(1)}$.
- `Toy‑тест:` при $c=0$, $M=n^2$, $\\kappa=1/6$ имеем
  $$\\bigl((\\log n)^5\\bigr)^d=\\exp\\bigl((5/6+o(1))\\log n\\bigr)=n^{5/6+o(1)},$$
  значит $N\\ge\\exp(\\Omega(n^{1/6}))$.
- `Статус:` проверено (явный $\\kappa$‑порог при критической глубине с $c_1=4$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оценить вклад фактора $M^{s/\\ell}$ при естественном выборе $\\ell:=t'=(2s+1)\\log M$ и проверить, остаётся ли он $\\exp(\\Theta(1))$ (Q43.S32-m-factor-ell-constant).

### 16.199. Исследовательский шаг (toy computation): константность фактора $M^{s/\\ell}$ при $\\ell=t'$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S32-m-factor-ell-constant):`
  Пусть $s\\ge 0$, $M>1$ и
  $$\\ell:=t':=(2s+1)\\log M.$$
  Тогда
  $$M^{s/\\ell}=\\exp\\!\\left(\\frac{s}{2s+1}\\right)\\le e^{1/2},$$
  то есть фактор $M^{s/\\ell}$ — абсолютная константа и поглощается в $A$.
- `Toy‑вычисление:`
  $$M^{s/\\ell}=\\exp\\!\\left(\\frac{s}{\\ell}\\cdot\\log M\\right)=\\exp\\!\\left(\\frac{s}{(2s+1)\\log M}\\cdot\\log M\\right)=\\exp\\!\\left(\\frac{s}{2s+1}\\right).$$
  Так как $s/(2s+1)\\le 1/2$ при $s\\ge 0$, получаем $M^{s/\\ell}\\le e^{1/2}$.
  (Если $\\log$ берётся по основанию $2$, то $M^{s/\\ell}=2^{s/(2s+1)}\\le\\sqrt{2}$.)
- `Toy‑тест:` при $s=1$, $M=2$ имеем $2^{1/(3\\log 2)}=e^{1/3}<e^{1/2}$.
- `Статус:` проверено (фактор $M^{s/\\ell}$ константен при $\\ell=t'$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (чистая арифметика в параметрах), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить допустимость выбора $\\ell=t'$ в Lemma 4.4/Def. “$\\ell$‑common” (есть ли ограничение $\\ell\\le s$ или иное) — Q43.S33-ell-admissibility-check.

### 16.200. Исследовательский шаг (exact citation): допустимость $\\ell=t'$ в Def. 2.10 / Lemma 4.4

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S33-ell-admissibility-check):`
  В HR’22 Def. 2.10 и Lemma 4.4 параметр $\\ell$ не ограничен сверху (нет условий вида $\\ell\\le t$ или $\\ell\\le s$);
  значит выбор $\\ell=t'$ допустим на уровне формулировок (при сохранении условий на $t,s$ из Lemma 4.4).
- `Exact citation:`
  Def. 2.10: “for every $T_i$ and branch $\\tau\\in T$ there are decision trees $T^{(i,\\tau)}$ of depth $\\ell$ …”
  без дополнительных условий на $\\ell$ (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:574–582`).
  Lemma 4.4: параметры $k,M,n',s,t\\in\\mathbb N^+$ с условиями $t\\le s\\le n'/32$ и $\\mathrm{depth}(T_i)\\le t$,
  а $\\ell$ появляется только в требовании “represented by an $\\ell$‑common partial decision tree of depth $s$”
  и в множителе $M^{s/\\ell}$ (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1073–1084`).
- `Toy‑тест:` при дереве глубины $t$ и частичном дереве глубины $0$ Def. 2.10 допускает любой $\\ell$,
  так что выбор $\\ell>t$ не вызывает противоречия в определении.
- `Статус:` подтверждено (ограничения на $\\ell$ в формулировках отсутствуют).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (цитата/формулировка), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, не используется ли в доказательстве Lemma 4.4 скрытое условие $\\ell\\le t$ или $\\ell\\le s$ (Q43.S35-ell-vs-t-constraint).

### 16.201. Исследовательский шаг (toy computation): скрытое $\\ell\\le s$ в подсчёте раундов Lemma 4.4

- `Линза:` Инвариант.
- `Утверждение (Q43.S35-ell-vs-t-constraint):`
  В доказательстве Lemma 4.4 фактор $M^{s/\\ell}$ получается из “по одному индексу $j\\in[M]$ на раунд”
  (HR’22 §7.3: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2784–2790`).
  Это требует верхней оценки на число раундов вдоль ветви глубины $s$; в §7.2 раунд завершается,
  когда добавлено $\\ge\\ell/4$ центров, и затем в $T$ запрашиваются все переменные, инцидентные $S_{\\lambda_j}$
  (HR’22 §7.2: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2718–2732`).
  Поэтому без явного округления получается неявное ограничение $\\ell\\le s$ (иначе число раундов
  может быть $1$, тогда как $s/\\ell<1$).
- `Toy‑тест:` пусть $s=2$, $t=1$, $\\ell=5$. В каждом раунде добавляется $\\ge\\ell/4>1$ центров и
  запрашиваются инцидентные переменные, значит одна итерация уже даёт глубину $\\ge s$ и требует один
  индекс $j$ (cost $\\log M$). Но $s/\\ell=0.4$, и множитель $M^{s/\\ell}$ даёт $<M$; это несовместимо с
  “по одному индексу на раунд”, если не вводить явное $\\lceil s/\\ell\\rceil$ или условие $\\ell\\le s$.
- `Статус:` контрпример‑toy к гипотезе “нет скрытого ограничения”; нужна явная оговорка $\\ell\\le s$
  (или округление числа раундов).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (локальная проверка proof), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить в оригинальном PDF/доказательстве, как фиксируется число раундов
  (округление/транкция) и можно ли заменить $M^{s/\\ell}$ на $M^{\\lceil s/\\ell\\rceil}$ без изменения остального.

### 16.202. Исследовательский шаг (proof): округление числа раундов по глубине

- `Линза:` Инвариант.
- `Утверждение (Q43.S36-round-count-from-depth):`
  В §7.2 каждый раунд добавляет к ветви $T$ по крайней мере $\\ell$ **новых** запросов,
  поэтому префикс длины $s$ на любой ветви может пересекать не более $\\lceil s/\\ell\\rceil$ раундов.
  Следовательно, “по одному индексу $j$ на раунд” даёт фактор $M^{\\lceil s/\\ell\\rceil}$ (при $s<\\ell$ это даёт $M$).
- `Доказательство:`
  В §7.2 раунд выбирает ветвь $\\lambda$ длины $\\ge\\ell$ в $T^j$ и **расширяет** $T$ в листе $\\tau$
  запросами “всех переменных на $\\lambda$” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2671–2684`).
  По определению дерева решений внутренняя разметка на любой ветви использует **различные** переменные
  (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:489–494`),
  а при расширении листа запрещены запросы к переменным, локально имплицированным $\\tau$
  (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:532–535`),
  поэтому $\\lambda$ добавляет $\\ge\\ell$ новых запросов к текущей ветви.
  Значит префикс длины $s$ может включать не более $\\lceil s/\\ell\\rceil$ раундов
  (каждый раунд даёт минимум $\\ell$ новых запросов), и индекс $j\\in[M]$ кодируется
  не более чем $\\lceil s/\\ell\\rceil$ раз.
- `Toy‑тест:` $s=2$, $\\ell=5$: первый раунд уже добавляет $\\ge 5$ запросов, значит префикс длины $2$
  использует $\\le 1$ раунд; $M^{\\lceil 2/5\\rceil}=M$.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (локальная оценка в доказательстве), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить альтернативный bound по числу centers (Q43.S37-round-count-from-centers).

### 16.203. Исследовательский шаг (counterexample): из “$\\ge\\ell/4$ центров за раунд” не следует $\\le\\lceil 4a/\\ell\\rceil$

- `Линза:` Инвариант.
- `Утверждение (Q43.S37-rounds-via-uj):`
  В §7.2 “$\\ge\\ell/4$ центров за раунд” относится к **всем** exposed centers в $S(\\lambda^j,\\sigma)$, а не к associated centers.
  Поэтому утверждение “в каждом раунде добавляется $\\ge\\ell/4$ associated centers” (и, следовательно, bound $\\#\\text{rounds}\\le\\lceil 4a/\\ell\\rceil$) неверно без дополнительной структуры.
  В общем виде из Lemma 6.5–6.8 следует лишь
  $$\\#\\text{rounds}\\le\\Bigl\\lceil\\frac{64a}{\\ell}\\Bigr\\rceil.$$
- `Контрпример (структурный разрыв):`
  В §7.2 раунд заканчивается, когда “at least $\\ell/4$ centers have been added … to $S(\\lambda^j,\\sigma)$” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2718–2722`).
  Но в одной стадии центры добавляются как $\\mathrm{supp}(J)\\cup S_J$, и Lemma 6.5 даёт верхний bound “at most $4|\\mathrm{supp}(J)|$ centers are added” (там же: `…:2013–2022`).
  Далее Lemma 6.8 утверждает $|\\mathrm{supp}(J)|\\le 4a_j$ (там же: `…:2081–2086`), поэтому одна стадия может добавить до $16a_j$ центров.
  Следовательно, раунд может достичь порога $\\ell/4$ при $a_j\\ge \\ell/64$, так что вывод $a_j\\ge\\ell/4$ (и bound $\\lceil 4a/\\ell\\rceil$) не проходит; корректный общий upper — $\\lceil 64a/\\ell\\rceil$.
- `Toy‑тест:` локальная конфигурация, где каждый associated center даёт 3 соседних chosen centers в $\\mathrm{supp}(J)$, а каждый из них имеет ещё 3 новых соседних chosen centers в $S_J\\setminus\\mathrm{supp}(J)$, реализует фактор 16 между $a_j$ и числом новых центров.
- `Статус:` контрпример (гипотеза “$\\ge\\ell/4$ associated centers за раунд” не следует из §7.2).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (комбинаторный счёт релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить в оригинальном PDF, что “centers” в §7.2 не означает “chosen centers”; если нет, встроить константу $64$ в фактор $M^{s/\\ell}$ и оценить, даёт ли это что‑то лучшее, чем bound через $\\lceil s/\\ell\\rceil$.

### 16.204. Исследовательский шаг (exact citation): “centers” в §7.2 — это exposed centers (подмножество alive centers)

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S38-quote-centers-exposed):`
  В HR’22 “центры” в остановке раунда §7.2 — это именно exposed centers $S(\\lambda^j,\\sigma)$, а exposed centers определены как подмножество alive centers.
- `Exact citation:`
  Определение exposed centers: “1. a subset of the alive centers $S = S(\\tau,\\sigma)$ called the exposed centers” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1841`).
  Остановка раунда: “We continue with the next stage until at least $\\ell/4$ centers have been added in this round to the set of exposed centers $S(\\lambda^j,\\sigma)$ …” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2718–2719`).
- `Toy‑тест:` подстановка определений: слово “centers” в §7.2 прямо отсылает к “set of exposed centers”, без упоминания chosen centers.
- `Статус:` подтверждено (точная цитата).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сравнить верхнюю оценку числа раундов через $\\lceil 64a/\\ell\\rceil$ с фактором $M^{\\lceil s/\\ell\\rceil}$ и показать, что константа 64 не ухудшает итог (Q43.S39-compare-round-bounds).

### 16.205. Исследовательский шаг (proof): 64 поглощается рескейлом $\\ell$ ($\\ell\\ge t$ ⇒ t‑common)

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S39-absorb-64-rescale-ell):`
  В HR’22 Lemma 4.4 параметр $\\ell$ свободен (без условий $\\ell\\le t$ или $\\ell\\le s$), и если входные деревья имеют глубину $\\le t'$,
  то $\\ell$‑common partial decision tree при $\\ell\\ge t'$ автоматически является $t'$‑common.
  Поэтому можно выбрать $\\ell:=64t'$ и получить
  $$M^{\\lceil 64a/\\ell\\rceil}=M^{\\lceil a/t'\\rceil},$$
  а множитель $M^{s/\\ell}$ в Lemma 4.4 только уменьшается.
- `Доказательство:`
  1) Def. 2.10 и Lemma 4.4 не накладывают ограничений на $\\ell$; $\\ell$ входит только как глубина локальных деревьев и в фактор $M^{s/\\ell}$
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:574–582`, `…:1073–1084`).
  2) Пусть все $T_i$ имеют глубину $\\le t'$, а $T$ — $\\ell$‑common partial tree с $\\ell\\ge t'$. Для каждой ветви $\\tau$ ограничение
     $T_i\\!\\upharpoonright\\!\\tau$ — decision tree глубины $\\le t'$ (глубина не возрастает при ограничении), а корректность/локальная согласованность
     обеспечивает факт, что $T$ — $\\ell$‑common. Тогда, выбирая $T^{(i,\\tau)}:=T_i\\!\\upharpoonright\\!\\tau$, получаем $t'$‑common partial tree.
  3) Подстановка $\\ell:=64t'$ преобразует $M^{\\lceil 64a/\\ell\\rceil}$ в $M^{\\lceil a/t'\\rceil}$, а $M^{s/\\ell}\\le M^{s/t'}$,
     поэтому коэффициент 64 поглощается без ухудшения вероятностной оценки.
- `Toy‑тест:` при $s=2$, $M=n^k$, $t'=(2s+1)\\log M$ и $\\ell=64t'$ условия Lemma 4.4
  ($t'\\le s_\\eta\\le n'/32$) остаются прежними, а фактор по $M$ становится $M^{\\lceil a/t'\\rceil}$.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (перемасштабирование параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли связать $a$ с $s$ (например $a\\le s$) или иначе пересчитать corollary с фактором $M^{\\lceil a/t'\\rceil}$ — Q43.S40-bound-a-by-s.

### 16.206. Исследовательский шаг (counterexample): non-chosen associated centers не инъектируются в запросы, $a\\le s$ не следует

- `Линза:` Инвариант.
- `Утверждение (Q43.S40-inject-a-to-queries):`
  Каждый disappearing center, учтённый в $a$, соответствует хотя бы одному запросу на ветви $\\tau$,
  разные центры дают разные запросы, значит $a\\le s$.
- `Контрпример (структурный):`
  В построении HR’22 ветвь $\\tau$ запрашивает **только** переменные, инцидентные chosen центрам:
  $S_J$ определяется как множество chosen центров на расстоянии $\\le 1$ от $\\mathrm{supp}(J)\\cap C_\\sigma$,
  и $T$ расширяется запросами всех переменных, инцидентных $S_J$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1943–1947`);
  Invariant 6.1(5) фиксирует, что запросы появляются только из exposed chosen centers
  (`…:1858–1860`).
  Но на forceable branch $\\psi$ могут стоять переменные с non-chosen associated center:
  Cor. 6.6 прямо различает случаи “associated center chosen/non-chosen”
  (`…:2024–2026`), а Def. 6.2(2) требует закрывать $J$ на таких центрах
  (`…:1886–1888`).
  Такие non-chosen центры входят в $\\mathrm{supp}(J)\\setminus S^*_{j-1}$ и учитываются в $a_j$,
  но не попадают в $S_J$, поэтому **не создают запросов** на $\\tau$.
  Следовательно, инъекция “$a$ → запросы” не работает, и $a\\le s$ не обосновано.
- `Toy‑тест:` пусть $T_i$ имеет 1‑ветвь из одного ребра $x_e$, чья associated center $u$ — non-chosen.
  Выберем $\\sigma$ так, что pairing $\\pi$ фиксирует соответствующий non-chosen path
  (Eq. (11), `…:1456–1467`), тогда $\\psi$ pairwise locally consistent с $\\sigma$.
  По Def. 6.2(2) $J$ закрыт на $u$, значит $a_j=1$, но $\\mathrm{supp}(J)\\cap C_\\sigma=\\varnothing$
  и $S_J=\\varnothing$, т.е. на $\\tau$ не добавляется ни одного запроса.
- `Статус:` контрпример (инъекция ломается на non-chosen центрах).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` разделить $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$ и проверить,
  можно ли bound’ить $a_{\\mathrm{ch}}$ через $s$, а вклад $a_{\\mathrm{nch}}$ переформулировать в параметрах,
  не требующих $a\\le s$ (или перейти к оптимизации суммы по $a$ без этого шага).

### 16.207. Исследовательский шаг (proof): $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$, раунд‑фактор зависит только от $a_{\\mathrm{ch}}$

- `Линза:` Инвариант.
- `Утверждение (Q43.S41-split-a-ch-nch):`
  Пусть $a_{j,\\mathrm{ch}}$ — число **chosen** associated centers среди переменных на $\\psi_j$,
  лежащих в $\\mathrm{supp}(J_j)\\setminus S^*_{j-1}$, и $a_{\\mathrm{ch}}:=\\sum_j a_{j,\\mathrm{ch}}$.
  Тогда $s\\le 64a_{\\mathrm{ch}}$, а значит фактор по раундам можно оценивать как
  $$M^{\\lceil s/\\ell\\rceil}\\le M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}.$$
  Вклад $a_{\\mathrm{nch}}$ кодируется через $\\pi$ и не порождает новых запросов.
- `Доказательство:`
  1) Non‑chosen информация определяется pairing $\\pi$ и не требует запросов в $T$
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1854–1866`), при этом
     $I$ не содержит путей между chosen и non‑chosen центрами
     (`…:1869–1870`). Следовательно, только exposed **chosen** centers создают запросы.
  2) Пусть $S_{\\mathrm{ch}}(\\tau,\\sigma):=S(\\tau,\\sigma)\\cap C_\\sigma$.
     Из §6.4: “only variables incident to exposed chosen centers are queried and each exposed center causes at most 4 queries”
     (`…:2049–2051`), значит существует стадия $g$ с $|S^*_g\\cap C_\\sigma|\\ge s/4$.
  3) В стадии $j$ множество новых chosen центров лежит в $\\mathrm{supp}(J_j)\\cap C_\\sigma$ и $S_J$.
     По аргументу Lemma 6.5 (ограниченному на chosen‑центры) каждый chosen центр в $\\mathrm{supp}(J_j)$
     имеет chosen‑соседа в $\\mathrm{supp}(J_j)$, поэтому
     $$|\\mathrm{supp}(J_j)\\cap C_\\sigma\\cup S_J|\\le 4|\\mathrm{supp}(J_j)\\cap C_\\sigma|.$$
     Кроме того, из минимальности $J_j$ и запрета chosen–non‑chosen путей следует, что каждый chosen центр
     в $\\mathrm{supp}(J_j)$ либо сам является associated center переменной на $\\psi_j$,
     либо соседствует с таким chosen associated center; значит
     $$|\\mathrm{supp}(J_j)\\cap C_\\sigma|\\le 4a_{j,\\mathrm{ch}}.$$
     Следовательно, на стадии $j$ добавляется не более $16a_{j,\\mathrm{ch}}$ chosen‑центров, и
     $|S^*_g\\cap C_\\sigma|\\le 16a_{\\mathrm{ch}}$.
  4) Совмещая с п.2, получаем $s\\le 4|S^*_g\\cap C_\\sigma|\\le 64a_{\\mathrm{ch}}$ и требуемый bound на
     $M^{\\lceil s/\\ell\\rceil}$.
- `Toy‑тест:` $s=1$, $\\psi$ содержит переменную с non‑chosen associated center $u$.
  По Def. 6.2(2) $J$ закрыт на $u$, а Invariant 6.1(4) + ремарка про $\\pi$ дают,
  что нужная информация уже в $\\pi$ и не требует запросов (`…:1854–1866`);
  при $\\mathrm{supp}(J)\\cap C_\\sigma=\\varnothing$ имеем $S_J=\\varnothing$, поэтому
  depth ветви не увеличивается и раунд‑счёт не растёт.
- `Статус:` доказано (для раунд‑фактора; $a\\log t$ в Lemma 6.9 по‑прежнему зависит от $a$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (encoding/center‑счёт), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оптимизировать суммирование по $a$ без предположения $a\\le s$ (Q43.S42-optimise-a-sum).

### 16.208. Исследовательский шаг (proof): $\\log t$ в Lemma 6.9 нужен только для chosen associated centers

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S42-encode-nch-no-logt):`
  В доказательстве Lemma 6.9 log t-биты используются только для **chosen** associated centers,
  тогда как non-chosen associated centers восстанавливаются из pairing $\\pi$ с постоянным числом бит
  на структуру компоненты и $O(\\log \\Delta)$ на идентификацию узлов.
  Следовательно, в оценке кодирования можно заменить $t^{a}$ на $t^{a_{\\mathrm{ch}}}$, а вклад
  $a_{\\mathrm{nch}}$ переносится в $\\Delta$-часть.
- `Доказательство:`
  В реконструкции $J_j$ из подписей: для каждого associated center $u$,
  который **chosen**, читаются (до 3) инцидентные центры, и если такой центр уже определен,
  он выбирается по "first bit in the signature is 1" с ценой $\\log t$ (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2468-2475`).
  После этого "structure of $J_j$ on the chosen centers" фиксирована (`…:2474-2476`).
  Для non-chosen центров затем "complete some connected components from the pairing $\\pi$",
  структура компоненты кодируется константным числом бит, и каждый узел восстанавливается
  с ценой не более $\\log \\Delta$ (`…:2476-2480`).
  Значит, log t участвует только при идентификации chosen центров, тогда как non-chosen
  оплачиваются лишь $\\log \\Delta$.
- `Toy‑тест:` один раунд, одна переменная на $\\psi_j$ с non-chosen associated center.
  По тексту реконструкции $J_j$ для non-chosen используется только pairing $\\pi$ и
  $\\log \\Delta$ на узлы, без упоминания $\\log t$ (`…:2476-2480`).
- `Статус:` доказано (точная цитата в доказательстве Lemma 6.9).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (encoding), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` переписать сумму по $a_{\\mathrm{ch}},a_{\\mathrm{nch}}$ в Eq. (18) и проверить геометрию (Q43.S42-sum-split-geometric).

### 16.209. Исследовательский шаг (proof): геометрия суммы после разбиения $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S43-sum-split-geometric):`
  В Eq. (18) HR’22 (сумма $\\sum_a A_2^s(4t\\log n'/\\Delta)^a$) после замены $t^a\\rightsquigarrow t^{a_{\\mathrm{ch}}}$
  и разбиения $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$ получается факторизация в два геометрических ряда.
  При $\\ell\\ge 64t'$ раунд‑фактор удовлетворяет $M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}\\le M^{a_{\\mathrm{ch}}/t'}$,
  поэтому
  $$
  \\sum_{a_{\\mathrm{ch}},a_{\\mathrm{nch}}\\ge 0}
  A_2^s\\Bigl(\\frac{4t'\\log n'}{\\Delta}\\Bigr)^{a_{\\mathrm{ch}}}
  \\Bigl(\\frac{4\\log n'}{\\Delta}\\Bigr)^{a_{\\mathrm{nch}}}
  M^{a_{\\mathrm{ch}}/t'}
  =
  A_2^s\\Bigl(\\sum_{a_{\\mathrm{ch}}\\ge 0} r_{\\mathrm{ch}}^{a_{\\mathrm{ch}}}\\Bigr)
  \\Bigl(\\sum_{a_{\\mathrm{nch}}\\ge 0} r_{\\mathrm{nch}}^{a_{\\mathrm{nch}}}\\Bigr),
  $$
  где $r_{\\mathrm{ch}}:=(4t'\\log n'/\\Delta)\\cdot M^{1/t'}$ и $r_{\\mathrm{nch}}:=4\\log n'/\\Delta$.
  В режиме HR (выбор $n_\\eta$ даёт $t'\\log n'/\\Delta\\le c<1$) оба отношения $<1$, значит сумма ограничена константой.
- `Доказательство:`
  Из Eq. (18) HR’22 имеем сумму $\\sum_a A_2^s(4t\\log n'/\\Delta)^a$ (см. PDF, Eq. (18)). По §16.208
  можно заменить $t^a$ на $t^{a_{\\mathrm{ch}}}$, то есть
  $$(4t\\log n'/\\Delta)^a=(4t\\log n'/\\Delta)^{a_{\\mathrm{ch}}}(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}.$$
  После переноса на $t'= (2s+1)\\log M$ и учёта раунд‑множителя (из §16.207) получаем указанную двойную сумму.
  При $\\ell\\ge 64t'$ имеем $M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}\\le M^{a_{\\mathrm{ch}}/t'}$, поэтому
  ряд по $a_{\\mathrm{ch}}$ имеет отношение $r_{\\mathrm{ch}}$, а по $a_{\\mathrm{nch}}$ — $r_{\\mathrm{nch}}$.
  В HR‑параметрах $\\Delta=\\Theta(n/n')$ и рекурсия $n_\\eta$ обеспечивает $t'\\log n'/\\Delta<1$,
  значит оба ряда геометрические и сходятся к константе.
- `Toy‑тест:` $s=2$, $\\ell=5$, $t'=5$; возьмём $n'=2$ (так что $\\log n'=1$), $M=2$ (тогда $t'=(2s+1)\\log M=5$)
  и $\\Delta=32$.
  Тогда $r_{\\mathrm{ch}}=(4\\cdot5/32)\\cdot 2^{1/5}\\approx 0.72$ и $r_{\\mathrm{nch}}=4/32=0.125$.
  Сумма начинается как $1+r_{\\mathrm{ch}}+r_{\\mathrm{nch}}+\\cdots$ и равна
  $1/\\bigl((1-r_{\\mathrm{ch}})(1-r_{\\mathrm{nch}})\\bigr)=O(1)$.
- `Статус:` доказано (факторизация и геометричность после разбиения $a$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка вероятности/счёт), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оценить связь $a_{\\mathrm{nch}}$ с $a_{\\mathrm{ch}}$ или $s$ (например через pairing $\\pi$),
  чтобы убрать зависимость от $a_{\\mathrm{nch}}$ в основной сумме (Q43.S44-bound-anonch).

### 16.210. Исследовательский шаг (proof): Eq. (18) после $t^a\\to t^{a_{\\mathrm{ch}}}$ не содержит $a_{\\mathrm{nch}}$ вне $\\Delta$‑части

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S45-audit-eq18-anonch-free):`
  После замены $t^a\\rightsquigarrow t^{a_{\\mathrm{ch}}}$ и при $\\ell\\ge 64t'$ вся зависимость от
  $a_{\\mathrm{nch}}$ в сумме Eq. (18) HR’22 остаётся только в множителе
  $(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$; ни $A_2^s$, ни раунд‑фактор
  $M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}$ от $a_{\\mathrm{nch}}$ не зависят.
  Следовательно, суммирование по $a_{\\mathrm{nch}}$ — чисто геометрическое и не требует
  доп. оценки $a_{\\mathrm{nch}}$ через $a_{\\mathrm{ch}}$ или $s$.
- `Доказательство:`
  В HR Eq. (18) стоит сумма вида $\\sum_a A_2^s(4t\\log n'/\\Delta)^a$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2125-2134`).
  По §16.208 можно заменить $t^a$ на $t^{a_{\\mathrm{ch}}}$ и разложить
  $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$, откуда
  $(4t\\log n'/\\Delta)^a=(4t'\\log n'/\\Delta)^{a_{\\mathrm{ch}}}(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$.
  Раунд‑множитель в flat local‑EF(s) зависит только от chosen‑центров
  ($M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}$ из §16.207), поскольку non‑chosen centers
  не создают запросов. Поскольку $A_2^s$ зависит только от $s$, единственный источник
  зависимости от $a_{\\mathrm{nch}}$ — это $(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$,
  а значит суммирование по $a_{\\mathrm{nch}}$ геометрично.
- `Toy‑тест:` возьмём $a_{\\mathrm{ch}}=0$. Тогда вклад равен
  $A_2^s(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$, без $t'$ и без $M$,
  что подтверждает отсутствие скрытых зависимостей.
- `Статус:` доказано (audit Eq. (18): $a_{\\mathrm{nch}}$ только в $\\Delta$‑части).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, что в HR‑параметрах гарантированно $4\\log n'/\\Delta<1$
  (после подстановки $\\Delta=\\Theta(n/n')$) и зафиксировать это в основном bound (Q43.S46-check-rnch-params).

### 16.211. Исследовательский шаг (proof): $r_{\\mathrm{nch}}<1$ из HR‑оценок на $\\Delta$

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S48-delta-constant-bridge):`
  В HR‑параметрах при условии $n\\ge 20 C n'\\log n'$ имеем $\\Delta\\ge 2C\\log n'$,
  а также $\\Delta\\ge n/(6n')$. Тогда
  $$
  r_{\\mathrm{nch}}=\\frac{4\\log n'}{\\Delta}\\le \\frac{2}{C}<1 \\quad (C\\ge 3),
  $$
  так что сумма по $a_{\\mathrm{nch}}$ в §16.210 ограничена константой.
- `Доказательство:`
  В HR после (14) явно сказано: из предположения $n\\ge 20 n' C\\log n'$ следует
  $\\Delta\\ge 2C\\log n'$, и далее «claimed bound follows from the fact $\\Delta\\ge n/6 n'$»
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1567-1568`).
  По §16.209–§16.210 $r_{\\mathrm{nch}}=4\\log n'/\\Delta$, поэтому
  $r_{\\mathrm{nch}}\\le 4\\log n'/(2C\\log n')=2/C<1$ для $C\\ge 3$.
- `Toy‑тест:` минимальный случай $n=20 C n'\\log n'$ даёт $\\Delta\\ge 2C\\log n'$ и
  $r_{\\mathrm{nch}}\\le 2/C$; при $C=4$ получаем $r_{\\mathrm{nch}}\\le 1/2$.
- `Статус:` доказано (константное $r_{\\mathrm{nch}}$ из HR‑оценок на $\\Delta$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` подставить $r_{\\mathrm{nch}}<1$ в итоговый bound Eq. (18)
  и зафиксировать константу в основном резюме Q43 (Q43.S49-finalize-geo-constant).

### 16.212. Исследовательский шаг (proof): $r_{\\mathrm{ch}}<1$ из HR‑параметров

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S50-bound-rch-constant):`
  В режиме HR при $t':=(2s+1)\\log M$ и $s\\ge 1$ имеем
  $$r_{\\mathrm{ch}}=\\Bigl(\\frac{4t'\\log n'}{\\Delta}\\Bigr)\\cdot M^{1/t'}\\le \\kappa<1$$
  для всех достаточно больших $n$. Более точно, из условий
  $n/n'\\ge A t'\\log^4 n$ (Lemma 4.2) и $\\Delta\\ge n/(6n')$ следует
  $$r_{\\mathrm{ch}}\\le \\frac{24e^{1/2}}{A\\,\\log^3 n},$$
  так что при $\\log^3 n\\ge 48e^{1/2}/A$ можно взять $\\kappa=1/2$.
- `Доказательство:`
  Из $t'=(2s+1)\\log M$ получаем
  $$M^{1/t'}=\\exp\\!\\left(\\frac{1}{2s+1}\\right)\\le e^{1/2}$$
  при $s\\ge 1$. По HR Lemma 4.2 выполняется $n/n'\\ge A t'\\log^4 n$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:950-952`),
  а после (14) имеем $\\Delta\\ge n/(6n')$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1567-1568`).
  Тогда
  $$r_{\\mathrm{ch}}\\le \\frac{4t'\\log n'}{\\Delta}\\,e^{1/2}
  \\le \\frac{24t'\\log n'}{n/n'}\\,e^{1/2}
  \\le \\frac{24e^{1/2}}{A}\\cdot\\frac{\\log n'}{\\log^4 n}.$$
  Используя $\\log n'\\le\\log n$, получаем указанную оценку
  $r_{\\mathrm{ch}}\\le 24e^{1/2}/(A\\log^3 n)$ и, следовательно, $r_{\\mathrm{ch}}<1$
  при $n\\ge n_0(A)$.
- `Toy‑тест:` $s=2$, $M=2$ дают $t'=5$ и $M^{1/t'}=2^{1/5}\\approx 1.15$.
  Если $A=1$ и $\\log n=32$, то
  $$r_{\\mathrm{ch}}\\le \\frac{24e^{1/2}}{32^3}\\approx 1.2\\cdot 10^{-3}<1.$$
- `Статус:` доказано (явная константа для $r_{\\mathrm{ch}}$ при HR‑параметрах).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` подставить $r_{\\mathrm{ch}}<1$ и $r_{\\mathrm{nch}}<1$ в Eq. (18)
  и зафиксировать константу в основном резюме Q43 (Q43.S49-finalize-geo-constant).

### 16.213. Исследовательский шаг (proof): явная константа из геометрической суммы

- `Линза:` Инвариант.
- `Утверждение (Q43.S51-geo-constant-explicit):`
  Из факторизации §16.209 имеем
  $$
  \\sum_{a_{\\mathrm{ch}},a_{\\mathrm{nch}}\\ge 0}
  A_2^s\\,r_{\\mathrm{ch}}^{a_{\\mathrm{ch}}}\\,r_{\\mathrm{nch}}^{a_{\\mathrm{nch}}}
  =\\frac{A_2^s}{(1-r_{\\mathrm{ch}})(1-r_{\\mathrm{nch}})}.
  $$
  При условиях HR (C\\ge 3 и $n\\ge n_0(A)$) можно взять
  $r_{\\mathrm{ch}}\\le 1/2$ (§16.212) и $r_{\\mathrm{nch}}\\le 2/3$ (§16.211), поэтому
  сумма в Eq. (18) ограничена $6\\,A_2^s$.
- `Доказательство:`
  Геометрическая сумма по $a_{\\mathrm{ch}}$ равна $1/(1-r_{\\mathrm{ch}})$,
  по $a_{\\mathrm{nch}}$ — $1/(1-r_{\\mathrm{nch}})$ (§16.209). В §16.212 получено
  $r_{\\mathrm{ch}}\\le 24e^{1/2}/(A\\log^3 n)$, так что при $\\log^3 n\\ge 48e^{1/2}/A$
  можно взять $r_{\\mathrm{ch}}\\le 1/2$. В §16.211 имеем $r_{\\mathrm{nch}}\\le 2/C$,
  и при $C\\ge 3$ получаем $r_{\\mathrm{nch}}\\le 2/3$. Тогда
  $1/((1-r_{\\mathrm{ch}})(1-r_{\\mathrm{nch}}))\\le 1/((1-1/2)(1-2/3))=6$.
- `Toy‑тест:` подставляя $r_{\\mathrm{ch}}=1/2$, $r_{\\mathrm{nch}}=2/3$ получаем множитель 6.
  Для чисел из §16.209 ($s=2$, $M=2$, $\\Delta=32$) имеем
  $r_{\\mathrm{ch}}\\approx 0.72$, $r_{\\mathrm{nch}}=0.125$ и итоговый множитель
  $1/((1-0.72)(1-0.125))\\approx 4.1\\le 6$.
- `Статус:` доказано (явная константа в сумме Eq. (18)).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (суммирование), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` вывести явное $n_0(A)$ для условия $r_{\\mathrm{ch}}\\le 1/2$
  и сопоставить с требованием $n\\ge 20Cn'\\log n'$ (Q43.S52-explicit-n0).

### 16.214. Исследовательский шаг (proof): явный $n_0(A)$ для $r_{\\mathrm{ch}}\\le 1/2$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S52-explicit-n0-closedform):`
  Пусть $A>0$ из условий HR Lemma 4.2 и выполнена оценка
  $$r_{\\mathrm{ch}}\\le \\frac{24e^{1/2}}{A\\log^3 n}$$
  (§16.212). Тогда
  $$n_0(A):=\\left\\lceil \\exp\\!\\left(\\left(\\frac{48e^{1/2}}{A}\\right)^{1/3}\\right)\\right\\rceil$$
  гарантирует $r_{\\mathrm{ch}}\\le 1/2$ для всех $n\\ge n_0(A)$.
- `Доказательство:`
  Из $r_{\\mathrm{ch}}\\le 24e^{1/2}/(A\\log^3 n)$ следует, что $r_{\\mathrm{ch}}\\le 1/2$
  достаточно при $\\log^3 n\\ge 48e^{1/2}/A$, т.е.
  $$\\log n\\ge \\left(\\frac{48e^{1/2}}{A}\\right)^{1/3}.$$
  Экспоненцируя, получаем $n\\ge \\exp\\!\\left((48e^{1/2}/A)^{1/3}\\right)$; для целых $n$
  это эквивалентно $n\\ge n_0(A)$.
- `Toy‑тест:` при $A=1$ имеем $n_0=\\lceil e^{(48e^{1/2})^{1/3}}\\rceil=74$ и
  $r_{\\mathrm{ch}}\\le 24e^{1/2}/\\log^3 74\\approx 0.496<1/2$.
  При $A=10$ получаем $n_0=8$ и $r_{\\mathrm{ch}}\\le 0.440<1/2$.
- `Статус:` доказано (явная замкнутая формула $n_0(A)$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сравнить условие $n\\ge 20Cn'\\log n'$ с $n\\ge n_0(A)$
  (Q43.S53-compare-20cnlogn).

### 16.215. Исследовательский шаг (exact citation): константа $A$ в Lemma 6.9/4.2 не раскрыта численно

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S53-extract-a-bound):`
  В HR'22 константа $A$ в Lemma 6.9/4.2 вводится как "some constant" без численного значения;
  в доказательстве появляются дополнительные константы $A_1,A_2,A_3,A_4$ также без оценок.
  Поэтому явный нижний bound $A_{\\min}$ нельзя извлечь из текста без подробного подсчёта битов
  в алгоритмах восстановления (§6.5/Appendix B), и сравнение $n\\ge 20Cn'\\log n'$ с $n\\ge n_0(A)$
  требует отдельного вычисления констант.
- `Доказательство (exact citation):`
  В `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt` Lemma 6.9 формулируется
  как "There is a constant A > 0 ... a log t + b log \\Delta + s * A many bits suffice to encode ρ"
  (строки 2096-2101). В конце доказательства перечисляются дополнительные "some constant"
  величины: "A1 |S*_g| ... for some constant A1", "another A2 |S*_g| ... for some constant A2",
  "There is a constant A3 > 0 ...", "some other constant A4" (строки 2551-2562). Численных
  оценок для этих констант не приводится.
- `Toy-тест:` из $t\\le s$ следует $s+16t+s/4\\le (69/4)s$, так что можно взять
  $A_3,A_4\\le 69/4$, но $A_1,A_2$ остаются неявными, и потому $A_{\\min}$ не фиксируется.
- `Статус:` частично (константа $A$ существует, но неявная).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка констант), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` пройти Appendix B / Algorithms 2–7 и выписать явный верхний bound
  на $A_1,A_2$ (сколько бит на центр/ребро), затем получить явный $A$ и сравнить $n_0(A)$
  с $20Cn'\\log n'$ (Q43.S54-bound-a1a2-bits).

### 16.216. Исследовательский шаг (toy computation): toy‑bound для $A_1$ из Algorithms 2–4

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S54-bound-a1-from-alg2-4):`
  В toy‑случае $|S^{*}_g|=1$, $s=2$, $\\ell=5$ (одна стадия) псевдокод Algorithms 2–4
  читает не более 18 константных бит из $X$ сверх терминов $a\\log t$, $b\\log\\Delta$
  и $9|S^{*}_g|$. Следовательно, для этого случая можно взять $A_1\\le 18$.
- `Toy‑тест:` при $|S^{*}_g|=1$ имеем $g=1$ (так как $|S^{*}_g|\\ge s/4$). В Algorithm 2
  внутренний цикл читает ровно один бит `discover=1` для единственного ассоц. центра
  и один бит `discover=0` для завершения стадии (2 бита;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3119-3127`).
  Рассматривая худший по константным битам вариант (центр выбранный),
  Algorithm 3 вызывает `GetPossiblyDeadCenter` не более 4 раз по направлениям
  подписи (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3166-3173`),
  давая 4 бита `known` (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3304`).
  Далее `RecoverExposed` даёт ещё ≤4 вызова (4 бита `known`;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3259-3264`)
  и `RecoverNonExposed` даёт ≤4 бита `recover` плюс ≤4 бита `known`
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3283-3286,3304`).
  Итого $2+4+4+8=18$ константных бит. В альтернативе (центр не выбранный)
  читаются $\\log 20\\le 5$ бит `cc` и ≤8 бит `known`
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3182-3193,3304`),
  что даёт ≤15, поэтому 18 остаётся верхней оценкой.
- `Статус:` частично (toy‑случай; общий bound на $A_1$ ещё не выведен).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (подсчёт констант), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обобщить подсчёт константных бит на произвольный $|S^{*}_g|$
  и выписать явный $A_1$ (с отделением вкладов $\\log t$, $\\log\\Delta$ и 9‑битных подписей).

### 16.217. Исследовательский шаг (toy computation): $|S^{*}_g|=2$ (один chosen + один non‑chosen)

- `Линза:` Инвариант.
- `Утверждение (Q43.S55-count-a1-per-center):`
  В toy‑сценарии $|S^{*}_g|=2$ с одним chosen и одним non‑chosen центром при $s=2$, $\\ell=5$
  Algorithms 2–4 читают не более 32 константных бит сверх $a\\log t$, $b\\log\\Delta$
  и $9|S^{*}_g|$. Следовательно, линейный bound $A_1|S^{*}_g|$ выполняется уже с $A_1=18$.
- `Toy‑тест:` здесь $g=1$ (так как $|S^{*}_g|\\ge s/4$). Пусть оба центра обнаружены как ассоц.
  центры на ветви $\\psi$ (худший случай для константных битов). Тогда Algorithm 2 читает
  два бита `discover=1` и один бит `discover=0` (итого 3 бита;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3119-3127`).
  В Algorithm 3 для chosen‑центра возможно до 4 вызовов `GetPossiblyDeadCenter`, каждый даёт
  один бит `known` (4 бита; `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3166-3173,3304`).
  Для non‑chosen‑центра: в первом цикле ≤4 бита `known` (те же строки), затем читается
  $\\log 20\\le 5$ бит `cc` и ещё ≤4 бита `known` для восстановления компонент (всего 13 бит;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3182-3193,3304`).
  Далее `RecoverExposed` для единственного chosen‑центра даёт ≤4 бита `known`, а
  `RecoverNonExposed` даёт ≤4 бита `recover` и ≤4 бита `known`
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3259-3264,3283-3286,3304`).
  Суммарно $3+4+13+12=32$ константных бита; так как $32\\le 18\\cdot 2$, линейность по
  $|S^{*}_g|$ сохраняется на этом toy‑уровне.
- `Статус:` доказано (toy‑случай; линейное масштабирование подтверждено).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (подсчёт констант), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` перейти к общему $|S^{*}_g|$: вывести per‑center bound, аккуратно учесть
  единственный `discover=0` на стадию и получить явный $A_1$.

### 16.218. Исследовательский шаг (toy scan): локальный arXiv‑срез не даёт прямой ссылки на “common partial decision tree” / “multi‑switching”

- `Линза:` Эксперимент.
- `Утверждение (Q43.S56a-arxiv-scan):`
  В локальном arXiv‑срезе `resources/arxiv/pvnp_slice.tsv` нет прямых совпадений по фразам
  “common partial decision tree” или “multi‑switching”; совпадения по “Tseitin” указывают на HR’22,
  а по “switching lemma” — лишь на общий обзор/проект. Готовой ссылки на “a‑sum trick” в метаданных
  не видно.
- `Toy‑тест:`
  1) `rg -ni "common partial decision tree|multi-switching" resources/arxiv/pvnp_slice.tsv` → нет совпадений.
  2) `rg -ni "tseitin" resources/arxiv/pvnp_slice.tsv | head -20` → есть HR’22 (`…:13`).
  3) `rg -ni "switching lemma" resources/arxiv/pvnp_slice.tsv | head -20` → есть общий обзор (`…:149`).
- `Статус:` прямых ссылок не найдено (локальный срез).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` продолжить Q43.S56-generalize-a1-per-center.

### 16.219. Исследовательский шаг (toy computation): $|S^{*}_g|=3$ (две chosen + одна non‑chosen)

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S56-generalize-a1-per-center):`
  В toy‑сценарии $|S^{*}_g|=3$ (две chosen + одна non‑chosen) при $s=2$, $\\ell=5$
  Algorithms 2–4 читают не более 49 константных бит сверх $a\\log t$, $b\\log\\Delta$
  и $9|S^{*}_g|$. Следовательно, $49\\le 18\\cdot |S^{*}_g|$ и линейность по
  $|S^{*}_g|$ сохраняется на этом toy‑уровне.
- `Toy‑тест:` здесь $g=1$ (так как $|S^{*}_g|\\ge s/4$). Предположим, что все три
  центра обнаружены как ассоц. центры на ветви $\\psi$ (хуже по константным битам).
  Algorithm 2 читает три бита `discover=1` и один бит `discover=0` (4 бита;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3119-3127`).
  В Algorithm 3 первый цикл даёт до 4 вызовов `GetPossiblyDeadCenter` на центр, т.е.
  12 бит `known` (`…:3166-3173,3304`). Для non‑chosen‑центра дополнительно читаются
  $\\log 20\\le 5$ бит `cc` и ещё ≤4 бита `known` при восстановлении компонент
  (`…:3182-3193,3304`), итого 21 бит в Algorithm 3. Далее `RecoverExposed` даёт
  ≤4 бита `known` на chosen‑центр (8 бит; `…:3259-3264,3304`), а `RecoverNonExposed`
  даёт ≤4 бита `recover` и ≤4 бита `known` на chosen‑центр (16 бит; `…:3283-3286,3304`).
  Суммарно $4+21+24=49$ константных бит, что ≤ $18\\cdot 3=54$.
- `Статус:` частично (toy‑случай; общий $A_1$ ещё не выведен).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (подсчёт констант), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться вывести общий per‑center инвариант
  “каждый associated‑center обнаруживается максимум один раз” и тем самым получить
  глобальный $A_1$ (Q43.S57-invariant-one-discovery).

### 16.220. Исследовательский шаг (proof): one‑discovery для associated centers

- `Линза:` Инвариант.
- `Утверждение (Q43.S57-one-discovery-proof):`
  Если associated center $u$ переменной на forceable branch $\\psi_j$ не лежит в $S^{*}_{j-1}$,
  то $u$ становится disappearing center ровно в этой стадии; следовательно, в Algorithm 2 бит
  `discover=1` читается не более одного раза на центр, и число таких битов $\\le |\\mathrm{supp}(K^{*})|\\le |S^{*}_g|$.
- `Доказательство:`
  1) По Def. 6.2(2), если associated center $u$ переменной на $\\psi_j$ не в $S^{*}_{j-1}$, то $J_j$ закрыт в $u$
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1886-1888`), и такие $u$ — disappearing centers
     (`…:2255-2257`). Поэтому $u\\in\\mathrm{supp}(J_j)=\\mathrm{supp}(K_j)$.
  2) По Lemma 6.7 supports $J_j$ и $J_{j'}$ дискретны при $j\\ne j'$ (`…:2028-2041`), значит любой disappearing center
     принадлежит единственной стадии.
  3) Обновление $S(\\tau',\\sigma)=S(\\tau,\\sigma)\\cup S_J\\cup\\mathrm{supp}(J)$ (`…:1949-1952`)
     и Invariant 6.1(1) (“S только растёт”, `…:1838-1842`) дают: после стадии $j$ тот же $u$ уже в $S^{*}_{j}$,
     поэтому в последующих стадиях он не может снова входить в $\\mathrm{supp}(J_{j'})\\setminus S^{*}_{j'-1}$.
  4) В Algorithm 2 бит `discover=1` читается лишь для disappearing center, который является associated center
     переменной на $\\psi$ (`…:3119-3124`), значит каждое такое $u$ даёт ≤1 чтение. Так как
     $\\bigcup_{j\\le g}\\mathrm{supp}(J_j)\\subseteq S^{*}_g$, число этих битов $\\le |S^{*}_g|$.
- `Toy‑тест:` двухстадийный сценарий: пусть один и тот же центр $u$ пытается быть associated center на $\\psi_j$
  и $\\psi_{j+1}$ при $u\\notin S^{*}_{j-1}$. Тогда $u\\in\\mathrm{supp}(J_j)$ по Def. 6.2(2), но Lemma 6.7
  запрещает $u\\in\\mathrm{supp}(J_{j+1})$ — противоречие. Если же $u\\in S^{*}_j$, то он не участвует в $a_{j+1}$
  и не требует `discover=1`.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` использовать one‑discovery для полного per‑center подсчёта константных бит в Algorithms 2–4
  и вывести явный $A_1$ (Q43.S58-bound-a1-constant).

### 16.221. Исследовательский шаг (proof): Algorithm 3 даёт ≤13 константных бит на центр

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S59-alg3-per-center-constant):`
  В Algorithm 3 (RecoverForcingInformation) суммарное число константных битов (known/recover/cc)
  из $X$, прочитанных на стадиях $j\\le g$, не превышает $13\\,|S^{*}_g|$. Эквивалентно, каждому
  центру из $S^{*}_g$ можно приписать ≤13 таких битов.
- `Доказательство:`
  1) В первом цикле Algorithm 3 каждый associated center $v\\in E_{\\psi}$ вызывает `GetPossiblyDeadCenter`
     не более 4 раз (по направлениям), и каждый вызов читает ровно один бит `known`
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3161-3173,3304`).
     Для non‑chosen‑центра второй цикл добавляет $\\log 20\\le 5$ бит `cc` и ещё ≤4 бита `known`
     при восстановлении компонент (`…:3177-3193,3304`), итого ≤13 константных бит.
  2) Для chosen‑центров из $\\mathrm{supp}(J)$ Lemma 6.5 даёт наличие соседнего chosen‑центра в
     $\\mathrm{supp}(J)$ (`…:2013-2017`), поэтому в `RecoverExposed` среди 4 направлений хотя бы одно
     уже содержит chosen‑центр, и `GetPossiblyDeadCenter` вызывается ≤3 раз (≤3 бита `known`;
     `…:3259-3264,3304`).
  3) Каждый chosen‑центр $u\\in S$ имеет соседний chosen‑центр в $S$: если $u\\in\\mathrm{supp}(J)$ —
     по Lemma 6.5, иначе $u$ добавлен `RecoverExposed` из под‑квадрата, смежного с таким
     центром. Тогда в `RecoverNonExposed` условие “нет chosen‑центра” может выполняться
     не более чем в 3 направлениях, давая ≤3 бита `recover` и ≤3 бита `known`
     (`…:3279-3286,3304`).
  4) Следовательно, каждый chosen associated center даёт ≤$4+3+6=13$ константных бит,
     а любые другие chosen‑центры, найденные через `RecoverExposed`, дают ≤$1+6\\le 7$.
     По Lemma 6.7 supports $J_j$ дискретны (`…:2028-2036`), а $S$ монотонен
     (Invariant 6.1(1) и обновление $S(\\tau',\\sigma)$; `…:1842-1844,1949-1952`),
     поэтому каждый центр из $S^{*}_g$ обрабатывается максимум один раз. Итог:
     ≤$13\\,|S^{*}_g|$ константных бит.
- `Toy‑тест:` для toy‑случая $|S^{*}_g|=3$ оценки из §16.219 можно усилить:
  заменяя “4 направления” на “≤3” в `RecoverExposed/RecoverNonExposed`, получаем
  $21+6+12=39\\le 13|S^{*}_g|$.
- `Статус:` доказано (линейный per‑center bound для Algorithm 3).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (учёт битов), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` закрыть вклад Algorithm 2 (`discover=0` на стадию) и собрать явный $A_1$
  вместе с Algorithm 4 (Q43.S58-alg2-discover-budget).

### 16.222. Исследовательский шаг (proof): `discover=0` ограничен числом центров

- `Линза:` Инвариант.
- `Утверждение (Q43.S60-bound-g-by-centers):`
  В Algorithm 2 число битов `discover=0` равно числу стадий $g$, и $g\\le |S^{*}_g|$.
  Следовательно, вклад `discover=0` в $A_1$ не превосходит $|S^{*}_g|$.
- `Доказательство:`
  1) В Algorithm 2 шаг 3 читает бит $b$; если $b=1$, процедура остаётся в той же стадии
     и возвращается к шагу 3, а если $b=0$, то выполняется шаг 5 и стадия $j$ завершается
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2381-2388`).
     Значит, на каждую стадию приходится ровно один бит `discover=0`, и их число равно $g$.
  2) $g$ — первая стадия, где $|S^{*}_g|\\ge s/4$ (`…:2043-2051`), и в тексте явно сказано,
     что «в каждой стадии добавляется хотя бы один центр в $S$», откуда $g\\le s/4$
     (`…:2052-2054`). Следовательно, $g\\le s/4\\le |S^{*}_g|$.
  3) Комбинируя (1)–(2), получаем требуемую оценку вклада `discover=0`.
- `Toy‑тест:` при $|S^{*}_g|=1$ неизбежно $g=1$ (так как $|S^{*}_g|\\ge s/4$),
  и Algorithm 2 действительно читает ровно один бит `discover=0` на единственной стадии.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оценить константные биты в Algorithm 4 и собрать явный $A_1$
  (Q43.S61-alg4-constant).

### 16.223. Исследовательский шаг (proof): Algorithm 4 не читает X ⇒ вклад 0

- `Линза:` Инвариант.
- `Утверждение (Q43.S61-alg4-constant):`
  В Algorithm 4 (RecoverK) не читаются биты из $X$; множество $K$ вычисляется
  детерминированно из $J$ и $I^{*}_{-}$. Следовательно, вклад Algorithm 4 в число
  константных битов равен $0$ (и, в частности, $\\le C\\,|S^{*}_g|$ при $C=1$).
- `Доказательство:`
  1) Псевдокод Algorithm 4 принимает только $I^{*}_{-}$ и $J$ и не содержит обращений
     к `next bit from X`; операции — это обход $u\\in\\mathrm{supp}(J)$ и добавление
     не‑ребра $(u,\\delta,\\bot)$ в $K$
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3230-3238`).
  2) Направление $\\delta$ определяется из уже восстановленных $J$ и $I^{*}_{-}$
     как направление без информации в $J\\cup I^{*}_{-}$; это вычисление не требует
     чтения дополнительных битов.
  3) Поэтому суммарный вклад Algorithm 4 в константные биты равен $0$.
- `Toy‑тест:` при $s=2$, $\\ell=5$ и $|S^{*}_g|\\in\\{1,2\\}$ Algorithm 4 не читает $X$,
  поэтому toy‑подсчёты из §16.216–§16.217 не меняются.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (учёт битов), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` собрать явный $A_1$ как сумму вкладов Algorithms 2–4 и зафиксировать
  итоговую константу (Q43.S62-assemble-a1).

### 16.224. Исследовательский шаг (proof): явный $A_1$ из суммы вкладов Algorithms 2–4

- `Линза:` Инвариант.
- `Утверждение (Q43.S62-assemble-a1-sum):`
  Суммарное число константных битов, читаемых в Algorithms 2–4, плюс чтение подписей
  (не более $9|S^{*}_g|$) ограничено величиной $24|S^{*}_g|$. Эквивалентно, можно взять
  явную константу $A_1^{\\mathrm{tot}}=24$ для всего “constant‑part” термина в Lemma 6.9.
  Если держать подписи отдельно, то $A_1\\le 15$.
- `Доказательство:`
  1) По §16.220 биты `discover=1` читаются не более одного раза на центр, т.е.
     не более $|S^{*}_g|$ бит.
  2) По §16.222 биты `discover=0` равны числу стадий и не превосходят $|S^{*}_g|$.
  3) По §16.221 Algorithm 3 даёт ≤ $13|S^{*}_g|$ константных бит (known/recover/cc).
  4) По §16.223 Algorithm 4 не читает $X$, вклад равен 0.
  5) Чтение подписей даёт ещё ≤ $9|S^{*}_g|$ бит
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2549`).
  Складывая, получаем $9+1+1+13=24$ бит на центр; при раздельном учёте подписи
  остаётся $A_1\\le 15$.
- `Toy‑тест:` при $|S^{*}_g|=4$ (2 chosen + 2 non‑chosen) суммарный worst‑case равен
  $4+4+13\\cdot 4+9\\cdot 4=96=24\\cdot 4$, что согласуется с bound $A_1^{\\mathrm{tot}}|S^{*}_g|$.
- `Статус:` доказано (явная константа $A_1$ получена суммированием вкладов).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (учёт битов), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оценить явный $A_2$ для структуры $J_j$ и $I^{*}_{-}$, чтобы получить
  полностью численные константы Lemma 6.9 (Q43.S63-bound-a2-graph-structure).

### 16.225. Исследовательский шаг (proof): явный $A_2$ для структуры $J_j$ и $I^{*}_{-}$

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S63-bound-a2-graph-structure):`
  Для каждого центра есть ровно 4 направления (left/right/up/down), поэтому структура
  information set (в частности, $J_j$ или $I_j$) кодируется ≤2 битами на направление
  (нет информации / non-edge / edge), то есть ≤8 бит на центр. Следовательно, для совокупной
  структуры $J_j$ и $I^{*}_{-}$ можно взять явную константу $A_2\\le 16$.
- `Доказательство:`
  1) По Def. 5.6 information piece — либо edge $\\{v,w\\}$ между соседними центрами, либо
     non-edge $(v,\\delta,\\bot)$ с $\\delta\\in\\{\\text{left},\\text{right},\\text{up},\\text{down}\\}$,
     т.е. ровно 4 направления на центр
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1586-1590`).
  2) В тексте HR структура $J_j$ восстанавливается за «constant number of bits per potential edge»
     (`…:2259-2261`), а для $I_j$ требуется тот же тип константы
     (`…:2536-2539`); итоговый вклад суммируется в $A_2|S^{*}_g|$ (`…:2555`).
  3) При известном support центров (log $\\Delta$ биты учтены отдельно) для каждого направления
     остаётся тройственный выбор: нет информации / non-edge / edge. Это кодируется 2 битами,
     значит ≤8 бит на центр для $J_j$ и ≤8 бит на центр для $I_j$.
  4) Итого можно взять явную $A_2:=16$ для структуры $J_j$ и $I^{*}_{-}$.
- `Toy‑тест:` $s=2$, один chosen‑центр. У центра 4 направления; 2 бита на направление дают
  8 бит для структуры $J_j$ и 8 бит для структуры $I_j$, всего 16 = $A_2\\cdot|S^{*}_g|$
  при $|S^{*}_g|=1$.
- `Статус:` доказано (явная константа $A_2$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (подсчёт бит), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли поглотить $A_2$ в подписи/структуру $J_j$
  (Q43.S64-absorb-a2-into-signature).

### 16.226. Исследовательский шаг (counterexample): подписи не фиксируют структуру $I_j$

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S64-absorb-a2-by-signature):`
  Подписи Definition 6.11 фиксируют только структуру $J_j$ и не определяют структуру $I_j$;
  уже на toy‑примере существуют два разных $I_j$ при одинаковых подписях и поддержке, так что
  $A_2=0$ не следует.
- `Контрпример / Toy‑тест:`
  Пусть на стадии $j$ множество exposed‑центров $S_j$ — это 2x2 блок chosen‑центров, а $J_j$
  (и его подписи) фиксированы. По Invariant 6.1(2) $I_j$ должен быть локально согласован и
  замкнут на $S_j$ (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1841-1848`),
  а замкнутость/нечётность степеней задаются Definition 5.8 и 5.11
  (`…:1618-1623,1659-1665`). Тогда возможны два разных закрытых $I_j$ на той же поддержке:
  $I_j^{H}$ с горизонтальным matching (две горизонтальные рёбра) и $I_j^{V}$ с вертикальным
  matching. В обоих случаях у каждого центра ровно одно инцидентное ребро (нечётная степень),
  а остальные направления заняты non‑edge‑информацией, так что локальная согласованность
  сохраняется. Подписи зависят только от $J_j$ (`…:2327-2333`), поэтому для $I_j^{H}$ и $I_j^{V}$
  они совпадают, но структуры различны. Следовательно, подписи/поддержка не определяют $I_j$,
  и отдельный $A_2$‑терм необходим.
- `Статус:` контрпример (поглощение $A_2$ в подписи невозможно в текущем виде).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли добавить $O(1)$ бит на центр к подписи так, чтобы
  закодировать структуру $I_j$ при сохранении константного размера (Q43.S66-tradeoff-augment-signature).

### 16.227. Исследовательский шаг (proof): циклы дают 1 бит неоднозначности $I_j$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S68-tree-uniqueness-cycle-bit):`
  Зафиксируем support и граф возможных рёбер $G$ на этих центрах (ребро между центрами
  в соседних под‑квадратах, Definition 5.6). Тогда каждый закрытый $I$ на данном support
  эквивалентен выбору подмножества рёбер $E(I)\\subseteq E(G)$, в котором у каждой вершины
  нечётная степень; множество таких $I$ имеет размер $2^{\\beta(G)}$, где $\\beta(G)$ — цикломатическое
  число. В частности, если $G$ — лес, то $I$ единственен.
- `Доказательство:`
  1) По Definition 5.6 любая информация в направлении — это либо edge‑piece $\\{v,w\\}$,
     либо non‑edge $(v,\\delta,\\bot)$ (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1586-1590`).
     Для фиксированного support: если в направлении нет центра, то non‑edge обязателен,
     если центр есть — выбор «edge vs non‑edge» определяет наличие ребра. Значит $I$
     полностью задаётся множеством рёбер $E(I)$ в графе возможных рёбер $G$.
  2) По Definition 5.8 и 5.11 локальная согласованность и замкнутость на support дают
     «нечётное число рёбер у каждой вершины» (`…:1618-1623,1659-1665`), т.е. $E(I)$ —
     нечётностепенной подграф $G$.
  3) Пусть $I$ и $I'$ — два закрытых множества на одном support. Тогда в $E(I)\\oplus E(I')$
     каждая вершина имеет чётную степень (odd ⊕ odd = even), значит $E(I)\\oplus E(I')$
     раскладывается в дизъюнктное объединение циклов. Отсюда множество решений — аффинное
     пространство размерности $\\beta(G)$, и $|\\{I\\}|=2^{\\beta(G)}$.
  4) Если $G$ — лес (циклов нет), то $E(I)\\oplus E(I')=\\varnothing$ и $I=I'$; каждый
     независимый цикл добавляет ровно 1 бит (переключение по циклу сохраняет нечётные степени).
- `Toy‑тест:` путь из 4 центров (дерево) допускает ровно один $I$; 2x2 блок центров имеет
  $\\beta=1$ и даёт два $I$ (горизонтальный/вертикальный matching), как в §16.226.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться закодировать выбор базиса циклов $G$ через $O(1)$ бит на центр
  (например, через фиксированный spanning forest + биты на chords) и проверить, укладывается ли
  это в подписи Definition 6.11 (Q43.S69-encode-cycle-basis-bits).

### 16.228. Исследовательский шаг (proof): канонический остов + биты хорд

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S69-encode-cycle-basis-bits):`
  Для фиксированного support и графа возможных рёбер $G$ (Definition 5.6) существует
  канонический spanning forest $F(G)$ и канонический odd‑degree подграф $E_0\\subseteq F(G)$
  такие, что любой закрытый $I$ с этим support удовлетворяет
  $E(I)=E_0\\oplus\\bigoplus_{e\\in\\mathrm{Chords}(G)} b_e C_e$, где $C_e$ — фундаментальный
  цикл хорды $e$, а биты $b_e\\in\\{0,1\\}$ можно хранить на концах хорд, используя
  $\\le 4$ дополнительных бита на центр.
- `Доказательство:`
  1) Зафиксируем канонический порядок центров (например, лексикографический) и построим
     $F(G)$ как BFS‑forest. Если закрытый $I$ существует, то в каждой компоненте $G$
     число вершин чётно: сумма нечётных степеней равна $2|E(I)|$ (чётно). Тогда на дереве
     $F$ существует ровно один подграф с нечётной степенью в каждой вершине (решение
     системы паритетов на дереве; строится удалением листьев). Обозначим его $E_0$.
  2) Для любого закрытого $I$ подграф $D:=E(I)\\oplus E_0$ имеет чётные степени в каждой
     вершине, то есть лежит в cycle space $G$. По стандартному факту, cycle space
     порождается фундаментальными циклами хорд $e\\in E(G)\\setminus E(F)$, и коэффициенты
     $b_e$ при этом разложении единственны.
  3) Каждая хорда $e=\\{u,v\\}$ соответствует направлению у $u$ и $v$. Храним $b_e$ у конца
     с меньшим лексикографическим идентификатором; у центра максимум 4 инцидентных ребра,
     значит он хранит ≤4 бит хорд.
  4) Реконструкция: стартуем с $E_0$ и для каждой хорды с $b_e=1$ переключаем рёбра на
     цикле $C_e$ (хорда + уникальный путь в $F$ между концами). Получаем $E(I)$.
- `Toy‑тест:` 2×2 блок центров. Канонический $F$ — путь из 3 рёбер; $E_0$ — два несмежных
  ребра. Единственная хорда даёт цикл длины 4: $b=0$ даёт один matching, $b=1$ — второй.
  2×3 ladder: $|V|=6$, $|E|=7$, $|E(F)|=5$, значит две хорды. $E_0$ фиксирован на дереве,
  а два бита хорд дают 4 закрытых $I$, что совпадает с $2^{\\beta(G)}$.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, что добавление 4 бит на центр согласуется с Def. 6.11/Def. 6.13
  и не ломает критерий конфликта (т.е. не требует идентификаторов центров).

### 16.229. Исследовательский шаг (proof): интеграция битов хорд в подписи

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S70-integrate-chord-bits-signature):`
  Если подпись Definition 6.11 расширить дополнительными ≤4 битами на центр,
  кодирующими выбор хорд из §16.228, то Definition 6.13 и Algorithms 2–4 остаются
  корректны без изменения логики чтения: конфликт‑чек использует только 9‑битный
  префикс подписи, а новые биты участвуют лишь в восстановлении структуры $I_j$.
- `Доказательство:`
  1) Подпись Definition 6.11 — это 9 бит на центр (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2327-2332`),
     читаемые вместе с фиксированным центром (`…:2336-2338`). Поэтому можно присоединить к подписи
     локальные биты $b_e$ для хорд, назначенных этому центру (≤4 на центр по §16.228), не кодируя
     никакую «личность» центра — центр известен по порядку чтения.
  2) Definition 6.13 определяет конфликт через частичное присваивание на инцидентных направлениях,
     задаваемое первой и второй четверками бит подписи (`…:2345-2367`). Дополнительные chord‑биты
     не изменяют эти восемь бит, значит predicate “conflict” совпадает с исходным после проекции
     на 9‑битный префикс.
  3) В процедуре восстановления (Algorithms 2–4) подписи читаются как константные блоки бит и
     добавляются в $E$ (`…:2378-2385`); логика шагов 1–5 использует только конфликт и восстановление
     $J_j$. Поэтому можно читать расширенные подписи и сохранять chord‑биты до момента восстановления
     $I_j$. По §16.228 канонический остов $F(G)$ вместе с набором $b_e$ однозначно восстанавливает
     $E(I_j)$; это добавляет лишь ≤$4|S^{*}_g|$ бит и не меняет логику чтения.
  4) Следовательно, добавление ≤4 бит на центр совместимо с Definition 6.13 и алгоритмами.
- `Toy‑тест:` 2×2 блок chosen‑центров. Для фиксированного support возможны два $I_j$
  (горизонтальный/вертикальный matching, §16.226). Канонический остов даёт одну хорду и бит $b$.
  Фиксируем $b=0$, получаем $I_j^{H}$. Любая ветвь $\\psi$, содержащая переменную на вертикальном
  ребре, вместе с $I_j^{H}$ нарушает pairwise local consistency в Definition 6.13(2), поэтому
  конфликт‑чек отсекает несовместимую ветвь при фиксированном $b$.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, не нарушает ли правило назначения chord‑битов требование
  “signature does not include identity” (Q43.S72-identity-leak-check-chord-bits).

### 16.230. Исследовательский шаг (counterexample): chord‑биты зависят от глобальной нумерации

- `Линза:` Инвариант.
- `Утверждение (Q43.S72-identity-leak-check-chord-bits):`
  В расширении §16.228–16.229 дополнительные chord‑биты на центр зависят только от локальной
  структуры (support + инцидентные направления) и инвариантны под автоморфизмами grid,
  поэтому расширенная подпись не кодирует identity центра (Remark 6.12).
- `Контрпример / Toy‑тест:`
  Возьмём support = 2×2 блок центров. Граф возможных рёбер $G$ — квадрат. Канонический
  остов $F(G)$ из §16.228 строится BFS с лексикографическим порядком центров: три рёбра
  входят в $F(G)$, а единственная хорда — четвёртое ребро квадрата. Эта хорда соединяет
  два диагонально симметричных центра. По правилу §16.228 бит $b_e$ хранится у конца
  хорды с меньшим лексикографическим идентификатором. Если применить симметрию квадрата
  (поворот/отражение) и переименовать направления, то 9‑битные подписи Definition 6.11
  преобразуются эквивариантно, но правило «меньший лексикографический ID хранит бит»
  не сохраняется: хорда переносит бит на другой угол. Значит расширенная подпись зависит
  от глобальной нумерации центров и не инвариантна под симметрией.
- `Статус:` контрпример (identity‑leak для правила назначения chord‑битов §16.228).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` переопределить назначение chord‑битов локально‑канонически (без
  глобальной нумерации) или явно зафиксировать допустимую ориентацию grid
  (Q43.S74-local-reencode-chord-bits).

### 16.231. Исследовательский шаг (toy): локальное правило назначения chord‑битов по направлению

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S74-dir-rule-chord-bits):`
  При фиксированной ориентации grid бит каждой хорды $e=\\{u,v\\}$ можно назначать локально:
  хранить $b_e$ у того конца, для которого направление к соседу минимально в фиксированном
  порядке, например South < West < North < East (то есть «южный» или «западный» конец).
  Это использует только метки направлений, не требует глобальной нумерации центров, сохраняет
  ≤4 бит на центр и не изменяет конфликт‑чек Definition 6.13 (он зависит лишь от 9‑битного
  префикса подписи).
- `Toy‑тест:`
  1) 2×2 блок центров. Единственная хорда — одно ребро квадрата. Бит хранится на «южном/западном»
     конце хорды; при переносе блока (translation) направление ребра и выбор конца сохраняются,
     поэтому распределение битов по центрам не зависит от абсолютных координат. Конфликт‑чек
     использует только первые 9 бит подписи (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2345-2367`),
     так что дополнительные chord‑биты игнорируются.
  2) 2×3 ladder. Две хорды: каждая горизонтальная/вертикальная, бит хранится на западном
     или южном конце. Любой перенос ladder сохраняет направления и распределение битов;
     на каждом центре ≤4 инцидентных направления ⇒ ≤4 бит.
- `Статус:` частично (toy‑подтверждение; общая корректность и допустимость фиксированной
  ориентации пока не доказаны).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить на общем support, не вносит ли фиксированная ориентация
  (South/West‑правило) скрытого identity‑leak при симметриях, и нужно ли явно фиксировать
  ориентацию grid в модели.

### 16.232. Исследовательский шаг (proof): фиксированная ориентация не даёт identity‑leak

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S75-orientation-leak-check):`
  Если grid рассматривается как ориентированный (направления N/E/S/W фиксированы и уже
  используются в Definition 6.11), то правило «бит хорды хранится на южном/западном конце»
  зависит только от направлений инцидентных рёбер, инвариантно при переносах support и не
  кодирует identity центра (Remark 6.12).
- `Доказательство:`
  1) Definition 6.11 задаёт подпись из 9 бит, где две четвёрки отвечают направлениям
     (information pieces + наличие рёбер), а Remark 6.12 подчёркивает, что подпись не включает
     identity центра (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2327-2337`).
     Следовательно, фиксированные направления уже являются допустимой частью локальной
     информации.
  2) South/West‑правило выбирает конец хорды по направлению ребра (южный/западный), то есть
     использует только локальные direction‑метки и не обращается к глобальной нумерации или
     координатам. Поэтому любая ориентационно‑сохраняющая автоморфизм (перенос) сохраняет
     распределение chord‑битов.
  3) В симметричных support (2×2, 2×3) попытка “поменять конец” через поворот/отражение меняет
     направления инцидентных рёбер, а значит не сохраняет 9‑битную подпись; такие симметрии не
     допустимы при фиксированной ориентации. Следовательно, локально изоморфных (с сохранением
     направлений) окружений с разными chord‑битами нет.
- `Toy‑тест:` 2×2 и 2×3: переносы сохраняют направления и выбор “южного/западного” конца;
  отражение/поворот меняют direction‑биты в подписи и не являются допустимой изоморфией.
- `Статус:` доказано (при фиксированной ориентации grid, уже используемой в подписи).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если ориентация не считается частью структуры (допускаются повороты/отражения),
  построить канонический якорь/ориентацию из одной подписи (Q43.S76-anchor-canonicalization).

### 16.233. Исследовательский шаг (exact citation): в HR’22 ориентация grid фиксирована координатами и направлениями

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S78-orientation-explicit-quote):`
  В HR’22 grid задаётся как ориентированная структура с фиксированными координатами (i, j) ∈ [n] и
  явно используемыми направлениями left/right/up/down и нумерацией строк; значит повороты/отражения
  не являются допустимыми симметриями модели по умолчанию.
- `Точная ссылка (HR’22, text cache):`
  1) определение grid через координаты: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:395–399`
     (“Throughout the paper we work over graphs Gn = (V, E) with n2 nodes which we call the grid.
      However, in order to avoid problems at the boundary, we in fact work over the 2-dimensional
      torus: each node (i, j) ∈ V is indexed by two integers i, j ∈ [n] and an edge {u, v} is in E if and
      only if it connects two adjacent nodes, that is, if one of the coordinates of u and v are identical
      and the other differs by 1 modulo n.”)
  2) направления left/right/up/down заданы в терминах относительного положения: `…:1382–1384`
     (“Given a fixed center v we say that a path P connecting v to some other center u goes to the δ,
      where δ is one of the directions left, right, up or down, if v lies in the sub-square to the δ of u.”)
  3) используется нумерация строк: `…:1403–1405`
     (“… fixing the alive centers with the lowest numbered row in each sub-square to be the chosen
      centers Cσ of σ.”)
- `Toy‑тест:` не требуется (цитата фиксирует структуру модели).
- `Статус:` exact citation.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если рассматривается ориентационно‑свободная модель (с поворотами/отражениями),
  нужна канонизация якоря (Q43.S76); иначе вернуться к основному треку Q43.

### 16.234. Исследовательский шаг (counterexample): односигнатурные данные не фиксируют ориентацию

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S79-symmetry-counterexample):`
  В ориентационно‑свободной модели (допускающей повороты/отражения) одной подписи центра
  (Definition 6.11, даже с добавленными локальными chord‑битами) недостаточно, чтобы канонически
  зафиксировать ориентацию: существует симметричный support, где поворот на 180° оставляет
  односигнатурные данные неизменными, но меняет ориентацию.
- `Контрпример / Toy‑тест:`
  1) Возьмём support как «крест» из 5 центров: центральный v и его четыре соседа по N/E/S/W.
     Граф возможных рёбер здесь — дерево, так что никаких chord‑битов нет. Пусть v выбран (chosen),
     и в J_j у v есть information pieces во всех четырёх направлениях и присутствуют все четыре
     инцидентные ребра. Тогда подпись v имеет вид (chosen=1; info=1111; edges=1111)
     (Definition 6.11 в `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2327-2332`).
  2) Поворот на 180° или отражение сохраняет этот «крест», фиксирует v и переставляет направления.
     В ориентационно‑свободной модели это допустимый автоморфизм. Поскольку все четыре direction‑бита
     у v одинаковы, подпись v инвариантна под этой перестановкой.
  3) Следовательно, две противоположные ориентации (N/E/S/W и S/W/N/E) совместимы с одной и той же
     подписью v; любая процедура, использующая только одну подпись, не может выбрать между ними
     без дополнительного симметри‑ломающего бита.
- `Статус:` контрпример (канонизация ориентации из одной подписи в ориентационно‑свободной модели невозможна).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, достаточно ли добавить один глобальный chirality‑бит или иной
  минимальный симметри‑ломающий маркер к подписи, чтобы фиксировать ориентацию без identity‑leak
  (Q43.S80-chirality-bit).

### 16.235. Исследовательский шаг (counterexample): глобальный chirality‑бит не ломает симметрию

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S80-chirality-bit):`
  Добавление одного глобального бита $\\chi$, общего для всех центров и не зависящего от их identity
  (Remark 6.12), к 9‑битным подписям достаточно для канонической фиксации ориентации в
  ориентационно‑свободной модели.
- `Контрпример / Toy‑тест:`
  1) Предположим, что $\\chi$ вычисляется из unlabeled‑support и набора подписей, то есть инвариантен
     относительно автоморфизмов grid (иначе он использует identity центров). Возьмём «крест» из 5
     центров как в §16.234, с chosen‑центром $v$ и подписью $(1;1111;1111)$. Поворот на $180^\\circ$
     сохраняет support и все подписи, поэтому $\\chi$ имеет то же значение. Следовательно, расширенные
     подписи (signature+$\\chi$) совпадают для двух противоположных ориентаций.
  2) Аналогично для 2×2 блока центров с симметричным набором локальных данных: $180^\\circ$‑поворот
     переставляет углы, но сохраняет мультимножество подписей, а глобальный инвариант $\\chi$ остаётся
     тем же. Ориентация по расширенным подписям не фиксируется.
- `Статус:` контрпример (один глобальный инвариантный бит не фиксирует ориентацию без identity).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если разрешить внешнее «ориентационное» значение $\\chi$ как advice‑бит, проверить,
  что оно не нарушает Remark 6.12 и добавляет лишь $O(1)$ бит в Algorithms 2–4; иначе зафиксировать,
  что ориентационно‑свободная модель требует не‑инвариантного якоря.

### 16.236. Исследовательский шаг (proof): advice‑бит ориентации $\\chi$ совместим с Remark 6.12

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S81-chirality-advice-check):`
  Если разрешить один глобальный non‑invariant advice‑бит $\\chi$, фиксирующий ориентацию grid,
  то Algorithms 2–4 используют его с добавкой $O(1)$ бит, подписи остаются identity‑free
  (Remark 6.12), а комбинация signature+$\\chi$ задаёт ориентацию для всего support.
- `Доказательство:`
  1) Remark 6.12 фиксирует, что подпись центра не содержит его identity и читается вместе с
     заданным центром $v$; порядок подписей — часть внешней информации, но не кодируется в подписи
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2327-2338`). Глобальный
     бит $\\chi$ не привязан к центру и не меняет 9‑битную подпись, поэтому не нарушает требование
     “no identity in signature”.
  2) Algorithms 2–4 читают подписи как константные блоки бит и используют только направление
     инцидентных рёбер/подквадратов (Algorithm 2: чтение 9 бит подписи; Algorithm 3–4: работа по
     направлениям и подквадратам) (`…:3089-3133`, `…:3161-3173`, `…:3234-3238`). Следовательно,
     $\\chi$ можно считать глобальным параметром, определяющим интерпретацию направлений
     (например, ориентацию “clockwise/anti‑clockwise”); его достаточно прочитать один раз
     в начале Algorithm 2. Это добавляет только $O(1)$ бит и не требует пер‑центровых данных.
  3) При фиксированном $\\chi$ направления в подписи трактуются относительно выбранной ориентации,
     так что ориентация определяется глобально (вся обработка в Algorithms 2–4 согласована по
     этому выбору). Поэтому signature+$\\chi$ задаёт ориентацию без дополнительного identity‑кода.
- `Toy‑тест:` «крест» и 2×2 блок из §16.234–16.235. Для каждого support алгоритм читает только
  9‑битные подписи и направление‑зависимые проверки. Если выбрать $\\chi=0$ как “стандартную”
  ориентацию, все вызовы в Algorithms 2–4 интерпретируют направления одинаково; поворот на 180°
  соответствует смене $\\chi$ и не требует обращения к координатам центров. Следовательно, $\\chi$
  разбивает симметрии на две ориентации без identity‑leak.
- `Статус:` доказано (advice‑бит допустим и добавляет $O(1)$ бит).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оценить минимальное число глобальных бит для канонизации ориентации (например,
  различить все 8 симметрий $D_4$) и сравнить с вариантом $|\\chi|=1$ (Q43.S83-min-orientation-bits).

### 16.237. Исследовательский шаг (proof): $D_4$‑симметрия требует ≥3 глобальных бит для ориентации

- `Линза:` Инвариант.
- `Утверждение (Q43.S83-d4-lower-bound):`
  В ориентационно‑свободной модели существует support и набор 9‑битных подписей, чьи
  данные инвариантны под всеми 8 симметриями $D_4$; следовательно, любая identity‑free
  канонизация ориентации требует ≥3 глобальных бит.
- `Доказательство:`
  1) Построение. Возьмём support как «крест» из 5 центров на grid: центральный $v$ и
     четыре соседа по N/E/S/W. Пусть все центры chosen. Зададим подпись $v$ как
     $(1;1111;1111)$ (есть information pieces и edges во всех направлениях), а подписи
     листьев — как $(1;1000;1000)$, $(1;0100;0100)$, $(1;0010;0010)$, $(1;0001;0001)$
     в зависимости от направления к $v$. Такое распределение реализуется $J_j$, содержащим
     ровно четыре ребра $v$–лист и информацию вдоль этих направлений.
  2) Любая симметрия $g \\in D_4$ (поворот/отражение) сохраняет support и переставляет
     направления N/E/S/W. Подпись $v$ инвариантна (все направления =1), а четыре листовых
     подписи просто переставляются. Следовательно, мультимножество подписей инвариантно
     под всеми 8 симметриями.
  3) Пусть $A$ — identity‑free канонизатор ориентации, читающий support, подписи и $k$
     глобальных advice‑бит. Для этого symmetric support все 8 ориентаций согласованы с
     входом, и различаться могут только по advice‑битам. Поэтому $2^k \\ge 8$, то есть
     $k \\ge 3$.
- `Toy‑тест:` крест: $D_4$ переставляет листья и направления, но мультимножество подписей
  не меняется; ориентация остаётся неразличимой без внешних бит.
- `Статус:` доказано (информационно‑теоретический lower bound: ≥3 глобальных бит).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` построить явную 3‑битную схему канонизации ориентации, совместимую
  с Algorithms 2–4 (Q43.S84-3bit-upper).

### 16.238. Исследовательский шаг (proof): 3‑битная канонизация ориентации (upper bound)

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S84-3bit-upper):`
  В ориентационно‑свободной модели можно задать глобальный advice‑код $\\omega\\in\\{0,1\\}^3$,
  кодирующий элемент $D_4$, и интерпретировать direction‑биты в подписях относительно $\\omega$.
  Такой код читается один раз перед Algorithms 2–4, не зависит от identity центров,
  не добавляется в 9‑битные подписи и не меняет конфликт‑чек Definition 6.13.
- `Доказательство:`
  1) Зафиксируем кодирование $D_4$: пусть $b_2b_1b_0\\in\\{0,1\\}^3$; если $b_2=0$, берём поворот
     $r^{k}$ (где $k=2b_1+b_0$) на $0/90/180/270^\\circ$, а если $b_2=1$, берём отражение
     $s\\circ r^{k}$ (где $s$ — отражение относительно вертикали). Это биекция $\\{0,1\\}^3\\leftrightarrow D_4$.
  2) Definition 6.11 задаёт подпись центра как 9 бит: chosen, четыре direction‑бита для information
     pieces и четыре direction‑бита для рёбер (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2327-2332`),
     а Remark 6.12 запрещает identity в подписи (`…:2333-2336`). Для фиксированного $g\\in D_4$ трактуем
     эти биты как данные в направлениях $g(N),g(E),g(S),g(W)$. Это глобальная переименовка направлений,
     одинаковая для всех центров, поэтому identity‑информация не появляется.
  3) Algorithm 2 читает подпись как ровно 9 бит (`…:3122-3124`), а конфликт‑чек Definition 6.13 опирается
     только на эти 9 бит и $I$. Algorithms 2–4 далее используют лишь индексы направлений при работе
     с под‑квадратами (`…:3164-3169`), поэтому интерпретация через $g$ внедряется один раз и не меняет
     логику алгоритмов.
- `Toy‑тест:`
  «Крест», 2×2 блок, 2×3 ladder. Для каждого support любая симметрия $D_4$ лишь переставляет
  направления; код $\\omega$ выбирает $g$ и тем самым фиксирует соответствие direction‑битов N/E/S/W.
  Подписи остаются 9‑битными, конфликт‑чек зависит только от префикса, поэтому
  логика Algorithms 2–4 сохраняется во всех трёх примерах.
- `Статус:` доказано (3‑битный global advice задаёт ориентацию без identity‑leak).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли вычислить эти 3 бита из support+подписей без
  внешнего advice (anchor‑канонизация) или получить локальный impossibility (Q43.S85/Q43.S86).

### 16.239. Исследовательский шаг (toy computation): допустимость D4‑симметричного «креста»

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S86-admissible-d4-support):`
  Существует D4‑симметричный support+подписи из §16.237 (крест с центральной подписью
  $(1;1111;1111)$), который допустим как possible forcing information $J_j$ (Definition 6.2)
  и может возникать во входах Algorithms 2–4.
- `Toy‑тест:`
  1) В §16.237 центральному центру $v$ приписана подпись с info=1111 и edges=1111, то есть
     $J_j$ имеет информацию во всех четырёх направлениях и 4 инцидентных ребра
     (Definition 6.11, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2327-2332`).
  2) По локальной согласованности, если информация есть во всех 4 направлениях, число
     инцидентных рёбер должно быть нечётным (`…:1618-1623`). Здесь 4 (чётно), значит
     такой $J_j$ не локально согласован и нарушает Def. 6.2(1) (`…:1882-1886`).
- `Статус:` контрпример к допустимости этого D4‑симметричного «креста» как support $J_j$.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` либо найти D4‑симметричный support, удовлетворяющий локальной
  согласованности (odd‑degree), либо доказать, что такие support невозможны в модели.

### 16.240. Исследовательский шаг (proof): D4 + фикс‑центр несовместимы с odd‑degree

- `Линза:` Инвариант.
- `Утверждение (Q43.S87-fixed-center-parity):`
  Пусть $I$ — closed information set (Def. 5.11 в HR'22), $U:=\\mathrm{supp}(I)$. Если $U$
  D4‑симметричен относительно фиксированного центра $c\\in U$, то такого $I$ не существует:
  closed $\\Rightarrow$ граф рёбер на $U$ имеет нечётные степени (1 или 3), поэтому $|U|$ чётно,
  но D4‑симметрия с фикс‑центром даёт $|U|$ нечётным.
- `Доказательство:`
  1) По Def. 5.11 и локальной согласованности, для каждого $u\\in U$ информация дана во всех
     4 направлениях, и число инцидентных рёбер у $u$ нечётно; значит граф рёбер на $U$ —
     odd‑degree (степени 1 или 3). См. HR’22, remark после Def. 5.11
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1664-1679`).
  2) По лемме рукопожатий число вершин с нечётной степенью чётно; следовательно $|U|$ чётно.
  3) Если $U$ инвариантен под $D_4$ и содержит фиксированный центр $c$, то все остальные
     орбиты имеют размер 4 или 8 (точки на осях/диагоналях или общий случай), поэтому
     $|U|=1+4a+8b$ и $|U|$ нечётно. Противоречие.
- `Toy‑тест:` «крест» (5 центров) и 3×3 блок (9 центров): оба имеют D4‑симметрию
  с фикс‑центром, но $|\\mathrm{supp}|$ нечётно, значит odd‑degree невозможно.
- `Статус:` доказано (исключены все D4‑симметричные closed‑supports с фикс‑центром).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить D4‑симметричные closed‑supports без фикс‑центра
  (орбиты 4/8), либо выписать mod‑2 несогласованность (Q43.S88).

### 16.241. Исследовательский шаг (counterexample): D4‑квотиент слишком сильный

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S88-quotient-parity):`
  Попытка свести существование D4‑симметричного closed‑support (без фикс‑центра)
  к системе паритетов на орбитных переменных (D4‑квотиент) некорректна: такая система
  описывает только D4‑инвариантные множества рёбер и может быть несовместна даже когда
  closed‑support существует.
- `Toy‑тест:`
  1) На grid 4×4 возьмём support $U$ = центральный 2×2 блок. Он D4‑симметричен и не содержит
     фикс‑центра. Индуцированный граф — цикл $C_4$, и закрытый $I$ существует: например,
     горизонтальный (или вертикальный) matching даёт нечётные степени 1 у всех вершин
     (odd‑degree ⇔ closed, Def. 5.11 + ремарка после него,
     `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1659-1679`).
  2) Если же требовать D4‑симметрию для рёбер (орбитные переменные на D4‑квотиенте),
     то у $C_4$ одна орбита рёбер (все 4 ребра), и любая вершина инцидентна ей дважды.
     Поэтому любая D4‑симметричная выборка рёбер даёт чётные степени (0 или 2),
     и уравнение $\\deg(v)\\equiv 1\\pmod 2$ несовместно.
- `Статус:` контрпример (квотиентный паритет захватывает только D4‑инвариантные $I$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать ограничение на supports без фикс‑центра, которое запрещает
  любые odd‑degree подграфы (без требования D4‑симметрии рёбер), либо перейти к
  orbit‑8‑only конструированию (Q43.S88b).

### 16.242. Исследовательский шаг (toy computation): orbit‑8‑only support на 6×6 с odd‑degree

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S89-orbit8-construction):`
  На grid 6×6 существует D4‑симметричный closed‑support без фикс‑центра, состоящий только
  из orbit‑8‑центров, на котором есть odd‑degree подграф; значит существует closed information
  set (Def. 5.11 в HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1659-1670`).
- `Toy‑тест:`
  1) Используем координаты $(i,j)\\in[6]^2$ и симметрии $D_4$ квадрата относительно центра
     $(3.5,3.5)$. Возьмём орбиту точки $(2,3)$:
     $$U=\\{(2,3),(2,4),(3,2),(3,5),(4,2),(4,5),(5,3),(5,4)\\}.$$
     Все вершины $U$ вне диагоналей $i=j$ и $i+j=7$, поэтому орбита имеет размер 8
     (orbit‑8‑only) и $U$ D4‑симметричен.
  2) В графе соседства grid выберем рёбра
     $$E=\\{(2,3)(2,4),(3,2)(4,2),(3,5)(4,5),(5,3)(5,4)\\}.$$
     Тогда каждый $u\\in U$ имеет степень $1$ (нечётную).
  3) Определим information set $I$ как $E$ плюс non‑edges во всех остальных направлениях
     инцидентных $u\\in U$. По Def. 5.8 условие локальной согласованности выполнено
     (odd‑degree; `…:1618-1623`), а по Def. 5.11 $I$ — closed.
- `Статус:` доказано (явная конструкция на 6×6).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, совместимы ли такие orbit‑8 supports с требованиями
  possible forcing information $J_j$ (Def. 6.2), или найти дополнительную локальную обструкцию.

### 16.243. Исследовательский шаг (counterexample): orbit‑8 support не исключается локально

- `Линза:` Инвариант.
- `Утверждение (Q43.S91-orbit8-jj-local-obstruction):`
  Orbit‑8 support на 6×6 не может быть support возможной forcing‑информации $J_j$:
  локальная согласованность (Def. 6.2(1)) и запрет chosen–non‑chosen edges уже дают
  локальный паритетный конфликт.
- `Toy‑тест:`
  1) Возьмём orbit‑8 support $U$ и рёбра $E$ из §16.242 (4 непересекающихся ребра).
     Пусть $J$ содержит эти 4 рёбра и non‑edges во всех остальных направлениях у каждого
     $u\\in U$. Тогда $J$ локально согласован: информация во всех 4 направлениях и ровно
     1 инцидентное ребро (нечётно) у каждого $u$ (Def. 5.8).
  2) Пусть $I=\\varnothing$ (или $\\mathrm{supp}(I)\\cap U=\\varnothing$), тогда Def. 6.2(1) выполнено.
     Если все центры в $U$ одного типа (все chosen или все non‑chosen), то запрет
     chosen–non‑chosen edges соблюдён автоматически.
  3) В случае non‑chosen центров возьмём pairing $\\pi$ с 4 компонентами‑рёбрами $E$;
     тогда $J\\!\upharpoonright_{\\text{non‑chosen}}$ — объединение компонент $\\pi$,
     т.е. Def. 6.2(4) выполнено.
  4) Для ветви $\\psi$, состоящей из переменных с ассоц. центрами $U$, $J$ закрыт на
     каждом $u$ и поэтому все переменные принудительно заданы (Def. 5.9), а удаление
     любого information piece ломает forcing, т.е. $J$ минимален.
- `Статус:` контрпример (локальной обструкции нет: Def. 6.2(1) + запрет chosen–non‑chosen
  не исключают orbit‑8 support).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить совместимость такого $J_j$ с реальными ограничениями на $S/I/\\pi$
  в каноническом дереве (глобальные условия), либо формализовать mod‑2 систему для
  orbit‑8 с выбранным разбиением chosen/non‑chosen.

### 16.244. Исследовательский шаг (toy computation): orbit‑8 и 2‑стадийный канонический фрагмент

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S94-orbit8-canonical-fragment):`
  Попытка исключить orbit‑8 как стадию канонического дерева через Def. 6.2(3) или Def. 6.13(2)
  не срабатывает на 2‑стадийном toy‑фрагменте: существует выбор $(\\rho,I,S,\\pi,\\psi)$, где $J_j$
  из §16.243 удовлетворяет Def. 6.2(1–4), а конфликт Definition 6.13(2) не возникает.
- `Toy‑тест:`
  1) Возьмём orbit‑8 support $U$ и $J$ из §16.243. Положим $I=\\varnothing$ и $S=\\varnothing$.
     Тогда Def. 6.2(1) верно (попарная локальная согласованность), а Def. 6.2(2) тривиально,
     т.к. $J$ закрыт на каждом $u\\in U$ (информация во всех 4 направлениях).
  2) Возьмём ветвь $\\psi$ с переменными, ассоц. центрами $U$. По Def. 5.9 каждый такой
     переменный forced, следовательно Def. 6.2(3) выполняется, а минимальность $J$ следует
     из того, что удаление любого piece на $u$ снимает forcing у центра $u$.
  3) Если все центры $U$ non‑chosen, то Def. 6.2(4) выполняется при pairing $\\pi$,
     чьи компоненты совпадают с 4 рёбрами $E$; а в Def. 6.13(2) множество $E_\\psi$
     пусто, и assignment из $I$ тривиально pairwise‑locally consistent.
  4) Если все центры $U$ chosen, то подписи (Definition 6.11) кодируют ту же схему
     edges/non‑edges, что и $J$; induced assignment на меньшей решётке локально согласован
     (odd‑degree 1 на каждом $u$), так что Def. 6.13(2) также не даёт конфликта.
- `Статус:` частично (toy‑фрагмент совместим с Def. 6.2(3) и Def. 6.13(2); обструкция не найдена).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` выписать глобальную mod‑2 систему для orbit‑8 с заданным разбиением
  chosen/non‑chosen и pairing $\\pi$ (Q43.S95).

### 16.245. Исследовательский шаг (toy computation): orbit‑8 mod‑2 глобальный чек (all‑non‑chosen)

- `Линза:` Инвариант.
- `Утверждение (Q43.S95-orbit8-mod2-global):`
  Для all‑non‑chosen support $U$ и pairing $\\pi=E$ глобальный конфликт Definition 6.13(2)
  сводится к линейной системе $A x=b$ над $\\mathbb F_2$ по рёбрам $\\pi$; для 6×6 orbit‑8
  из §16.242 система разрешима (единственное решение $x_e=1$ для всех $e\\in E$).
- `Toy‑тест:`
  1) При all‑non‑chosen и $\\pi=E$ assignment на выбранных путях определяется только
     information pieces на non‑chosen центрах. Локальная согласованность (Def. 5.8) даёт
     уравнение $\\sum_{e\\ni v} x_e = 1$ для каждого $v\\in U$ (odd‑degree).
  2) Нумеруем рёбра $e_1=(2,3)(2,4)$, $e_2=(3,2)(4,2)$, $e_3=(3,5)(4,5)$, $e_4=(5,3)(5,4)$.
     Тогда
     $$A=\\begin{pmatrix}
     1&0&0&0\\\\
     1&0&0&0\\\\
     0&1&0&0\\\\
     0&1&0&0\\\\
     0&0&1&0\\\\
     0&0&1&0\\\\
     0&0&0&1\\\\
     0&0&0&1
     \\end{pmatrix},\\quad b=\\mathbf 1,$$
     и система эквивалентна $x_1=x_2=x_3=x_4=1$ (rank$=4$), т.е. совместна.
- `Статус:` доказано (mod‑2 чек не даёт конфликта в all‑non‑chosen case).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить mixed chosen/non‑chosen: выписать систему для 2 chosen + 6 non‑chosen
  и проверить конфликт Definition 6.13(2).

### 16.246. Исследовательский шаг (toy computation): orbit‑8 mixed chosen/non‑chosen, mod‑2 чек

- `Линза:` Инвариант.
- `Утверждение (Q43.S96-orbit8-mixed-chosen-conflict):`
  На orbit‑8 support $U$ из §16.242 при выборе chosen центров $(2,3)$ и $(5,4)$ и остальных
  non‑chosen, если $J$ использует рёбра $E$ из §16.242, то mod‑2 чек Definition 6.13(2)
  остаётся совместимым (как в all‑non‑chosen случае).
- `Toy‑тест:`
  1) Берём $U$ и $E$ из §16.242. Обозначим
     $e_1=(2,3)(2,4)$, $e_2=(3,2)(4,2)$, $e_3=(3,5)(4,5)$, $e_4=(5,3)(5,4)$ и
     переменные $x_i\\in\\{0,1\}$ для этих рёбер.
  2) Пусть chosen центры $c_1=(2,3)$ и $c_2=(5,4)$, остальные 6 центров non‑chosen, а $J$
     содержит рёбра $E$ и non‑edges во всех остальных направлениях, т.е. информация полна
     на каждом $u\\in U$.
  3) Локальная согласованность даёт уравнения $\\sum_{e\\ni u} x_e = 1$ для всех $u\\in U$,
     что эквивалентно $x_1=x_2=x_3=x_4=1$ (система совпадает с §16.245) и, следовательно,
     совместна.
  4) Замечание: рёбра $e_1,e_4$ соединяют chosen–non‑chosen и нарушают Def. 6.2(4); здесь
     проверяется только конфликт‑чек Def. 6.13(2).
- `Статус:` toy computation (конфликт Definition 6.13(2) не обнаружен в этой конфигурации).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` повторить mod‑2 чек при запрете chosen–non‑chosen рёбер (Def. 6.2(4)),
  например, выбрать adjacent chosen центры или зафиксировать $x_{e_1}=x_{e_4}=0$ и проверить
  совместимость.

### 16.247. Исследовательский шаг (toy computation): orbit‑8 запрет chosen–non‑chosen → $x_{e_1}=x_{e_4}=0$

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S97-orbit8-force-e1e4-zero):`
  В конфигурации §16.246 запрет chosen–non‑chosen edges (Def. 6.2(4)) эквивалентен фиксации
  $x_{e_1}=x_{e_4}=0$ в мод‑2 системе §16.245; тогда система $A x=\\mathbf 1$ несовместна,
  так что конфликт Definition 6.13(2) возникает на toy‑уровне.
- `Toy‑тест:`
  1) Оставим support $U$ и chosen центры $c_1=(2,3)$, $c_2=(5,4)$ как в §16.246.
     Рёбра $e_1=(2,3)(2,4)$ и $e_4=(5,3)(5,4)$ соединяют chosen–non‑chosen, поэтому в $J$
     должны быть non‑edges: $x_{e_1}=x_{e_4}=0$.
  2) В системе $A x=\\mathbf 1$ из §16.245 строки для $(2,3),(2,4)$ дают $x_{e_1}=1$,
     а строки для $(5,3),(5,4)$ дают $x_{e_4}=1$. Противоречие с $x_{e_1}=x_{e_4}=0$,
     следовательно система несовместна.
- `Статус:` доказано (mod‑2 конфликт при запрете mixed‑edges).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить альтернативную конфигурацию без mixed‑edges, например adjacent chosen
  центры и новый $J$ без рёбер chosen–non‑chosen (Q43.S98).

### 16.248. Исследовательский шаг (toy computation): orbit‑8 adjacent chosen без mixed‑edges

- `Линза:` Инвариант.
- `Утверждение (Q43.S98-adjacent-chosen-mod2-conflict):`
  В orbit‑8 support $U$ при adjacent chosen центрах $(2,3)$ и $(2,4)$, запрете chosen–non‑chosen edges
  (Def. 6.2(4)) и $J$ с рёбрами $E$ из §16.242 mod‑2 система $A x=\\mathbf 1$
  несовместна (конфликт Def. 6.13(2)).
- `Toy‑тест:`
  1) Берём $U$ и рёбра $E$ из §16.242, обозначим
     $e_1=(2,3)(2,4)$, $e_2=(3,2)(4,2)$, $e_3=(3,5)(4,5)$, $e_4=(5,3)(5,4)$ и $x_i\\in\\{0,1\}$.
  2) Выберем chosen центры $c_1=(2,3)$ и $c_2=(2,4)$ (adjacent), остальные 6 центров non‑chosen;
     пусть $J$ содержит рёбра $E$ и non‑edges во всех остальных направлениях, так что информация
     полна на каждом $u\\in U$. Тогда среди $E$ нет chosen–non‑chosen рёбер: $e_1$ соединяет
     chosen‑chosen, а $e_2,e_3,e_4$ — non‑chosen‑non‑chosen.
  3) Локальная согласованность даёт ту же систему $A x=\\mathbf 1$ из §16.245,
     т.е. $x_1=x_2=x_3=x_4=1$. Запрет mixed‑edges не фиксирует ни одного $x_i$,
     поэтому система совместна и конфликт Def. 6.13(2) не возникает.
- `Статус:` контрпример (adjacent chosen не влечёт mod‑2 конфликт в этой конфигурации).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.

### 16.249. Исследовательский шаг (exact citation): adjacent chosen допустимы по Def. 5.6/6.2/6.11

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S99-adjacent-chosen-allowed):`
  В HR’22 определения не запрещают минимальный $J$ с ровно двумя adjacent chosen центрами и без
  chosen–non‑chosen рёбер; конфигурация §16.248 допустима по Def. 5.6/6.2/6.11, а Lemma 6.5
  требует наличие adjacency между chosen центрами в $\\mathrm{supp}(J)$.
- `Exact citation:`
  “Edges between chosen centers are new grid edges and we say that two chosen centers are neighbors
  if they lie in adjacent sub-squares” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1571-1574`).
  Definition 5.6: информация — это либо edge между центрами в соседних sub‑squares,
  либо non‑edge $(v,\\delta,\\bot)$ (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1586-1594`).
  Definition 6.2: возможный $J$ — минимальный набор с условиями (1)–(4) и явной ремаркой
  “a possible forcing information $J$ never contains an edge between a chosen center and a non-chosen center”
  (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1882-1893`).
  Lemma 6.5 использует минимальность $J$ и локальную согласованность, чтобы показать:
  “every chosen center in $\\mathrm{supp}(J)$ is adjacent to at least one other chosen center in $\\mathrm{supp}(J)$”
  (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2016-2023`).
  Definition 6.11 задаёт 9‑битную подпись центра (chosen‑бит, направления информации, направления рёбер),
  без ограничений на adjacency (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2327-2332`).
- `Toy‑тест:`
  1) В конфигурации §16.248 берём chosen центры $c_1=(2,3)$ и $c_2=(2,4)$ (adjacent),
     $J$ содержит ребро $e_1=c_1c_2$ и рёбра $e_2,e_3,e_4$ между non‑chosen центрами, а
     остальные направления закрыты non‑edges.
  2) Def. 5.6 допускает такие информационные куски (edge между adjacent центрами и non‑edge‑записи).
  3) Нарушения “no chosen–non‑chosen edges” нет: $e_1$ соединяет chosen–chosen, $e_2,e_3,e_4$ —
     non‑chosen–non‑chosen, что согласуется с Def. 6.2(4) и явной ремаркой после Def. 6.2.
  4) Локальная согласованность выполнена (ровно один piece на направление и нечётная степень),
     поэтому при локально согласованном $I$ (например, $I=\\varnothing$) выполняется Def. 6.2(1).
  5) Подписи Def. 6.11 корректно определены: у выбранных центров bit chosen = 1, отмечены все направления
     и ровно одно направление с ребром, поэтому adjacency не создаёт запрета.
- `Статус:` подтверждено (adjacent chosen разрешены на уровне определений; запрета нет).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (цитата/формулировка), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, может ли minimal $J$ с ровно двумя adjacent chosen центрами
  реально возникать как possible forcing information (Def. 6.2(3)), или требуется ≥3 chosen (Q43.S101).

### 16.250. Исследовательский шаг (toy computation): 2 adjacent chosen дают possible forcing information

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S101-two-chosen-example):`
  На grid 4×4 существует конфигурация с ровно двумя adjacent chosen центрами, для которой
  можно выбрать $(\\rho,I,S,\\pi,\\psi)$ так, что $J$ является possible forcing information
  (Def. 6.2) и минимален (Def. 5.9), при этом $J$ не содержит chosen–non‑chosen edges.
- `Toy‑тест:`
  1) Возьмём adjacent chosen центры $c_1=(2,3)$ и $c_2=(2,4)$, остальные центры вне поддержки.
     Положим $I=\\varnothing$, $S=\\varnothing$, $\\pi=\\varnothing$, а $\\psi$ — ветвь,
     содержащая хотя бы одну переменную, ассоциированную с каждым из $c_1,c_2$.
  2) Определим $J$ как edge $\\{c_1,c_2\\}$ и non‑edges $(c_1,\\delta,\\bot)$ для трёх остальных
     направлений от $c_1$ и аналогично для $c_2$. Тогда $J$ закрыт на $c_1,c_2$
     (Def. 5.11; `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1659-1664`)
     и локально согласован (по одному инцидентному ребру — нечётная степень, Def. 5.8).
     Следовательно, Def. 6.2(1) выполнено.
  3) Так как $S=\\varnothing$, Def. 6.2(2) требует закрытости в $c_1,c_2$, что выполнено.
  4) По Def. 5.9 наличие информации во всех 4 направлениях у $c_1,c_2$ принудительно задаёт
     все переменные, ассоциированные с этими центрами; значит все переменные на $\\psi$ forced
     и Def. 6.2(3) выполнено. Если удалить любой piece в $J$, один из центров перестаёт быть
     закрытым, и переменная на $\\psi$ при этом центре не forced — поэтому $J$ минимален.
  5) $J$ не содержит non‑chosen центров, значит Def. 6.2(4) выполнено тривиально
     (пустое подмножество компонент $\\pi$), и chosen–non‑chosen edges отсутствуют.
- `Статус:` доказано (toy‑пример: $J$ с 2 adjacent chosen возможен).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, накладывают ли глобальные ограничения на $S/I/\\pi$ инвариант
  min‑degree≥2 или линейную неоднозначность, исключающие поддержку из 2 chosen (Q43.S102).

### 16.251. Исследовательский шаг (counterexample): глобальные ограничения на $S/I/\\pi$ не дают min‑degree≥2

- `Линза:` Инвариант.
- `Утверждение (Q43.S102-degree2-invariant):`
  Если possible forcing information $J$ имеет ровно два adjacent chosen центра, то глобальные
  ограничения на $S/I/\\pi$ принуждают min‑degree≥2 в графе $\\mathrm{supp}(J)$, поэтому toy‑пример
  из §16.250 невозможен.
- `Toy‑тест:`
  1) Берём конфигурацию §16.250: два chosen центра $c_1,c_2$, $J$ содержит ребро $\\{c_1,c_2\\}$
     и по три non‑edges из каждого центра; $I=\\varnothing$, $S=\\varnothing$, $\\pi=\\varnothing$.
  2) По Def. 6.2(2) при $S=\\varnothing$ каждый associated center на ветви $\\psi$ обязан быть
     закрыт; это ровно выполнено, а Def. 6.2(4) тривиальна (нет non‑chosen центров).
  3) По Def. 5.9 переменные на $\\psi$ forced **только** если есть информация во всех 4 направлениях;
     удаление любого piece в $J$ снимает закрытость и разрушает forcedness, так что $J$ минимален.
  4) Граф $\\mathrm{supp}(J)$ имеет степень 1 у обоих chosen центров (единственное ребро между ними),
     и это совместимо с Def. 6.2(1–4). Следовательно, глобальные ограничения на $S/I/\\pi$ не дают
     инвариант min‑degree≥2.
- `Статус:` контрпример (инвариант min‑degree≥2 не следует).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить линейную неоднозначность $I/\\pi$ для fixed support при двух
  adjacent chosen (Q43.S103-linear-ambiguity-2chosen).

### 16.252. Исследовательский шаг (toy computation): adjacent chosen не дают линейной неоднозначности

- `Линза:` Инвариант.
- `Утверждение (Q43.S103-ambiguity-construct):`
  В конфигурации §16.250 с двумя adjacent chosen и без chosen–non‑chosen рёбер
  линейная система для closed information set на фиксированном support имеет
  единственное решение; следовательно, (I,π) на этом support однозначны, и
  линейной неоднозначности нет.
- `Toy‑тест:`
  1) Фиксируем support $U=\\{c_1=(2,3),c_2=(2,4)\\}$ из §16.250; non‑chosen центров нет,
     поэтому pairing $\\pi=\\varnothing$.
  2) Граф возможных рёбер $G$ на $U$ имеет единственное ребро $e=\\{c_1,c_2\\}$.
     Пусть $x_e\\in\\{0,1\\}$ — наличие edge‑piece между $c_1,c_2$.
  3) Закрытость и локальная согласованность (Def. 5.8/5.11:
     `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1618-1623,1659-1665`)
     требуют нечётную степень на каждом $v\\in U$, то есть
     $$A=\\begin{pmatrix}1\\\\1\\end{pmatrix},\\quad A x=\\mathbf 1,$$
     откуда $x_e=1$.
  4) Следовательно, для фиксированного support существует ровно один closed information set,
     и никакой свободы в $I/\\pi$ (при тех же подписях) нет.
- `Статус:` контрпример (линейной неоднозначности нет: решение единственно).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить критерий “cycle‑space ⇔ неоднозначность” на support с циклом
  (например, 2×2 chosen блок или mixed chosen/non‑chosen), сравнить с §16.227 (Q43.S105).

### 16.253. Исследовательский шаг (toy computation): 2×2 chosen‑цикл допускает possible forcing info и 1‑бит неоднозначности

- `Линза:` Инвариант.
- `Утверждение (Q43.S105-cycle-space-criterion):`
  На grid 4×4 support из 2×2 chosen‑центров может быть support возможной forcing‑информации
  $J$, а закрытые $I$ на этом support ровно два (горизонтальный/вертикальный matching);
  оба проходят Def. 6.13(2), значит 1‑бит неоднозначности цикла не устраняется локальными
  условиями.
- `Toy‑тест:`
  1) Возьмём chosen‑центры $U=\\{(2,2),(2,3),(3,2),(3,3)\\}$ на 4×4, положим $S=\\varnothing$,
     $I=\\varnothing$, $\\pi=\\varnothing$, а ветвь $\\psi$ содержит переменные, ассоциированные
     с каждым $u\\in U$.
  2) Определим $J^{H}$: два горизонтальных ребра $(2,2)(2,3)$ и $(3,2)(3,3)$ плюс non‑edges во
     всех остальных направлениях у каждого $u\\in U$. Тогда $J^{H}$ локально согласован и закрыт
     на каждом $u$ (odd‑degree=1; Def. 5.8/5.11:
     `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1618-1623,1659-1665`),
     поэтому Def. 6.2(1–2) выполнены (`…:1882-1888`). По Def. 5.9 информация во всех 4 направлениях
     у каждого $u$ принуждает переменные на $\\psi$ (`…:1632-1636`), и удаление любого piece ломает
     forcedness, значит Def. 6.2(3) и минимальность выполнены. Def. 6.2(4) тривиальна (non‑chosen нет).
  3) Аналогично $J^{V}$ с двумя вертикальными рёбрами — тоже possible forcing information.
  4) Для фиксированного support $U$ закрытые information sets соответствуют нечётностепенным
     подграфам 4‑цикла; единственные решения — $J^{H}$ и $J^{V}$ (см. §16.227). В каждом случае,
     беря $I:=J$, получаем локально согласованный assignment на выбранных путях, так что
     Def. 6.13(2) конфликта не даёт (`…:2359-2367`).
- `Статус:` доказано (support‑цикл реализуем, и остаётся ровно 1 бит неоднозначности).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обобщить критерий через $\\mathbb F_2$‑ранг/quotient‑граф при фиксированном
  pairing $\\pi$ (Q43.S106).

### 16.254. Исследовательский шаг (proof): $\\pi$‑quotient сводится к cycle‑space chosen‑части

- `Линза:` Коммуникация/ранг.
- `Утверждение (Q43.S106-pi-quotient-rank-lemma):`
  Зафиксируем support $U$ и pairing $\\pi$. Пусть $I$ — closed information set на $U$,
  совместимое с $\\pi$ в смысле Invariant 6.1(4)/Def. 6.2(4), и $I$ не содержит
  chosen–non‑chosen edges (Remark после Invariant 6.1). Обозначим через $G_{\\mathrm{ch}}$
  граф возможных рёбер на chosen‑центрах из $U$. Тогда множество таких $I$ образует
  аффинное $\\mathbb F_2$‑подпространство размерности $\\beta(G_{\\mathrm{ch}})$; в частности
  $$|\\{I\\}|=2^{\\beta(G_{\\mathrm{ch}})}.$$
  Если определить $G/\\pi$ как граф, полученный стягиванием компонент $\\pi$ внутри $U$,
  то из отсутствия выбранных–невыбранных рёбер следует $\\beta(G/\\pi)=\\beta(G_{\\mathrm{ch}})$,
  и формула совпадает с “$\\pi$‑quotient” критерием.
- `Доказательство:`
  1) По Invariant 6.1(4) и Remark после Def. 5.11, на non‑chosen центрах $I$ представляет
     собой объединение целых компонент $\\pi$, каждая из которых сама является closed
     information set. Следовательно, структура $I$ на non‑chosen фиксирована выбранными
     компонентами $\\pi$ и не даёт степеней свободы.
  2) По Remark после Invariant 6.1 в $I$ нет путей между chosen и non‑chosen центрами,
     значит рёбра $I$ раскладываются по компонентам “chosen” и “non‑chosen”.
  3) На chosen‑части замкнутость эквивалентна условию “odd‑degree на каждом центре”, так
     что множество решений — ровно аффинное пространство нечётностепенных подграфов
     $G_{\\mathrm{ch}}$ и имеет размер $2^{\\beta(G_{\\mathrm{ch}})}$ (см. §16.227).
  4) Стягивание компонент $\\pi$ не влияет на цикл‑пространство chosen‑части (компоненты
     $\\pi$ изолированы), поэтому $\\beta(G/\\pi)=\\beta(G_{\\mathrm{ch}})$.
- `Toy‑тест:`
  1) 2×2 chosen‑цикл из §16.253: $\\pi=\\varnothing$, $G/\\pi=G$, $\\beta=1$ ⇒ два $I$
     (горизонтальный/вертикальный matching).
  2) Два adjacent chosen из §16.252: $\\pi=\\varnothing$, $G/\\pi$ — дерево, $\\beta=0$ ⇒
     $I$ единственен.
- `Статус:` доказано (в каноническом режиме $\\pi$ фиксирует non‑chosen части, а неоднозначность
  целиком задаётся cycle‑space chosen‑графа).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти (или исключить) пример, где $\\beta(G/\\pi)=1$,
  но Def. 6.2(4) запрещает все closed $I$ (Q43.S107-pi-quotient-counterexample-def6-2-4).

### 16.255. Исследовательский шаг (toy computation): 2×2 chosen‑цикл + π‑компонента из 2 non‑chosen

- `Линза:` Инвариант.
- `Утверждение (Q43.S107-pi-quotient-counterexample-def6-2-4):`
  В минимальной конфигурации “2×2 chosen‑цикл + одна non‑chosen π‑компонента из двух соседних
  центров” при запрете chosen–non‑chosen edges (Def. 6.2(4)) мод‑2 система на рёбрах совместна,
  т.е. closed $I$ существуют несмотря на $\\beta(G/\\pi)=1$.
- `Toy‑тест:`
  1) Возьмём chosen‑центры $C=\\{(2,2),(2,3),(3,2),(3,3)\\}$ (4‑цикл) и non‑chosen
     $N=\\{(2,4),(3,4)\\}$, соседние по вертикали. Пусть pairing $\\pi$ имеет одну компоненту
     $P$ на $N$ с ребром $f=(2,4)(3,4)$, а $U=C\\cup N$ — support. По Def. 6.2(4) и ремарке
     “no chosen–non‑chosen edge” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1882-1893`)
     направления между $(2,3)$–$(2,4)$ и $(3,3)$–$(3,4)$ фиксируются как non‑edges.
  2) Обозначим рёбра chosen‑цикла:
     $e_1=(2,2)(2,3)$, $e_2=(2,3)(3,3)$, $e_3=(3,3)(3,2)$, $e_4=(3,2)(2,2)$ и переменную $y$
     для $f$. Закрытость (Def. 5.8/5.11: `…:1618-1623,1659-1665`) даёт уравнения
     $e_1+e_4=1$, $e_1+e_2=1$, $e_2+e_3=1$, $e_3+e_4=1$ на chosen‑вершинах и $y=1$ на $N$.
  3) Система имеет ровно два решения на $C$ (горизонтальный или вертикальный matching) и
     фиксирует $y=1$; значит closed $I$ существуют и “узкое место” Def. 6.2(4) в этой
     минимальной конфигурации отсутствует. При стягивании $\\pi$ цикл‑пространство chosen‑части
     не меняется, поэтому $\\beta(G/\\pi)=\\beta(C)=1$.
- `Статус:` toy computation (конфликт Def. 6.2(4) не найден в минимальной конфигурации).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, может ли π‑компонента нечётного размера (или две компоненты),
  при условии “$J$ закрыт на non‑chosen” (Def. 6.2(2)+(4)), исключить все $I$ при
  $\\beta(G/\\pi)=1$; либо попытаться доказать общую лемму о декуплинге chosen/non‑chosen.

### 16.256. Исследовательский шаг (toy computation): нечётная π‑компонента non‑chosen

- `Линза:` Инвариант.
- `Утверждение (Q43.S108-odd-pi-component-parity):`
  если non‑chosen π‑компонента имеет нечётный размер и Def. 6.2(2)+(4) требует, чтобы $J$
  был закрыт на всех её центрах при запрете chosen–non‑chosen edges, то mod‑2 система
  замкнутости несовместна и closed $I$ не существует. Однако по Def. 5.2 компоненты π
  имеют размер 2 или 4, поэтому такая обструкция не реализуется в реальном π.
- `Toy‑тест:`
  1) Пусть chosen‑центры $C=\\{(2,2),(2,3),(3,2),(3,3)\\}$ (2×2 цикл), а non‑chosen
     $N=\\{(2,4),(3,4),(4,4)\\}$ образуют одну π‑компоненту $P$ с рёбрами
     $f_1=(2,4)(3,4)$, $f_2=(3,4)(4,4)$. По Def. 6.2(4) выбранные–невыбранные рёбра запрещены.
  2) Замкнутость на $N$ (Def. 5.11: `…:1659-1665`) даёт уравнения $f_1=1$, $f_1+f_2=1$,
     $f_2=1$; суммирование даёт $0=1$ по модулю 2, т.е. решения нет.
  3) Эквивалентно: в любой графовой компоненте нечётного размера система $A x=\\mathbf 1$
     несовместна, так как сумма всех уравнений равна 0, а правая часть — 1.
  4) Часть $C$ по‑прежнему имеет два решения (matching), но odd‑компонента $N$ запрещает
     все closed $I$.
- `Статус:` toy computation (паритетный конфликт для нечётной компоненты; вне модели π).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, может ли две π‑компоненты (даже чётные) дать аналогичную
  несовместимость при $\\beta(G/\\pi)=1$ (Q43.S109).

### 16.257. Исследовательский шаг (toy computation): две чётные π‑компоненты non‑chosen

- `Линза:` Коммуникация/ранг.
- `Утверждение (Q43.S109-two-pi-components-rank):`
  в конфигурации “2×2 chosen‑цикл + две disjoint π‑компоненты размера 2” при запрете
  chosen–non‑chosen edges (Def. 6.2(4)) mod‑2 система замкнутости совместна; closed $I$
  существуют несмотря на $\\beta(G/\\pi)=1$.
- `Toy‑тест:`
  1) Возьмём chosen‑центры $C=\\{(2,2),(2,3),(3,2),(3,3)\\}$ (4‑цикл) и две non‑chosen пары
     $N_1=\\{(2,4),(3,4)\\}$, $N_2=\\{(4,2),(4,3)\\}$. Пусть pairing $\\pi$ имеет две компоненты
     $P_1$ с ребром $f_1=(2,4)(3,4)$ и $P_2$ с ребром $f_2=(4,2)(4,3)$; $U=C\\cup N_1\\cup N_2$.
     По Def. 6.2(4) и ремарке “no chosen–non‑chosen edge” направления между chosen и non‑chosen
     фиксируются как non‑edges.
  2) Для chosen‑цикла обозначим $e_1=(2,2)(2,3)$, $e_2=(2,3)(3,3)$, $e_3=(3,3)(3,2)$,
     $e_4=(3,2)(2,2)$. Замкнутость (Def. 5.8/5.11: `…:1618-1623,1659-1665`) даёт
     $e_1+e_4=1$, $e_1+e_2=1$, $e_2+e_3=1$, $e_3+e_4=1$ на $C$.
  3) На non‑chosen парах получаем уравнения $f_1=1$ и $f_2=1$ (каждый центр имеет степень 1
     внутри своей компоненты). Эти ограничения независимы от chosen‑части.
  4) Система совместна: уравнения на $C$ дают два решения (горизонтальный/вертикальный matching),
     а $f_1=f_2=1$ фиксируются однозначно. При стягивании $\\pi$ получаем 4‑цикл и две изолированные
     вершины, поэтому $\\beta(G/\\pi)=1$.
- `Статус:` toy computation (две чётные π‑компоненты не создают новой несовместимости).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить конфигурации с π‑компонентами размера 4 или попытаться доказать
  общую лемму о декуплинге chosen/non‑chosen (Q43.S110).

### 16.258. Исследовательский шаг (toy computation): чётная π‑компонента‑звезда и декуплинг

- `Линза:` Инвариант.
- `Утверждение (Q43.S110-decouple-even-pi):`
  В каноническом режиме (Invariant 6.1(4) + запрет chosen–non‑chosen edges) конфигурация
  “2×2 chosen‑цикл + π‑компонента‑ребро (|P|=2) + π‑компонента‑звезда (|P|=4)” даёт совместную
  систему $A x=\\mathbf 1$; non‑chosen часть фиксирована, и число closed $I$ равно
  $2^{\\beta(G_{\\mathrm{ch}})}$ (здесь $=2$).
- `Toy‑тест:`
  1) Возьмём chosen‑центры $C=\\{(2,2),(2,3),(3,2),(3,3)\\}$ (2×2 цикл) и non‑chosen пару
     $N_2=\\{(2,6),(3,6)\\}$ с ребром $f$ (π‑компонента‑ребро). Для второй π‑компоненты возьмём
     звезду $N_4=\\{(5,5),(5,4),(5,6),(6,5)\\}$ с рёбрами $g_1=(5,5)(5,4)$,
     $g_2=(5,5)(5,6)$, $g_3=(5,5)(6,5)$ (Def. 5.2: компоненты π — ребро или звезда размера 4,
     `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1442-1449`).
     Компоненты отделены от $C$, так что chosen–non‑chosen edges отсутствуют (Def. 6.2(4)).
  2) На chosen‑цикле уравнения такие же, как в §16.255: $e_1+e_4=1$, $e_1+e_2=1$,
     $e_2+e_3=1$, $e_3+e_4=1$, откуда два решения (H/V matching).
  3) На ребре $f$ замкнутость даёт $f=1$.
  4) На звезде листья дают $g_1=g_2=g_3=1$, а у центрального узла $g_1+g_2+g_3=1$,
     что совместно; решение единственно.
  5) Итог: non‑chosen часть фиксирована, а chosen‑часть даёт 2 решения; поэтому
     $|\\{I\\}|=2=2^{\\beta(G_{\\mathrm{ch}})}$ (так как $\\beta(G_{\\mathrm{ch}})=1$).
- `Статус:` toy computation (even π‑компонента‑звезда не добавляет ограничений; декуплинг сохраняется).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, может ли две π‑компоненты‑звезды размера 4 дать
  несовместимость при $\\beta(G/\\pi)=1$ (Q43.S111-size4-pi-obstruction).

### 16.259. Исследовательский шаг (toy computation): две π‑звезды размера 4 не дают паритетной обструкции

- `Линза:` Инвариант.
- `Утверждение (Q43.S111-size4-pi-obstruction):`
  в минимальной конфигурации “2×2 chosen‑цикл + две disjoint π‑звезды размера 4”
  при запрете chosen–non‑chosen edges mod‑2 система замкнутости совместна; паритетной
  обструкции нет.
- `Toy‑тест:`
  1) Пусть chosen‑центры $C=\\{(2,2),(2,3),(3,2),(3,3)\\}$ (2×2 цикл). Возьмём две disjoint
     π‑компоненты‑звезды размера 4: $N_4^a=\\{(5,5),(5,4),(5,6),(6,5)\\}$ с рёбрами
     $g_1=(5,5)(5,4)$, $g_2=(5,5)(5,6)$, $g_3=(5,5)(6,5)$ и
     $N_4^b=\\{(7,2),(7,1),(7,3),(8,2)\\}$ с рёбрами
     $h_1=(7,2)(7,1)$, $h_2=(7,2)(7,3)$, $h_3=(7,2)(8,2)$.
     Компоненты удалены от $C$, поэтому chosen–non‑chosen edges отсутствуют (Def. 6.2(4)).
  2) Для chosen‑цикла обозначим $e_1=(2,2)(2,3)$, $e_2=(2,3)(3,3)$, $e_3=(3,3)(3,2)$,
     $e_4=(3,2)(2,2)$. Замкнутость даёт те же уравнения $e_1+e_4=1$, $e_1+e_2=1$,
     $e_2+e_3=1$, $e_3+e_4=1$, поэтому два решения (H/V matching).
  3) На каждой π‑звезде листья дают $g_1=g_2=g_3=1$ и $h_1=h_2=h_3=1$, а у центральных узлов
     $g_1+g_2+g_3=1$ и $h_1+h_2+h_3=1$; это совместно, т.к. $1+1+1\\equiv 1\\pmod 2$.
     Решение на non‑chosen части единственно.
  4) Итог: система $A x=\\mathbf 1$ распадается на блоки chosen/π‑звёзд и совместна; число
     closed $I$ равно $2^{\\beta(G_{\\mathrm{ch}})}=2$.
- `Статус:` toy computation (контрпример: две π‑звезды размера 4 не создают обструкции).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться обобщить совместимость для двух π‑звёзд или вывести
  паритетный критерий через $G/\\pi$ (Q43.S112-size4-pi-compatibility).

### 16.260. Исследовательский шаг (toy computation): β=0 не даёт конфликта для двух π‑звёзд

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S113-beta0-counterexample):`
  Существует конфигурация из двух π‑звёзд размера 4 без chosen–non‑chosen рёбер, для которой
  $\\beta(G/\\pi)=0$, но система $A x=\\mathbf 1$ несовместна.
- `Toy‑тест:`
  1) При отсутствии chosen–non‑chosen рёбер Def. 6.2(4) фиксирует non‑chosen часть как
     объединение компонент $\\pi$, т.е. граф возможных рёбер на non‑chosen — дизъюнктная
     сумма двух π‑звёзд.
  2) Для одной звезды с центром $v$ и листьями $u_1,u_2,u_3$ замкнутость даёт уравнения
     $x_{vu_i}=1$ для каждого $i$ и $x_{vu_1}+x_{vu_2}+x_{vu_3}=1$, что совместно; решение
     единственно: все три ребра равны 1.
  3) Следовательно, для двух π‑звёзд система $A x=\\mathbf 1$ распадается на два независимых
     блока и всегда совместна; $\\beta(G/\\pi)=0$ (каждая звезда — дерево).
  4) Брутфорс‑проверка всех disjoint‑пар π‑звёзд в решётках 4×4 и 5×5: 68 и 564 пар
     соответственно, несовместимых случаев не найдено.
- `Статус:` контрпример не найден (β=0 не приводит к конфликту в модели “две π‑звезды”).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться формализовать общий критерий совместимости для двух π‑звёзд
  (Q43.S112-size4-pi-compatibility).

### 16.261. Исследовательский шаг (proof): паритетный критерий через π‑quotient

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S115-quotient-parity-criterion):`
  В каноническом режиме (Invariant 6.1(4) + запрет chosen–non‑chosen edges) система
  замкнутости $A x=\\mathbf 1$ на support $U$ эквивалентна по существованию решений системе
  $B_{G/\\pi}x=b$ на графе $G/\\pi$, где $B_{G/\\pi}$ — матрица инцидентности, а
  $b\\equiv \\mathbf 1$ на вершинах. Следовательно, решение существует тогда и только тогда,
  когда в каждой связной компоненте $H$ графа $G/\\pi$ выполнено
  $\\sum_{v\\in H} b_v\\equiv 0$ (т.е. $|V(H)|$ чётно; эквивалентно $b\\perp\\ker B_{G/\\pi}^T$).
- `Доказательство:`
  1) Из запрета chosen–non‑chosen edges граф возможных рёбер раскладывается на
     $G_{\\mathrm{ch}}$ и изолированные компоненты $\\pi$; поэтому $A$ блочно‑диагональна:
     $A=A_{\\mathrm{ch}}\\oplus\\bigoplus_{P\\in\\pi}A_P$.
  2) Для каждой компоненты $P$ допустимы только |P|=2 (ребро) или |P|=4 (звезда) (Def. 5.2).
     В обоих случаях система $A_P x=\\mathbf 1$ имеет единственное решение (см. §16.256, §16.258),
     значит совместимость $A x=\\mathbf 1$ эквивалентна совместимости $A_{\\mathrm{ch}}x=\\mathbf 1$.
  3) Так как компоненты $\\pi$ изолированы, $G/\\pi$ совпадает с $G_{\\mathrm{ch}}$ плюс изолированные
     вершины; следовательно $A_{\\mathrm{ch}}=B_{G/\\pi}$ и $b\\equiv\\mathbf 1$.
  4) Для любой компоненты $H$ матрица $B_H$ имеет ранг $|V(H)|-1$, а сумма строк равна нулю,
     поэтому $B_H x=b_H$ совместна iff $\\sum_{v\\in H} b_v=0$; это эквивалентно условию
     $b\\perp\\ker B_{G/\\pi}^T$.
- `Toy‑тест:`
  1) 2×2 chosen‑цикл и adjacent chosen (разделы §16.252–§16.253): $|V|$ чётно ⇒ система совместна.
  2) Добавление π‑компонент размера 2 или 4 (§16.255–§16.259) не меняет условие: каждая
     компонента $H$ имеет чётный размер ⇒ совместимость сохраняется.
  3) Гипотетическая нечётная π‑компонента (§16.256) даёт $|V(H)|$ нечётно ⇒ несогласованность.
- `Статус:` доказано (совместимость сводится к чётности компонент в $G/\\pi$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` стресс‑тестировать критерий вне канонического режима
  (overlapping π‑звёзды / chosen–non‑chosen edge) и попытаться найти контрпример
  (Q43.S116-overlapping-stars-counterexample).

### 16.262. Исследовательский шаг (counterexample): overlapping π‑звёзды ломают декуплинг

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S116-overlapping-stars-counterexample):`
  Вне канонического режима (разрешая перекрытие π‑звёзд) паритетный критерий §16.261
  в наивном виде “каждая π‑звезда имеет чётный размер ⇒ Ax=\\mathbf 1 совместна”
  неверен: существует support $U$, где каждая из двух π‑звёзд размера 4, но система
  $A x=\\mathbf 1$ несовместна.
- `Контрпример (4×4):`
  1) Пусть все центры non‑chosen. Возьмём $U=\\{(2,2),(2,1),(2,3),(1,2),(3,2)\\}$.
     Зададим две π‑звезды с общим центром $c=(2,2)$:
     $P_1$ на рёбрах $c(2,1),c(1,2),c(2,3)$ и $P_2$ на рёбрах $c(2,1),c(2,3),c(3,2)$.
     Это запрещено Def. 5.2 (перекрытие компонент), но разрешено вне канонического режима.
  2) Если игнорировать перекрытие и применять критерий §16.261 “по компонентам π”,
     каждая звезда имеет 4 вершины (чётно), поэтому паритетный тест не исключает решения.
  3) Обозначим рёбра $e_W=c(2,1)$, $e_E=c(2,3)$, $e_N=c(1,2)$, $e_S=c(3,2)$.
     Линейная система замкнутости (Def. 5.8/5.11) даёт на листьях $e_W=e_E=e_N=e_S=1$,
     а на центре $e_W+e_E+e_N+e_S=1$. Подстановка даёт $0=1$, т.е. $A x=\\mathbf 1$ несовместна.
- `Статус:` контрпример (перекрытие π‑звёзд ломает декуплинг на $U$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить chosen–non‑chosen edge как источник конфликта в каноническом
  критерии (Q43.S117-chosen-nonchosen-edge-counterexample).

### 16.263. Исследовательский шаг (counterexample): один chosen–non‑chosen edge ломает критерий по $G/\pi$

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S117-chosen-nonchosen-edge-counterexample):`
  Существует каноническое $\\pi$ (одна звезда размера 4) и локально согласованный $J$ с ровно
  одним chosen–non‑chosen edge, для которого паритетный критерий §16.261 по $G/\\pi$
  предсказывает совместимость, но система замкнутости $A x=\\mathbf 1$ несовместна.
- `Контрпример (4×4):`
  1) Возьмём non‑chosen π‑звезду $P$ с центром $v_0=(2,2)$ и листьями
     $v_W=(2,1)$, $v_N=(1,2)$, $v_E=(2,3)$; компонента $\\pi$ — рёбра
     $g_W=v_0v_W$, $g_N=v_0v_N$, $g_E=v_0v_E$. Пусть chosen‑центр $c=(3,1)$ соседен с $v_W$,
     и $J$ содержит рёбра $g_W,g_N,g_E$ и единственное mixed‑ребро $m=cv_W$;
     других information pieces нет. Тогда $J$ локально согласован (ни в одном центре
     нет информации во всех 4 направлениях).
  2) Любой closed information set $I$, pairwise‑locally consistent с $J$, добавляет
     non‑edges в отсутствующих направлениях, поэтому система замкнутости на $U$ имеет вид:
     $$m=1,\\quad g_N=1,\\quad g_E=1,\\quad g_W+m=1,\\quad g_W+g_N+g_E=1.$$
     Из $m=1$ получаем $g_W=0$ (уравнение для $v_W$), но из $g_N=g_E=1$ следует
     $g_W=1$ (уравнение для $v_0$). Противоречие, значит $A x=\\mathbf 1$ несовместна.
  3) В то же время граф $G/\\pi$ получается стягиванием звезды $P$ в одну вершину $p$;
     остаются две вершины $\\{p,c\\}$ и одно ребро между ними, т.е. компонент имеет чётный
     размер и паритетный критерий §16.261 предсказывает совместимость.
- `Статус:` контрпример (один mixed‑edge ломает критерий по $G/\\pi$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться восстановить критерий, добавив поправку на mixed‑ребро
  (например, вывести условие на паритет инцидентных рёбер π‑звезды или показать, что
  любой mixed‑edge при закрытии даёт конфликт).

### 16.264. Исследовательский шаг (proof): паритетный инвариант для mixed‑edges у π‑компоненты

- `Линза:` Инвариант.
- `Утверждение (Q43.S118-mixed-edge-parity-invariant):`
  Пусть $I$ — closed information set на support $U$ при pairing $\\pi$, и система замкнутости
  на рёбрах $I$ имеет вид $A x=\\mathbf 1$ (odd‑degree на каждом центре). Для любой
  π‑компоненты $P$ обозначим через $\\delta_{\\mathrm{mix}}(P)$ число mixed‑edges,
  инцидентных $P$ (edges между $P$ и chosen‑центрами с $x_e=1$). Тогда
  $$\\delta_{\\mathrm{mix}}(P)\\equiv \\sum_{v\\in P}1\\pmod 2,$$
  т.е. паритет mixed‑edges равен сумме “зарядов” на $P$. В частности, так как
  $|P|\\in\\{2,4\\}$, для любой реализуемой конфигурации $\\delta_{\\mathrm{mix}}(P)$ чётно.
- `Доказательство:`
  1) Для каждого $v\\in P$ уравнение $A x=\\mathbf 1$ даёт
     $\\sum_{e\\ni v} x_e=1$.
  2) Складывая эти уравнения по всем $v\\in P$, получаем
     $\\sum_{e\\in E(P)}2x_e+\\sum_{e\\in\\partial P}x_e=|P|$.
     Внутренние рёбра $E(P)$ исчезают по модулю 2, остаются только рёбра
     $\\partial P$, инцидентные $P$ и выходящие из него.
  3) Все рёбра из $\\partial P$ — ровно mixed‑edges (между $P$ и chosen‑центрами), поэтому
     $\\sum_{e\\in\\partial P}x_e=\\delta_{\\mathrm{mix}}(P)$, что даёт требуемую конгруэнцию.
- `Toy‑тест:`
  1) 4×4 π‑звезда $P$ как в §16.263: центр $v_0=(2,2)$ и листья
     $v_W=(2,1)$, $v_N=(1,2)$, $v_E=(2,3)$, один chosen‑центр $c=(3,1)$ и mixed‑ребро
     $m=cv_W$. Тогда $|P|=4$ ⇒ $\\delta_{\\mathrm{mix}}(P)\\equiv 0$, но у $c$ единственный
     инцидентный edge даёт $m=1$, противоречие. Это объясняет конфликт §16.263.
  2) Добавим второй chosen‑центр $c'=(1,1)$ и mixed‑ребро $m'=c'v_N$.
     Присвоение $m=m'=1$, $g_E=1$, $g_W=g_N=0$ удовлетворяет уравнениям
     $g_W+m=1$, $g_N+m'=1$, $g_E=1$, $g_W+g_N+g_E=1$, так что $A x=\\mathbf 1$ совместна.
     Паритет $\\delta_{\\mathrm{mix}}(P)=2$ совпадает с $|P|\\equiv 0$.
- `Статус:` доказано (паритет mixed‑edges на каждой π‑компоненте — необходимое условие).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, даёт ли чётность mixed‑edges достаточный критерий
  (или найти минимальный обструктивный мотив/канонический swap в π‑звезде)
  (Q43.S119).

### 16.265. Исследовательский шаг (counterexample): чётность mixed‑edges недостаточна

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S120-even-mixed-edge-counterexample):`
  Даже если у каждой π‑компоненты число mixed‑edges чётно, система замкнутости
  $A x=\\mathbf 1$ может быть несовместна: достаточно π‑звезды размера 4, где
  два mixed‑edge инцидентны одному chosen‑центру.
- `Контрпример (4×4):`
  1) Non‑chosen π‑звезда $P$ с центром $v_0=(2,2)$ и листьями
     $v_W=(2,1)$, $v_N=(1,2)$, $v_E=(2,3)$. Компонента $\\pi$ — рёбра
     $g_W=v_0v_W$, $g_N=v_0v_N$, $g_E=v_0v_E$ (Def. 5.2).
  2) Один chosen‑центр $c=(1,1)$ смежен с $v_W,v_N$; добавим два mixed‑ребра
     $m_W=cv_W$, $m_N=cv_N$, других рёбер нет. Тогда
     $\\delta_{\\mathrm{mix}}(P)=2$ и $|P|=4$ (паритет §16.264 выполнен).
  3) Уравнения $A x=\\mathbf 1$ на $U=\\{v_0,v_W,v_N,v_E,c\\}$:
     $$g_E=1,\\quad g_W+m_W=1,\\quad g_N+m_N=1,\\quad
     g_W+g_N+g_E=1,\\quad m_W+m_N=1.$$
     Из $g_E=1$ получаем $g_W+g_N=0$, значит $m_W=m_N=1+g_W$, и тогда
     $m_W+m_N=0$, противоречие.
- `Статус:` контрпример (чётность mixed‑edges на π‑компоненте недостаточна).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить критерий на квотиенте с сохранением chosen‑вершин
  (например, $b_{\\mathrm{mix}}\\perp\\ker B_{G/\\pi}^T$) и сверить с toy‑случаями
  §16.263–§16.265 (Q43.S121).

### 16.266. Исследовательский шаг (toy computation): mixed‑edge критерий на квотиенте

- `Линза:` Инвариант.
- `Утверждение (Q43.S121-mixed-edge-quotient-linear-criterion):`
  Гипотеза: если $G/\\pi$ получен стягиванием каждой non‑chosen π‑компоненты, а chosen‑вершины
  оставлены, и $b_{\\mathrm{mix}}(v)=1$ для chosen‑вершин, $b_{\\mathrm{mix}}(P)\\equiv|P|\\pmod 2$
  для стянутых π‑компонент, то совместимость $A x=\\mathbf 1$ требует
  $b_{\\mathrm{mix}}\\perp\\ker B_{G/\\pi}^T$ (эквивалентно существованию решения
  $B_{G/\\pi}x=b_{\\mathrm{mix}}$). Toy‑тест: конфигурация §16.265 нарушает это условие.
- `Toy‑тест:`
  1) В §16.265 есть π‑звезда $P$ размера 4 и chosen‑центр $c$, инцидентный двум mixed‑рёбрам.
     В $G/\\pi$ получаем две вершины $\\{p,c\\}$ и две параллельные дуги $pc$.
  2) Матрица инцидентности $B_{G/\\pi}$ над $\\mathbb F_2$ имеет два одинаковых столбца
     $(1,1)^T$, значит $\\ker B_{G/\\pi}^T=\\langle(1,1)\\rangle$.
  3) Здесь $b_{\\mathrm{mix}}(c)=1$ и $b_{\\mathrm{mix}}(p)=|P|\\equiv 0$, поэтому
     $b_{\\mathrm{mix}}\\cdot(1,1)=1$, и условие $b_{\\mathrm{mix}}\\perp\\ker B_{G/\\pi}^T$
     не выполняется.
- `Статус:` частично (toy‑тест поддерживает критерий; §16.265 отсеивается).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` либо доказать эквивалентность $A x=\\mathbf 1\\Leftrightarrow B_{G/\\pi}x=b_{\\mathrm{mix}}$
  в каноническом режиме, либо найти контрпример, где условие выполняется, но $A x=\\mathbf 1$
  несовместна (Q43.S122).

### 16.267. Исследовательский шаг (proof): квотиентный критерий с $b_{\\mathrm{mix}}$ достаточен

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S122-quotient-sufficiency-proof):`
  В каноническом режиме (Invariant 6.1(4): non‑chosen центры разбиты на π‑компоненты)
  система замкнутости $A x=\\mathbf 1$ на support $U$ совместна тогда и только тогда,
  когда существует решение $y$ уравнения $B_{G/\\pi}y=b_{\\mathrm{mix}}$, где $G/\\pi$ —
  граф после стягивания π‑компонент, а $b_{\\mathrm{mix}}(c)=1$ для chosen‑центров и
  $b_{\\mathrm{mix}}(P)\\equiv|P|\\pmod 2$ для вершины‑компоненты $P$.
- `Доказательство:`
  1) Разделим рёбра $G$ на $E_{cc}$ (chosen–chosen), $E_{\\mathrm{mix}}$ (chosen–non‑chosen)
     и $E_P$ внутри каждой π‑компоненты $P$. Уравнения $A x=\\mathbf 1$ на chosen‑центрах
     используют только $E_{cc}\\cup E_{\\mathrm{mix}}$ и совпадают со строками
     $B_{G/\\pi}y=b_{\\mathrm{mix}}$ при $y:=x|_{E_{cc}\\cup E_{\\mathrm{mix}}}$.
  2) Для каждой π‑компоненты $P$ положим
     $m_P(v):=\\sum_{e\\in E_{\\mathrm{mix}}: e\\ni v} y_e$ для $v\\in P$. Тогда уравнения
     на $P$ имеют вид $B_{H_P}x_P=\\mathbf 1+m_P$, где $H_P=(P,E_P)$.
  3) Складывая по $v\\in P$, получаем $0=\\sum_{v\\in P}(1+m_P(v))$, т.е.
     $\\delta_{\\mathrm{mix}}(P)\\equiv|P|\\pmod 2$. Это ровно строка
     $B_{G/\\pi}y=b_{\\mathrm{mix}}$ для вершины $P$.
  4) Обратно, если $y$ удовлетворяет $B_{G/\\pi}y=b_{\\mathrm{mix}}$, то для каждого $P$
     вектор $\\mathbf 1+m_P$ имеет чётную сумму, значит лежит в образе $B_{H_P}$.
     При $H_P$–дереве (edge или 4‑star) решение $x_P$ единственно (по листьям); в общем
     графе достаточно этой чётности. Склеивая решения по всем $P$ и беря
     $x|_{E_{cc}\\cup E_{\\mathrm{mix}}}=y$, получаем решение $A x=\\mathbf 1$.
- `Toy‑тест:`
  π‑компонента $P$ — 4‑цикл $v_1v_2v_3v_4v_1$ с двумя boundary‑вершинами $v_1,v_3$
  и mixed‑рёбрами $m_1,m_3$ к chosen‑центрам. Уравнения:
  $x_{12}+x_{14}+m_1=1$, $x_{12}+x_{23}=1$, $x_{23}+x_{34}+m_3=1$,
  $x_{34}+x_{14}=1$. Сумма даёт $m_1+m_3=0$ (|P|=4). При $m_1=m_3$ берём $x_{12}=t$,
  получаем $x_{23}=1+t$, $x_{34}=t+m_3$, $x_{14}=1+t+m_1$, так что решение существует
  для любого $t$.
- `Статус:` доказано (квотиентный критерий с $b_{\\mathrm{mix}}$ необходим и достаточен).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` стресс‑тестировать критерий вне канонического режима (например, разрешить
  перекрытие π‑компонент или дополнительные non‑chosen–non‑chosen рёбра) и проверить,
  какие дополнительные линейные ограничения появляются (Q43.S123).
