# P vs NP — исследовательские шаги 16.85–16.128 (Tseitin / proof complexity)

Этот файл — часть `docs/research/` (см. [index](index.md)).
Главный файл: `P_vs_NP.md`.

[Открыть главный ноутбук](../../P_vs_NP.md)

### 16.85. Исследовательский шаг: Tseitin($G,\chi$) и паритетный сертификат невыполнимости

- `Линза:` Инвариант.
- `Определение:` Пусть $G=(V,E)$ — неориентированный граф и $\chi:V\to\{0,1\}$
  («заряды»). Каждому ребру $e\in E$ сопоставим булеву переменную $x_e$.
  XOR‑система Tseitin задаётся уравнениями по модулю 2:
  $$\bigoplus_{e\ni v} x_e\ =\ \chi(v)\qquad\text{для всех }v\in V.$$
- `Утверждение:` Если для некоторой связной компоненты $H\subseteq G$ выполнено
  $\bigoplus_{v\in V(H)}\chi(v)=1$, то система (а значит и любая CNF/3‑CNF
  кодировка этих XOR‑ограничений) невыполнима.
- `Доказательство:` Возьмём XOR по всем вершинам $v\in V(H)$ от левых частей.
  Каждая переменная $x_e$ (для ребра $e$ внутри $H$) входит ровно дважды — по
  концам ребра — и потому сокращается: $\bigoplus_{v\in V(H)}\bigoplus_{e\ni v}x_e=0$.
  Тогда из уравнений следует $0=\bigoplus_{v\in V(H)}\chi(v)=1$, противоречие.
- `3‑CNF кодировка для 3‑регулярного $G$:` если $\deg(v)=3$ и инцидентные ребра
  имеют переменные $a,b,c$, то ограничение $a\oplus b\oplus c=\chi(v)$ эквивалентно
  3‑CNF из 4 клауз (запрещаем 4 несовпадающих по паритету тройки). Поэтому при
  3‑регулярном $G$ получаем 3‑CNF размера $4|V|$, и каждая переменная $x_e$ входит
  ровно в $8$ клауз (по $4$ у каждого конца ребра).
- `Toy‑тест:` одно ребро $e=\{u,v\}$ и $\chi(u)=1,\chi(v)=0$ даёт систему
  $x_e=1$ и $x_e=0$ (явная невыполнимость); паритетный аргумент выше ровно это
  фиксирует как $\chi(u)\oplus\chi(v)=1$.
- `Статус:` доказано (паритетный инвариант) + явная 3‑CNF для $\Delta=3$.
- `Барьер‑чек:` r — применимо (тривиально релятивизируется), NP — неприменимо
  (нет «natural property»), alg — неприменимо.
- `Следующий шаг:` зафиксировать в основном тексте, что это даёт семейство
  невыполнимых 3‑CNF с bounded‑occ на 3‑регулярных экспандерах, и привязать
  к известным резолюционным нижним оценкам (через экспансию/ширину).

### 16.86. Исследовательский шаг: экспансия ⇒ ширина/размер резолюции для Tseitin на bounded‑degree графах

- `Линза:` Трейд-офф.
- `Утверждение:` Пусть $G=(V,E)$ — связный граф максимальной степени $\le k$, а
  $e(G):=\min_{A\subseteq V,\ |V|/3\le |A|\le 2|V|/3}|E(A,\bar A)|$ — его экспансия
  (Itsykson–Oparin 2013, Def. 2). Если Tseitin($G,\chi$) невыполнима, то ширина
  резолюционного опровержения удовлетворяет $W(\mathrm{Tseitin}(G,\chi)\vdash 0)\ge e(G)-1$
  (Itsykson–Oparin 2013, Cor. 1). Тогда по trade‑off “width ⇒ size”
  (Ben‑Sasson–Wigderson 2001; также сформулировано как Thm. 1 в Itsykson–Oparin 2013)
  получаем для числа переменных $n:=|E|$ (где $S$ — размер dag‑resolution, а $ST$ — размер tree‑like resolution):
  $$S(\mathrm{Tseitin}(G,\chi))\ \ge\ \exp\!\left(\Omega\!\left(\frac{(e(G)-k-1)^2}{n}\right)\right),\qquad
    ST(\mathrm{Tseitin}(G,\chi))\ \ge\ 2^{\,e(G)-k-1}.$$
  В частности, для семейства графов степени $O(1)$ с $e(G)=\Omega(|V|)$ (экспандеры)
  имеем $n=\Theta(|V|)$ и потому $S\ge \exp(\Omega(|V|))$.
- `Toy‑тест:` цикл $C_n$ имеет $e(C_n)=2$, значит оценка даёт лишь константную
  нижнюю границу на ширину/размер; это согласуется с тем, что “плохая” экспансия
  не должна давать сильных нижних оценок.
- `Статус:` доказано (цитата Cor. 1 + стандартный width–size trade‑off).
- `Барьер‑чек:` r — неприменимо (модель‑специфическая нижняя оценка),
  NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` применить к 3‑регулярным экспандерам и 3‑CNF кодировке из §16.85,
  чтобы получить явное семейство bounded‑occ 3‑CNF с экспоненциальной резолюцией.

### 16.87. Исследовательский шаг: явное bounded‑occ Tseitin‑семейство на 3‑регулярных экспандерах

- `Линза:` Эквивалентность.
- `Утверждение:` Существует сильно‑явное семейство 3‑регулярных экспандеров
  $\{G_n\}$ с $\lambda(G_n)\le \lambda_0<1$ (например, семейство Ramanujan‑графов;
  см. обсуждение в `../../resources/downloads/arora_barak.pdf`, §16.3, Remark 16.10).
  Тогда по связи спектральной и комбинаторной экспансии (Arora–Barak, Thm. 16.18)
  имеем $|E(A,\bar A)|\ge \rho d|A|$ для всех $|A|\le |V|/2$ и некоторой константы
  $\rho>0$, откуда $e(G_n)=\Omega(|V_n|)$ в смысле Def. 2 из Itsykson–Oparin.
  Пусть $\chi_n$
  имеет нечётную сумму зарядов, и $F_n$ — 3‑CNF кодировка Tseitin($G_n,\chi_n$) из §16.85.
  Тогда:
  (i) $F_n$ невыполнима; (ii) $|F_n|=\Theta(|V_n|)$; (iii) bounded‑occ = 8;
  (iv) размер резолюционного опровержения $S(F_n)=\exp(\Omega(|V_n|))$ (по §16.86).
- `Toy‑тест:` если $G$ — цикл, то $e(G)=2$ и §16.86 даёт лишь константные границы;
  на экспандере $e(G)=\Omega(|V|)$ и при $|E|=\Theta(|V|)$ получаем экспоненту
  $\Omega(|V|)$ в нижней оценке на $S(F)$.
- `Статус:` доказано (композиция 16.85 + 16.86 + существование expander family).
- `Барьер‑чек:` r — неприменимо (модель‑специфическая нижняя оценка),
  NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` уточнить/зафиксировать конкретную ссылку на выбранную явную
  3‑регулярную expander family (по необходимости) и отметить, какие системы
  доказательств (PC/EF) остаются открытыми на этих формулах.

### 16.88. Исследовательский шаг: Tseitin легко в EF; PC зависит от поля/базиса

- `Линза:` Алгебраизация.
- `Утверждение:` Пусть $G$ связен и $\bigoplus_{v\in V}\chi(v)=1$. Тогда 3‑CNF
  кодировка $F=\mathrm{TseitinCNF}(G,\chi)$ из §16.85 имеет полиномиальное
  опровержение в Extended Frege (EF), так как
  противоречие даёт суммирование XOR‑уравнений по модулю 2. Для Polynomial
  Calculus: над полем характеристики 2 соответствующая линейная система
  опровергается в степени 1; над $\mathrm{char}(F)\ne 2$ в Fourier‑базисе известны
  линейные degree‑нижние оценки (Beame–Sabharwal 2000, Thm. 2.18).
- `Доказательство (EF‑каркас):`
  Обозначим $a\oplus b := (a\wedge\neg b)\vee(\neg a\wedge b)$.
  Тождества ассоциативности/коммутативности и сокращения
  $a\oplus(a\oplus b)\leftrightarrow b$, $a\oplus a\leftrightarrow 0$
  имеют константный размер (3 переменные) ⇒ константные Frege‑выводы.
  Для каждой вершины $v$ степени 3, с инцидентными рёбрами $e_1,e_2,e_3$,
  4 клаузы из §16.85 эквивалентны формуле
  $$(x_{e_1}\oplus x_{e_2}\oplus x_{e_3})\leftrightarrow \chi(v)$$
  (проверка 8 значений; константный вывод).
  В EF введём extension‑переменные $p_v\leftrightarrow (x_{e_1}\oplus x_{e_2}\oplus x_{e_3})$
  и $P\leftrightarrow\bigoplus_{v\in V} p_v$ (цепочка/дерево XOR, размер $O(|V|)$).
  Из предыдущего получаем $P\leftrightarrow\bigoplus_v\chi(v)$, а значит $P$.
  С другой стороны, подставляя определения $p_v$ и используя локальные
  перестановки/скобки XOR (полиномиально много шагов), получаем
  $$P\leftrightarrow\bigoplus_{v\in V}\ \bigoplus_{e\ni v} x_e\ \leftrightarrow\ \bigoplus_{e\in E}(x_e\oplus x_e)\ \leftrightarrow\ 0,$$
  противоречие.
- `Ссылка (EF ⊢ XOR/Gauss):` отмечено, что EF «легко симулирует Gaussian elimination»
  (и потому полиномиально доказывает линейно‑алгебраические утверждения),
  см. Bonet–Buss–Pitassi 2002, `../../resources/downloads/bonet_buss_pitassi_2002_hard_examples_frege.pdf` (p. 7).
- `PC‑заметка:` Если рассматривать Tseitin как линейную систему над $\mathbb F_2$,
  $$\sum_{e\ni v} x_e = \chi(v)\quad(\bmod 2),$$
  то в PC над $\mathbb F_2$ опровержение получается в степени 1: суммируем
  уравнения по $v\in V$, получаем $0=\bigoplus_v\chi(v)=1$.
- `Известный факт (PC, $\mathrm{char}(F)\ne 2$):` для любой последовательности bounded‑degree
  графов $\{G_n\}$ с $c(G_n)=\Omega(1)$ (экспандеры) любая PC‑рефутация
  $\mathrm{Tseitin}(G_n)$ над полем нечётной или нулевой характеристики имеет степень
  $\Omega(|V_n|)$, а по связи degree→size также размер $\exp(\Omega(|V_n|))$
  (Razborov 2023, Thm. 6.8 + абзац после Thm. 6.9).
- `Toy‑тест:` $G=C_3$ и $\chi\equiv 1$. Сумма трёх уравнений даёт
  $(x_{12}\oplus x_{12})\oplus(x_{23}\oplus x_{23})\oplus(x_{31}\oplus x_{31})=1$,
  то есть $0=1$.
- `Статус:` EF‑верхняя оценка — доказано как схема; для PC над $\mathbb F_2$ — доказано;
  для $\mathrm{char}(F)\ne 2$ степень и размер — известные нижние оценки (см. факт выше).
- `Барьер‑чек:` r — неприменимо (утверждение про конкретные proof‑системы),
  NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` см. §16.89 (клаузная форма TseitinCNF легко в PC над $\mathbb F_2$);
  дальше — понять, переносится ли (и как) degree‑LB для $\mathrm{char}(F)\ne 2$ с XOR‑системы
  на 3‑CNF кодировку.

### 16.89. Исследовательский шаг: TseitinCNF легко в PC над $\mathbb F_2$ (степень 3)

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G$ — 3‑регулярный граф, $\chi:V\to\{0,1\}$ и
  $\bigoplus_{v\in V}\chi(v)=1$. Пусть $F=\mathrm{TseitinCNF}(G,\chi)$ — 3‑CNF из §16.85.
  Тогда над полем $\mathbb F_2$ существует Polynomial Calculus‑рефутация $F$ степени $\le 3$
  и размера $O(|V|)$.
- `Доказательство (локальная линейная форма):`
  Переводим клаузу $(\ell_1\vee \ell_2\vee \ell_3)$ в полиномиальное уравнение
  $$(1-\ell_1)(1-\ell_2)(1-\ell_3)=0,$$
  где литерал $\neg x$ интерпретируется как $1-x$ (булевы аксиомы $x^2-x=0$ не нужны).
  Зафиксируем вершину $v$ степени 3 с инцидентными рёбрами $e_1,e_2,e_3$ и обозначим
  $x_i:=x_{e_i}$.
  - Если $\chi(v)=1$, то 4 клаузы из §16.85 дают 4 аксиомы:
    $$(1-x_1)(1-x_2)(1-x_3)=0,\ (1-x_1)x_2x_3=0,\ x_1(1-x_2)x_3=0,\ x_1x_2(1-x_3)=0.$$
    Складывая их в $\mathbb F_2$, получаем $1+x_1+x_2+x_3=0$, то есть $x_1+x_2+x_3+\chi(v)=0$.
  - Если $\chi(v)=0$, то аналогично из 4 клауз получаем аксиомы:
    $$(1-x_1)(1-x_2)x_3=0,\ (1-x_1)x_2(1-x_3)=0,\ x_1(1-x_2)(1-x_3)=0,\ x_1x_2x_3=0,$$
    и их сумма равна $x_1+x_2+x_3=0$, то есть снова $x_1+x_2+x_3+\chi(v)=0$.

  Итак, для каждого $v$ выводится линейное уравнение
  $$\sum_{e\ni v} x_e\ +\ \chi(v)\ =\ 0\quad(\text{в }\mathbb F_2).$$
  Складывая эти уравнения по всем $v\in V$, получаем
  $$\sum_{v\in V}\sum_{e\ni v}x_e\ +\ \sum_{v\in V}\chi(v)=0.$$
  Каждая переменная $x_e$ входит в левую часть ровно дважды (по концам ребра), значит
  в $\mathbb F_2$ сокращается, и остаётся $\sum_v\chi(v)=0$, то есть $1=0$ — противоречие.
  Степень доказательства $\le 3$ (все клаузные аксиомы степени 3), число строк $O(|V|)$.
- `Toy‑тест:` $G=C_3$ и $\chi\equiv 1$. Для каждой вершины выводится линейное уравнение
  по трём рёбрам, сумма трёх уравнений даёт $1=0$.
- `Статус:` доказано (явный локальный вывод + суммирование по графу).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сформулировать такой же «локальный перевод» для $\mathrm{char}(F)\ne 2$
  (или найти ссылку), чтобы связать TseitinCNF с известными degree‑LB для PC.

### 16.90. Исследовательский шаг: TseitinCNF $\leftrightarrow$ биномиальная Tseitin в PC при $\mathrm{char}(F)\ne 2$

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $F$ — поле, $\mathrm{char}(F)\ne 2$, и $v$ — вершина степени 3
  с инцидентными переменными $x_1,x_2,x_3\in\{0,1\}$ и зарядом $\chi\in\{0,1\}$.
  Пусть 4 клаузы TseitinCNF($v$) — стандартная 3‑CNF кодировка ограничения
  $x_1\oplus x_2\oplus x_3=\chi$ (как в §16.85), переведённая в PC‑аксиомы вида
  $(1-\ell_1)(1-\ell_2)(1-\ell_3)=0$. Тогда:
  1) из этих 4 клауз в PC выводится одно уравнение степени 3
     $$X(x_1,x_2,x_3)-\chi=0,$$
     где
     $$X(x_1,x_2,x_3):=x_1+x_2+x_3-2(x_1x_2+x_1x_3+x_2x_3)+4x_1x_2x_3;$$
  2) при линейной замене $y_i:=1-2x_i$ это эквивалентно биномиальному уравнению
     $$y_1y_2y_3-(1-2\chi)=0\quad(\text{и }y_i^2-1=0);$$
  3) наоборот, из $X-\chi=0$ в PC выводятся все 4 клаузные аксиомы с константной
     потерей степени (≤6). Следовательно, для 3‑регулярных графов TseitinCNF и
     «биномиальная» Tseitin (Fourier/±1‑база) p‑эквивалентны по степени в PC.
     В частности, degree/size‑нижние оценки для биномиальной Tseitin при $\mathrm{char}(F)\ne 2$
     (Razborov 2023, Thm. 6.8; см. также Beame–Sabharwal 2000, Thm. 2.18) переносятся на TseitinCNF.

- `Доказательство (1, локально):`
  В $\mathbb F[x_1,x_2,x_3]/(x_i^2-x_i)$ каждая клаузная аксиома для вершины степени 3 —
  это индикатор запрещённого присваивания (моном степени 3 в литералах $x_i$ и $(1-x_i)$).
  Для $\chi=0$ запрещены 4 нечётные тройки, и сумма 4 индикаторов равна ровно $X$.
  Для $\chi=1$ запрещены 4 чётные тройки, и сумма индикаторов равна $1-X$.
  В обоих случаях из 4 равенств “индикатор = 0” выводится $X-\chi=0$
  (для $\chi=1$ умножением на $-1$).

- `Доказательство (2):`
  Раскрывая скобки,
  $$(1-2x_1)(1-2x_2)(1-2x_3)=1-2X(x_1,x_2,x_3).$$
  Поэтому
  $$y_1y_2y_3-(1-2\chi)=(1-2X)-(1-2\chi)=-2(X-\chi),$$
  то есть уравнения отличаются на ненулевой скаляр.

- `Доказательство (3, локально):`
  Пусть $m_{a_1a_2a_3}:=\prod_i (x_i)^{a_i}(1-x_i)^{1-a_i}$ — индикатор присваивания $(a_1,a_2,a_3)$.
  Если $(a_1\oplus a_2\oplus a_3)\ne\chi$, то на этом присваивании $X-\chi=\pm 1$, а на остальных
  $m_{a_1a_2a_3}=0$, значит в фактор‑алгебре тождественно
  $$(X-\chi)\,m_{a_1a_2a_3}=\pm m_{a_1a_2a_3}.$$
  Из $X-\chi=0$ по правилу умножения получаем $(X-\chi)m_{a_1a_2a_3}=0$, откуда $m_{a_1a_2a_3}=0$.
  Это ровно одна из 4 клауз TseitinCNF($v$). Степень: $\deg(X-\chi)\le 3$, $\deg(m)\le 3$, итого ≤6.

- `Toy‑тест:` $\chi=1$. Сумма 4 «чётных» индикаторов (000,011,101,110) равна $1-X$,
  значит из них следует $X-1=0$, а затем и $y_1y_2y_3+1=0$.
- `Статус:` доказано (локальная p‑эквивалентность по степени при $\mathrm{char}(F)\ne 2$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужно для основного текста, добавить 1‑строчную ремарку в 15.x:
  «при $\mathrm{char}(F)\ne 2$ TseitinCNF наследует PC degree/size‑LB через 16.90».

### 16.91. Исследовательский шаг: Tseitin имеет полиномиальные Frege‑опровержения (Urquhart 1987)

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G$ связен и $\bigoplus_{v\in V}\chi(v)=1$; пусть $\mathrm{TseitinCNF}(G,\chi)$ — клаузная
  форма уравнений по модулю 2 (как в §16.85 для $\deg(G)=3$, или в общем виде через $2^{\deg(v)-1}$ клауз на вершину).
  Тогда $\mathrm{TseitinCNF}(G,\chi)$ имеет полиномиальное опровержение в обычном Frege (в частности,
  в «Kleene’s axiomatic system», т.е. Hilbert‑style propositional calculus): Urquhart (1987) даёт
  явный вывод длины $O(n^4)$ (где $n=\Theta(|V|)$ при bounded‑degree).
- `Доказательство (идея из Urquhart 1987, Lemma 6.1):`
  1) для каждой вершины $v$ из клаузы‑кодировки восстанавливается соответствующее XOR‑уравнение
     (у Urquhart — «biconditional»/эквивалентность, фиксирующая чётность литералов у вершины);
  2) эти эквивалентности «склеиваются» в одно большое выражение; затем с помощью
     ассоциативности/коммутативности «всплывают» парные вхождения переменных и сокращаются;
  3) остаётся противоречие, так как левая часть сокращается в $0$, а правая даёт
     $\bigoplus_v\chi(v)=1$.
  Подробности: Urquhart 1987, §6, Lemma 6.1, `../../resources/downloads/urquhart_1987_hard_examples_resolution.pdf`.
- `Toy‑тест:` $G=C_3$, $\chi\equiv 1$: три локальные XOR‑уравнения суммируются в $0=1$
  (см. также toy‑тест в §16.88).
- `Статус:` доказано (верхняя оценка/ссылка).
- `Барьер‑чек:` r — неприменимо (это верхняя оценка в фиксированной модели доказательств),
  NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` уточнить «минимальную глубину» полиномиальных Frege‑опровержений Tseitin:
  зафиксировать лучшую известную depth‑vs‑size оценку (ссылка на работу уровня Håstad’17/18 и/или последующие усиления).

### 16.92. Исследовательский шаг: depth‑vs‑size для Tseitin(Grid) в bounded‑depth Frege (Håstad 2020)

- `Линза:` Трейд‑офф.
- `Утверждение:` Рассмотрим Tseitin‑противоречие на $n\times n$ решётке (grid).
  Если $d\le \frac{\log n}{59\log\log n}$, то любая depth‑$d$ Frege‑рефутация имеет размер
  $\exp(\Omega(n^{1/(58(d+1))}))$ (Håstad 2020, Thm. 6.5; `../../resources/downloads/hastad_2020_small_depth_frege_tseitin_grids.pdf`).
  В частности, любая полиномиальная
  по $n$ (а значит и по числу переменных $N=\Theta(n^2)$) Frege‑рефутация требует формул глубины
  $\Omega(\log n/\log\log n)$ (Håstad 2020, Cor. 6.6).
- `Toy‑тест:` при константной глубине $d=O(1)$ получаем superpolynomial нижнюю оценку
  $\exp(\Omega(n^{\Omega(1)}))=\exp(\Omega(N^{\Omega(1)}))$ для Tseitin(Grid$_{n,n}$).
- `Статус:` известный факт (точная ссылка).
- `Барьер‑чек:` r — неприменимо (нижняя оценка для ограниченной модели доказательств),
  NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сопоставить с «верхней» оценкой $O(\log n)$ глубины для poly‑size Frege‑рефутаций Tseitin
  (Buss‑style счёт/паритет) и зафиксировать, насколько tight остаётся разрыв $O(\log\log n)$.

### 16.93. Исследовательский шаг: верхняя оценка $O(\log n)$ глубины для poly‑size Frege на Tseitin (bounded‑degree)

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Для Tseitin‑противоречия на любом bounded‑degree графе (клаузная форма паритетных уравнений)
  существует полиномиальный по $n$ Frege‑вывод, использующий формулы глубины $O(\log n)$ в стандартном языке
  $L_\\in=\\{\\wedge,\\vee,\\neg\\}$.
- `Доказательство:` берём polynomial‑size Frege‑опровержение $\\pi$ из Urquhart (1987) (см. §16.91).
  Затем применяем к каждой линии $A$ из $\\pi$ Spira‑балансировку (Bonet–Buss 2002, Thm. 2; см. §16.94),
  получая эквивалентную формулу $A'$ глубины $O(\\log|A|)$ и размера $\\mathrm{poly}(|A|)$.
  По §16.114 для этой балансировки существуют polynomial‑size Frege‑доказательства тавтологий $A\\leftrightarrow A'$,
  а по §16.113 из $A$ и $A\\leftrightarrow A'$ выводится $A'$ с $O(1)$ дополнительными строками.
  Заменяя линии по индукции, получаем Frege‑опровержение $\\pi'$ той же CNF, где все линии имеют глубину $O(\\log n)$,
  а общий blow‑up остаётся полиномиальным (так как исходный размер $\\pi$ полиномиален по $n=\\Theta(|\\mathrm{TseitinCNF}(G,\\chi)|)$ при bounded‑degree).
- `Toy‑тест:` на цикле можно выписать balanced‑формулу для XOR всех уравнений и сократить парные вхождения рёбер,
  получая $0=1$ при нечётной сумме зарядов.
- `Статус:` доказано (через §16.91+§16.94+§16.113–§16.114).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, даёт ли верхняя оценка из 16.97 (GIRS’19, Thm. 19) polynomial‑size уже при глубине
  $\\Theta(\\log n/\\log\\log n)$ на решётках/экспандерах, и тем самым закрывает разрыв с 16.92.

### 16.94. Исследовательский шаг: балансовка формул ⇒ можно требовать глубину $O(\log n)$ в Frege

- `Линза:` Трейд‑офф.
- `Утверждение:` Любая булева формула размера $m$ эквивалентна формуле глубины $O(\log m)$
  (Brent/Spira restructuring). Точная ссылка: Bonet–Buss (2002), Theorem 2 (Spira),
  `../../resources/downloads/bonet_buss_2002_size_depth_tradeoffs_boolean_formulae.pdf`.
  Следовательно, если $\mathrm{TseitinCNF}(G,\chi)$ имеет polynomial‑size Frege‑рефутацию
  (16.91, Urquhart 1987), то можно считать, что все большие промежуточные формулы
  в этой рефутации сбалансированы до глубины $O(\log n)$ (с полиномиальным blow‑up),
  т.е. верхняя оценка $O(\log n)$ по глубине не требует отдельной «счётной» конструкции.
- `Toy‑тест:` длинная цепочка дизъюнкций/биимпликаций длины $m$ имеет глубину $\Theta(m)$,
  но после балансировки становится глубины $O(\log m)$.
- `Статус:` доказано (замена линий: §16.113; p‑доказательства эквивалентности для Spira‑балансировки: §16.114).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` использовать 16.94+16.95 как «чистую» верхнюю оценку по глубине и возвращаться к нижним оценкам (16.92, 16.97).

### 16.95. Исследовательский шаг: Urquhart‑Tseitin + Spira‑перевод ⇒ $O(\log n)$‑depth Frege (строго)

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть есть Frege‑опровержение формулы $\Phi$ в языке $L_\infty$, где в частности разрешены
  $\{\wedge,\oplus,\neg\}$ или $\{\equiv,\oplus\}$ (как в Urquhart 1987 для «biconditionals»).
  Тогда существует полиномиально по размеру доказательства Frege‑опровержение $\Phi'$ в стандартном языке
  $L_\in=\{\wedge,\vee,\neg\}$, причём перевод $\phi\mapsto\phi'$ устроен так, что:
  (i) $\phi'$ эквивалентна $\phi$ (по смыслу); (ii) глубина $\phi'$ равна $O(\log|\phi|)$ (Spira‑rebalancing);
  (iii) размер $\phi'$ полиномиален в $|\phi|$. Ссылка: Buss (1997), Theorem 3 + доказательство‑эскиз
  «indirect translation via Spira», `../../resources/downloads/buss_1997_proof_complexity_intro.pdf`.
  Следствие: для bounded‑degree $\mathrm{TseitinCNF}(G,\chi)$ (нечётная сумма зарядов) существует
  polynomial‑size Frege‑опровержение, использующее формулы глубины $O(\log n)$: берём
  Urquhart (1987) (16.91) и применяем перевод Buss’97/Spira.
- `Toy‑тест:` если делать «прямой перевод» $\phi_1\oplus\phi_2\mapsto(\phi_1\wedge\neg\phi_2)\vee(\neg\phi_1\wedge\phi_2)$
  рекурсивно по линейной глубине, то размер может стать экспоненциальным; Spira‑перевод
  «ре‑балансирует» дерево и держит размер полиномиальным (Buss’97, Proof sketch к Thm. 3).
- `Статус:` известный факт (закрыта техническая часть для 16.94/вопроса Q14).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` использовать это как «чистое» обоснование верхней оценки $O(\log n)$ по глубине и
  дальше улучшать нижние оценки (сужать разрыв с 16.92).

### 16.96. Исследовательский шаг: Tseitin на экспандерах — depth‑vs‑size (Pitassi–Rossman–Servedio–Tan 2016)

- `Линза:` Трейд‑офф.
- `Утверждение:` Существует линейного размера 3‑CNF‑противоречие $\mathrm{Tseitin}(G_n[\alpha])$
  на 3‑регулярном $n$‑вершинном экспандере, такое что для любого $d$ любая depth‑$d$ Frege‑рефутация
  имеет размер $n^{\Omega((\log n)/d^2)}$ (Pitassi–Rossman–Servedio–Tan 2016, Thm. 1,
  `../../resources/downloads/pitassi_rossman_servedio_tan_2016_expander_switching_lemma.pdf`).
  Следовательно, любая polynomial‑size Frege‑рефутация требует глубины $d=\Omega(\sqrt{\log n})$.
- `Toy‑тест:` если $d=O(1)$, то нижняя оценка даёт размер $\exp(\Omega((\log n)^2))=n^{\Omega(\log n)}$ (quasi‑poly),
  а если $d=\Theta(\sqrt{\log n})$, то показатель $(\log n)/d^2=\Theta(1)$ и оценка перестаёт быть superpolynomial.
- `Статус:` известный факт (точная ссылка).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сопоставить 16.96 (экспандер: $\sqrt{\log n}$) с 16.92 (grid: $\log n/\log\log n$)
  и понять, где именно “теряется” $\sqrt{\log n}\to\log n/\log\log n$ в технике ограничений.

### 16.97. Исследовательский шаг: treewidth даёт tight depth‑vs‑size для Tseitin в bounded‑depth Frege (Galesi–Itsykson–Riazanov–Sofronova 2019)

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — связный неориентированный граф на $n$ вершинах, $t=\mathrm{tw}(G)$, и $\mathrm{Tseitin}(G,f)$ невыполнима.
  Тогда существуют константы $K,C>0$ такие, что для любого $d\le K\log n/\log\log n - C$ любая depth‑$d$ Frege‑рефутация
  имеет размер $\ge 2^{t^{\Omega(1/d)}}$ (Galesi–Itsykson–Riazanov–Sofronova 2019, Thm. 18,
  `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`).
  Более того, для всех достаточно больших $d$ существует depth‑$d$ Frege‑рефутация размера $\le 2^{t^{O(1/d)}}\cdot\mathrm{poly}(|\mathrm{Tseitin}(G,f)|)$
  (там же, Thm. 19).
- `Toy‑тест:` если $\mathrm{tw}(G)=\Omega(n)$ (в частности, для bounded‑degree экспандеров, как отмечено в той же работе),
  то polynomial‑size ($n^{O(1)}$) возможно только при $d=\Omega(\log n/\log\log n)$ (по Thm. 18).
  При этом upper Thm. 19 записан в виде $2^{t^{O(1/d)}}\\cdot\\mathrm{poly}(|\\mathrm{Tseitin}(G,f)|)$ и корректен/информативен для фиксированного $d$.
  Если же $d$ растёт с $n$ (как в «пороговом» режиме $d\\approx\\log n/\\log\\log n$), то нужно отслеживать зависимость от $d$ в big‑O:
  явный unpack через Claim 28 даёт оценку $\\mathrm{poly}(|T|)\\cdot 2^{O(d\\cdot X^{2/d})}$ и на grid/экспандерах сертифицирует polynomial‑size
  лишь при глубине $d=\\Theta(\\log n)$ (см. §16.115–§16.121).
- `Статус:` известный факт (точная ссылка + уточнение про режим растущей глубины; обновляет вывод для Q15).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если понадобится связать с «поиском доказательств», извлечь Cor. 34 из той же работы:
  bounded‑depth Frege размера $S$ ⇒ tree‑like Resolution размера $2^{\mathrm{poly}(\log S)}$.

### 16.98. Исследовательский шаг: bounded‑depth Frege ⇒ tree‑like Resolution (quasi‑poly) для Tseitin (GIRS 2019, Cor. 34)

- `Линза:` Эквивалентность.
- `Утверждение:` Для любой невыполнимой Tseitin‑CNF $\mathrm{Tseitin}(G,f)$: если она имеет доказательство размера $S$
  в bounded‑depth Frege (в смысле статьи; ниже упоминается «constant‑depth Frege»), то она имеет tree‑like Resolution‑опровержение
  размера $\le 2^{\mathrm{poly}(\log S)}$ (Galesi–Itsykson–Riazanov–Sofronova 2019, Cor. 34,
  `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`).
- `Доказательство (эскиз из §5 той же работы):` там используется (i) верхняя оценка на tree‑like Resolution через ширину:
  по §16.99 (Beame–Beck–Impagliazzo 2016, Lemma 61) имеем $\mathrm{size}_{\mathrm{TL\text{-}Res}}\le n^{O(\mathrm{cw}(G))}$;
  по §16.100–16.101 (и определению $w(G):=W(T(G,\\varphi)\\vdash\\bot)-1$) получаем $\mathrm{cw}(G)\le w(G)+2$, значит
  $\mathrm{size}_{\mathrm{TL\text{-}Res}}(T(G,\\varphi))\le n^{O(w(G))}=2^{O(\mathrm{tw}(G)\,\Delta(G)\,\log n)}$
  (Harvey–Wood 2014, (2); см. §16.102); (ii) нижняя оценка из главной теоремы для bounded‑depth Frege: $S\ge 2^{\mathrm{tw}(G)^{\varepsilon}}$
  для некоторой константы $\varepsilon>0$ (глубина фиксирована); (iii) тривиально $S\ge|\mathrm{Tseitin}(G,f)|\ge 2^{\Delta(G)-1}$ и $S\ge n$.
  Отсюда $\mathrm{tw}(G)\le (\log S)^{1/\varepsilon}$, $\Delta(G)\le O(\log S)$ и $\log n\le O(\log S)$, и подстановка в (i)
  даёт $2^{O((\log S)^{1/\varepsilon+2})}=2^{\mathrm{poly}(\log S)}$.
- `Toy‑тест:` если $S=n^{O(1)}$, то получаем tree‑like Resolution размера $\le 2^{\mathrm{poly}(\log n)}=n^{\mathrm{polylog}\,n}$ (quasi‑poly).
- `Статус:` известный факт (точная формулировка + минимальный вывод «откуда берётся» $2^{\mathrm{poly}(\log S)}$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` при необходимости перенести цепочку §16.99–16.102 (определение $w(G)$ и $n^{O(w(G))}$) в основной текст
  рядом с формулировкой Cor. 34, чтобы не ссылаться на «см. обсуждение».

### 16.99. Исследовательский шаг: tree‑like Resolution‑upper bound для Tseitin через carving width (Beame–Beck–Impagliazzo 2016)

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — граф на $n$ вершинах с carving width $W$ (Definition 58). Тогда соответствующая
  Tseitin‑таутология $\tau(G)$ имеет tree‑like resolution‑рефутацию ранга $\le W\log_{3/2} n$; в частности,
  существует tree‑like resolution‑рефутация размера $\le n^{O(W)}$ и clause space $\le W\log_{3/2} n+1$
  (Beame–Beck–Impagliazzo 2016, Lemma 61,
  `../../resources/downloads/beame_beck_impagliazzo_2016_time_space_tradeoffs_resolution.pdf`).
- `Toy‑тест:` при $W=O(1)$ получаем polynomial‑size tree‑like resolution для $\tau(G)$ (и глубину дерева $O(\log n)$);
  при каждом рекурсивном разрезе по (1/3,2/3)-лемме ранг увеличивается на $\le W$, а высота рекурсии равна $\log_{3/2} n$.
- `Статус:` известный факт (точная ссылка; закрывает «где именно берётся» tree‑like upper bound, т.е. компонент [3] в GIRS’19 Cor. 34).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` связать параметр $W$ (carving width) с $w(G)$ из GIRS’19 (минимальная resolution‑width для Tseitin)
  и выписать минимальную цепочку неравенств, нужную для $n^{O(w(G))}$.

### 16.100. Исследовательский шаг: carving width $\le \mathrm{tw}(L(G))+1$ (и значит $n^{O(W)}=n^{O(w(G))}$)

- `Линза:` Эквивалентность.
- `Утверждение:` Для любого графа $G$ выполнено $\mathrm{cw}(G)\le \mathrm{tw}(L(G))+1$, где $\mathrm{cw}$ — carving width,
  а $L(G)$ — line graph. Следовательно, используя формулу для Tseitin‑width
  $w(G)=\max\{\Delta(G),\mathrm{tw}(L(G))\}-1$ (Galesi–Talebanfard–Torán 2018, Cor. 8+16,
  `../../resources/downloads/galesi_talebanfard_toran_2018_cops_robber_tseitin.pdf`), получаем $\mathrm{cw}(G)\le w(G)+2$, и верхняя оценка
  из §16.99 вида $n^{O(\mathrm{cw}(G))}$ эквивалентна $n^{O(w(G))}$.
- `Доказательство:` Пусть $(T,\{B_t\})$ — tree decomposition графа $L(G)$ ширины $k=\mathrm{tw}(L(G))$,
  т.е. $|B_t|\le k+1$.
  Для вершины $v\in V(G)$ множество рёбер $E(v)$ образует клику в $L(G)$, значит (по свойству Helly для поддеревьев в $T$)
  существует узел $t_v\in V(T)$ такой, что $E(v)\subseteq B_{t_v}$.
  Добавим к $T$ лист $\ell_v$ с ребром $\ell_v t_v$ и положим $\chi(\ell_v)=v$; получаем carving‑дерево
  (при необходимости его можно сделать бинарным стандартным «раздвоением» узлов копиями того же bag — ширина не растёт).
  Рассмотрим ребро $xy$ этого дерева и индуцированный разрез $V(G)=A\sqcup B$ по листьям.
  Если $xy=\ell_v t_v$, то $|E(A,B)|=\deg(v)\le |B_{t_v}|\le k+1$.
  Иначе $xy$ соединяет два bag‑узла: если $uv\in E(A,B)$, то в $L(G)$ вершина $e=\{u,v\}$ лежит и в $B_{t_u}$, и в $B_{t_v}$,
  значит её множество появлений в tree decomposition — связное поддерево, содержащее путь $t_u\leadsto t_v$ и, в частности, ребро $xy$.
  Следовательно, $e\in B_x\cap B_y$, то есть $E(A,B)\subseteq B_x\cap B_y$ и $|E(A,B)|\le |B_x\cap B_y|\le k+1$.
  Значит ширина построенной carving‑декомпозиции $\le k+1$, т.е. $\mathrm{cw}(G)\le \mathrm{tw}(L(G))+1$.
- `Toy‑тест:` для цикла $C_n$: $\mathrm{tw}(L(C_n))=2$, поэтому $\mathrm{cw}(C_n)\le 3$ (на деле $\mathrm{cw}(C_n)=2$);
  для звезды $K_{1,n}$: $\mathrm{tw}(L)=n-1$ и $\mathrm{cw}(K_{1,n})=n=\mathrm{tw}(L)+1$.
- `Статус:` доказано.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` теперь, когда первоисточник $w(G)=\max\{\Delta(G),\mathrm{tw}(L(G))\}-1$ зафиксирован (16.101),
  обновить цепочку в §16.98/Cor. 34: tree‑like upper bound $n^{O(\mathrm{cw}(G))}$ можно заменить на $n^{O(w(G))}$ без ссылочных дыр.

### 16.101. Исследовательский шаг: точная ссылка на $w(G)=\max\{\\Delta(G),\\mathrm{tw}(L(G))\\}-1$ для Tseitin‑width

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G$ — связный граф, а $\\varphi$ — нечётная разметка (odd marking), так что Tseitin‑CNF $T(G,\\varphi)$ невыполнима.
  Тогда минимальная ширина резолюционного опровержения удовлетворяет
  $$W(T(G,\\varphi)\\vdash\\bot)=\\max\\{\\Delta(G),\\mathrm{tw}(L(G))\\},$$
  где $\\Delta(G)$ — максимальная степень, $L(G)$ — line graph. В обозначениях GIRS’19 (Cor. 33),
  где $w(G)=W(T(G,\\varphi)\\vdash\\bot)-1$, получаем
  $$w(G)=\\max\\{\\Delta(G),\\mathrm{tw}(L(G))\\}-1.$$
- `Доказательство (по источнику):` Galesi–Talebanfard–Torán (2018) доказывают (i) Cor. 8:
  $W(T(G,\\varphi)\\vdash\\bot)=\\max\\{\\Delta(G),\\mathrm{ec}(G)-1\\}$, и (ii) Cor. 16:
  $\\mathrm{ec}(G)=\\mathrm{tw}(L(G))+1$; подстановка даёт требуемую формулу.
  См. `../../resources/downloads/galesi_talebanfard_toran_2018_cops_robber_tseitin.pdf`.
- `Toy‑тест:` для звезды $K_{1,n}$ имеем $\\Delta=n$ и $L(G)=K_n$ с $\\mathrm{tw}(K_n)=n-1$,
  значит $W=\\max\\{n,n-1\\}=n$ (и $w=n-1$), что согласуется с тем, что начальные клаузы имеют ширину $n$.
  Для цикла $C_n$: $\\Delta=2$ и $L(C_n)=C_n$ с $\\mathrm{tw}=2$, поэтому $W=2$ (и $w=1$).
- `Статус:` известный факт (точная ссылка; закрывает Q19).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сопоставить эту treewidth‑формулу с альтернативной параметризацией Tseitin‑width через branch‑width
  из Alekhnovich–Razborov (2011) (возможная замена $\\mathrm{tw}(L(G))$ на эквивалентную «ширину»).

### 16.102. Исследовательский шаг: $n^{O(w(G))}=2^{O(\\mathrm{tw}(G)\\,\\Delta(G)\\log n)}$ (через оценки на $\\mathrm{tw}(L(G))$)

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — связный граф на $n$ вершинах и $\\varphi$ — нечётная разметка, так что Tseitin‑CNF $T(G,\\varphi)$ невыполнима.
  Обозначим $w(G):=W(T(G,\\varphi)\\vdash\\bot)-1$. Тогда
  $$n^{O(w(G))}=2^{O(\\mathrm{tw}(G)\\,\\Delta(G)\\log n)}.$$
- `Доказательство:` По §16.101 имеем $w(G)+1=\\max\\{\\Delta(G),\\mathrm{tw}(L(G))\\}$.
  По Harvey–Wood (2014), неравенство (2), $\\mathrm{tw}(L(G))\\le (\\mathrm{tw}(G)+1)\\Delta(G)-1$
  (`../../resources/downloads/harvey_wood_2014_treewidth_line_graphs.pdf`).
  Следовательно $w(G)=O(\\mathrm{tw}(G)\\,\\Delta(G))$ и потому
  $$n^{O(w(G))}=2^{O(w(G)\\log n)}=2^{O(\\mathrm{tw}(G)\\,\\Delta(G)\\log n)}.$$
- `Toy‑тест:` для звезды $K_{1,n}$: $\\mathrm{tw}(G)=1$, $\\Delta(G)=n$, и формула даёт $2^{O(n\\log n)}$, что согласуется с $n^{O(w)}$ при $w=n-1$ (16.101).
- `Статус:` доказано (вывод из известных фактов).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обновить формулировку в §16.98/Cor. 34, чтобы $2^{O(\\mathrm{tw}(G)\\Delta(G)\\log n)}$ появлялось с явной ссылкой (закрыть Q20).

### 16.103. Исследовательский шаг: Tseitin‑width через branch‑width гиперграфа (Alekhnovich–Razborov 2011)

- `Линза:` Эквивалентность.
- `Утверждение:` Для любого связного графа $G$ и нечётной разметки $\sigma$ (так что Tseitin‑CNF $T(G,\sigma)$ невыполнима)
  branch‑width $\\mathrm{wb}(T(G,\\sigma))$ её «подлежащего гиперграфа» $H_{T(G,\\sigma)}$ удовлетворяет
  $$\\mathrm{wb}(T(G,\\sigma))=\\Theta\\bigl(W(T(G,\\sigma)\\vdash\\bot)\\bigr),$$
  где $W(F\\vdash\\bot)$ — минимальная resolution‑width (Alekhnovich–Razborov 2011, Thm. 2.12,
  `../../resources/downloads/alekhnovich_razborov_2011_satisfiability_branchwidth_tseitin.pdf`).
  При этом $H_{T(G,\\sigma)}$ совпадает с двойственным гиперграфом $G^*$ (с повторениями гиперрёбер), см. Remark 2.11 там же.
  Повторы гиперрёбер не меняют $\\mathrm{wb}$ для этого случая, см. §16.106.
  В частности, вместе с точной формулой §16.101 получаем сравнение
  $$\\mathrm{wb}(T(G,\\sigma))=\\Theta\\bigl(\\max\\{\\Delta(G),\\mathrm{tw}(L(G))\\}\\bigr).$$
- `Toy‑тест:` для $K_{1,n}$ имеем $W=n$ (16.101) и $\\mathrm{wb}=\\Theta(n)$ по Thm. 2.12; для $C_n$ имеем $W=2$ и $\\mathrm{wb}=\\Theta(1)$.
- `Статус:` известный факт (точная ссылка; закрывает Q21).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужно использовать без $\\Theta(\\cdot)$, извлечь из доказательства Thm. 2.12 явные константы в обе стороны (см. Q22).

### 16.104. Исследовательский шаг: явные константы в $\\mathrm{wb}(T(G,\\sigma))=\\Theta(W(T(G,\\sigma)\\vdash\\bot))$

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G$ — связный граф и $T(G,\\sigma)$ — соответствующая невыполнимая Tseitin‑CNF. Обозначим
  $$W:=W(T(G,\\sigma)\\vdash\\bot),\\qquad B:=\\mathrm{wb}(T(G,\\sigma)),$$
  где $W$ — минимальная resolution‑width, $B$ — branch‑width подлежащего гиперграфа (AR’11 Remark 2.11). Тогда выполнены явные неравенства
  $$\\frac{1}{8}B\\ \\le\\ W\\ \\le\\ 2B.$$
- `Доказательство (из AR’11, §4):`
  1) (Gaussian width) Пусть $w_g(G,\\sigma)$ — минимальная ширина Gaussian‑рефутации (Def. 4.2). Тогда по Prop. 4.3
     $$\\tfrac12 W\\le w_g(G,\\sigma)\\le W.$$
  2) (Branch‑width vs Gaussian width) В доказательстве Lemma 4.4 показано, что $B\\ge w_g(G,\\sigma)$ (tree‑like restriction),
     а «алгоритм Figure 3.1 + obstacle‑аргумент» даёт $B\\le 8\\,w_g(G,\\sigma)$ (повторяется оценка из доказательства Lemma 3.1).
     Следовательно $w_g(G,\\sigma)\\le B\\le 8w_g(G,\\sigma)$.
  3) Комбинируя 1)–2), получаем $W\\le 2w_g\\le 2B$ и $B\\le 8w_g\\le 8W$, т.е. $B/8\\le W\\le 2B$.
  Ссылки: `../../resources/downloads/alekhnovich_razborov_2011_satisfiability_branchwidth_tseitin.pdf`.
- `Toy‑тест:` для $K_{1,n}$ (16.101) $W=n$ и $B\\ge r(H)=n$, поэтому $B/8\\le W\\le 2B$ выполняется; для $C_n$ имеем $W=2$ и $B=\\Theta(1)$.
- `Статус:` доказано (из явных констант в AR’11).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если хочется убрать константу 8, проверить, можно ли в Lemma 4.4 получить $B\\le c\\,w_g$ с меньшим $c$ (или равенство) для $G^*$.

### 16.105. Исследовательский шаг: $\\mathrm{wb}(G^*)=\\mathrm{cw}(G)$ (branch‑width двойственного гиперграфа = carving width)

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G=(V,E)$ — связный граф, а $G^*$ — его двойственный гиперграф с множеством вершин $E$ и гиперрёбрами
  $E(v)=\\{e\\in E: e\\text{ инцидентно }v\\}$ для $v\\in V$. Тогда
  $$\\mathrm{wb}(G^*)=\\mathrm{cw}(G),$$
  где $\\mathrm{wb}$ — branch‑width гиперграфа (AR’11, Def. 2.1), а $\\mathrm{cw}$ — carving width графа $G$ (как в §16.99–16.100).
- `Доказательство:` В branch‑decomposition гиперграфа $G^*$ листья соответствуют гиперрёбрам $E(v)$, то есть вершинам $v\\in V$.
  Пусть $(T,\\theta)$ — branch‑decomposition $G^*$. Определим разметку листьев $\\chi: \\mathrm{Leaves}(T)\\to V$ как $\\chi(\\theta(E(v)))=v$.
  Рассмотрим любой ненулевой узел $t$ дерева (т.е. $t\\ne\\mathrm{root}$) и пусть $S_t\\subseteq V$ — множество вершин, чьи листья лежат в поддереве $t$.
  Тогда по определению AR’11 (Def. 2.1) имеем
  $$\\mathrm{Cut}(t)=\\Bigl(\\bigcup_{v\\in S_t}E(v)\\Bigr)\\cap\\Bigl(\\bigcup_{v\\notin S_t}E(v)\\Bigr)=\\delta_G(S_t),$$
  то есть множество рёбер графа $G$, пересекающих разрез $S_t\\sqcup(V\\setminus S_t)$.
  Поэтому порядок узла $t$ равен $|\\delta_G(S_t)|$.
  Замечая, что каждому узлу $t\\ne\\mathrm{root}$ соответствует ребро $t\\text{--parent}(t)$, получаем carving‑декомпозицию $G$ на том же дереве $T$
  (игнорируя ориентацию): ширина разреза на ребре $t\\text{--parent}(t)$ равна $|\\delta_G(S_t)|=|\\mathrm{Cut}(t)|$.
  Отсюда $\\mathrm{cw}(G)\\le \\mathrm{wb}(G^*)$.

  В обратную сторону: из любой carving‑декомпозиции $(T,\\chi)$ графа $G$ (листья помечены вершинами) строим branch‑decomposition $G^*$,
  положив $\\theta(E(v)):=\\chi^{-1}(v)$. Для узла $t\\ne\\mathrm{root}$ множество $S_t$ листьев в поддереве снова задаёт разрез вершин,
  и та же формула показывает $\\mathrm{Cut}(t)=\\delta_G(S_t)$. Значит ширины совпадают на каждом соответствующем разрезе, и
  $\\mathrm{wb}(G^*)\\le \\mathrm{cw}(G)$.
  Совместно: $\\mathrm{wb}(G^*)=\\mathrm{cw}(G)$.
- `Toy‑тест:` для звезды $K_{1,n}$: $\\mathrm{cw}(K_{1,n})=n$ (любой разрез, отделяющий центр от листа, режет $n$ рёбер) и $G^*$ имеет гиперрёбра
  размеров $n$ и $1$, так что $\\mathrm{wb}(G^*)=n$; для цикла $C_n$: $\\mathrm{cw}(C_n)=2$ и $\\mathrm{wb}(C_n^*)=2$.
- `Статус:` доказано (закрывает Q23).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` использовать $\\mathrm{wb}(G^*)=\\mathrm{cw}(G)$, чтобы переписать AR‑параметры для Tseitin (Remark 2.11) напрямую через carving width,
  и сравнить с treewidth‑формулой §16.101.

### 16.106. Исследовательский шаг: повторы гиперрёбер в $G^*$ не меняют $\\mathrm{wb}$ (для применения Remark 2.11)

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G=(V,E)$ — связный граф без петель. Обозначим двойственный гиперграф
  $$G^* := \\bigl(E,\\ \\{E(v): v\\in V\\}\\bigr),\\qquad E(v):=\\{e\\in E: e\\text{ инцидентно }v\\}.$$
  Пусть $\\widetilde G^*$ — мультигиперграф на том же множестве вершин $E$, в котором каждое гиперребро $E(v)$ повторено $m_v\\ge 1$ раз.
  Тогда
  $$\\mathrm{wb}(\\widetilde G^*)=\\mathrm{wb}(G^*).$$
  В частности, по AR’11 Remark 2.11 подлежащий гиперграф Tseitin‑CNF $T(G,\\sigma)$ — это ровно $\\widetilde G^*$ при $m_v=2^{\\deg_G(v)-1}$, и потому
  $$\\mathrm{wb}(T(G,\\sigma))=\\mathrm{wb}(H_{T(G,\\sigma)})=\\mathrm{wb}(G^*).$$
- `Доказательство:`
  1) (**Монотонность по удалению гиперрёбер.**) Если $H'=(V,E')$ получается из $H=(V,E)$ удалением гиперрёбер (подмультисет $E'\\subseteq E$),
     то $\\mathrm{wb}(H')\\le \\mathrm{wb}(H)$.
     Действительно, возьмём branch‑decomposition $(T,\\theta)$ для $H$.
     Рассмотрим минимальное поддерево $T'\\subseteq T$, натянутое на листья $\\theta(E')$,
     и подавим в нём все вершины степени 2 (получая снова бинарное корневое дерево) — это даёт branch‑decomposition для $H'$.
     Для каждого узла $t$ в новом дереве множества гиперрёбер‑потомков на обеих сторонах разреза — подмножества соответствующих множеств в $T$,
     поэтому $V(t)$ и $V^\\perp(t)$ только уменьшаются, а значит $|\\mathrm{Cut}(t)|=|V(t)\\cap V^\\perp(t)|$ не растёт.
  2) (**Нижняя оценка $\\mathrm{wb}(G^*)\\ge \\Delta(G)$.**) Для любого $v\\in V$ и любого branch‑decomposition $(T,\\theta)$ гиперграфа $G^*$
     лист $t_v:=\\theta(E(v))$ имеет
     $$\\mathrm{Cut}(t_v)=E(v)\\cap\\bigcup_{u\\ne v}E(u)=E(v),$$
     поскольку каждое ребро $e\\in E(v)$ также инцидентно некоторому $u\\ne v$ (нет петель).
     Следовательно, порядок листа равен $|E(v)|=\\deg_G(v)$, и потому $\\mathrm{wb}(G^*)\\ge \\max_v \\deg_G(v)=\\Delta(G)$.
  3) (**Строим декомпозицию для $\\widetilde G^*$.**) Пусть $(T,\\theta)$ — оптимальная branch‑decomposition $G^*$ ширины $w:=\\mathrm{wb}(G^*)$.
     Для каждого $v\\in V$ заменим лист $\\theta(E(v))$ на бинарное поддерево с $m_v$ листьями,
     помеченными $m_v$ копиями гиперребра $E(v)$ (корень поддерева занимает место старого листа).
     Получим branch‑decomposition $(\\widetilde T,\\widetilde\\theta)$ гиперграфа $\\widetilde G^*$.
     Для узлов вне добавленных поддеревьев разрезы не меняются: на каждой стороне теперь стоит либо ноль, либо все копии $E(v)$,
     и объединение по копиям равно $E(v)$.
     Для узла $t$ внутри поддерева, соответствующего $v$, на обеих сторонах разреза есть хотя бы одна копия $E(v)$,
     поэтому $V(t)=V^\\perp(t)=E(v)$ и $|\\mathrm{Cut}(t)|=|E(v)|=\\deg_G(v)\\le \\Delta(G)\\le w$ (по п. 2).
     Следовательно, ширина $(\\widetilde T,\\widetilde\\theta)$ не превосходит $w$, то есть $\\mathrm{wb}(\\widetilde G^*)\\le \\mathrm{wb}(G^*)$.
  4) В обратную сторону, $G^*$ получается из $\\widetilde G^*$ удалением копий гиперрёбер, поэтому по п. 1
     $\\mathrm{wb}(G^*)\\le \\mathrm{wb}(\\widetilde G^*)$.
     Совместно: $\\mathrm{wb}(\\widetilde G^*)=\\mathrm{wb}(G^*)$.
- `Toy‑тест:`
  1) Для $K_{1,n}$ гиперребро $E(\\text{центр})$ повторяется $2^{n-1}$ раз, но оба значения $\\mathrm{wb}(G^*)$ и $\\mathrm{wb}(\\widetilde G^*)$ равны $n$ (см. §16.105).
  2) (Почему утверждение нельзя обобщать.) Если $H$ имеет два непересекающихся гиперребра $A,B$ размера $r$, то $\\mathrm{wb}(H)=0$,
     но при добавлении второй копии $A$ получаем $\\mathrm{wb}\\ge |A|=r$ (лист, соответствующий одной копии).
- `Статус:` доказано (закрывает Q24).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` в основном тексте (или итоговой ремарке для §16.103–16.105) можно свести цепочку AR’11 к краткой формуле
  $W(T(G,\\sigma)\\vdash\\bot)=\\Theta(\\mathrm{cw}(G))$ через $\\mathrm{wb}(T)=\\mathrm{wb}(G^*)=\\mathrm{cw}(G)$.

### 16.107. Исследовательский шаг: $W(T(G,\\sigma)\\vdash\\bot)=\\Theta(\\mathrm{cw}(G))$ (явные константы)

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G$ — связный граф без петель, а $\\sigma:V(G)\\to\\{0,1\\}$ такова, что Tseitin‑CNF $T(G,\\sigma)$ невыполнима.
  Обозначим $W:=W(T(G,\\sigma)\\vdash\\bot)$ минимальную resolution‑width. Тогда
  $$\\frac{1}{8}\\,\\mathrm{cw}(G)\\ \\le\\ W\\ \\le\\ 2\\,\\mathrm{cw}(G).$$
  В частности, $W(T(G,\\sigma)\\vdash\\bot)=\\Theta(\\mathrm{cw}(G))$.
- `Доказательство:` По §16.104 имеем $\\tfrac18\\,\\mathrm{wb}(H_{T(G,\\sigma)})\\le W\\le 2\\,\\mathrm{wb}(H_{T(G,\\sigma)})$ (AR’11, Thm. 2.12 + §4).
  По AR’11 Remark 2.11, $H_{T(G,\\sigma)}$ — это мульти‑$G^*$, а по §16.106 повторения гиперрёбер не меняют $\\mathrm{wb}$, значит
  $\\mathrm{wb}(H_{T(G,\\sigma)})=\\mathrm{wb}(G^*)$.
  По §16.105, $\\mathrm{wb}(G^*)=\\mathrm{cw}(G)$. Подстановка даёт требуемое неравенство.
- `Toy‑тест:` для $K_{1,n}$ имеем $\\mathrm{cw}(K_{1,n})=n$ и $W=n$ (по формуле §16.101); для цикла $C_n$ имеем $\\mathrm{cw}(C_n)=2$ и $W=2$.
- `Статус:` доказано (закрывает Q25).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить «планарные графы с ограниченной степенью граней ⇒ ограниченная cyclicity $\\ell(G)$» из AR’11 (абзац после Thm. 2.16),
  чтобы понимать, когда $W\\le \\ell(G)^{O(1)}\\log S$ реально даёт автоматизируемость.

### 16.108. Исследовательский шаг: bounded face degree (planar) ⇒ bounded cyclicity $\\ell(G)$ (уточнение ремарки AR’11 после Thm. 2.16)

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G$ — связный планарный граф, который допускает вложение в плоскость, в котором каждая грань имеет степень $\\le d$
  (длина граничного обхода, считая кратности), и пусть $G$ 2‑реберно‑связен (нет мостов).
  Тогда cyclicity $\\ell(G)$ из AR’11 Def. 2.14 удовлетворяет
  $$\\ell(G)\\le \\max\\{d,2\\}.$$
- `Доказательство:`
  Рассмотрим фиксированное плоское вложение. Для каждой грани $f$ возьмём её граничный замкнутый обход $W_f$ длины $\\deg(f)\\le d$.
  Так как у $G$ нет мостов, каждое ребро инцидентно двум различным граням и потому встречается в каждом из двух обходов ровно по одному разу
  (эквивалентно: ребро входит в границу одной и той же грани дважды тогда и только тогда, когда это мост).
  Следовательно, $W_f$ — замкнутый обход без повторений рёбер.

  Любой такой обход раскладывается на попарно непересекающиеся по рёбрам простые циклы (индукция по длине: если в $W_f$ повторяется вершина,
  то разрежем обход в месте повтора на два более коротких замкнутых обхода; иначе это уже простой цикл).
  В частности, все циклы в разложении имеют длину $\\le |W_f|\\le d$, и каждое ребро, лежащее на границе $f$, принадлежит ровно одному циклу из этого разложения.

  Возьмём объединение циклов по всем граням. Тогда каждый ребро $e$ принадлежит ровно двум граням, значит попадает не более чем в два цикла (по одному «со стороны» каждой грани),
  и все циклы имеют длину $\\le d$. Это и есть покрытие рёбер циклами, удовлетворяющее определению cyclicity с параметром $\\max\\{d,2\\}$.
- `Toy‑тест:` треугольник с «хвостом» (подвешенным ребром‑мостом) имеет вложение с $d=5$, но покрытие рёбер циклами невозможно (мост не лежит ни в одном цикле),
  так что условие «нет мостов» действительно нужно.
- `Статус:` доказано (закрывает Q26; объясняет ремарку AR’11 после Thm. 2.16,
  `../../resources/downloads/alekhnovich_razborov_2011_satisfiability_branchwidth_tseitin.pdf`).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужно использовать Theorem 2.15 количественно, извлечь из доказательства AR’11 явную степень в $\\ell(G)^{O(1)}$ (вместо $O(1)$).

### 16.109. Исследовательский шаг: явная степень в AR’11 Thm. 2.15 (получается $\\ell^7$)

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — связный граф, для которого cyclicity $\\ell(G)<\\infty$, и $\\sigma$ — нечётная разметка (так что $T(G,\\sigma)$ невыполнима).
  Обозначим $\\ell:=\\ell(G)$, $W:=W(T(G,\\sigma)\\vdash\\bot)$ минимальную resolution‑width и $S:=S(T(G,\\sigma)\\vdash\\bot)$ минимальный размер резолюционного опровержения.
  Тогда существует абсолютная константа $C>0$ такая, что
  $$W\\le C\\,\\ell^7\\,\\log S.$$
  В частности, это делает явной степень в записи AR’11 $W\\le \\ell(G)^{O(1)}\\log S$.
- `Доказательство:` В доказательстве AR’11 Thm. 2.15 (раздел 5) получены две оценки:
  (i) по (5.4) $W(T(G,\\sigma)\\vdash\\bot)\\le O(\\ell\\cdot W(T(G,\\sigma)|\\rho\\vdash\\bot))$ для построенной случайной рестрикции $\\rho$;
  (ii) по (5.6) с «overwhelming probability» выполняется $W(T(G,\\sigma)|\\rho\\vdash\\bot)\\le O(\\ell^6\\log S)$.
  Перемножая, получаем $W\\le O(\\ell^7\\log S)$.
  Ссылка: `../../resources/downloads/alekhnovich_razborov_2011_satisfiability_branchwidth_tseitin.pdf`, §5 (уравнения (5.4) и (5.6)).
- `Toy‑тест:` если $\\ell$ ограничена абсолютной константой, то $W=O(\\log S)$ (smoothness).
  Совместно с §16.108: для 2‑реберно‑связных плоских графов с $\\max\\deg(\\text{face})\\le d$ получаем $W\\le O(d^7\\log S)$.
- `Статус:` известный факт (явное извлечение степени; закрывает Q27).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` аналогично попытаться сделать явной зависимость в AR’11 Thm. 2.17 (квази‑smoothness через $\\tilde\\ell(G)$).

### 16.110. Исследовательский шаг: явная константа в Thm. 2.17 (можно взять $c=6$)

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — связный граф, $\\tilde\\ell:=\\tilde\\ell(G)<\\infty$ — параметр AR’11 (после Thm. 2.16),
  $\\sigma$ — нечётная разметка (так что $T(G,\\sigma)$ невыполнима), $W:=W(T(G,\\sigma)\\vdash\\bot)$ — минимальная resolution‑width,
  $S:=S(T(G,\\sigma)\\vdash\\bot)$ — минимальный размер резолюционного опровержения. Тогда для некоторой абсолютной константы $C>0$ верно
  $$W\\le (C\\,\\tilde\\ell\\,\\log S)^{6\\tilde\\ell^2}.$$
  Это делает явной зависимость в AR’11 Thm. 2.17: $W\\le (\\tilde\\ell\\log S)^{O(\\tilde\\ell^2)}$.
- `Доказательство:` В доказательстве AR’11 Thm. 2.17 (раздел 5) фиксируют $\\ell:=\\tilde\\ell(G)$ и получают:
  1) по (5.12) существует (с вероятностью $1-O(S^{-1})$) ограничение $\\rho$ такое, что
     $$W(T(G,\\sigma)|\\rho\\vdash\\bot)\\le w:=\\bigl(K\\ell^2\\log S\\bigr)^{\\ell}.$$
  2) по Claim 5.17, при условии регулярности $E_p$ (Claim 5.16) из $W(T|\\rho)\\le w$ следует
     $$\\mathrm{wb}(T(G,\\sigma)\\vdash\\bot)\\le w^2 + R,$$
     где $R$ — число «relevant edges» для некоторой пары $(V_0,V_1)$ с $|V_0|,|V_1|\\le w$.
  3) Делаем оценку $R$ явной: в определении $P_{V_0,V_1}$ все пути имеют длину $\\le 2\\ell-1$, значит каждое множество рёбер в семье имеет размер $\\le 2\\ell$.
     После plucking‑процедуры в $F_{V_0,V_1}$ нет sunflower‑семейства размера $r$ среди минимальных элементов, где $r=C_0 w\\log n$ (см. (5.15)), $n:=|V(G)|$.
     Поэтому по Erdős–Rado (Prop. 5.8) получаем явную оценку
     $$|F_{V_0,V_1}|\\le (2\\ell)!\\,(r-1)^{2\\ell}\\le (2\\ell)!\\,r^{2\\ell},$$
     а значит число relevant edges удовлетворяет
     $$R\\le (2\\ell)\\,|F_{V_0,V_1}|\\le 2\\ell\\,(2\\ell)!\\,r^{2\\ell}.$$
  4) Подстановка $r=C_0 w\\log n$ даёт
     $$R\\le 2\\ell\\,(2\\ell)!\\,(C_0\\log n)^{2\\ell}\\,w^{2\\ell}.$$
     По §16.112 имеем $S\\ge n$, значит $\\log n\\le \\log S$.
     Также $(2\\ell)!\\le (2\\ell)^{2\\ell}$, поэтому
     $$2\\ell\\,(2\\ell)!\\,(C_0\\log n)^{2\\ell}\\le (C_1\\,\\ell\\,\\log S)^{4\\ell}.$$
     Следовательно,
     $$\\mathrm{wb}(T(G,\\sigma)\\vdash\\bot)\\le w^2 + (C_1\\ell\\log S)^{4\\ell}\\,w^{2\\ell}.$$
  5) Так как $w=(K\\ell^2\\log S)^{\\ell}$, имеем $w^{2\\ell}=(K\\ell^2\\log S)^{2\\ell^2}$, а множитель $(C_1\\ell\\log S)^{4\\ell}$
     увеличивает степень не более чем на $4\\ell\\le 4\\ell^2$.
     Поэтому (поглощая константы и переходя от branch‑width к width через AR’11 Thm. 2.12 + Remark 2.11 + §16.106) получаем
     $$W\\le (C\\,\\ell\\,\\log S)^{6\\ell^2}.$$
- `Toy‑тест:` если $\\ell=O(1)$, то $W\\le (\\log S)^{O(1)}$ (quasi‑smoothness) согласуется с формулировкой AR’11.
- `Статус:` доказано (грубая явная константа; закрывает Q28).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужно, улучшить грубую константу 6 (уточнить оценки на $|F_{V_0,V_1}|$ / relevant edges).

### 16.111. Исследовательский шаг: итог AR’11 (Thm. 2.15/2.17/2.18) в «употребимом» виде

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $G$ — связный граф, $\\sigma$ — нечётная разметка (так что Tseitin‑CNF $T(G,\\sigma)$ невыполнима), и
  $W:=W(T(G,\\sigma)\\vdash\\bot)$, $S:=S(T(G,\\sigma)\\vdash\\bot)$.
  Тогда:
  1) (**Smoothness через cyclicity.**) Если $\\ell:=\\ell(G)$ конечна, то
     $$W\\le O(\\ell^7\\log S)$$
     (AR’11, (5.4)+(5.6); явная степень выписана в §16.109).
     В частности, если $G$ 2‑реберно‑связен, планарен и $\\max\\deg(\\text{face})\\le d$, то $\\ell(G)\\le\\max\\{d,2\\}$ (§16.108) и потому
     $$W\\le O(d^7\\log S).$$
  2) (**Quasi‑smoothness через $\\tilde\\ell$.**) Если $\\tilde\\ell:=\\tilde\\ell(G)$ конечна, то
     $$W\\le (C\\,\\tilde\\ell\\,\\log S)^{6\\tilde\\ell^2}$$
     (AR’11, Claim 5.17/(5.18); явная константа $6$ выписана в §16.110).
  3) (**Без параметров.**) Для любого $G$ выполняется
     $$W\\le O(\\log S + |V(G)|)$$
     (AR’11, Thm. 2.18).
- `Toy‑тест:` при фиксированном $d$ в (1) получаем $W=O(\\log S)$ (smoothness), а при фиксированном $\\tilde\\ell$ в (2) получаем $W\\le (\\log S)^{O(1)}$ (quasi‑smoothness).
- `Статус:` доказано (сводка; закрывает Q29).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` по необходимости перенести этот итог в основной текст (не таща доказательства) как 3–6 строк с ссылкой на AR’11 и §16.108–16.110.

### 16.112. Исследовательский шаг: для Tseitin $S(T(G,\\sigma)\\vdash\\bot)\\ge |V(G)|$ (и потому $\\log n\\le\\log S$)

- `Линза:` Инвариант.
- `Утверждение:` Пусть $G$ — связный граф без петель, $\\sigma:V(G)\\to\\{0,1\\}$ нечётна (так что Tseitin‑CNF $T(G,\\sigma)$ невыполнима).
  Для вершины $v\\in V(G)$ обозначим через $B_v$ множество клауз в блоке $\\mathrm{PARITY}_{v,\\sigma(v)}$ (см. AR’11, (2.9)).
  Тогда CNF $T(G,\\sigma)\\setminus B_v$ выполнима. В частности, любая резолюционная рефутация $T(G,\\sigma)$ должна использовать
  хотя бы одну исходную клаузу из каждого блока $B_v$, и потому
  $$S(T(G,\\sigma)\\vdash\\bot)\\ge |V(G)|.$$
- `Доказательство:`
  1) (**Выполнимость после удаления одного блока.**) Зафиксируем вершину $r$ и построим удовлетворяющее присваивание для всех вершин $v\\ne r$.
     Возьмём остовное дерево $T$ графа $G$ с корнем $r$. Положим $x_e:=0$ для всех рёбер $e\\notin E(T)$.
     Обойдём вершины $T$ снизу вверх. Для каждой $v\\ne r$ пусть $p(v)$ — родитель, $e_v:=(v,p(v))$ — ребро к родителю.
     Когда значения $x_f$ уже заданы для всех рёбер $f$ инцидентных $v$, кроме $e_v$, положим
     $$x_{e_v}:=\\sigma(v)\\oplus \\bigoplus_{f\\ni v,\\ f\\ne e_v} x_f.$$
     Тогда у вершины $v$ выполняется требуемое уравнение $\\bigoplus_{f\\ni v}x_f=\\sigma(v)$.
     Значит присваивание удовлетворяет всем XOR‑ограничениям для $v\\ne r$ и, следовательно, удовлетворяет всем клаузам из блоков $B_v$ при $v\\ne r$.
     Так как блок $B_r$ удалён, получаем выполнимость $T(G,\\sigma)\\setminus B_r$.
  2) (**Отсюда нижняя оценка на размер.**) Если резолюционная рефутация $\\pi$ не использует ни одной исходной клаузы из блока $B_v$,
     то она является резолюционной рефутацией выполнимой CNF $T(G,\\sigma)\\setminus B_v$, что невозможно по корректности резолюции.
     Следовательно, $\\pi$ использует хотя бы одну исходную клауза из каждого блока, и число клауз в $\\pi$ не меньше $|V(G)|$,
     то есть $S(T(G,\\sigma)\\vdash\\bot)\\ge |V(G)|$.
- `Toy‑тест:` для цикла $C_3$ с нечётной $\\sigma$ (ровно одна вершина с зарядом 1) удаление блока этой вершины делает систему из двух XOR‑уравнений
  совместной; дерево‑конструкция выше явно находит решение.
- `Статус:` доказано (закрывает Q30).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` использовать как подстановку $\\log|V(G)|\\le\\log S$ в местах, где $n$ появляется внутри $\\log$ (например, в оценках из AR’11 §5).

### 16.113. Исследовательский шаг: Frege‑«line replacement» по эквивалентности $A\\leftrightarrow A'$

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Пусть $\\Gamma$ — множество формул, и в Frege‑выводе из $\\Gamma$ уже получена формула $A$.
  Если также есть Frege‑вывод (без гипотез) тавтологии $A\\leftrightarrow A'$, то из $\\Gamma$ выводится $A'$.
  Более того, $A'$ можно вставить в вывод сразу после $A$ с $O(1)$ дополнительными строками (плюс вывод $A\\leftrightarrow A'$).
- `Доказательство:` Пишем $A\\leftrightarrow A'$ как $(A\\to A')\\wedge(A'\\to A)$.
  В любой Frege‑системе есть короткие (константные) выводы тавтологий
  $((X\\wedge Y)\\to X)$ и $((X\\wedge Y)\\to Y)$.
  Применяя modus ponens к строке $(A\\to A')\\wedge(A'\\to A)$, получаем строку $A\\to A'$,
  а затем modus ponens к строкам $A$ и $A\\to A'$ даёт $A'$.
  (Аналогично из $A'$ и $A\\leftrightarrow A'$ выводится $A$.)
- `Оценка blow-up:` одна замена линии добавляет константное число строк сверх вывода эквивалентности $A\\leftrightarrow A'$,
  т.е. если $|\\pi|$ — длина исходного вывода и $E$ — суммарная длина добавленных выводов эквивалентностей, то новый вывод имеет длину $O(|\\pi|+E)$.
- `Toy‑тест:` для $A=(p\\vee q)\\vee r$ и $A'=p\\vee(q\\vee r)$: из $A$ и ассоциативности $\\vee$ (как $A\\leftrightarrow A'$) выводим $A'$.
- `Статус:` доказано (закрывает Q32).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужно для строгой «log‑depth» интерпретации, зафиксировать (ссылкой), что выбранная схема балансировки даёт
  полиномиальный Frege‑вывод эквивалентности $A\\leftrightarrow A'$ для каждой линии (иначе пользоваться переводом Buss’97 из §16.95).

### 16.114. Исследовательский шаг: Spira‑балансировка даёт p‑размерные Frege‑доказательства $A\\leftrightarrow A'$

- `Линза:` Эквивалентность.
- `Утверждение:` Существует стандартная Spira‑схема балансировки формул $A\\mapsto A'$ глубины $O(\\log|A|)$ и размера $\\mathrm{poly}(|A|)$, для которой
  тавтологии $A\\leftrightarrow A'$ имеют полиномиальные Frege‑доказательства. Следовательно, аргумент 16.94 «балансировать каждую линию» можно
  проводить строго через §16.113.
- `Обоснование/ссылка:` в Buss (1997), Proof (Sketch) к Theorem 3 (p. 8),
  `../../resources/downloads/buss_1997_proof_complexity_intro.pdf`,
  прямо отмечено, что в доказательстве p‑симуляции Frege‑систем по Rekhow/Spira
  «must prove that there are polynomial size proofs that the Spira translation of a conjunction $A\\wedge B$ is equivalent to the conjunction of the Spira translations of $A$ and $B$»,
  т.е. корректность Spira‑перевода (и, в частности, эквивалентность исходной формулы и её балансировки) верифицируется внутри Frege с полиномиальным blow‑up.
- `Toy‑тест:` для $A=(p\\vee q)\\vee r$ и $A'=p\\vee(q\\vee r)$ эквивалентность $A\\leftrightarrow A'$ выводится из ассоциативности $\\vee$ константным числом строк (см. §16.113).
- `Статус:` известный факт (точная ссылка; закрывает Q33).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` вернуться к 16.93: либо найти источник с явной конструкцией $O(\\log n)$‑depth Frege‑рефутации Tseitin, либо оставлять только «перевод Buss’97/Spira» как строгую верхнюю оценку по глубине (16.95).

### 16.115. Исследовательский шаг: когда верхняя оценка GIRS’19 Thm. 19 становится polynomial‑size?

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $t:=\\mathrm{tw}(G)$ и $\\Delta:=\\Delta(G)$.
  Из доказательства GIRS’19 Thm. 27/Claim 28 (разд. 4.3; см. также §16.119–§16.120) получается **нециркулярная** явная форма верхней оценки:
  для любого $d\\ge 1$ существует bounded‑depth Frege‑рефутация глубины $O(d)$ и размера
  $$\\mathrm{poly}(|\\mathrm{Tseitin}(G,f)|)\\cdot 2^{\\,O\\bigl(d\\cdot X^{2/d}\\bigr)},\\qquad X:=\\Delta\\,\\mathrm{tpw}(G).$$
  Подставляя $\\mathrm{tpw}(G)\\le 10\\Delta\\,t$ (GIRS’19 Thm. 26), получаем
  $$\\mathrm{poly}(|\\mathrm{Tseitin}(G,f)|)\\cdot 2^{\\,O\\bigl(d\\cdot (10\\Delta^2 t)^{2/d}\\bigr)}.$$
  В частности, гарантированно polynomial‑size следует уже при $d=\\Theta(\\log(10\\Delta^2 t))$ (тогда $(10\\Delta^2 t)^{2/d}=\\exp(O(1))$ и экспонента становится $O(\\log t)$).
- `Доказательство:` по Claim 28 (GIRS’19, p. 13) размер game tree ограничен $\\mathrm{poly}(|T|)$ и доминирующими слагаемыми вида
  $2^{O(\\sum_{i=1}^d t_i)}$, где в доказательстве Thm. 27 выбирают $t_i=(\\Delta\\,\\mathrm{tpw}(G))^{2/d}$ для всех $i$ (p. 14),
  так что $\\sum_i t_i=d\\cdot X^{2/d}$. Константы в переходе Lemma 24/25 фиксируются в §16.118, и потому итоговый размер
  имеет вид $\\mathrm{poly}(|T|)\\cdot 2^{O(d\\cdot X^{2/d})}$. Подстановка Thm. 26 даёт формулу через $t$.
- `Toy‑тест:` если $d=\\Theta(\\log t)$, то $X^{2/d}=\\exp(O(1))$, и оценка становится $2^{O(\\log t)}=\\mathrm{poly}(t)$.
- `Статус:` доказано (исправляет 16.115: из GIRS’19 **не следует** polynomial‑size при $d=\\Theta(\\log t/\\log\\log t)$ без доп. идей; см. §16.120).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для grid переписать итог в терминах $N$ и сопоставить с Håstad’20 Cor. 6.6 (см. §16.116 и §16.120).

### 16.116. Исследовательский шаг: Tseitin(Grid) — порог глубины polynomial‑size в терминах $N$

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — $n\\times n$ grid и $T:=\\mathrm{Tseitin}(G,f)$ — соответствующая Tseitin‑CNF.
  Обозначим через $N$ число переменных в $T$ (для стандартного кодирования $N=\\Theta(|E(G)|)=\\Theta(n^2)$).
  Тогда:
  1) (**Нижняя оценка.**) Любая polynomial‑size Frege‑рефутация в depth‑$d$ требует
     $$d\\ =\\ \\Omega\\!\\left(\\frac{\\log N}{\\log\\log N}\\right)$$
     (Håstad’20, Cor. 6.6; см. §16.92).
  2) (**Верхняя оценка.**) Polynomial‑size Frege‑рефутации существуют при глубине
     $$d\\ =\\ O(\\log N)$$
     (например, из GIRS’19: polynomial‑size уже при $d=\\Theta(\\log\\mathrm{tw}(G))=\\Theta(\\log n)=\\Theta(\\log N)$; см. §16.115 и §16.120).
  Следовательно, известная зона для минимальной глубины polynomial‑size на grid:
  $$\\Omega\\!\\left(\\frac{\\log N}{\\log\\log N}\\right)\\ \\le\\ d_{\\mathrm{poly}}(N)\\ \\le\\ O(\\log N).$$
- `Доказательство:`
  1) (**Нижняя оценка.**) Это Cor. 6.6 из Håstad (2020) (см. §16.92), переписанная через $N=\\Theta(n^2)$.
  2) (**Верхняя оценка.**) Из §16.115 имеем polynomial‑size при глубине $d=\\Theta(\\log(\\Delta^2\\mathrm{tw}(G)))$.
     Для grid $\\Delta=4$ и $\\mathrm{tw}(G)=\\Theta(n)$, значит $d=\\Theta(\\log n)=\\Theta(\\log N)$.
- `Toy‑тест:` $N=n^2$ даёт $\\log N=2\\log n$ и $\\log\\log N=\\log(\\log n+\\log 2)=\\log\\log n+O(1)$, так что масштабы
  $\\log n/\\log\\log n$ и $\\log N/\\log\\log N$ совпадают по порядку.
- `Статус:` доказано (исправляет 16.116: порядок для $d_{\\mathrm{poly}}$ на grid **не** зафиксирован; известны только $\\Omega(\\log N/\\log\\log N)$ и $O(\\log N)$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужно для «главного текста», заменить «tight» на двусторонние границы $\\Omega(\\log N/\\log\\log N)$ и $O(\\log N)$ (см. `docs/15_proof_complexity.md`).

### 16.117. Исследовательский шаг: константы в пороге глубины для Tseitin(Grid) (Håstad’20 vs GIRS’19)

- `Линза:` Трейд‑офф.
- `Утверждение:` Для Tseitin(Grid$_{n,n}$) в bounded‑depth Frege:
  1) (**Явная нижняя константа.**) Из Håstad (2020), Cor. 6.6 (см. §16.92) следует, что polynomial‑size невозможен при
     $$\\mathrm{depth}\\le \\frac{\\log n}{59\\,\\log\\log n}.$$
  2) (**Известный upper.**) Из §16.115 (на базе GIRS’19 Thm. 27/26) следует polynomial‑size при глубине $\\mathrm{depth}=O(\\log n)=O(\\log N)$.
  Следовательно, «константное» сравнение вида $1/59$ vs “$9c$” невалидно: известная верхняя оценка для polynomial‑size находится на другом масштабе
  (между $\\Omega(\\log n/\\log\\log n)$ и $O(\\log n)$; см. §16.116), и задача — закрыть этот зазор (или объяснить барьер).
- `Доказательство:`
  1) Пункт (1) — это ровно Cor. 6.6 из Håstad (2020), как записано в §16.92.
  2) Для grid $\\Delta=4$, $\\mathrm{tw}(G)=\\Theta(n)$, и по §16.115 polynomial‑size получается при глубине $\\Theta(\\log n)$.
- `Toy‑тест:` при $d=\\alpha\\,\\log n/\\log\\log n$ из §16.115 получаем экспоненту $\\Theta(d\\cdot n^{2/d})=\\Theta\\bigl((\\log n)^{1+2/\\alpha}/\\log\\log n\\bigr)$,
  то есть гарантированно **не** polynomial‑size; чтобы сделать экспоненту $O(\\log n)$, нужен $d=\\Theta(\\log n)$.
- `Статус:` доказано (уточнён масштаб: известный upper для polynomial‑size — $O(\\log n)$, а не $\\Theta(\\log n/\\log\\log n)$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти/построить upper на polynomial‑size при глубине $O(\\log n/\\log\\log n)$ (или аргумент, почему подход через “компактный parity” этого не даёт).

### 16.118. Исследовательский шаг: в GIRS’19 Lemma 24/25 можно взять явную константу $c=21$

- `Линза:` Трейд‑офф.
- `Утверждение:` В Galesi–Itsykson–Riazanov–Sofronova (2019) (GIRS’19) в Lemma 24 и Lemma 25
  (раздел 4.2, “Summation of linear equations”) можно выбрать константу $c=21$:
  для любого $d$ и любого $p(t_1,\\dots,t_d)$‑refinement $U$ существует вывод, заявленный в Lemma 24, размера
  $\\le 21\\cdot|\\Phi_1(\\varnothing,U)|^6$, и, следовательно, в Lemma 25 можно взять ту же константу (размер $\\le 21k\\cdot|\\Phi_1(\\varnothing,U)|^6$).
- `Доказательство:` в доказательстве Lemma 24 (GIRS’19, p. 10–11 в PDF‑нумерации) получена оценка
  $$\\text{size}\\ \\le\\ 2^{3t_1}\\,c\\,|\\Phi_1(\\varnothing,V^1)|^6\\ +\\ 20\\,|\\Phi_1(\\varnothing,U)|^6,$$
  и далее используется тождество (там же)
  $$|\\Phi_1(\\varnothing,U)|=2^{t_1+1}t_1\\,|\\Phi_1(\\varnothing,V^1)|.$$
  Подставляя, получаем
  $$2^{3t_1}c|\\Phi_1(\\varnothing,V^1)|^6
    =c\\,\\frac{2^{3t_1}}{2^{6(t_1+1)}t_1^6}\\,|\\Phi_1(\\varnothing,U)|^6
    \\le \\frac{c}{512}\\,|\\Phi_1(\\varnothing,U)|^6,$$
  так как $t_1\\ge 1$. Поэтому при $c=21$ имеем
  $$\\frac{c}{512}+20<21,$$
  и индуктивный шаг в Lemma 24 проходит с той же константой $c=21$ (база $d=0$ даёт константный размер и тем более укладывается в $21\\cdot|\\Phi_1(\\varnothing,U)|^6$).
  В Lemma 25 (p. 11) пункт (1) — это $(k-1)$ последовательных применений Lemma 24 с композицией по Lemma 2, поэтому размер
  $\\le k\\cdot 21\\cdot|\\Phi_1(\\varnothing,U)|^6$.
- `Toy‑тест:` при $t_1=1$ худший множитель в первом слагаемом равен $2^{3}/2^{12}=1/512$, и запас $21-20=1$ ещё остаётся.
- `Статус:` доказано (явная константа; полезно для Q39).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` распаковать оставшиеся “существует $c$”/big‑O в верхней оценке GIRS’19 Thm. 19 (p. 14):
  теперь единственные неявные константы сидят в переходе от Claim 28/Theorem 27 к форме $2^{(10\\Delta^2\\mathrm{tw})^{c/d}}$.

### 16.119. Исследовательский шаг: в GIRS’19 Thm. 19 можно взять явную константу $c=4$ (распаковка Claim 28 → Thm. 27)

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — связный граф, $T:=\\mathrm{Tseitin}(G,f)$ невыполнима и $d\\ge 1$.
  Обозначим $X:=\\Delta(G)\\,\\mathrm{tpw}(G)$. Если $X^{1/d}\\ge \\max(2d,6)$, то в конструкции GIRS’19 (разд. 4.3)
  можно взять **явную** константу $c=4$ в экспоненте:
  существует derivation глубины $3d+O(1)$ размера
  $$\\mathrm{poly}(|T|)\\cdot 2^{X^{4/d}}.$$
  Следовательно, по Theorem 26 (GIRS’19) можно взять ту же константу $c=4$ в форме Thm. 19:
  $$\\mathrm{poly}(|T|)\\cdot 2^{(10\\Delta(G)^2\\mathrm{tw}(G))^{4/d}}.$$
- `Доказательство:` фиксируем явные константы, скрытые в Claim 28 (GIRS’19, p. 13–14).
  Пусть $t_1=\\dots=t_d:=\\lceil X^{2/d}\\rceil$ и $Q$ — $(3,t_1,\\dots,t_d)$‑refinement, как в доказательстве Thm. 27.
  Положим $M:=|\\Phi^1(\\varnothing,Q)|$ (компактное представление паритета).
  1) По Lemma 21 (GIRS’19) имеем
     $$M\\le 48\\cdot\\prod_{i=1}^d 2^{t_i+1}t_i.$$
  2) В Claim 28 крупнейшие поддеривации — это применения Lemma 25; после фиксации константы $21$ в Lemma 24/25 (см. §16.118)
     получаем размер $\\le 21k\\,M^6$ (для $k\\le (\\Delta+1)\\mathrm{tpw}$), а вклад Lemma 22 ($\\le 4M^3$) и Lemma 4
     (для перехода CNF‑паритетов к $\\Phi$‑представлениям) полиномиален в $|T|$ и $M^6$.
     Поэтому вся конструкция Thm. 27 даёт оценку вида
     $$\\mathrm{size}\\le \\mathrm{poly}(|T|)\\cdot M^6.$$
  3) Так как $t_i\\ge 1$, множители $t_i^6$ можно поглотить в $\\mathrm{poly}(|T|)$ (при наших $t_i$ это $\\le (2^dX^2)^{O(1)}$,
     а из $X^{1/d}\\ge 2d$ следует $X\\ge 2^d$). Отсюда
     $$M^6\\le \\mathrm{poly}(|T|)\\cdot 2^{6\\sum_{i=1}^d t_i}.$$
  4) При $t_i=\\lceil X^{2/d}\\rceil$ имеем $\\sum_i t_i\\le d(X^{2/d}+1)\\le 2dX^{2/d}$.
     Из условия $X^{1/d}\\ge 2d$ получаем $2dX^{2/d}\\le X^{3/d}$, значит
     $$6\\sum_i t_i\\le 6X^{3/d}.$$
     Наконец, из $X^{1/d}\\ge 6$ следует $6X^{3/d}\\le X^{4/d}$, то есть $M^6\\le \\mathrm{poly}(|T|)\\cdot 2^{X^{4/d}}$.
  Комбинируя (2)–(4), получаем требуемую явную форму для Thm. 27; подстановка $\\mathrm{tpw}(G)\\le 10\\Delta(G)\\mathrm{tw}(G)$
  (Theorem 26) даёт явную форму Thm. 19.
- `Toy‑тест:` для grid $n\\times n$ имеем $X=\\Delta\\,\\mathrm{tpw}=\\Theta(n)$.
  Если пытаться получить polynomial‑size из формулы $2^{X^{4/d}}$, то естественно взять $d\\asymp 4\\log n/\\log\\log n$, чтобы $X^{4/d}=\\Theta(\\log n)$.
  Но при таком $d$ условие леммы **не выполняется**:
  $$X^{1/d}=\\exp(\\tfrac{\\log X}{d})=\\exp\\!\\left(\\tfrac14\\log\\log n+o(1)\\right)=(\\log n)^{1/4+o(1)}\\ll 2d=\\Theta(\\tfrac{\\log n}{\\log\\log n}).$$
  Следовательно, §16.119 фиксирует явную константу лишь в режиме $d$ “не слишком большой” (когда $X^{1/d}\\ge 2d$), но не даёт polynomial‑size при $d=\\Theta(\\log n/\\log\\log n)$.
- `Статус:` доказано (условная явная константа; **не** закрывает Q39 без снятия условия).
- `Барьер‑чек:` r — неприменимо (верхняя оценка в ограниченной модели доказательств), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` см. §16.120: записать unconditional upper из Claim 28 и оценить, какой глубины он реально требует для polynomial‑size.

### 16.120. Исследовательский шаг: GIRS’19 upper bound даёт polynomial‑size лишь при глубине $\\Theta(\\log n)$ (а при $\\Theta(\\log n/\\log\\log n)$ — только quasi‑poly)

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $G$ — связный граф, $T:=\\mathrm{Tseitin}(G,f)$ невыполнима, $d\\ge 1$ и $X:=\\Delta(G)\\,\\mathrm{tpw}(G)$.
  Тогда из доказательства GIRS’19 Thm. 27/Claim 28 следует upper
  $$\\mathrm{size}(T\\vdash\\bot)\\ \\le\\ \\mathrm{poly}(|T|)\\cdot 2^{\\,O\\bigl(d\\cdot X^{2/d}\\bigr)}.$$
  Для grid $n\\times n$ (где $X=\\Theta(n)$ и число переменных $N=\\Theta(n^2)$) это означает:
  1) при глубине $d=\\Theta(\\log n/\\log\\log n)$ гарантируется лишь $\\mathrm{size}=2^{(\\log n)^{\\omega(1)}}$ (quasi‑poly), а
  2) чтобы из этой оценки получить polynomial‑size, достаточно и по сути необходимо взять $d=\\Theta(\\log n)=\\Theta(\\log N)$.
- `Доказательство:`
  1) Формула $\\mathrm{poly}(|T|)\\cdot 2^{O(d\\cdot X^{2/d})}$ — это §16.115 (полученная непосредственно из Claim 28 и выбора $t_i=X^{2/d}$).
  2) Пусть $L:=\\log X$ и положим $f(d):=d\\cdot X^{2/d}=d\\,\\exp(2L/d)$.
     Если $d=\\alpha\\,L/\\log L$, то $X^{2/d}=\\exp(2L/d)=\\exp(2\\log L/\\alpha)=L^{2/\\alpha}$ и потому
     $$f(d)=\\Theta\\!\\left(\\frac{L}{\\log L}\\cdot L^{2/\\alpha}\\right)=\\Theta\\!\\left(\\frac{L^{1+2/\\alpha}}{\\log L}\\right)=\\omega(L).$$
     Значит экспонента в $2^{O(f(d))}$ строго больше $\\Theta(\\log X)$, и гарантированно polynomial‑size не следует.
  3) Если $d=\\Theta(L)$, то $X^{2/d}=\\exp(\\Theta(1))=\\Theta(1)$ и потому $f(d)=\\Theta(L)$; следовательно
     $2^{O(f(d))}=2^{\\Theta(\\log X)}=\\mathrm{poly}(X)$.
     Для grid $X=\\Theta(n)$ это даёт polynomial‑size при $d=\\Theta(\\log n)=\\Theta(\\log N)$.
- `Toy‑тест:` при $d=\\log X$ имеем $X^{2/d}=X^{2/\\log X}=\\exp(2)$ и экспонента $\\asymp e^2\\log X$; при $d=\\log X/\\log\\log X$
  имеем $X^{2/d}=(\\log X)^2$ и экспонента $\\asymp (\\log X)^3/\\log\\log X$.
- `Статус:` доказано (объясняет, почему «59 vs $c$» из Q39 не закрывается через текущий GIRS‑upper).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать другой upper‑аргумент (не через “refinement‑parity” в стиле §16.115), который даёт polynomial‑size уже при глубине $O(\\log n/\\log\\log n)$, или явный барьер для такого улучшения в Frege без XOR‑гейтов.

### 16.121. Исследовательский шаг: оптимизация $f(d)=d\\,X^{2/d}$ (в рамках Claim 28) ⇒ сертификат polynomial‑size требует $d=\\Omega(\\log X)$

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $X\\ge 2$ и $f(d):=d\\,X^{2/d}$ для $d>0$ (реальное).
  Тогда:
  1) (**Нижняя граница для сертификата polynomial‑size.**) Если $d=o(\\log X)$, то $f(d)=\\omega(\\log X)$, а значит из upper вида
     $\\mathrm{poly}(|T|)\\cdot 2^{O(f(d))}$ нельзя вывести polynomial‑size.
  2) (**Оптимальный выбор внутри этой оценки.**) $f$ минимальна при $d=2\\ln X$, и $\\min f(d)=2e\\ln X=\\Theta(\\log X)$.
     В частности, bound из Claim 28 действительно даёт polynomial‑size при глубине $d=\\Theta(\\log X)$ (но не при $o(\\log X)$).
- `Доказательство:`
  Запишем $X^{2/d}=\\exp(2\\ln X/d)$ и положим $t:=2\\ln X/d$ (так что $d=2\\ln X/t$). Тогда
  $$\\frac{f(d)}{\\ln X}=\\frac{2\\exp(t)}{t}.$$
  1) Если $d=o(\\log X)$, то $t=2\\ln X/d\\to\\infty$, а потому $\\exp(t)/t\\to\\infty$, то есть $f(d)/\\ln X\\to\\infty$ и $f(d)=\\omega(\\log X)$.
  2) Производная $f'(d)=\\exp(2\\ln X/d)\\cdot(1-2\\ln X/d)$, поэтому минимум достигается при $d=2\\ln X$ и равен
     $f(2\\ln X)=2\\ln X\\cdot \\exp(1)=2e\\ln X$.
- `Toy‑тест:` если $X=2^{64}$, то $\\ln X\\approx 44.36$ и оптимум при $d\\approx 88.7$, где $f(d)\\approx 2e\\ln X\\approx 241$ (экспонента $2^{O(241)}$ — полином от $X$).
- `Статус:` доказано (локальный «барьер техники»: Claim‑28‑upper сам по себе не даёт polynomial‑size при $d=o(\\log X)$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q39 искать upper‑источник/приём, где верхняя оценка имеет вид $2^{O(X^{c/d})}$ без дополнительного множителя $d$ в экспоненте (или объяснить, почему такой приём невозможен в Frege без XOR‑гейтов).

### 16.122. Исследовательский шаг: «Gaussian elimination» как (пока) отсутствующий upper‑шаг для bounded‑depth Frege на grid

- `Линза:` Эквивалентность.
- `Утверждение:` В Håstad–Risse (2022/2025) §1.2 (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`)
  явным образом выделен «потенциальный» путь к upper bound для Tseitin(Grid) в bounded‑depth Frege:
  пытаться симулировать суммирование линейных уравнений (Gaussian elimination по модулю 2) в языке формул глубины $d$.
  Авторы показывают, как **представлять** промежуточные паритетные уравнения в виде небольших depth‑$d$ формул,
  но подчёркивают, что **не знают**, как синтаксически переводить один шаг Gaussian elimination в ограниченное число шагов доказательства,
  т.е. получают «representation of partial results», а не proof.
- `Доказательство/ссылка:` Håstad–Risse, §1.2 “Constructing small proofs” (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`):
  1) (p. 3; PDF p. 5) “If we are allowed to reason with linear equations modulo two then the Tseitin contradiction has efficient refutations.”
  2) (p. 4; PDF p. 6) “We do not know how to syntactically translate a Gaussian elimination step to some proof steps in this representation and thus we do not actually get a proof, only a representation of the partial results.”
- `Toy‑тест:` пусть максимальный размер строки $M=n^{O(1)}$, тогда $\\log M=\\Theta(\\log n)$.
  Если (как в эвристике HR §1.2) временно считать, что глубина‑$d$ **представление** паритета допускает блок
  $m\\approx(\\log M)^{d-1}$, то
  При $d=\\Theta(\\log n/\\log\\log n)$ имеем $m=\\exp(\\Theta(\\log n))=n^{\\Theta(1)}\\ge n$, т.е. представление паритета на $n$ переменных возможно при polynomial $M$;
  остаётся ровно «нехватающий» шаг: вывести из таких представлений следующее XOR‑уравнение внутри Frege.
  (Для растущей глубины и **формул** нужно аккуратно учитывать разницу «схемы vs формулы», см. §16.147–§16.152.)
- `Статус:` известный факт (точная ссылка; формализует, где именно ломается наивный upper‑подход).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` формализовать как лемму‑цель: «в bounded‑depth Frege можно (p‑)выводить представление $L_1\\oplus L_2=b_1\\oplus b_2$ из представлений $L_1=b_1$ и $L_2=b_2$ с контролем по глубине/размеру», либо найти источник, где это уже сделано.

### 16.123. Исследовательский шаг: исправление про «representation PARITY» — наивная DNF‑индукция даёт $M^{\\Theta(d)}$, а нужный факт явно заявлен в Håstad–Risse §1.2

- `Линза:` Трейд‑офф.
- `Утверждение:` Рассмотрим утверждение из §16.122: «формулы глубины $d$ размера $M$ могут представлять паритет на $m:=(\\log M)^{d-1}$ переменных» (для растущей $d$ см. caveat §16.147–§16.152).
  1) Наивная конструкция через DNF‑разложение $\\mathrm{PARITY}_{\\lceil\\log_2 M\\rceil}$ и подстановку по глубине действительно даёт depth $O(d)$, но лишь размер $M^{\\Theta(d)}$,
     поэтому **не** выводит polynomial‑size для $d=\\Theta(\\log n/\\log\\log n)$ при $M=\\mathrm{poly}(n)$ (получается quasi‑poly).
  2) Сам «representation»‑факт в нужной (для Q39) форме **известен** и прямо сформулирован в Håstad–Risse (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, §1.2):
     они утверждают, что при группировке по блокам размера $(\\log M)^{d-1}$ можно «write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity».
- `Доказательство/ссылка:`
  1) (Почему DNF‑индукция не годится при растущей $d$.) Пусть $g:=\\lceil\\log_2 M\\rceil$ и $m:=g^{d-1}$.
     База $d=2$: DNF для $\\mathrm{PARITY}_g$ имеет $2^{g-1}$ термов, т.е. размер $\\Theta(2^g\\cdot g)=\\Theta(M\\log M)$.
     Шаг $d\\to d+1$: подстановка формулы размера $S_d$ в каждое вхождение переменной в этой DNF даёт
     $$S_{d+1}=\\Theta(2^g\\cdot g\\cdot S_d)=\\Theta(M\\log M\\cdot S_d),$$
     откуда $S_d=(M\\log M)^{\\Theta(d)}=M^{\\Theta(d)}$ (лог‑факторы поглощаются в $M^{o(d)}$).
     При $M=n^C$ и $d=\\Theta(\\log n/\\log\\log n)$ это даёт $S_d=n^{\\Theta(\\log n/\\log\\log n)}$ (quasi‑poly), а не $n^{O(1)}$.
  2) (Корректный источник representation.) Håstad–Risse, §1.2, абзац начиная с “Let us consider proofs that contain formulas of depth d …”:
     “… divide the variables in to groups of size $(\\log M)^{d−1}$ and write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity …”.
- `Toy‑тест:` возьмём $M=n^{10}$ и $d=\\lfloor\\log n/\\log\\log n\\rfloor$. Тогда $m=(\\Theta(\\log n))^{\\Theta(\\log n/\\log\\log n)}=n^{\\Theta(1)}$,
  и representation из Håstad–Risse допускает формулы размера $M=\\mathrm{poly}(n)$; но DNF‑индукция выше дала бы только quasi‑poly размер.
- `Статус:` контрпример к прежнему выводу «DNF‑индукция ⇒ poly‑size при $d=\\Theta(\\log n/\\log\\log n)$»; representation‑лемма закрыта точной ссылкой (Håstad–Risse §1.2).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` теперь, когда representation опирается на источник, вернуть фокус на missing step из §16.122: найти/доказать (или барьерно опровергнуть) синтаксическую симуляцию одного шага $L_1=b_1,\\ L_2=b_2\\Rightarrow L_1\\oplus L_2=b_1\\oplus b_2$ в bounded‑depth Frege без экспоненциального blow‑up.

### 16.124. Исследовательский шаг: на пороге $d\\approx\\log n/\\log\\log n$ representation XOR‑уравнения ширины $O(n)$ становится константной; Q39 сводится к 1‑шаговой XOR‑симуляции

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $n\\to\\infty$, $M=n^{O(1)}$ и $d:=\\lceil\\log_2 n/\\log_2\\log_2 n\\rceil+1$.
  Тогда $(\\log_2 M)^{d-1}\\ge n$, а значит (в терминах §16.122–§16.123) паритетное уравнение на $m=O(n)$ переменных можно представлять **как один блок**:
  в bounded‑depth Frege линии «$\\sum x_i=b$» и «$\\neg(\\sum x_i=b)$» допускают depth‑$d$ формулы размера $\\mathrm{poly}(n)$, и representation‑overhead $2^{m/(\\log M)^{d-1}}$ становится $2^{O(1)}$.
  Следовательно, потенциальный upper‑подход через Gaussian elimination на grid (ширина каждого промежуточного уравнения $O(n)$ и $O(n)$ шагов) упирается не в представимость уравнений, а только в возможность синтаксически симулировать **один** шаг $L_1=b_1,\\ L_2=b_2\\Rightarrow L_1\\oplus L_2=b_1\\oplus b_2$ в bounded‑depth Frege.
- `Доказательство:` так как $M=n^{O(1)}$, существует константа $C\\ge 1$ такая, что $\\log_2 M\\ge C\\log_2 n\\ge \\log_2 n$ для больших $n$.
  По определению $d$ имеем $d-1\\ge \\log_2 n/\\log_2\\log_2 n$.
  Тогда
  $$(\\log_2 M)^{d-1}\\ \\ge\\ (\\log_2 n)^{\\log_2 n/\\log_2\\log_2 n}\\ =\\ 2^{(\\log_2 n/\\log_2\\log_2 n)\\cdot\\log_2\\log_2 n}\\ =\\ 2^{\\log_2 n}\\ =\\ n.$$
  Подстановка в счёт $2^{m/(\\log M)^{d-1}}$ даёт $2^{O(n)/\\Omega(n)}=2^{O(1)}$.
- `Toy‑тест:` пусть $n=2^{16}$, $M=n^{10}$ и $d=\\lceil 16/4\\rceil+1=5$.
  Тогда $\\log_2 M=160$ и $(\\log_2 M)^{d-1}=160^4>10^8\\gg n$, так что $m=n$ попадает в один блок.
- `Статус:` доказано (количественная редукция Q39: на пороговой глубине representation‑стоимость константна).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать/формализовать либо (i) p‑выводимость правила XOR‑сложения двух уравнений в bounded‑depth Frege с контролем по глубине/размеру, либо (ii) известный lower‑bound/барьер, запрещающий такое правило при $d=\\Theta(\\log n/\\log\\log n)$.

### 16.125. Исследовательский шаг: формальная редукция Q39 к p‑выводимости одного XOR‑шага (Gaussian elimination) в bounded‑depth Frege

- `Линза:` Эквивалентность.
- `Утверждение:` Зафиксируем $n\\to\\infty$, пусть $G$ — $n\\times n$ grid, а $F_n=\\mathrm{TseitinCNF}(G,\\chi)$ (с $\\bigoplus_v\\chi(v)=1$) — 3‑CNF из §16.85.
  Предположим, что для каждого $m=O(n)$ существует uniform family depth‑$d(n)$ Frege‑выводов полиномиального размера для следующего «XOR‑шага»:
  из двух представлений линейных уравнений по модулю 2,
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2),$$
  где $S_i$ — множества переменных $\\{x_e\\}$ размера $\\le m$, $\\triangle$ — симм. разность, а каждое $E(S,b)$ записано depth‑$d(n)$ формулой размера $\\mathrm{poly}(n)$ (representation из §16.123–§16.124).
  Тогда существует polynomial‑size depth‑$O(d(n))$ Frege‑рефутация $F_n$.
- `Доказательство:` возьмём линейно‑алгебраическую стратегию из Håstad–Risse §1.2:
  (i) суммирование всех уравнений одной колонки даёт уравнение ширины $O(n)$; (ii) прибавление соседней колонки сохраняет ширину $O(n)$;
  (iii) после прохода по всем колонкам получается противоречие $0=1$, и нигде не используется уравнение шире $O(n)$.
  Стандартная 3‑CNF кодировка вершины (4 клаузы для степени 3/4) имеет константный Frege‑вывод эквивалентной XOR‑формулы
  $(\\bigoplus_{e\\ni v} x_e)\\leftrightarrow\\chi(v)$ (см. схему в §16.88), так что мы можем начать с representation всех вершинных уравнений.
  Далее каждый линейный шаг суммирования/сокращения общих переменных — это ровно применение указанного XOR‑правила к двум уравнениям ширины $O(n)$,
  причём по §16.124 каждое промежуточное уравнение можно держать одним representation‑блоком (size $\\mathrm{poly}(n)$, depth $d(n)$).
  Число линейных шагов полиномиально (можно суммировать вершины по очереди внутри колонки и затем колонки по очереди), а каждая подстановка XOR‑правила имеет размер $\\mathrm{poly}(n)$ по предположению,
  значит суммарный размер Frege‑рефутации остаётся $\\mathrm{poly}(n)$ (а значит $\\mathrm{poly}(|F_n|)$).
- `Toy‑тест:` при $n=4$ суммирование 4 вершин одной колонки убивает внутренние вертикальные рёбра (каждое появляется дважды) и оставляет только рёбра, пересекающие границу колонки;
  ширина остаётся $O(n)$, и этот шаблон повторяется при добавлении следующей колонки.
- `Статус:` доказано (условная редукция: закрытие Q39 эквивалентно наличию poly‑size bounded‑depth симуляции одного Gaussian‑elimination шага на XOR‑уравнениях ширины $O(n)$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти точный источник/результат про (не)существование такого XOR‑правила в bounded‑depth Frege (возможно через известные lower bounds для AC$^0$‑Frege на «линейно‑алгебраических» тавтологиях).

### 16.126. Исследовательский шаг: «один XOR‑шаг» = Tseitin на 3‑вершинном (мульти)графе

- `Линза:` Эквивалентность.
- `Утверждение:` Зафиксируем множества переменных $S_1,S_2\\subseteq X$ и биты $b_1,b_2\\in\\{0,1\\}$.
  Тогда правило из §16.125
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2)$$
  (где $E(S,b)$ — «XOR‑уравнение по модулю 2» над переменными из $S$) эквивалентно refutation’у Tseitin‑противоречия на графе из трёх вершин, в котором каждое ребро соответствует одной переменной из $X$.
- `Доказательство:`
  1) (**Граф.**) Построим мультиграф $H(S_1,S_2)$ с вершинами $A,B,C$ и рёбрами:
     - для каждого $x\\in S_1\\cap S_2$ добавим ребро $(A,B)$, помеченное $x$;
     - для каждого $x\\in S_1\\setminus S_2$ добавим ребро $(A,C)$, помеченное $x$;
     - для каждого $x\\in S_2\\setminus S_1$ добавим ребро $(B,C)$, помеченное $x$.
     Тогда инцидентные $A$ рёбра — ровно переменные из $S_1$, инцидентные $B$ — из $S_2$, а инцидентные $C$ — из $S_1\\triangle S_2$.
  2) (**Tseitin‑система.**) Положим заряды $\\chi(A)=b_1$, $\\chi(B)=b_2$, $\\chi(C)=1\\oplus b_1\\oplus b_2$.
     Тогда Tseitin($H,\\chi$) есть система трёх XOR‑уравнений
     $$E(S_1,b_1),\\quad E(S_2,b_2),\\quad E(S_1\\triangle S_2,\\ 1\\oplus b_1\\oplus b_2).$$
     Поскольку $b_1\\oplus b_2\\oplus(1\\oplus b_1\\oplus b_2)=1$, сумма зарядов нечётна, и по инварианту из §16.85 система невыполнима.
  3) (**Импликация ↔ refutation.**) Невыполнимость тройки уравнений равносильна тавтологии
     $$E(S_1,b_1)\\wedge E(S_2,b_2)\\ \\to\\ \\neg E(S_1\\triangle S_2,\\ 1\\oplus b_1\\oplus b_2).$$
     Но $\\neg E(S,1\\oplus b)$ тождественно $E(S,b)$, значит это ровно $E(S_1,b_1)\\wedge E(S_2,b_2)\\to E(S_1\\triangle S_2,b_1\\oplus b_2)$.
     Поэтому polynomial‑size bounded‑depth Frege refutation Tseitin($H,\\chi$) (при фиксированном способе записи $E$) даёт polynomial‑size bounded‑depth доказательство XOR‑шага и наоборот (с точностью до $O(1)$ по глубине).
- `Toy‑тест:` если $S_1=\\{x,y\\}$, $S_2=\\{y,z\\}$, то рёбра: $y$ между $(A,B)$, $x$ между $(A,C)$, $z$ между $(B,C)$.
  Уравнения: $x\\oplus y=b_1$, $y\\oplus z=b_2$, $x\\oplus z=1\\oplus b_1\\oplus b_2$ — явное противоречие.
- `Статус:` доказано (переформулировка «missing step» как частного Tseitin).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать (не)известные оценки на bounded‑depth Frege для этой 3‑вершинной Tseitin‑семьи при ширине $|S_1|,|S_2|=\\Theta(n)$ и глубине $d=\\Theta(\\log n/\\log\\log n)$ (это и есть «один Gaussian‑elimination шаг»).

### 16.127. Исследовательский шаг: XOR‑сложение уравнений тривиально в EF, но перевод в bounded‑depth Frege даёт лишь $O(\\log n)$ по глубине

- `Линза:` Трейд‑офф.
- `Утверждение:` Семейство «одного XOR‑шага» (эквивалентное 3‑вершинному Tseitin из §16.126) имеет polynomial‑size refutation в Extended Frege (EF),
  поскольку EF может вводить abbreviation‑переменные и симулировать Gaussian elimination. Однако стандартные приёмы перевода/балансировки дают
  для обычного Frege только верхнюю оценку глубины $O(\\log n)$ (а не $O(\\log n/\\log\\log n)$), так что это не закрывает Q39.
- `Доказательство/пояснение:`
  1) EF‑верхняя оценка: см. §16.88 (каркас EF‑доказательства Tseitin через XOR‑переменные) и замечание «EF легко симулирует Gaussian elimination»
     (Bonet–Buss–Pitassi 2002, `../../resources/downloads/bonet_buss_pitassi_2002_hard_examples_frege.pdf`, p. 7).
     Для 3‑вершинного Tseitin (и вообще для линейных систем над $\\mathbb F_2$) EF может хранить промежуточные XOR‑уравнения в extension‑переменных и выполнять шаги сложения строк.
  2) Переход к bounded‑depth Frege: даже если есть polynomial‑size (E)Frege‑доказательство, известная универсальная балансировка формул (Spira/Brent) даёт глубину лишь
     $O(\\log m)$ для формул размера $m$ (см. §16.94), а в нашем режиме $m=\\mathrm{poly}(n)$ это $O(\\log n)$.
     Именно поэтому «есть EF‑доказательство Gaussian elimination» не означает «есть depth‑$\\Theta(\\log n/\\log\\log n)$ Frege‑доказательство одного XOR‑шага».
- `Toy‑тест:` для паритета на $n$ переменных балансировка даёт глубину $O(\\log n)$ для явной XOR‑деревянной формулы, но Q39 требует глубину порядка $\\log n/\\log\\log n$.
- `Статус:` доказано (локальный барьер: стандартный EF→Frege+балансировка не даёт нужной глубины).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать технику, которая уменьшает глубину вывода XOR‑шага ниже $O(\\log n)$ (например, через специальные depth‑$d$ представления паритета из Håstad–Risse и доказательства их линейности), либо источник, что такой сдвиг невозможен.

### 16.128. Исследовательский шаг: Claim‑28 upper (GIRS’19) не сертифицирует polynomial‑size даже для «локального» 3‑вершинного Tseitin при $d\\approx\\log n/\\log\\log n$

- `Линза:` Трейд‑офф.
- `Утверждение:` Рассмотрим семейство 3‑вершинных Tseitin‑противоречий из §16.126, где $|S_1|,|S_2|=\\Theta(n)$ (значит число переменных $\\Theta(n)$).
  Тогда общий upper bound из GIRS’19 (Claim 28 → Thm. 27; см. §16.115–§16.121) гарантирует polynomial‑size refutation лишь при глубине
  $$d=\\Omega(\\log n),$$
  и потому не может закрыть Q39 в режиме $d=\\Theta(\\log n/\\log\\log n)$ даже на одном Gaussian‑elimination шаге.
- `Доказательство:` пусть $H=H(S_1,S_2)$ — мультиграф на вершинах $A,B,C$ из §16.126.
  1) $\\Delta(H)=\\max\\{|S_1|,|S_2|,|S_1\\triangle S_2|\\}=\\Theta(n)$.
  2) По определению tree‑partition width из GIRS’19 §4.3 можно взять одно множество $\\{A,B,C\\}$ как единственную часть tree‑partition, значит
     $$\\mathrm{tpw}(H)\\le 3.$$
     Следовательно, $X:=\\Delta(H)\\,\\mathrm{tpw}(H)=\\Theta(n)$.
  3) Применяя явный unconditional upper из §16.120,
     $$\\mathrm{size}\\le \\mathrm{poly}(|T|)\\cdot 2^{O\\bigl(d\\cdot X^{2/d}\\bigr)},$$
     и лемму‑оптимизацию §16.121 (polynomial‑size возможно только при $d=\\Omega(\\log X)$), получаем требование $d=\\Omega(\\log n)$.
- `Toy‑тест:` если $d=\\lfloor\\log n/\\log\\log n\\rfloor$, то $X^{2/d}=\\exp(2\\log n/d)=(\\log n)^{\\Theta(1)}$ и
  $$2^{O(d\\cdot X^{2/d})}=2^{\\mathrm{polylog}(n)}=n^{\\mathrm{polylog}(n)}$$
  (quasi‑poly), а не $n^{O(1)}$.
- `Статус:` доказано (локальный «барьер техники»: tree‑partition upper из GIRS’19 не достигает пороговой глубины даже для 3‑вершинного шага).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` искать приём, который использует специальную структуру grid/representation (Håstad–Risse) и обходится без параметра $X=\\Delta\\,\\mathrm{tpw}$ (или доказать, что для 3‑вершинного Tseitin при $d=\\Theta(\\log n/\\log\\log n)$ неизбежна quasi‑poly нижняя оценка).

### 16.129. Исследовательский шаг: «компактное представление паритета» в GIRS’19 (Lemma 21) = DNF‑индукция и имеет размер $\\exp(\\Theta(d\\,n^{1/d}))$ ⇒ при $d\\approx\\log n/\\log\\log n$ это quasi‑poly

- `Линза:` Сжатие/канонизация.
- `Утверждение:` В GIRS’19, §4.1 (Lemma 20–21) «компактное представление» $\\mathrm{PARITY}$ строится через $(t_1,\\dots,t_d)$‑refinement и даёт формулу глубины $\\le 3d+1$ и размера
  $$\\mathrm{size}=\\prod_{i=1}^d (2^{t_i+1}t_i).$$
  При условии $\\prod_{i=1}^d t_i\\ge n$ (Lemma 20) лучшая возможная оценка для **этого** построения имеет вид
  $$2^{\\Omega(d\\,n^{1/d})}\\ \\le\\ \\mathrm{size}\\ \\le\\ 2^{O(d\\,n^{1/d})}\\cdot\\mathrm{poly}(n).$$
  В частности, при $d=\\Theta(\\log n/\\log\\log n)$ получаем $\\mathrm{size}=n^{\\Theta(\\log n/\\log\\log n)}$ (quasi‑poly), т.е. ровно тот же «лишний множитель $d$ в экспоненте», что и в §16.123.
- `Доказательство/ссылка:`
  1) (Размер/глубина формулы.) GIRS’19, Lemma 21 (в `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`): при $(t_1,\\dots,t_d)$‑refinement формула для $\\mathrm{PARITY}$ имеет глубину $\\le 3d+1$ и размер $\\prod_{i=1}^d (2^{t_i+1}t_i)$.
  2) (Нижняя оценка для этого построения.) Так как $\\prod_{i=1}^d (2^{t_i+1}t_i)\\ge \\prod_i 2^{t_i}=2^{\\sum_i t_i}$, достаточно оценить сумму.
     По AM–GM: если $t_i\\ge 1$ и $\\prod_i t_i\\ge n$, то $\\frac1d\\sum_i t_i\\ge (\\prod_i t_i)^{1/d}\\ge n^{1/d}$, значит $\\sum_i t_i\\ge d\\,n^{1/d}$ и
     $$\\mathrm{size}\\ge 2^{\\sum_i t_i}\\ge 2^{d\\,n^{1/d}}.$$
  3) (Верхняя оценка.) Возьмём $t_i:=\\lceil n^{1/d}\\rceil$. Тогда $\\prod_i t_i\\ge n$, и
     $$\\mathrm{size}=\\prod_i (2^{t_i+1}t_i)=2^{O(d\\,n^{1/d})}\\cdot (n^{1/d}+1)^d=2^{O(d\\,n^{1/d})}\\cdot\\mathrm{poly}(n).$$
  4) (Порог $d\\approx\\log n/\\log\\log n$.) Тогда $n^{1/d}=2^{(\\log_2 n)/d}=2^{\\Theta(\\log\\log n)}=\\mathrm{polylog}(n)$, и экспонента
     $$d\\,n^{1/d}=\\Theta\\Bigl(\\frac{\\log n}{\\log\\log n}\\cdot\\log n\\Bigr)=\\Theta\\Bigl(\\frac{\\log^2 n}{\\log\\log n}\\Bigr),$$
     т.е. $\\mathrm{size}=2^{\\Theta(\\log^2 n/\\log\\log n)}=n^{\\Theta(\\log n/\\log\\log n)}$ (quasi‑poly).
- `Toy‑тест:` пусть $n=2^{256}$, $d=\\lfloor 256/8\\rfloor=32$. Тогда $n^{1/d}=2^8=256$ и нижняя оценка даёт $\\mathrm{size}\\ge 2^{32\\cdot 256}=2^{8192}$, тогда как любой $n^C$ имеет вид $2^{256C}$.
- `Статус:` доказано (ограничение техники: GIRS’19 Lemma 21/Claim 28 используют parity‑представление размера $\\exp(\\Theta(d\\,n^{1/d}))$, что не достигает порога $d\\approx\\log n/\\log\\log n$ без новых идей).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` выяснить, существует ли в литературе «доказуемое в bounded‑depth Frege» представление паритета без множителя $d$ в экспоненте (в духе Håstad–Risse §1.2), или есть известный lower bound/барьер, запрещающий синтаксическую симуляцию XOR‑сложения на глубине $\\Theta(\\log n/\\log\\log n)$.

### 16.130. Исследовательский шаг: XOR‑сложение уравнений становится лёгким, если все уравнения записаны как паритет по $k$ «блок‑паритетам» одного фиксированного разбиения

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть множество переменных $X$ разбито на непересекающиеся блоки $X=\\biguplus_{i=1}^k B_i$.
  Для каждого $i$ пусть $P_i(x_{B_i})$ — формула глубины $\\le d_0$ и размера $\\mathrm{poly}(n)$, вычисляющая паритет на $B_i$ (т.е. $P_i=1\\iff \\bigoplus_{x\\in B_i}x=1$).
  Для $I\\subseteq[k]$ и $b\\in\\{0,1\\}$ обозначим
  $$E^{\\mathrm{blk}}(I,b)\\ :=\\ \\Bigl(\\bigoplus_{i\\in I} y_i=b\\Bigr)$$
  как **DNF‑формулу** на абстрактных переменных $y_1,\\dots,y_k$ (полная DNF паритета на $I$, размера $\\Theta(2^{|I|-1}|I|)$).
  Тогда для любых $I_1,I_2\\subseteq[k]$ и $b_1,b_2\\in\\{0,1\\}$ существует bounded‑depth Frege‑вывод глубины $O(1)$ и размера $2^{O(k)}$, доказывающий
  $$E^{\\mathrm{blk}}(I_1,b_1)\\wedge E^{\\mathrm{blk}}(I_2,b_2)\\ \\to\\ \\ E^{\\mathrm{blk}}(I_1\\triangle I_2,\\ b_1\\oplus b_2).$$
  Подстановкой $y_i\\mapsto P_i$ получаем polynomial‑size depth‑$O(d_0)$ Frege‑вывод XOR‑шага для уравнений, которые являются **объединениями блоков** одного и того же разбиения:
  $$E(S_{I_1},b_1),\\ E(S_{I_2},b_2)\\ \\vdash\\ E(S_{I_1\\triangle I_2},\\ b_1\\oplus b_2),\\qquad S_I:=\\bigcup_{i\\in I} B_i.$$
  В частности, если $k=O(\\log n)$ и $|P_i|=\\mathrm{poly}(n)$, то один XOR‑шаг имеет polynomial‑size bounded‑depth Frege‑доказательство.
- `Доказательство:`
  1) На уровне $y$‑переменных импликация — тавтология (линейность паритета по $\\mathbb F_2$). По Lemma 4 (GIRS’19, `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`, p. 4),
     если формула зависит от $k$ переменных, то из семантической импликации следует derivation размера $\\le 2^k\\bigl(|\\psi_1|^2+|\\psi_2|^2\\bigr)=2^{O(k)}$ при той же глубине.
  2) Подстановка: в любой Frege‑системе, где аксиомы/правила заданы как схемы, подстановка $y_i\\mapsto P_i$ в каждую строку доказательства даёт доказательство подстановочной формулы.
     Глубина увеличивается на $O(d_0)$, а суммарный размер — не более чем на множитель $O(\\max_i |P_i|)$ (каждое вхождение $y_i$ заменяется формулой $P_i$).
- `Toy‑тест:` $k=3$, $I_1=\\{1,2\\}$, $I_2=\\{2,3\\}$: из $y_1\\oplus y_2=b_1$ и $y_2\\oplus y_3=b_2$ следует $y_1\\oplus y_3=b_1\\oplus b_2$ (cимм. разность убирает $y_2$).
- `Статус:` доказано (условный «easy case»: XOR‑шаг тривиализуется при фиксированном блок‑разбиении и малом $k$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` понять, можно ли для column‑summing стратегии на grid держать все промежуточные уравнения в виде union‑of‑blocks одного разбиения с $k=\\mathrm{polylog}(n)$ (и при этом выводить сами блок‑паритеты без «скрытого» Gaussian elimination), или это ломается и требует переходов между разбиениями.

### 16.131. Исследовательский шаг: фиксированный «block‑basis» не может покрыть column‑summing на grid при $k=\\mathrm{polylog}(n)$ (ранг $=\\Omega(n)$)

- `Линза:` Коммуникация/ранг.
- `Утверждение:` Рассмотрим $n\\times n$ grid и пусть $H_j$ — множество из $n$ горизонтальных рёбер между колонками $j$ и $j+1$ (для $j=1,\\dots,n-1$).
  Тогда множества $H_1,\\dots,H_{n-1}$ линейно независимы в $\\mathbb F_2^{E}$ (как характеристические векторы), и поэтому:
  если фиксирован набор $k$ подмножеств рёбер $B_1,\\dots,B_k\\subseteq E$, то одновременно представить **все** $H_j$ как симметрические разности
  $$H_j=\\bigtriangleup_{i\\in I_j} B_i$$
  возможно только при $k\\ge n-1$.
  В частности, попытка применить §16.130 к column‑summing с одним фиксированным block‑representation требует $k=\\Omega(n)$ и потому не даёт polynomial‑size (так как $2^{O(k)}$ становится экспоненциальным).
- `Доказательство:` так как множества $H_j$ попарно непересекаются, они независимы:
  если $\\bigtriangleup_{j\\in J} H_j=\\varnothing$, то для любого $e\\in H_{j_0}$ (где $j_0\\in J$) этот $e$ встречается в симм. разности ровно один раз (только из $H_{j_0}$), противоречие. Значит $J=\\varnothing$ и $\\{H_j\\}$ независимы.
  Следовательно, подпространство $\\langle H_1,\\dots,H_{n-1}\\rangle\\subseteq\\mathbb F_2^{E}$ имеет размерность $n-1$.
  Если же каждый $H_j$ лежит в линейной оболочке $\\langle B_1,\\dots,B_k\\rangle$, то
  $$n-1=\\dim\\langle H_1,\\dots,H_{n-1}\\rangle\\le \\dim\\langle B_1,\\dots,B_k\\rangle\\le k,$$
  откуда $k\\ge n-1$.
- `Toy‑тест:` при $n=4$ есть три непересекающихся сета $H_1,H_2,H_3$; значит любой фиксированный набор $B_1,\\dots,B_k$, порождающий все $H_j$, должен иметь $k\\ge 3$.
- `Статус:` контрпример к наивной идее «закрыть Q39 через один фиксированный block‑basis + §16.130» (нужны переходы между разбиениями/базисами).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` формализовать, какой именно «base‑change» требуется в стратегии Håstad–Risse, и свести его к синтаксической задаче: доказать/опровергнуть возможность эффективно переводить bounded‑depth представления паритета между двумя (существенно разными) разбиениями при глубине $\\Theta(\\log n/\\log\\log n)$.

### 16.132. Исследовательский шаг: наивный base‑change через общее уточнение двух разбиений даёт blow‑up $k\\mapsto k^2$ ⇒ при $k=\\Theta(\\log n)$ получается quasi‑poly

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть $U$ — множество переменных (или рёбер), а $\\mathcal P,\\mathcal Q$ — разбиения $U$ на $k$ блоков каждое.
  Рассмотрим «block‑representation» из §16.130: формулы для паритетов блоков и уравнения вида «паритет на объединении некоторых блоков равен $b$».
  Тогда любой «перевод» между представлениями относительно $\\mathcal P$ и $\\mathcal Q$ можно свести к общему уточнению
  $$\\mathcal R:=\\{P\\cap Q:\\ P\\in\\mathcal P,\\ Q\\in\\mathcal Q,\\ P\\cap Q\\ne\\varnothing\\},$$
  причём $|\\mathcal R|\\le k^2$ и каждое множество, являющееся объединением блоков $\\mathcal P$ (или $\\mathcal Q$), автоматически является объединением блоков $\\mathcal R$.
  Следовательно, если пытаться реализовать base‑change исключительно через §16.130 (т.е. через «абстрактное» доказательство размера $2^{O(|\\mathcal R|)}$ на переменных $y_R$ и подстановку $y_R\\mapsto \\mathrm{PARITY}(R)$), то базовый верхний предел на стоимость такого шага имеет вид
  $$2^{O(|\\mathcal R|)}\\le 2^{O(k^2)}.$$
  В частности, при $k=\\Theta(\\log n)$ это уже $2^{\\Theta(\\log^2 n)}=n^{\\Theta(\\log n)}$ (quasi‑poly), так что «универсальный» base‑change через уточнение не сохраняет polynomial‑size.
- `Доказательство:`
  1) (Общее уточнение.) Для любых разбиений $\\mathcal P,\\mathcal Q$ семейство $\\mathcal R$ выше — разбиение $U$ (на непустые попарно непересекающиеся множества), и по определению каждый блок $P\\in\\mathcal P$ раскладывается в дизъюнктное объединение блоков $P\\cap Q$ при $Q\\in\\mathcal Q$; аналогично для каждого $Q\\in\\mathcal Q$.
  2) (Оценка числа блоков.) Так как пар $P\\cap Q$ не больше, чем $k\\cdot k$, получаем $|\\mathcal R|\\le k^2$.
  3) (Худший случай достигается.) Пусть $U=[k]\\times[k]$. Возьмём $\\mathcal P$ как разбиение по строкам $P_i:=\\{i\\}\\times[k]$ и $\\mathcal Q$ как разбиение по столбцам $Q_j:=[k]\\times\\{j\\}$. Тогда каждое пересечение $P_i\\cap Q_j$ — одноточечное множество, значит $|\\mathcal R|=k^2$.
  4) (Стоимость «через §16.130».) В §16.130 абстрактный XOR‑вывод на $k$ блок‑переменных оценивается как $2^{O(k)}$ (по сути, перебор таблицы истинности). Если наивно привести две несовместимые block‑representations к общей $\\mathcal R$ и дальше работать абстрактно, то количество блок‑переменных становится $|\\mathcal R|$, и оценка превращается в $2^{O(|\\mathcal R|)}\\le 2^{O(k^2)}$.
- `Toy‑тест:` если $k=\\lfloor\\log_2 n\\rfloor$, то $2^{O(k^2)}=2^{O(\\log^2 n)}=n^{O(\\log n)}$, т.е. даже один «универсальный» base‑change такого типа уже может уничтожить цель $n^{O(1)}$.
- `Статус:` доказано (барьер метода: динамические разбиения действительно нужны, но «перевод через общее уточнение» в худшем случае квадратично раздувает число блоков и приводит к quasi‑poly при $k=\\Theta(\\log n)$).
- `Барьер‑чек:` r — неприменимо (вопрос о синтаксической цене внутри Frege, не оракулы), NP — неприменимо (не про алгоритмы решения SAT), alg — неприменимо (не про арифметизацию/алгебраизацию моделей).
- `Следующий шаг:` найти «структурный» base‑change, который для нужных промежуточных разбиений на grid избегает blow‑up $k\\to k^2$ (например, цепочка контролируемых refinement/coarsening, где каждое преобразование имеет поддержку $O(1)$ или $O(\\log n)$ на абстрактном уровне), или показать, что в стратегии Håstad–Risse неизбежно появляются пары разбиений с $|\\mathcal P\\wedge\\mathcal Q|=\\Omega(k^2)$.

### 16.133. Исследовательский шаг: для interval‑partition на $[m]$ общее уточнение имеет размер $\\le k_1+k_2-1$ (нет квадратичного blow‑up)

- `Линза:` Инвариант.
- `Утверждение:` Пусть $U=[m]=\\{1,\\dots,m\\}$ с фиксированным порядком. Назовём разбиение $\\mathcal P$ **interval‑partition**, если каждый блок — отрезок $[a,b]\\cap\\mathbb Z$.
  Тогда для любых двух interval‑partition $\\mathcal P,\\mathcal Q$ с $|\\mathcal P|=k_1$, $|\\mathcal Q|=k_2$ их общее уточнение удовлетворяет
  $$|\\mathcal P\\wedge\\mathcal Q|\\le k_1+k_2-1.$$
  Следовательно, «универсальный» base‑change из §16.132 через общее уточнение даёт лишь линейный рост числа блоков, если все разбиения совместимы с одним и тем же 1‑мерным порядком.
- `Доказательство:` interval‑partition однозначно задаётся множеством разрезов
  $$C(\\mathcal P)\\subseteq\\{1,\\dots,m-1\\},\\qquad i\\in C(\\mathcal P)\\iff i,i+1\\text{ лежат в разных блоках }\\mathcal P.$$
  Тогда $|\\mathcal P|=|C(\\mathcal P)|+1$.
  Для двух interval‑partition общее уточнение $\\mathcal P\\wedge\\mathcal Q$ имеет разрезы ровно в точках
  $$C(\\mathcal P\\wedge\\mathcal Q)=C(\\mathcal P)\\cup C(\\mathcal Q),$$
  потому что новое разбиение должно резать везде, где режет хотя бы одно из исходных, и больше нигде (иначе нарушится максимальность блоков‑отрезков).
  Значит
  $$|\\mathcal P\\wedge\\mathcal Q|=|C(\\mathcal P)\\cup C(\\mathcal Q)|+1\\le |C(\\mathcal P)|+|C(\\mathcal Q)|+1=(k_1-1)+(k_2-1)+1=k_1+k_2-1.$$
- `Toy‑тест:` пусть $m=6$, $\\mathcal P=(\\{1,2\\},\\{3,4\\},\\{5,6\\})$ ($k_1=3$) и $\\mathcal Q=(\\{1\\},\\{2,3\\},\\{4,5\\},\\{6\\})$ ($k_2=4$).
  Тогда $|\\mathcal P\\wedge\\mathcal Q|=6=k_1+k_2-1$ (граница точна).
- `Статус:` доказано (позитивный «structural case»: квадратичный blow‑up из §16.132 возникает только при «поперечных» разбиениях; для 1D‑совместимых разбиений уточнение линейно).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли в стратегии Håstad–Risse для grid выбрать все необходимые block‑representations так, чтобы разбиения были (приближённо) 1D‑совместимы с одним порядком на рёбрах/переменных; иначе найти место, где неизбежно требуется «поперечный» переход типа row↔column (и тогда §16.132 снова даёт quasi‑poly барьер).

### 16.134. Исследовательский шаг: в column‑summing на grid промежуточные XOR‑уравнения соответствуют границе прямоугольника и разбиваются на $O(1)$ row‑interval сегментов (поэтому $k^2$‑барьер §16.132 локально не срабатывает)

- `Линза:` Эквивалентность.
- `Утверждение:` Рассмотрим $n\\times n$ grid с вершинами $(i,j)$, $1\\le i,j\\le n$, и переменными $x_e$ на рёбрах.
  Зафиксируем внутреннюю колонку $2\\le j\\le n-1$ и для $t\\in[n]$ обозначим
  $$R_{j,t}:=\\{(i,j):1\\le i\\le t\\}$$
  (первые $t$ вершин колонки $j$) и $\\delta(R_{j,t})$ — множество рёбер, имеющих ровно один конец в $R_{j,t}$.
  Тогда XOR‑сумма вершинных Tseitin‑уравнений по вершинам $R_{j,t}$ равна одному уравнению
  $$E\\bigl(\\delta(R_{j,t}),\\ \\bigoplus_{v\\in R_{j,t}}\\chi(v)\\bigr).$$
  Более того, $\\delta(R_{j,t})$ раскладывается в дизъюнктное объединение не более чем четырёх «row‑interval» сегментов:
  - $L_{j,t}$: горизонтальные рёбра между колонками $j-1$ и $j$ на строках $1..t$,
  - $H_{j,t}$: горизонтальные рёбра между колонками $j$ и $j+1$ на строках $1..t$,
  - $T_{j}$: одно вертикальное ребро над $(1,j)$ (если $(1,j)$ не на верхней границе),
  - $B_{j,t}$: одно вертикальное «фронтирное» ребро между $(t,j)$ и $(t+1,j)$ (если $t<n$).
  Следовательно, в этой конкретной линейной стратегии все промежуточные уравнения имеют представление как паритет по $k=O(1)$ disjoint‑блокам, согласованным с одним 1D‑порядком по строкам.
- `Доказательство:`
  1) (Граница как XOR‑сумма.) При XOR‑суммировании вершинных уравнений по $R_{j,t}$ каждое внутреннее ребро (оба конца в $R_{j,t}$) входит в левую часть ровно два раза и сокращается по модулю 2, а каждое ребро с ровно одним концом в $R_{j,t}$ входит ровно один раз. Поэтому левая часть равна паритету по $\\delta(R_{j,t})$, а правая часть равна $\\bigoplus_{v\\in R_{j,t}}\\chi(v)$.
  2) (Геометрия $\\delta(R_{j,t})$.) Для множества вершин «префикса колонки» возможные рёбра, выходящие из $R_{j,t}$, бывают трёх типов:
     - горизонтальные влево/вправо из строк $1..t$ (дают два row‑interval сегмента $L_{j,t},H_{j,t}$);
     - вертикальные вверх из вершины $(1,j)$ и вниз из вершины $(t,j)$ (дают $\\le 2$ отдельных ребра $T_j,B_{j,t}$).
     Других рёбер, инцидентных вершинам $R_{j,t}$, нет.
- `Toy‑тест:` $n=4$, $j=2$, $t=2$.
  Тогда $\\delta(R_{2,2})$ состоит из двух горизонтальных сегментов длины 2 (между (i,1)-(i,2) и (i,2)-(i,3) для $i=1,2$) и одного вертикального ребра (2,2)-(3,2) (плюс верхнее, если считать внешнюю «рамку»).
- `Статус:` доказано (уточнение: для самой column‑summing стратегии множества переменных не создают «поперечных» разбиений; технический узел — не combinatorial $k^2$‑blow‑up, а синтаксическая возможность переходить между формулами паритета для растущих сегментов).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` выделить минимальную «локальную» подзадачу: для row‑interval $I=[1..t]$ понять, можно ли в bounded‑depth Frege при $d=\\Theta(\\log n/\\log\\log n)$ полиномиально доказывать корректность склейки
  $$\\mathrm{PARITY}(I\\cup\\{e\\})\\leftrightarrow \\bigl(\\mathrm{PARITY}(I)\\oplus x_e\\bigr)$$
  (и аналогично для сдвига фронтира), т.е. base‑change между формулами паритета для соседних интервалов.

### 16.135. Исследовательский шаг: даже для 1D‑префиксов фиксированный block‑basis требует $k=\\Omega(n)$ (ранг $n$)

- `Линза:` Коммуникация/ранг.
- `Утверждение:` Пусть $e_1,\\dots,e_n$ — попарно различные переменные (например, горизонтальные рёбра между фиксированными колонками $j$ и $j+1$ на строках $1..n$).
  Для $t\\in[n]$ обозначим префиксное множество
  $$L_t:=\\{e_1,\\dots,e_t\\}.$$
  Тогда в $\\mathbb F_2^{\\{e_1,\\dots,e_n\\}}$ множества $L_1,\\dots,L_n$ линейно независимы, а значит:
  если фиксирован набор $k$ подмножеств $B_1,\\dots,B_k$ и каждый $L_t$ представим как симметрическая разность
  $$L_t=\\bigtriangleup_{i\\in I_t} B_i,$$
  то обязательно $k\\ge n$.
  В частности, любая попытка держать в column‑summing один фиксированный малый базис «segment blocks», покрывающий **все** префиксы $[1..t]$, обречена (даже в 1D), и base‑change/динамические разбиения неизбежны.
- `Доказательство:` рассмотрим характеристические векторы $\\mathbf 1_{L_t}\\in\\mathbb F_2^n$ относительно базиса $e_1,\\dots,e_n$.
  Имеем тождество
  $$\\{e_t\\}=L_t\\triangle L_{t-1}\\qquad (t\\ge 2),$$
  и $\\{e_1\\}=L_1$. Следовательно, линейная оболочка $\\langle L_1,\\dots,L_n\\rangle$ содержит все одноэлементные множества $\\{e_t\\}$, значит имеет размерность $n$.
  Так как векторов $L_t$ ровно $n$, они линейно независимы.
  Отсюда, если все $L_t$ лежат в $\\langle B_1,\\dots,B_k\\rangle$, то
  $$n=\\dim\\langle L_1,\\dots,L_n\\rangle\\le \\dim\\langle B_1,\\dots,B_k\\rangle\\le k.$$
- `Toy‑тест:` $n=3$: $L_1=(1,0,0)$, $L_2=(1,1,0)$, $L_3=(1,1,1)$ — независимы (матрица верхнетреугольная с единицами на диагонали).
- `Статус:` доказано (барьер: «фиксированный малый базис для всех префиксов» невозможен уже в 1D; значит даже при структуре §16.134 узел остаётся в динамическом base‑change, а не в выборе единого базиса).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` разбирать base‑change не как «общий перевод между двумя произвольными разбиениями», а как локальные операции на границе (добавить/удалить один $e_t$) и искать, может ли bounded‑depth Frege реализовать такую локальную трансформацию на формулах паритета без накапливания глубины/квази‑поли blow‑up.

### 16.136. Исследовательский шаг: каноническая dyadic‑разбивка префикса $[t]$ даёт $\\le \\lfloor\\log_2 t\\rfloor+1$ блоков и обновляется за $O(\\log n)$ слияниями

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Для каждого $t\\in[n]$ существует разбиение префикса $[t]=\\{1,\\dots,t\\}$ на попарно непересекающиеся интервалы
  $$[t]=I_1\\uplus I_2\\uplus\\cdots\\uplus I_r,$$
  где каждый $I_j$ имеет длину степень двойки, и
  $$r\\le \\lfloor\\log_2 t\\rfloor+1.$$
  Более того, можно выбрать **каноническую** такую разбивку (через двоичную запись $t$), обладающую свойством обновления:
  переход $t\\mapsto t+1$ преобразует разбивку $[t]$ в разбивку $[t+1]$ последовательностью операций
  «добавить singleton $[t+1,t+1]$» и затем $\\le \\lfloor\\log_2 n\\rfloor+1$ раз применить
  $$J\\uplus J'\\mapsto J\\cup J'$$
  к двум соседним интервалам одинаковой длины (слияние в интервал вдвое большей длины).
- `Доказательство:`
  1) (Существование и оценка на $r$.) Запишем $t$ в двоичном виде
     $$t=\\sum_{a\\in A}2^a,\\qquad A\\subseteq\\{0,1,\\dots,\\lfloor\\log_2 t\\rfloor\\}.$$
     Переберём $a\\in A$ по убыванию и последовательно положим
     $$I_1=[1,2^{a_1}],\\ I_2=[2^{a_1}+1,2^{a_1}+2^{a_2}],\\ \\dots$$
     Тогда интервалы попарно не пересекаются, их объединение равно $[t]$, а $r=|A|\\le \\lfloor\\log_2 t\\rfloor+1$.
  2) (Каноничность и обновление.) Добавление 1 к двоичному числу $t$ меняет суффикс вида $\\underbrace{11\\cdots 1}_{s}\\mapsto 0\\cdots 0$ и увеличивает следующий бит.
     В терминах разбивки это означает: при переходе $t\\to t+1$ сначала добавляется новый интервал длины 1, а затем для каждого «переноса»
     сливаются две соседние dyadic‑части одинаковой длины в одну часть удвоенной длины. Число переносов равно числу подряд идущих единиц в конце двоичной записи $t$,
     поэтому не превосходит $\\lfloor\\log_2 n\\rfloor+1$.
- `Toy‑тест:` $t=13=8+4+1$: $[13]=[1,8]\\uplus[9,12]\\uplus[13,13]$.
  Тогда $t+1=14=8+4+2$: добавляем $[14,14]$ и сливаем $[13,13]$ с $[14,14]$ в $[13,14]$, получая
  $[14]=[1,8]\\uplus[9,12]\\uplus[13,14]$.
- `Статус:` доказано (канонический способ держать префиксы с $O(\\log n)$ блоками и локальными merge‑операциями).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` свести «локальный base‑change» для row‑interval’ов к одному типу операции: показать/опровергнуть, что bounded‑depth Frege может полиномиально выводить корректность merge
  $$\\mathrm{PARITY}(J)=b_1,\\ \\mathrm{PARITY}(J')=b_2\\ \\vdash\\ \\mathrm{PARITY}(J\\cup J')=b_1\\oplus b_2$$
  для двух соседних дизъюнктных интервалов одинаковой длины (и затем итеративно поддерживать префиксную стратегию).

### 16.137. Исследовательский шаг: merge‑правило для дизъюнктных блоков сводится к «easy case» §16.130, если принять representation паритета на каждом блоке как атом

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть множество переменных $X$ разбито на дизъюнктные блоки $B_1\\uplus\\cdots\\uplus B_k$.
  Для каждого $i$ пусть $P_i(x_{B_i})$ — формула, вычисляющая паритет на $B_i$ (то есть $P_i=1\\iff\\bigoplus_{x\\in B_i}x=1$), и считаем, что обе полярности доступны как $P_i$ и $\\neg P_i$.
  Тогда для любых дизъюнктных объединений блоков
  $$S_{I}:=\\bigcup_{i\\in I}B_i\\qquad (I\\subseteq[k])$$
  и любых $I_1,I_2\\subseteq[k]$ имеем polynomial‑size bounded‑depth Frege‑вывод
  $$E(S_{I_1},b_1),\\ E(S_{I_2},b_2)\\ \\vdash\\ E(S_{I_1\\triangle I_2},\\ b_1\\oplus b_2)$$
  размера $2^{O(k)}$ и глубины $O(\\max_i\\depth(P_i))$.
  В частности, для merge двух соседних интервалов одинаковой длины (dyadic‑merge из §16.136) достаточно взять $k=2$ и получить константный по $k$ вывод:
  $$\\mathrm{PARITY}(J)=b_1,\\ \\mathrm{PARITY}(J')=b_2\\ \\vdash\\ \\mathrm{PARITY}(J\\cup J')=b_1\\oplus b_2.$$
- `Доказательство:` это прямое применение §16.130:
  1) На абстрактных переменных $y_1,\\dots,y_k$, где $y_i$ означает «паритет блока $B_i$ равен 1», формулы $E^{\\mathrm{blk}}(I,b)$ (полная DNF на $y$) зависят только от $k$ переменных и семантически реализуют линейность XOR.
     Поэтому тавтология
     $$E^{\\mathrm{blk}}(I_1,b_1)\\wedge E^{\\mathrm{blk}}(I_2,b_2)\\to E^{\\mathrm{blk}}(I_1\\triangle I_2,b_1\\oplus b_2)$$
     имеет bounded‑depth Frege‑вывод размера $2^{O(k)}$ (Lemma 4 из GIRS’19, как в §16.130).
  2) Подстановкой $y_i\\mapsto P_i$ получаем вывод на исходных переменных. Так как блоки дизъюнктны, семантически
     $$\\bigoplus_{i\\in I} y_i\\ =\\ \\bigoplus_{x\\in S_I} x,$$
     то подстановочная формула действительно представляет уравнение $E(S_I,b)$.
- `Toy‑тест:` $k=2$: из $y_1=b_1$ и $y_2=b_2$ следует $y_1\\oplus y_2=b_1\\oplus b_2$; подстановка даёт merge для двух дизъюнктных блоков.
- `Статус:` частично (локальная формализация: merge становится «лёгким», если **уже есть** формулы $P_i$ для паритетов блоков и мы разрешаем представлять уравнения как DNF по этим $P_i$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` закрыть разрыв «representation vs proof»: в стратегии Håstad–Risse паритеты блоков $P_i$ существуют (как small depth‑$d$ формулы), но нужен способ **переиспользовать** их в последовательности шагов без накопления базы/без роста числа блоков; формально: можно ли держать все промежуточные уравнения как $E^{\\mathrm{blk}}(I,b)$ над текущим набором блок‑паритетов так, чтобы каждый шаг менял $k$ лишь на $O(1)$ и сохранял $2^{O(k)}=\\mathrm{poly}(n)$?

### 16.138. Исследовательский шаг: в Schoenfield‑Frege подстановка фиксирует отрицание синтаксически ($\\sigma(\\neg p)=\\neg\\sigma(p)$), поэтому «две отдельные OR‑формулы для паритета и его отрицания» не образуют пару литералов

- `Линза:` Сжатие/канонизация.
- `Утверждение:` В Schoenfield‑Frege (Håstad–Risse’25, §2.1; `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`) применение правила — это подстановка $\\sigma$ в схему вывода,
  и для любой переменной $p$ выполняется тождество **синтаксической** подстановки
  $$\\sigma(\\neg p)=\\neg\\sigma(p).$$
  Следовательно, нельзя «встроить» в одно применение правила пару формул $P(x),N(x)$ так, чтобы $P$ играла роль литерала $p$, а $N$ — роль литерала $\\neg p$, если только $N$ **буквально** не равна $\\neg P$ как формула.
  Это проясняет разрыв в Håstad–Risse’25, §1.2: там «PARITY и $\\neg$PARITY» на блоке представлены **двумя** малыми depth‑$d$ формулами с выходным $\\vee$,
  но сами правила Frege обращаются с отрицанием только как с *синтаксическим* $\\neg$ (а не как с «любым эквивалентным представителем отрицания»), поэтому такая пара не даёт автоматически Cut/резольвинг на уровне блоков без потери глубины.
- `Доказательство:` по определению (Håstad–Risse’25, §2.1) если в схеме правила встречаются одновременно $p$ и $\\neg p$, то после подстановки получаем одновременно $\\sigma(p)$ и $\\sigma(\\neg p)=\\neg\\sigma(p)$.
  Поэтому если хотим реализовать «$p\\mapsto P$ и $\\neg p\\mapsto N$», необходимо $N=\\neg P$ как формула. Для произвольной пары семантически противоположных формул это неверно.
- `Toy‑тест:` для 1‑переменной $P(x)=x$ и $N(x)=\\neg x$ имеем $N=\\neg P$, и подстановка действительно согласует обе полярности.
  Но уже для 2‑переменной паритетной пары можно взять
  $P(x,y)=(x\\wedge\\neg y)\\vee(\\neg x\\wedge y)$ и $N(x,y)=(x\\wedge y)\\vee(\\neg x\\wedge\\neg y)$ (оба с выходным $\\vee$);
  тогда $N\\not\\equiv_{\\text{synt}} \\neg P$, и одной подстановкой нельзя заставить $N$ играть роль «$\\neg P$» в экземплярах правил.
- `Статус:` доказано (точная «синтаксическая» причина, почему representation «PARITY + $\\neg$PARITY как две OR‑формулы» не автоматически даёт возможность делать Cut‑шаги на этих представителях без выхода за глубину).
- `Барьер‑чек:` r — неприменимо (это чисто синтаксическое свойство Frege‑правил), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли для конкретных HR‑представителей PARITY построить в bounded‑depth Frege **полиномиальные** доказательства эквивалентностей вида $N\\leftrightarrow\\neg P$ без выхода за глубину $d$ (или зафиксировать, что такой «negation‑normalization» сам стоит quasi‑poly и тем самым объясняет, почему §1.2 даёт лишь representation).

### 16.139. Исследовательский шаг: если для block‑паритетов доказуема «согласованность полярностей» $N_i\\leftrightarrow\\neg P_i$, то «representation» Håstad–Risse превращается в реальный подстановочный Frege‑шаг

- `Линза:` Двойственность/комплементы.
- `Утверждение:` Пусть $X=\\biguplus_{i=1}^k B_i$ — разбиение на дизъюнктные блоки, и заданы формулы $P_i(x_{B_i})$ и $N_i(x_{B_i})$ глубины $\\le d_0$, такие что семантически $N_i\\equiv\\neg P_i$.
  Предположим, что в bounded‑depth Frege (глубины $O(d_0)$) существует polynomial‑size вывод **согласованности**
  $$\\mathrm{Cons}_i:\\qquad N_i\\leftrightarrow\\neg P_i\\qquad (i\\in[k]).$$
  Тогда любой «абстрактный» вывод на переменных $y_1,\\dots,y_k$ (где $y_i$ означает «паритет $B_i$ равен 1») можно реализовать на исходных переменных так, чтобы
  положительная полярность $y_i$ интерпретировалась как $P_i$, а отрицательная $\\neg y_i$ — как $N_i$, с полиномиальным blow‑up по размеру и без выхода за глубину $O(d_0)$.
  В частности, tautология из §16.130 (и «easy case» merge из §16.137) остаётся polynomial‑size выводимой при такой dual‑rail интерпретации.
- `Доказательство:` берём bounded‑depth Frege‑вывод $\\pi$ tautологии на $y$‑переменных из §16.130:
  $$E^{\\mathrm{blk}}(I_1,b_1)\\wedge E^{\\mathrm{blk}}(I_2,b_2)\\to E^{\\mathrm{blk}}(I_1\\triangle I_2,b_1\\oplus b_2).$$
  1) Подстановкой $y_i\\mapsto P_i$ получаем вывод $\\pi'$ той же импликации, но с отрицательными литералами в виде $\\neg P_i$ (см. §16.130).
  2) Для каждого $i$ из $\\mathrm{Cons}_i$ и правила «замены эквивалентных» (локально: из $A\\leftrightarrow B$ выводимо $\\neg A\\leftrightarrow\\neg B$ и $(A\\vee C)\\leftrightarrow (B\\vee C)$; эти тавтологии зависят от $O(1)$ атомов и потому имеют константные bounded‑depth Frege‑выводы, как в §16.130) получаем, что можно **внутри любой формулы‑контекста** заменить каждое вхождение $\\neg P_i$ на $N_i$, сохраняя выводимость и увеличивая размер не более чем полиномиально от размера контекста.
  Применяя это ко всем литералам в $E^{\\mathrm{blk}}$ (размер $2^{O(k)}$), получаем требуемый вывод с полярностями $(P_i,N_i)$.
- `Toy‑тест:` $k=1$. Абстрактный шаг: из $y=0$ выводится $\\neg y=1$ (и наоборот) — это просто исключённое третье. После подстановки получаем $P_1=0\\vdash \\neg P_1=1$, а затем по $\\mathrm{Cons}_1$ можно заменить $\\neg P_1$ на $N_1$.
- `Статус:` доказано (редукция: центральный узел — цена доказательства $N_i\\leftrightarrow\\neg P_i$; без неё «двухформульное» representation из HR §1.2 не становится подстановочной симуляцией).
- `Барьер‑чек:` r — неприменимо (свойство синтаксической симуляции в фиксированном proof system), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для HR‑конструкции PARITY/$\\neg$PARITY на блоке попытаться либо (a) построить poly‑size bounded‑depth вывод $N\\leftrightarrow\\neg P$ (т.е. «consistency axiom»), либо (b) выявить место, где такой вывод должен стоить quasi‑poly и тем самым объясняет «representation, not proof» из §1.2.

### 16.140. Исследовательский шаг: «запас по глубине» убирает нужду в отдельной OR‑формуле для $\\neg\\mathrm{PARITY}$ — можно использовать синтаксическое $\\neg P$ (и при желании OR‑выход через добавление $\\bot$)

- `Линза:` Трейд‑офф.
- `Утверждение:` В Schoenfield‑языке $\\{\\vee,\\neg\\}$ (Håstad–Risse’25, §2.1) глубина формулы — число чередований $\\vee/\\neg$ на пути.
  Тогда для любой формулы $A$ выполняется
  $$\\depth(\\neg A)\\le \\depth(A)+1.$$
  Следовательно, если в bounded‑depth Frege мы умеем представлять block‑паритет формулой $P$ глубины $\\le d-1$, то обе полярности доступны **синтаксически** в глубине $\\le d$ как $P$ и $\\neg P$, и подстановочные шаги типа §16.130–§16.137 не требуют отдельной формулы $N$ и отдельного вывода $N\\leftrightarrow\\neg P$.
  Если же для конкретного «клауза‑стиля» нужно, чтобы литерал имел выход $\\vee$, можно заменить $\\neg P$ на
  $$N:=\\neg P\\vee\\bot,$$
  и тогда $N$ имеет выход $\\vee$, а тавтология $N\\leftrightarrow\\neg P$ имеет константный Frege‑вывод (по подстановке в схему $(\\neg p\\vee\\bot)\\leftrightarrow\\neg p$).
  Цена по глубине при таком «OR‑обёртывании» — $\\depth(N)\\le \\depth(P)+2$.
- `Доказательство:` добавление одного верхнего $\\neg$ к формуле либо добавляет один новый блок чередования (если корень $A$ — $\\vee$), либо не меняет число чередований (если корень $A$ — $\\neg$), поэтому $\\depth(\\neg A)\\le\\depth(A)+1$.
  Для $N:=\\neg P\\vee\\bot$ глубина увеличивается ещё максимум на 1 из‑за верхнего $\\vee$.
  Эквивалентность $N\\leftrightarrow\\neg P$ — экземпляр фиксированной тавтологии на одном атоме, значит имеет bounded‑depth Frege‑вывод размера $O(1)$, а подстановка даёт вывод для произвольного $P$.
- `Toy‑тест:` $A=p\\vee q$ имеет $\\depth(A)=1$, а $\\neg A$ имеет $\\depth=2$.
  Если $A=\\neg p$, то $\\neg A=\\neg\\neg p$ и число чередований не растёт.
- `Статус:` доказано (формально: «негативная полярность» не требует отдельной HR‑формулы, если можно позволить себе константный запас по глубине для явного $\\neg$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, позволяет ли HR‑representability для PARITY на одном блоке ($n$ переменных) с глубиной $d\\approx\\log n/\\log\\log n$ «съесть» константный запас (например, строить $P$ глубины $d-2$ размера $\\mathrm{poly}(n)$), чтобы отрицательные литералы в §16.130–§16.137 реализовывались как $\\neg P$ (или $\\neg P\\vee\\bot$) без выхода за целевую глубину.

### 16.141. Исследовательский шаг: константный «запас по глубине» совместим с порогом $d\\approx\\log n/\\log\\log n$ для representability PARITY при $M=\\mathrm{poly}(n)$

- `Линза:` Трейд‑офф.
- `Утверждение:` Пусть выполнен representation‑факт Håstad–Risse’25, §1.2: при ограничении «каждая строка имеет depth $d$ и size $M$» можно выписать формулу,
  представляющую $\\mathrm{PARITY}$ на блоке из
  $$m=(\\log M)^{d-1}$$
  переменных (и аналогично для отрицания).
  Тогда при $d=\\Theta(\\log n/\\log\\log n)$ константная потеря глубины не мешает покрыть блок ширины $n$ при polynomial $M$:
  существует константа $C>1$ такая, что при $M:=n^C$ и $d:=\\left\\lceil\\frac{\\log n}{\\log\\log n}\\right\\rceil+2$ выполняется
  $$(\\log M)^{(d-1)-1}=(\\log M)^{d-2}\\ge n.$$
  В частности, можно выбрать представителя паритета $P$ глубины $\\le d-1$ и размера $\\mathrm{poly}(n)$, а его отрицание брать как синтаксическое $\\neg P$ глубины $\\le d$ (см. §16.140).
- `Доказательство:` положим $M=n^C$, тогда $\\log M=C\\log n$ и нужно доказать $(C\\log n)^{d-2}\\ge n$, т.е.
  $$ (d-2)\\,\\log(C\\log n)\\ \\ge\\ \\log n.$$
  При $d=\\left\\lceil\\frac{\\log n}{\\log\\log n}\\right\\rceil+2$ имеем $d-2\\ge \\frac{\\log n}{\\log\\log n}$, поэтому
  $$(d-2)\\log(C\\log n)\\ \\ge\\ \\frac{\\log n}{\\log\\log n}\\cdot\\bigl(\\log\\log n+\\log C\\bigr)\\ =\\ \\log n+\\frac{\\log C}{\\log\\log n}\\,\\log n\\ \\ge\\ \\log n.$$
  Отсюда $(C\\log n)^{d-2}\\ge 2^{\\log n}=n$.
- `Toy‑тест:` $n=2^{64}$, $C=4$, $d=\\lceil 64/6\\rceil+2=13$.
  Тогда $\\log M=4\\log n=256$ и $(\\log M)^{d-2}=256^{11}=2^{88}>2^{64}=n$.
- `Статус:` доказано (арифметика параметров: использование $\\neg P$ в §16.140 требует лишь $O(1)$ запаса по глубине, и этот запас совместим с порогом $d\\approx\\log n/\\log\\log n$ при $M=\\mathrm{poly}(n)$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` зафиксировать точную формулировку representation‑факта из HR’25 §1.2 как отдельную «известную лемму» (какие именно глубина/база/выходной символ допускаются), чтобы не было скрытого +O(1) к глубине; затем вернуться к основному узлу: синтаксическая симуляция XOR‑сложения (Gaussian elimination step) внутри bounded‑depth Frege.

### 16.142. Исследовательский шаг: точная формулировка HR’25 §1.2 “representing parity” и стандартный upper bound для PARITY (Håstad’86, Remark 6)

- `Линза:` Эквивалентность.
- `Утверждение:` В Håstad–Risse’25, §1.2 (`../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`) representation‑шаг формулируется в модели Schoenfield‑Frege (§2.1: база $\\{\\vee,\\neg\\}$, глубина = число чередований $\\vee/\\neg$), и содержит конкретную параметрику:
  для уравнения паритета на $m$ переменных и ограничения «line size $\\le M$, line depth $\\le d$» авторы пишут:
  «divide the variables into groups of size $(\\log M)^{d-1}$ and write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity of each group… assume output gate is an or»
  (см. §1.2, абзац начиная с “Let us consider proofs that contain formulas of depth d…”).
  Это согласуется со стандартным (известным) upper bound для схем PARITY: Håstad’86, Remark 6 (`../../resources/downloads/hastad_1986.pdf`, p. 10) отмечает, что PARITY имеет depth‑$k$ схемы размера вида
  $$\\mathrm{size}\\ \\le\\ n\\cdot 2^{\\,O\\bigl(n^{1/(k-1)}\\bigr)}\\ =\\ \\exp\\bigl(O(n^{1/(k-1)})\\bigr).$$
  Инверсия даёт именно блок‑размер $n=\\Theta((\\log M)^{k-1})$ при заданном лимите $M$ (с точностью до констант в $O(\\cdot)$), то есть HR‑параметрика $(\\log M)^{d-1}$ — стандартная “solve $M=\\exp(O(n^{1/(d-1)}))$”.
- `Доказательство:` из Håstad’86 Remark 6 берём existence upper bound $\\mathrm{size}\\le \\exp(C\\,n^{1/(k-1)})$ для некоторой константы $C$ (при фиксированной глубине $k$).
  Положим $n:=\\bigl(\\tfrac{\\log M}{2C}\\bigr)^{k-1}$. Тогда $C\\,n^{1/(k-1)}=\\tfrac12\\log M$, и размер удовлетворяет
  $$\\mathrm{size}\\le \\exp(C\\,n^{1/(k-1)})\\le \\exp(\\tfrac12\\log M)=\\sqrt M\\le M.$$
  Следовательно, существует depth‑$k$ формула размера $\\le M$, вычисляющая PARITY на $\\Omega((\\log M)^{k-1})$ переменных. Для HR‑потребности «выход $\\vee$» можно применить OR‑обёртку $A\\mapsto A\\vee\\bot$ (см. §16.140) с константным overhead по глубине/размеру.
- `Toy‑тест:` если $k=3$, то bound имеет вид $\\exp(O(\\sqrt n))$; инверсия даёт $n=\\Theta((\\log M)^2)$, что совпадает с HR‑формулой $(\\log M)^{d-1}$ при $d=3$.
- `Статус:` известно/зафиксировано (точная ссылка + формальный вывод параметрики; теперь «representability PARITY на $(\\log M)^{d-1}$» не висит на неформальном “write down formulas”).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` вернуться к ядру Q39: даже при доступности формул $P$ для промежуточных уравнений нужен poly‑size bounded‑depth Frege‑вывод шага XOR‑сложения (Gaussian elimination) **между** такими представлениями; попытаться формализовать/убить toy‑случай «одна общая переменная пересечения» по аналогии с резолюцией из HR §1.2.

### 16.143. Исследовательский шаг: toy‑случай XOR‑шага при пересечении в одной переменной редуцируется к §16.130 с $k\\le k_1+k_2+1$ (если обе строки уже записаны как паритет по блокам)

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Пусть есть два XOR‑уравнения на множествах переменных $S_1,S_2\\subseteq X$ с
  $$S_1\\cap S_2=\\{x\\}.$$
  Предположим, что каждое уравнение уже записано в «block‑форме» из §16.130:
  существуют разбиения на непересекающиеся блоки
  $$S_1=\\biguplus_{i=1}^{k_1}B_i,\\qquad S_2=\\biguplus_{j=1}^{k_2}C_j,$$
  и для каждого блока есть формулы, представляющие его паритет (и отрицание), так что строки $E(S_1,b_1)$ и $E(S_2,b_2)$ реализуются как XOR по блок‑паритетам.
  Тогда существует разбиение $S_1\\cup S_2=\\biguplus_{t=1}^k D_t$ с
  $$k\\le k_1+k_2+1,$$
  относительно которого **обе** строки становятся объединениями блоков одного и того же разбиения, и потому один XOR‑шаг
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2)$$
  имеет bounded‑depth Frege‑вывод размера $2^{O(k)}$ (и, в частности, polynomial‑size при $k_1,k_2=O(\\log n)$).
- `Доказательство:`
  1) Обозначим через $B_{i^*}$ и $C_{j^*}$ единственные блоки, содержащие $x$ (существуют и единственны по непересечаемости разбиений).
  2) Построим совместное разбиение $\\mathcal D$ множества $S_1\\cup S_2$ так: оставим все блоки $B_i$ при $i\\ne i^*$ и все блоки $C_j$ при $j\\ne j^*$, а пересекающиеся в $x$ блоки «разрежем»:
     $$B_{i^*}=\\{x\\}\\uplus (B_{i^*}\\setminus\\{x\\}),\\qquad C_{j^*}=\\{x\\}\\uplus (C_{j^*}\\setminus\\{x\\}).$$
     Тогда семейство блоков
     $$\\mathcal D:=\\{\\{x\\},\\ B_{i^*}\\setminus\\{x\\},\\ C_{j^*}\\setminus\\{x\\}\\}\\ \\cup\\ \\{B_i:i\\ne i^*\\}\\ \\cup\\ \\{C_j:j\\ne j^*\\}$$
     (выкидывая пустые множества) состоит из попарно непересекающихся подмножеств и покрывает $S_1\\cup S_2$.
     По счёту блоков получаем $k\\le (k_1-1)+(k_2-1)+3=k_1+k_2+1$.
  3) Каждое из $S_1,S_2$ является объединением блоков из $\\mathcal D$ (блоки вне соответствующего множества просто не берутся), поэтому оба уравнения можно рассматривать как XOR по одному фиксированному набору блок‑паритетов $\\{P_{D_t}\\}_{t\\in[k]}$.
     Тогда требуемый XOR‑шаг — тавтология на $k$ «атомах» (блок‑паритетах), и именно этот случай покрывает §16.130.
- `Toy‑тест:` $S_1=\\{x,a,b,c\\}$, $S_2=\\{x,d,e\\}$.
  Пусть $S_1$ разбито как $B_1=\\{x,a,b\\}$, $B_2=\\{c\\}$ ($k_1=2$), а $S_2$ как $C_1=\\{x,d\\}$, $C_2=\\{e\\}$ ($k_2=2$).
  Тогда $\\mathcal D=\\{\\{x\\},\\{a,b\\},\\{c\\},\\{d\\},\\{e\\}\\}$ и $k=5=k_1+k_2+1$, после чего XOR‑шаг сводится к §16.130 с $k=5$.
- `Статус:` частично (toy‑случай «пересечение = 1 переменная» не создаёт $k^2$‑взрыва при приведении двух block‑записей к общему разбиению; оставшаяся трудность Q39 — обеспечить саму block‑форму и её поддержание при динамическом base‑change).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить на реальной стратегии для grid, можно ли устроить вывод так, чтобы *каждый* локальный шаг обновления границы (добавление вершины/малого уравнения) имел пересечение $O(1)$ и при этом обе строки были записаны как XOR по $O(\\log n)$ блокам одного «текущего» разбиения; если нет — найти минимальное место, где неизбежно возникает пересечение по многим переменным или «поперечный» переход между несовместимыми разбиениями (и тогда снова включается барьер §16.132).

### 16.144. Исследовательский шаг: в column‑summing каждый локальный переход $t\\to t+1$ — XOR‑шаг с пересечением ровно в одном ребре (вершинное уравнение пересекает границу по одному ребру)

- `Линза:` Инвариант.
- `Утверждение:` Пусть $G$ — граф, $A\\subseteq V(G)$ и $v\\notin A$.
  Обозначим $E(v)$ — множество рёбер, инцидентных $v$, и $\\delta(A)$ — рёбра, имеющие ровно один конец в $A$.
  Тогда
  $$\\delta(A\\cup\\{v\\})\\ =\\ \\delta(A)\\triangle E(v).$$
  Более того, если у $v$ ровно один сосед в $A$, то $\\delta(A)\\cap E(v)$ состоит ровно из одного ребра.
  В частности, для стратегии из §16.134 на grid, где $A=R_{j,t}$ и $v=(t+1,j)$, имеем
  $$\\delta(R_{j,t+1})=\\delta(R_{j,t})\\triangle E(v),\\qquad |\\delta(R_{j,t})\\cap E(v)|=1,$$
  поэтому переход $t\\to t+1$ в «Gaussian elimination по модулю 2» реализуется как XOR‑шаг между одним промежуточным уравнением ширины $\\Theta(n)$ и одним вершинным уравнением постоянной ширины.
- `Доказательство:`
  1) Для любого ребра $e=uw$ неинцидентного $v$ принадлежность $e$ множеству $\\delta(A)$ и $\\delta(A\\cup\\{v\\})$ совпадает, так как статусы принадлежности концов к $A$ не меняются.
  2) Пусть $e$ инцидентно $v$, т.е. $e=vu$.
     Тогда $e\\in\\delta(A)$ эквивалентно условию $u\\in A$ (поскольку $v\\notin A$), а $e\\in\\delta(A\\cup\\{v\\})$ эквивалентно $u\\notin A\\cup\\{v\\}$, т.е. $u\\notin A$.
     Следовательно, для рёбер из $E(v)$ принадлежность к границе **инвертируется** при добавлении $v$, то есть именно рёбра $E(v)$ переключают членство в $\\delta$.
     Это и означает $\\delta(A\\cup\\{v\\})=\\delta(A)\\triangle E(v)$.
  3) Если у $v$ ровно один сосед $u\\in A$, то ровно одно ребро $vu$ из $E(v)$ имеет другой конец в $A$, и именно оно лежит в $\\delta(A)$.
     Значит $|\\delta(A)\\cap E(v)|=1$.
  4) Для grid и $A=R_{j,t}$ из §16.134 вершина $v=(t+1,j)$ имеет ровно одного соседа в $A$ (вершина $(t,j)$), поэтому применимы пункты 1–3.
  5) На уровне XOR‑уравнений это ровно правило сложения строк по модулю 2:
     XOR‑сумма уравнения по $\\delta(R_{j,t})$ и вершинного уравнения по $E(v)$ даёт уравнение по $\\delta(R_{j,t+1})$, а правая часть обновляется как $b_{t+1}=b_t\\oplus \\chi(v)$.
- `Toy‑тест:` $n=4$, $j=2$, $t=1$. Тогда $A=\\{(1,2)\\}$, $v=(2,2)$.
  Граница $\\delta(A)$ содержит ребро $(1,2)-(2,2)$, а остальные рёбра из $E(v)$ выходят наружу, поэтому $\\delta(A)\\cap E(v)=\\{(1,2)-(2,2)\\}$ и $\\delta(A\\cup\\{v\\})=\\delta(A)\\triangle E(v)$.
- `Статус:` доказано (геометрический факт: «локальные» шаги column‑summing всегда имеют пересечение $O(1)$, причём в простейшем варианте — ровно 1 ребро).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` совместить это с §16.143 и dyadic‑обновлением §16.136: выписать явную схему, как держать уравнения $\\delta(R_{j,t})$ в block‑форме с $k=O(\\log n)$ так, чтобы каждый локальный шаг $t\\to t+1$ требовал только (i) XOR‑шаг «пересечение=1» и (ii) $O(\\log n)$ disjoint‑merge операций; затем найти, где в стратегии для **всего** grid неизбежно появляется «поперечный» переход (и включается барьер §16.132), либо подтвердить, что можно обойтись одним 1D‑порядком.

### 16.145. Исследовательский шаг: «протокол» поддержания block‑формы для $\\delta(R_{j,t})$ с $k=O(\\log n)$ в column‑summing (локальный XOR‑шаг + $O(\\log n)$ dyadic‑merge)

- `Линза:` Сжатие/канонизация.
- `Утверждение:` Зафиксируем внутреннюю колонку $2\\le j\\le n-1$ и множества $R_{j,t}$ из §16.134.
  Обозначим через $L_{j,t}$ и $H_{j,t}$ два горизонтальных сегмента границы (слева/справа) и через $B_{j,t}$ вертикальное «фронтирное» ребро (если $t<n$), так что
  $$\\delta(R_{j,t})\\ =\\ L_{j,t}\\uplus H_{j,t}\\uplus \\{B_{j,t}\\}\\qquad (t<n)$$
  (см. §16.134; верхнего ребра нет для обычного $n\\times n$ grid).
  Тогда существует каноническое разбиение $\\mathcal P_{j,t}$ множества $\\delta(R_{j,t})$ на
  $$k_t\\le 2\\lfloor\\log_2 n\\rfloor+3$$
  дизъюнктных блоков (dyadic‑интервалы по строкам внутри $L_{j,t}$ и $H_{j,t}$ из §16.136, плюс singleton $\\{B_{j,t}\\}$),
  и переход $t\\to t+1$ можно реализовать без $k^2$‑взрыва:
  1) (XOR‑шаг.) По §16.144 имеем $\\delta(R_{j,t+1})=\\delta(R_{j,t})\\triangle E(v)$ для $v=(t+1,j)$ и $|\\delta(R_{j,t})\\cap E(v)|=1$.
     Если $E(\\delta(R_{j,t}),b_t)$ и $E(E(v),\\chi(v))$ записаны в block‑форме относительно разбиений $\\mathcal P_{j,t}$ и singleton‑разбиения $E(v)$,
     то по §16.143 XOR‑шаг выводит $E(\\delta(R_{j,t+1}),b_t\\oplus\\chi(v))$ в polynomial‑size при $k_t=O(\\log n)$.
  2) (Dyadic‑merge.) Чтобы поддерживать канонический вид $\\mathcal P_{j,t+1}$, достаточно отдельно для $L$ и $H$ выполнить dyadic‑обновление префикса $t\\mapsto t+1$ из §16.136:
     «добавить singleton новой строки» и затем сделать $O(\\log n)$ слияний соседних равных интервалов.
     Каждое такое слияние — disjoint‑merge и потому сводится к «easy case» §16.137 (то есть к §16.130 с $k=2$).
  Следовательно, в column‑summing поддержание block‑формы для всех $t$ сводится к $n$ локальным XOR‑шагам с пересечением 1 и $O(n\\log n)$ disjoint‑merge операциям,
  причём на каждом шаге число блоков остаётся $O(\\log n)$ (и base‑change происходит только между interval‑partition, где refinement линейный по §16.133).
- `Доказательство:`
  1) (Канонические блоки.) Отождествим рёбра $L_{j,t}$ с позициями $[t]$ по строковому порядку (аналогично для $H_{j,t}$).
     Применим §16.136 к каждому из двух префиксов длины $t$, получая dyadic‑разбиения на $\\le\\lfloor\\log_2 t\\rfloor+1\\le\\lfloor\\log_2 n\\rfloor+1$ интервалов.
     Добавив singleton $\\{B_{j,t}\\}$, получаем разбиение $\\mathcal P_{j,t}$ и оценку $k_t\\le 2(\\lfloor\\log_2 n\\rfloor+1)+1$.
  2) (XOR‑обновление границы.) По §16.144
     $$\\delta(R_{j,t+1})=\\delta(R_{j,t})\\triangle E(v),\\qquad |\\delta(R_{j,t})\\cap E(v)|=1,$$
     где $v=(t+1,j)$, а общим ребром является $B_{j,t}$.
     Так как $B_{j,t}$ в $\\mathcal P_{j,t}$ — singleton, а $E(v)$ можно разбить на singleton‑блоки (их $\\le 4$), XOR‑шаг попадает в условия §16.143
     с общим refinement‑разбиением размера $\\le k_t+O(1)=O(\\log n)$.
  3) (Dyadic‑нормализация.) После XOR‑шага в множествах $L,H$ появляется по одному новому ребру (строка $t+1$), то есть их префиксы увеличиваются на 1.
     Каноническое dyadic‑разбиение $[t+1]$ получается из разбиения $[t]$ добавлением singleton и затем $O(\\log n)$ merge‑операциями (§16.136).
     Каждая merge‑операция склеивает два дизъюнктных интервала и потому имеет polynomial‑size bounded‑depth Frege‑симуляцию по §16.137.
     Так как все разбиения — interval‑partition одного порядка, их уточнения не дают $k^2$‑взрыва (§16.133).
- `Toy‑тест:` $n=8$, $t=5$.
  Dyadic‑разбиение $[5]=[1,4]\\uplus[5,5]$, а $[6]=[1,4]\\uplus[5,6]$ получается добавлением singleton $[6,6]$ и merge $[5,5]\\uplus[6,6]\\mapsto[5,6]$.
  Для $\\delta(R_{j,5})$ это означает: на каждой из двух сторон добавляется одно ребро и делается один disjoint‑merge; затем XOR с вершиной $v=(6,j)$ меняет $B_{j,5}$ на $B_{j,6}$, имея пересечение ровно в $B_{j,5}$.
- `Статус:` доказано (редукция: внутри column‑summing нет необходимости в «поперечном» base‑change; поддержание $k=O(\\log n)$ сводится к пересечению‑1 XOR и dyadic‑merge).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` перейти от одного столбца к «суммированию столбцов» как у Håstad–Risse §1.2: понять, можно ли выбрать block‑формы для граничных уравнений двух соседних столбцов так, чтобы их большая общая часть (полоса из $n$ рёбер) уже была синхронизирована теми же dyadic‑блоками, и тогда XOR‑сложение столбцов станет прямым «easy case» §16.130 (без k^2); либо зафиксировать место, где неизбежна несогласованность разбиений (row↔column) и снова включается барьер §16.132.

### 16.146. Исследовательский шаг: сложение соседних столбцов в HR‑стратегии сводится к «easy case» §16.130 при фиксированном dyadic‑разбиении полос $S_j$

- `Линза:` Эквивалентность.
- `Утверждение:` Для $1\\le j\\le n-1$ обозначим через $S_j$ множество из $n$ горизонтальных рёбер между колонками $j$ и $j+1$ (упорядоченных по строкам).
  Пусть для каждой полосы $S_j$ фиксировано dyadic‑разбиение на $r=O(\\log n)$ дизъюнктных row‑interval блоков (каноническое из §16.136 для $[n]$),
  и доступно block‑представление (в смысле §16.130) уравнений вида $E(S_j,b)$ как XOR по блок‑паритетам этих $r$ блоков.
  Тогда «добавление соседнего столбца» в схеме Håstad–Risse §1.2 реализуется одним XOR‑шагом в «easy case»:
  если
  $$E(S_j,\\,b)\\qquad\\text{и}\\qquad E(S_j\\uplus S_{j+1},\\,c)$$
  записаны как XOR по блокам одного общего разбиения $S_j\\uplus S_{j+1}$ (объединение dyadic‑блоков на $S_j$ и на $S_{j+1}$), то bounded‑depth Frege выводит
  $$E(S_{j+1},\\,b\\oplus c)$$
  polynomial‑size (при глубине, контролируемой глубинами блок‑паритетов), поскольку
  $$(S_j)\\triangle(S_j\\uplus S_{j+1})=S_{j+1}.$$
  То есть большое пересечение размера $|S_j|=n$ не приводит к $k^2$‑base‑change: оно «схлопывается» на уровне общих блок‑атомов.
- `Доказательство:`
  1) (Симметрическая разность.) Так как $S_j\\cap S_{j+1}=\\varnothing$, имеем
     $$(S_j)\\triangle(S_j\\uplus S_{j+1})=((S_j\\triangle S_j)\\triangle S_{j+1})=\\varnothing\\triangle S_{j+1}=S_{j+1}.$$
  2) (Общее разбиение и параметр $k$.) Полосы $S_j$ и $S_{j+1}$ дизъюнктны, поэтому объединение их dyadic‑разбиений даёт разбиение
     $$S_j\\uplus S_{j+1}=\\biguplus_{t=1}^{k} D_t$$
     с $k\\le 2r=O(\\log n)$.
     Тогда оба уравнения $E(S_j,b)$ и $E(S_j\\uplus S_{j+1},c)$ являются объединениями блоков одного и того же разбиения $\\{D_t\\}$.
  3) (XOR‑шаг как «easy case».) По §16.130 для такого фиксированного block‑базиса существует bounded‑depth Frege‑вывод размера $2^{O(k)}=\\mathrm{poly}(n)$,
     доказывающий
     $$E(S_j,b)\\wedge E(S_j\\uplus S_{j+1},c)\\to E(S_{j+1},b\\oplus c).$$
  4) (Связь с HR §1.2.) Уравнение $E(S_j\\uplus S_{j+1},c)$ — это «уравнение столбца $j+1$» (граница полного столбца; частный случай §16.134 при $t=n$),
     а $E(S_j,b)$ — «уравнение полосы из первых $j$ столбцов» (граница вертикальной полосы).
     Следовательно, шаг «прибавить следующий столбец» в линейном рассуждении по модулю 2 редуцируется к одному XOR‑шагу в режиме §16.130.
- `Toy‑тест:` $n=6$.
  Каноническая dyadic‑разбивка $[6]=[1,4]\\uplus[5,6]$ задаёт по два блока на каждой полосе $S_j$.
  Тогда $E(S_j,b)$ использует два блока полосы $S_j$, а $E(S_j\\uplus S_{j+1},c)$ использует четыре блока на $S_j\\uplus S_{j+1}$.
  Их XOR‑сложение отменяет оба блока на $S_j$ и оставляет ровно два блока на $S_{j+1}$.
- `Статус:` доказано (соседние столбцы не требуют «поперечного» base‑change: достаточно фиксировать одинаковые dyadic‑блоки на общей полосе $S_j$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` уточнить оставшийся узел Q39: в §16.145–§16.146 базисная часть Gaussian elimination на grid редуцировалась к «easy case» на $k=O(\\log n)$ блок‑атомах;
  теперь надо либо (a) формально контролировать глубину блок‑паритетов при всех необходимых dyadic‑merge (чтобы не вылезти в $O(\\log n)$), либо (b) выделить место в полном HR‑выводе, где всё же требуется base‑change между несовместимыми разбиениями (и тогда возвращается барьер §16.132).

### 16.147. Исследовательский шаг: caveat — Håstad’86, Remark 6 говорит про **схемы**, а для Frege‑линий нужны **формулы**; наивная «развёртка» схемы в формулу даёт blow‑up $M^{\\Theta(d)}$

- `Линза:` Модельный стресс‑тест.
- `Утверждение:` Ссылка Håstad’86, Remark 6 (`../../resources/downloads/hastad_1986.pdf`) даёт upper bound для PARITY в модели **depth‑$d$ схем**.
  Но в Schoenfield‑Frege строки — это **формулы** (деревья), и общий перевод «схема → эквивалентная формула той же глубины» может раздувать размер до $M^{O(d)}$.
  В частности, если единственное обоснование representability‑параметрики $(\\log M)^{d-1}$ опирается на Remark 6, то на пороговой глубине $d\\approx \\log n/\\log\\log n$ при $M=\\mathrm{poly}(n)$ развёртка даёт лишь quasi‑poly размер и не закрывает нужный режим.
- `Доказательство:`
  Пусть $C$ — булева схема размера $S$ и глубины $d$ (один выход).
  Построим эквивалентную формулу $F$ «развёрткой DAG в дерево»: корень — выход схемы; для узла‑вхождения гейта $g$ добавляем в формулу соответствующий символ и рекурсивно разворачиваем его входы, **копируя** подформулы при каждом новом использовании $g$.
  Тогда глубина $F$ равна глубине $C$.
  Оценим размер: каждое вхождение гейта в развёртке соответствует некоторому пути в схеме, идущему от этого гейта к выходу.
  Длина пути $\\le d$, и на каждом шаге можно перейти не более чем в один из $\\le S$ гейтов следующего уровня, значит число различных путей от любого гейта к выходу грубо ограничено $S^{d}$.
  Следовательно, каждый из $S$ гейтов может появиться в развёртке не более чем $S^{d}$ раз, и
  $$|F|\\ \\le\\ S\\cdot S^{d}\\ =\\ S^{d+1}\\ =\\ S^{O(d)}.$$
  Подстановка $S:=M=n^C$ и $d:=\\Theta(\\log n/\\log\\log n)$ даёт
  $$|F|\\ \\le\\ n^{C(d+1)}\\ =\\ 2^{\\Theta(\\log^2 n/\\log\\log n)},$$
  то есть quasi‑poly, а не polynomial.
- `Toy‑тест:` $n=2^{64}$, $M=n^4=2^{256}$, $d=13$.
  Тогда даже грубая оценка развёртки даёт $|F|\\le M^{14}=2^{3584}$.
- `Статус:` выявлен точный провал: Remark 6 сам по себе не обосновывает «формульную» representability‑часть в режиме $d\\approx\\log n/\\log\\log n$ (развёртка даёт именно тот $M^{\\Theta(d)}$, который HR отмечают как недостаточный).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти (или вывести) **формульный** upper bound для PARITY в нужной модели (глубина как у HR, база $\\{\\vee,\\neg\\}$, OR‑выход), дающий размер $M$ на блоке $(\\log M)^{d-1}$; затем вернуться к узлу Q39 про контроль глубины при dyadic‑merge без накопления $O(\\log n)$.

### 16.148. Исследовательский шаг: явный конструктивный upper bound для $\\mathrm{PARITY}$ формулами глубины $d$ даёт лишь $\\log \\mathrm{size}=O((d-1)\\,m^{1/(d-1)})$ (DNF‑композиция) — этого недостаточно на пороге

- `Линза:` Трейд‑офф.
- `Утверждение:` Для целых $d\\ge 2$ и $t\\ge 2$ положим $m:=t^{d-1}$.
  Тогда существуют формулы (в De Morgan виде, с OR‑выходом) глубины $d$ и размера
  $$\\mathrm{size}\\ \\le\\ \\mathrm{poly}(m)\\cdot 2^{\\,O((d-1)\\,t)}\\ =\\ \\exp\\bigl(O((d-1)\\,m^{1/(d-1)})\\bigr),$$
  вычисляющие $\\mathrm{PARITY}_m$ и $\\neg\\mathrm{PARITY}_m$.
  Инверсия даёт: чтобы уложиться в размер $\\le M$, из этого конструктивного bound’а следует лишь
  $$m\\ \\le\\ \\left(\\Theta\\!\\left(\\frac{\\log M}{d-1}\\right)\\right)^{d-1},$$
  то есть на пороге $d\\approx\\log n/\\log\\log n$ при $M=\\mathrm{poly}(n)$ такой подход покрывает только $n^{o(1)}$ переменных и не оправдывает целевой блок $(\\log M)^{d-1}\\ge n$.
- `Доказательство:`
  1) (Композиция блоков.) Для $m=t^{d-1}$ разобьём переменные на $t$ блоков по $t^{d-2}$ переменных.
     Пусть $P_{d-1}$ и $N_{d-1}$ — формулы глубины $d-1$, вычисляющие паритет/непаритет на $t^{d-2}$ переменных.
     Тогда $\\mathrm{PARITY}_m$ можно выписать как DNF по $t$ «литералам‑блокам»:
     $$\\bigvee_{a\\in\\{0,1\\}^t:\\ \\oplus_i a_i=1}\\ \\bigwedge_{i=1}^t L_i(a),\\qquad L_i(a):=\\begin{cases}P_{d-1}(\\text{block }i),&a_i=1\\\\N_{d-1}(\\text{block }i),&a_i=0.\\end{cases}$$
     Аналогично для $\\neg\\mathrm{PARITY}_m$ (берём $\\oplus_i a_i=0$). OR‑выход сохранён.
  2) (Рекурсия на размере.) Обозначим через $S(d,m)$ размер такого построения.
     Тогда при $m=t^{d-1}$ имеем
     $$S(d,\\,t^{d-1})\\ \\le\\ 2^{t}\\cdot O(t)\\cdot S(d-1,\\,t^{d-2}).$$
     База $d=2$: DNF для паритета на $t$ переменных имеет $2^{t-1}$ термов и размер $S(2,t)\\le 2^{t}\\cdot O(t)$.
     Индукцией получаем $S(d,t^{d-1})\\le 2^{(d-1)t}\\cdot \\mathrm{poly}(t)\\le \\mathrm{poly}(m)\\cdot 2^{O((d-1)t)}$.
  3) (Инверсия.) Если $S(d,m)\\le M$, то из $\\log M\\ge \\Omega((d-1)\\,m^{1/(d-1)})$ следует
     $m\\le (\\Theta((\\log M)/(d-1)))^{d-1}$.
     При $d=\\Theta(\\log n/\\log\\log n)$ и $M=n^{O(1)}$ имеем $(\\log M)/(d-1)=\\Theta(\\log\\log n)$, значит
     $$m\\ \\le\\ (\\Theta(\\log\\log n))^{\\Theta(\\log n/\\log\\log n)}\\ =\\ n^{o(1)}\\ll n.$$
- `Toy‑тест:` $n=2^{64}$, $M=n^4$ (так что $\\log M=256$), $d=13$ (то есть $d-1=12$).
  Тогда оценка даёт максимум
  $$m\\ \\lesssim\\ (256/12)^{12}\\ \\approx\\ 21^{12}\\ \\approx\\ 2^{53}\\ <\\ 2^{64}=n.$$
- `Статус:` получен честный «слишком слабый» формульный upper bound: DNF‑композиция действительно даёт ровно тот тип blow‑up по $d$, который делает representability на пороге недоказанной.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти (или опровергнуть) существенно более сильный **формульный** upper bound для $\\mathrm{PARITY}$ глубины $d\\approx\\log n/\\log\\log n$ (в духе схемного bound Håstad’86 без множителя $(d-1)$ в показателе); иначе representation‑редукция Q39 может быть заблокирована уже на уровне «PARITY в одном блоке».

### 16.149. Исследовательский шаг: множитель $d$ в экспоненте для PARITY‑формул **неустраним** (Rossman’16) ⇒ блок $(\\log M)^{d-1}$ при size $M$ невозможен для формул при растущем $d$

- `Линза:` Ссылка/барьер (закрыть «фольклор» точным фактом).
- `Утверждение:` Для unbounded fan-in De Morgan‑формул (деревьев) глубины $D\\ge 2$ функция $\\mathrm{PARITY}_n$ требует размера
  $$\\mathrm{size}\\ \\ge\\ 2^{\\,\\Omega\\bigl((D-1)\\,(n^{1/(D-1)}-1)\\bigr)}$$
  (Rossman’16, Thm. 3; см. `../../resources/downloads/rossman_2016_average_sensitivity_bounded_depth_formulas.pdf`).
  Следовательно, если формула глубины $D$ имеет размер $\\le M$ и вычисляет $\\mathrm{PARITY}_n$, то неизбежно
  $$n\\ \\le\\ \\left(\\Theta\\!\\left(\\frac{\\log M}{D-1}\\right)\\right)^{D-1}.$$
  В частности, при растущем $D$ нельзя иметь «representability‑блок» размера $(\\log M)^{D-1}$ при размере $M$ (как в эвристике HR §1.2): такой блок требует размера $\\ge M^{\\Omega(D)}$.
- `Доказательство:`
  1) (Lower bound.) Rossman’16, Thm. 3 утверждает для глубины $d+1$:
     $$\\mathrm{size}\\ge 2^{\\Omega(d(n^{1/d}-1))}.$$
     Положив $D:=d+1$, получаем stated bound $2^{\\Omega((D-1)(n^{1/(D-1)}-1))}$.
  2) (Инверсия.) Из $M\\ge 2^{\\Omega((D-1)(n^{1/(D-1)}-1))}$ следует
     $n^{1/(D-1)}\\le O((\\log M)/(D-1))+1$, то есть $n\\le (\\Theta((\\log M)/(D-1)))^{D-1}$ (для $n$ сверх констант).
  3) (Сопоставление с §16.148.) Верхняя оценка §16.148 даёт
     $$\\log\\mathrm{size}=O\\bigl((D-1)\\,n^{1/(D-1)}\\bigr),$$
     т.е. вместе с Rossman’16 множитель $(D-1)$ в показателе получается tight (с точностью до констант).
  4) (Провал блока $(\\log M)^{D-1}$.) Если взять $n:=(\\log M)^{D-1}$, то $n^{1/(D-1)}=\\log M$ и lower bound даёт
     $$\\mathrm{size}\\ge 2^{\\Omega((D-1)\\log M)}=M^{\\Omega(D-1)},$$
     что при растущем $D$ существенно больше $M$.
- `Toy‑тест:` $M=n^4$, $D=13$.
  Тогда «желанный» блок $n=(\\log M)^{12}=256^{12}=2^{96}$ потребовал бы по Rossman’16 размера $\\ge 2^{\\Omega(12\\cdot 256)}=2^{\\Omega(3072)}\\gg M=2^{256}$.
- `Статус:` закрыто как известный факт: для формул (fan-out 1) сильный upper bound без множителя $(D-1)$ невозможен; representability‑узел Q39 действительно «ломается» уже на уровне PARITY‑блоков при пороговой глубине.
- `Барьер‑чек:` r — неприменимо (без оракулов), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` пересобрать формулировку Q39: либо (a) HR §1.2 должен трактовать «size» не как tree‑size формулы (а как DAG/схема, что в Frege не строки), либо (b) для bounded‑depth Frege представление промежуточных XOR‑уравнений действительно требует quasi‑poly размера уже из-за PARITY‑формул, и тогда «gap по глубине» не сводится к одному XOR‑шагу.

### 16.150. Исследовательский шаг: глубина HR (= чередования $\\vee/\\neg$) сводится к De Morgan‑глубине $\\Theta(d)$ без потери размера ⇒ оценка Rossman’16 применима к строкам bounded‑depth Frege

- `Линза:` Эквивалентность.
- `Утверждение:` В HR’22 (Schoenfield‑Frege) формулы строятся над базой $\\{\\vee,\\neg\\}$; размер = число связок, глубина = число чередований $\\vee/\\neg$ на пути (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, §2.1, определения после строки “The size of a formula…”).
  Для любой такой формулы $A$ существует эквивалентная De Morgan‑формула $A^{\\mathrm{NNF}}$ (внутренние гейты $\\vee/\\wedge$, отрицания только на листьях) такая, что
  1) $|A^{\\mathrm{NNF}}|\\le |A|$ (с точностью до констант в выборе метрики размера),
  2) $\\mathrm{depth}_{\\wedge/\\vee}(A^{\\mathrm{NNF}})\\le \\lfloor d/2\\rfloor+1$, где $d:=\\mathrm{altdepth}_{\\vee/\\neg}(A)$.
  Следовательно, нижняя оценка Rossman’16 для PARITY‑**формул** по глубине (см. `../../resources/downloads/rossman_2016_average_sensitivity_bounded_depth_formulas.pdf`, Thm. 3) напрямую ограничивает representability в bounded‑depth Frege: при фиксированном $d$ и размере строки $\\le M$ паритет нельзя покрыть на блоке размера $(\\log M)^{d-1}$; максимум лишь $\\bigl(\\Theta((\\log M)/d)\\bigr)^{\\Theta(d)}$ (совпадает с §16.148–§16.149).
- `Доказательство:`
  1) (NNF‑перевод без blow‑up.) Определим $A^{\\mathrm{NNF}}$ рекурсией “push‑negation”:
     $$(\\neg B)^{\\mathrm{NNF}}:=\\mathrm{push}(\\neg,B),\\qquad (B_1\\vee\\cdots\\vee B_k)^{\\mathrm{NNF}}:=B_1^{\\mathrm{NNF}}\\vee\\cdots\\vee B_k^{\\mathrm{NNF}},$$
     а функция $\\mathrm{push}(s,\\cdot)$ для полярности $s\\in\\{+,-\\}$ задаётся правилами
     $$\\mathrm{push}(+,x)=x,\\ \\mathrm{push}(-,x)=\\neg x,$$
     $$\\mathrm{push}(+,\\neg C)=\\mathrm{push}(-,C),\\ \\mathrm{push}(-,\\neg C)=\\mathrm{push}(+,C),$$
     $$\\mathrm{push}(+,C_1\\vee\\cdots\\vee C_k)=\\bigvee_i \\mathrm{push}(+,C_i),\\qquad \\mathrm{push}(-,C_1\\vee\\cdots\\vee C_k)=\\bigwedge_i \\mathrm{push}(-,C_i).$$
     Это стандартный перевод в negation normal form: отрицания уходят на листья, а $\\vee$ под нечётной полярностью становится $\\wedge$. Размер при этом не растёт (каждый исходный узел $\\vee$ остаётся одним узлом $\\vee$ или $\\wedge$; двойные отрицания сокращаются).
  2) (Связь глубин.) Рассмотрим любой путь в $A$.
     Каждый новый внутренний гейт ($\\vee$ в $A^{\\mathrm{NNF}}$ или $\\wedge$) на этом пути соответствует некоторому исходному $\\vee$‑узлу на пути в $A$.
     Между двумя различными $\\vee$‑узлами на пути в $A$ должен встречаться хотя бы один $\\neg$ (иначе их можно слить ассоциативностью $\\vee$ без увеличения alternation depth).
     Поэтому число $\\vee$‑узлов на любом пути $\\le \\lfloor d/2\\rfloor+1$.
     Так как $\\mathrm{depth}_{\\wedge/\\vee}(A^{\\mathrm{NNF}})$ — это максимум числа $\\vee/\\wedge$‑узлов на пути, получаем заявленную оценку.
  3) (Применение Rossman’16.) Если строка bounded‑depth Frege имеет alternation depth $\\le d$ и size $\\le M$, то $A^{\\mathrm{NNF}}$ имеет De Morgan‑глубину $D\\le \\lfloor d/2\\rfloor+1$ и size $\\le O(M)$.
     Тогда по §16.149 (Rossman’16, Thm. 3 в терминах De Morgan‑глубины $D$) паритет на $n$ переменных требует
     $$M\\ \\ge\\ 2^{\\Omega\\bigl((D-1)(n^{1/(D-1)}-1)\\bigr)},$$
     что при инверсии даёт $n\\le (\\Theta((\\log M)/(D-1)))^{D-1}$, то есть $n\\le (\\Theta((\\log M)/d))^{\\Theta(d)}$.
- `Toy‑тест:` пусть $M=n^4$ и $d:=\\lceil\\log n/\\log\\log n\\rceil$.
  Тогда $(\\log M)/d=\\Theta(\\log\\log n)$ и bound $n\\le (\\Theta((\\log M)/d))^{\\Theta(d)}$ даёт лишь $n^{o(1)}$ переменных в одном PARITY‑блоке, в то время как $(\\log M)^{d-1}\\ge n$ — чисто арифметически; значит именно representability‑предпосылка ломается.
- `Статус:` доказано (сведение HR‑глубины к De Morgan‑глубине делает применение Rossman’16 к bounded‑depth Frege строкам формально корректным).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` перечитать HR §1.2 в исходном PDF: не используют ли они неявно **схемы**/DAG вместо tree‑формул при слове “formulas of size $M$”; если нет, то в Q39 следует считать representability‑часть закрытым препятствием и искать другой upper‑подход (не через широкие паритеты).

### 16.151. Исследовательский шаг: HR §1.2 “группы размера $(\\log M)^{d-1}$ и формулы размера $M$” — это лишь константно‑глубинная эвристика (с подавленным множителем $d$); при tree‑размере корректный блок $\\le \\bigl(\\Theta((\\log M)/(d-1))\\bigr)^{d-1}$, иначе нужен размер $\\ge M^{\\Omega(d)}$

- `Линза:` Уточнение формулировки (параметры/модель).
- `Утверждение:` В HR’22 формулы — **деревья**: “The size of a formula is the number of connectives … when A is viewed as a tree” (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, §2.1).
  В §1.2 они пишут: разбить переменные на группы размера $(\\log M)^{d-1}$ и “write down formulas of depth $d$ and size $M$ that represent the parity and the negation of the parity of each group” (там же, §1.2, абзац начиная с “Let us consider proofs…”).
  При этом в терминах их же меры (tree‑size + alternation depth) такая фраза совместима с известными bounds только если понимать “size $M$” с полиномиальной оговоркой (напр. $M^{\\Theta(d)}$) или считать $d$ константой и подавлять множитель $(d-1)$: для size $\\le M$ максимальный блок
  $$m\\ \\le\\ \\bigl(\\Theta((\\log M)/(d-1))\\bigr)^{d-1}$$
  (см. §16.148–§16.150), а для $m=(\\log M)^{d-1}$ требуется size $\\ge M^{\\Omega(d)}$ (см. §16.149).
- `Доказательство:`
  1) HR’22 фиксируют tree‑размер и глубину как alternations $\\vee/\\neg$ (§2.1), т.е. это именно формулы fan‑out 1.
  2) По §16.150 любую такую формулу глубины $d$ можно перевести в De Morgan‑формулу глубины $\\Theta(d)$ без увеличения размера, поэтому к строкам HR‑Frege применим lower bound Rossman’16 (Thm. 3), см. §16.149.
  3) Инверсия Rossman’16 даёт: если строка имеет size $\\le M$, то паритет можно покрыть лишь на $m\\le \\bigl(\\Theta((\\log M)/(d-1))\\bigr)^{d-1}$ переменных; подстановка $m=(\\log M)^{d-1}$ в §16.149 даёт необходимый размер $\\ge M^{\\Omega(d)}$.
- `Toy‑тест:` $M=n^4$, $d=13$ (так что $\\log M=256$).
  Тогда корректный блок $m\\lesssim(256/12)^{12}\\approx 2^{53}$, а “$(\\log M)^{12}$” дал бы $m=2^{96}$ и потребовал бы размера $\\ge M^{\\Omega(12)}$.
- `Статус:` уточнено: в HR §1.2 не скрыт DAG‑шэринг (они сами определяют tree‑формулы); “$(\\log M)^{d-1}$ при size $M$” следует читать как константно‑глубинную эвристику/подавление полиномиального фактора и не использовать при растущем $d$ в Q39.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` переформулировать Q39 как проблему **формул vs схем**: проверить, где именно в Håstad’20/HR’22 нижняя оценка опирается на fan‑out 1 (формулы), и даёт ли она тот же порог для “circuit‑Frege” (строки‑схемы).

### 16.152. Исследовательский шаг: блок $(\\log M)^{d-1}$ естественен для **схем** (fan‑out $>1$) из‑за sharing; для **формул** множитель $(d-1)$ в экспоненте неизбежен

- `Линза:` Трейд‑офф (size vs depth; формулы vs схемы).
- `Утверждение:` Пусть $d\\ge 2$, $t\\in\\mathbb N$, $m:=t^{d-1}$.
  Тогда существует unbounded fan-in De Morgan‑**схема** глубины $d$ размера $\\le \\mathrm{poly}(t)\\cdot 2^{O(t)}$, вычисляющая $\\mathrm{PARITY}_m$ (и аналогично $\\neg\\mathrm{PARITY}_m$).
  Следовательно, при размере $\\le M$ можно покрыть блок $m=(\\Theta(\\log M))^{d-1}$ — это ровно та зависимость, что стоит в HR §1.2.
  Для De Morgan‑**формул** же (fan‑out $=1$) та же “DNF‑композиция” даёт $\\mathrm{size}\\le 2^{\\Theta((d-1)t)}\\cdot\\mathrm{poly}(t)$ (см. §16.148), и Rossman’16 показывает, что множитель $(d-1)$ в экспоненте tight (§16.149).
- `Доказательство:`
  1) (База $d=2$.) $\\mathrm{PARITY}_t$ и $\\neg\\mathrm{PARITY}_t$ имеют DNF/CNF с $2^{t-1}$ термами/клауза́ми (полный перебор по значениям с нужным паритетом), т.е. схема глубины 2 размера $2^{O(t)}$.
  2) (Индукция по $d$; ключ: sharing.) Разобьём $m=t^{d-1}$ переменных на $t$ блоков по $t^{d-2}$.
     Пусть $P_{d-1}$ и $N_{d-1}$ — схемы глубины $d-1$, вычисляющие паритет/непаритет блока, размера $S_{d-1}$.
     Возьмём depth‑2 DNF для $\\mathrm{PARITY}$ на $t$ “литералах” $y_1,\\dots,y_t$:
     $$\\bigvee_{a\\in\\{0,1\\}^t:\\ \\oplus a=1}\\ \\bigwedge_{i=1}^t \\ell_i(a),\\qquad \\ell_i(a):=\\begin{cases}y_i,&a_i=1\\\\ \\neg y_i,&a_i=0.\\end{cases}$$
     и подставим $y_i:=P_{d-1}(\\text{block }i)$, $\\neg y_i:=N_{d-1}(\\text{block }i)$.
     В **схеме** каждый $P_{d-1}(\\text{block }i)$ и $N_{d-1}(\\text{block }i)$ вычисляется один раз и fan‑out’ится во все $2^{t-1}$ термов, поэтому
     $$S_d\\ \\le\\ t\\cdot( S_{d-1}+S_{d-1})\\ +\\ 2^{O(t)}\\cdot\\mathrm{poly}(t)\\ =\\ O(t)\\,S_{d-1}+2^{O(t)}\\mathrm{poly}(t).$$
     Индукцией из $S_2=2^{O(t)}$ получаем $S_d\\le 2^{O(t)}\\mathrm{poly}(t)$ (доминирует верхний уровень).
  3) (Следствие для блок‑размера.) Из $S_d\\le M$ следует $t=O(\\log M)$, значит $m=t^{d-1}=(\\Theta(\\log M))^{d-1}$.
  4) (Контраст с формулами.) В формуле тот же шаг требует копировать подформулу блока внутри каждого терма, давая множитель $2^{t}$ на каждом уровне и итог $2^{\\Theta((d-1)t)}$ (§16.148); это и есть «потерянный» множитель $(d-1)$ по сравнению со схемами.
- `Toy‑тест:` $M=n^4$, $d=13$ (так что $\\log M=256$, $t=\\Theta(256)$).
  Схемный bound допускает блок $m=t^{12}\\approx (256)^{12}=2^{96}$ при размере $\\approx 2^{O(256)}=n^{O(1)}$, тогда как для формул такой блок требует размера $\\ge M^{\\Omega(12)}$ (§16.149).
- `Статус:` доказано: HR‑зависимость $m=(\\log M)^{d-1}$ объясняется именно **sharing** (fan‑out) и соответствует схемному, а не формульному режиму.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` зафиксировать, какому proof system соответствует “circuit‑Frege” (строки‑схемы) и p‑эквивалентно ли оно EF; затем проверить, распространяется ли lower bound Håstad’20 на такой усиленный режим.

### 16.153. Исследовательский шаг: «строки‑схемы» = extension variables ⇒ circuit‑Frege p‑симулируется EF (и наоборот), так что спасение representability через sharing фактически переводит Q39 в EF‑режим

- `Линза:` Эквивалентность.
- `Утверждение:` Пусть $C$ — De Morgan‑**схема** (DAG) размера $S$ и глубины $d$ над входами $x_1,\\dots,x_m$.
  Тогда существует расширение переменных $\\{p_g\\}_{g\\in\\mathrm{Gates}(C)}$ и набор extension‑аксиом (по одной на гейт)
  $$p_g\\ \\leftrightarrow\\ \\mathrm{op}_g\\bigl(p_{g_1},\\dots,p_{g_k}\\bigr)$$
  такой, что в EF можно “представлять” значение схемы формулой размера $O(S)$ и глубины $O(d)$: выходная переменная $p_{\\mathrm{out}}$ играет роль результата $C(x)$.
  Следовательно, любой proof system, в котором линии разрешены как схемы (sharing), по сути совпадает (p‑эквивалентен) с EF: sharing ↔ abbreviations через extension variables (см. также Buss’97, §5.1 для мотивации).
- `Доказательство:`
  1) (Кодирование схемы extension‑переменными.) Для каждого входного литерала положим $p_{x_i}:=x_i$, $p_{\\neg x_i}:=\\neg x_i$.
     Для каждого внутреннего гейта $g$ схемы с детьми $g_1,\\dots,g_k$ вводим свежую переменную $p_g$ и добавляем extension‑формулу
     $$p_g\\leftrightarrow (p_{g_1}\\vee\\cdots\\vee p_{g_k})\\quad\\text{или}\\quad p_g\\leftrightarrow (p_{g_1}\\wedge\\cdots\\wedge p_{g_k})$$
     (или $p_g\\leftrightarrow\\neg p_{g_1}$, если $g$ — NOT‑гейт). Эти формулы имеют размер $O(k)$ и константную alternation‑глубину.
  2) (Почему это “представление”.) После добавления всех extension‑формул получаем, что каждый $p_g$ (под любым назначением $x$) равен значению под‑схемы $C_g(x)$; в частности, $p_{\\mathrm{out}}$ вычисляет $C(x)$.
     В терминах “representing parity” из HR §1.2 это означает: если паритет вычислим схемой глубины $d$ и размера $M$, то он автоматически представим EF‑линией размера $O(M)$ и глубины $O(d)$ (за счёт extension variables, т.е. DAG‑шеринга).
  3) (Связь с circuit‑Frege.) “Frege‑линии как схемы” можно рассматривать как Frege с разрешённым DAG‑шэрингом внутри строки; заменяя каждый общий под‑узел схемы на extension‑переменную, получаем EF‑режим с полиномиальным overhead по размеру.
     Обратное направление тривиально: EF‑линия уже есть формула с extension‑переменными, а значит вычисляет некоторую DAG‑схему (где extension‑переменные играют роль узлов с fan‑out $>1$).
- `Toy‑тест:` схемы из §16.152 для $\\mathrm{PARITY}_{t^{d-1}}$ глубины $d$ и размера $2^{O(t)}\\mathrm{poly}(t)$ превращаются в EF‑представления того же размера, т.е. при $t=\\Theta(\\log M)$ дают “блок” $(\\log M)^{d-1}$ без противоречия с Rossman’16 (потому что Rossman — про **формулы** без sharing).
- `Статус:` доказано: “починить” representability переходом от формул к схемам означает перейти к EF/circuit‑Frege (abbreviations); значит следующий вопрос Q39 — применимы ли LB Håstad’20/HR’22 к такому усиленному режиму.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` в Håstad’20/HR’22 найти точку, где требуется fan‑out 1 (дерево) в switching/evaluation‑аргументе, и решить: (a) LB распространяется на circuit‑Frege/EF‑вариант, или (b) именно здесь нужен нерелятивизирующий/не‑natural шаг.

### 16.154. Исследовательский шаг: EF даёт polynomial‑size refutation Tseitin(Grid) уже при $O(1)$‑глубине (в терминах $\\vee/\\neg$), поэтому LB Håstad’20 принципиально не распространяется на EF/circuit‑Frege

- `Линза:` Модельный стресс‑тест (что ломается при усилении модели).
- `Утверждение:` Для любого ограниченного по степени графа $G$ и заряда $\\chi$ с $\\bigoplus_{v\\in V}\\chi(v)=1$ существует EF‑рефутация
  $F:=\\mathrm{TseitinCNF}(G,\\chi)$ полиномиального размера, в которой **каждая строка имеет константную глубину** в смысле HR/Håstad (чередования $\\vee/\\neg$).
  В частности, для grid это даёт poly‑size refutation при глубине $O(1)$.
  Следовательно, любая попытка распространить нижнюю оценку Håstad’20 (Cor. 6.6) с bounded‑depth Frege на “circuit‑Frege”/EF невозможна: EF уже обходит порог $\\Omega(\\log N/\\log\\log N)$.
- `Доказательство:`
  1) (EF‑каркас.) См. §16.88: вводим extension‑переменные $p_v$ для XOR‑уравнений у вершин и переменную $P:=\\bigoplus_v p_v$.
     Из эквивалентности клауз ↔ XOR‑уравнений получаем $p_v\\leftrightarrow\\chi(v)$, откуда $P\\leftrightarrow\\bigoplus_v\\chi(v)=1$ и, значит, $P$.
     С другой стороны, раскрывая определения $p_v$ и перегруппировывая XOR (ассоц./коммутативность + сокращение $x\\oplus x\\leftrightarrow 0$), получаем
     $$P\\leftrightarrow\\bigoplus_{v\\in V}\\ \\bigoplus_{e\\ni v} x_e\\leftrightarrow\\bigoplus_{e\\in E}(x_e\\oplus x_e)\\leftrightarrow 0,$$
     то есть $\\neg P$. Противоречие.
  2) (Почему глубина $O(1)$.) Каждый extension‑шаг задаётся формулой константной глубины:
     бинарный XOR $a\\oplus b$ — константная формула в базисе $\\{\\vee,\\neg\\}$ (через $\\wedge:=\\neg(\\neg\\cdot\\vee\\neg\\cdot)$), а extension‑аксиомы имеют вид $p\\leftrightarrow\\varphi$ с $\\varphi$ константной глубины.
     Ассоциативность/коммутативность/сокращение XOR в §16.88 — это тавтологии на константном числе переменных, значит их инстанцирования в EF можно делать, не увеличивая глубину строк (линии содержат только переменные $p_*$, $x_*$ и константы).
  3) (Связь с circuit‑Frege.) По §16.153 любая “строка‑схема/sharing” p‑эквивалентна EF через extension variables, так что схемный режим действительно даёт тот же эффект: глубина строк может оставаться константой, скрывая большую схемную глубину в abbreviations.
- `Toy‑тест:` для 3‑регулярного $G$ формулы $p_v\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$ и шаги XOR‑перегруппировки используют лишь константные шаблоны (§16.88), а число введённых extension‑переменных $O(|V|+|E|)$.
- `Статус:` доказано (stress‑тест показывает: пороговая LB Håstad’20 — по сути про **формулы** fan‑out 1; в EF/circuit‑Frege глубина не является ограничением).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` в Håstad’20 явно указать, что доказательство работает только для Frege без extension variables, и локализовать в switching/evaluation‑аргументе место, где попытка включить extension‑переменные рушится (нужно “согласованно” рестриктить новые переменные, т.е. вычислять скрытую схему).

### 16.155. Исследовательский шаг: точка, где Håstad’20 жёстко использует “variables = edges” (fan‑out 1 по сути) — локальность через $\\mathrm{supp}(\\alpha)\\subseteq V$; extension variables ломают эту локальность и потому не входят в switching/evaluation‑framework

- `Линза:` Модельный стресс‑тест (локализовать зависимость от модели).
- `Утверждение:` В Håstad’20 локальная техника (restrictions + evaluations) опирается на то, что **каждая переменная соответствует ребру** и потому “затрагивает” лишь два конца ребра: для частичного присваивания $\\alpha$ определён
  $$\\mathrm{supp}(\\alpha)\\subseteq V\\quad\\text{как множество вершин, смежных с присвоенными переменными}$$
  (Håstad’20, §3: определения “complete assignment”, “support”, “locally consistent”, см. `../../resources/downloads/hastad_2020_small_depth_frege_tseitin_grids.pdf`, абзац начиная с “On a set $X$ of nodes …” и Definition 3.1).
  Из этого следует ключевой инвариант: путь decision‑tree глубины $t$, читающий только edge‑переменные, задаёт присваивание с
  $$|\\mathrm{supp}(\\alpha)|\\le 2t.$$
  Поэтому “малая глубина” автоматически означает “малая геометрическая поддержка” на grid, и можно говорить про giant component и замыкание $\\mathrm{cl}(X)$.
  Для EF/circuit‑Frege extension‑переменные $p$ не являются edge‑переменными: если трактовать $p$ как сокращение глобальной функции от многих рёбер (например, PARITY большого блока), то у неё нет малой поддержки, и инвариант $|\\mathrm{supp}(\\alpha)|\\le O(t)$ для глубины $t$ ломается уже при одном запросе $p$.
  Поэтому Håstad‑техника (в текущем виде) **не предназначена** для EF/circuit‑Frege: либо $p$ считается “свободной” переменной без поддержки (тогда теряется смысл extension‑аксиом), либо $\\mathrm{supp}(p)$ становится большим и рушит локальные леммы.
- `Доказательство:`
  1) (Локальность edge‑переменных.) В Tseitin(G) каждая переменная $x_e$ соответствует ребру $e=\\{u,v\\}$, значит при присваивании $x_e:=b$ в поддержку добавляются только $u,v$.
     Поэтому если decision tree спрашивает $t$ разных $x_e$, то множество затронутых вершин имеет размер $\\le 2t$.
  2) (Где это используется.) В §3 Håstad’20 рассматривает частичные присваивания с $|X|\\le 2n/3$ (где $X=\\mathrm{supp}(\\alpha)$) и выводит существование “giant component” в дополнении $X^c$ и корректность понятия $\\mathrm{cl}(X)$; это фундаментально для “locally consistent” и для того, чтобы evaluations работали с деревьями малой глубины.
  3) (Контр‑пример с extension variable.) Пусть в EF введена extension‑переменная $p\\leftrightarrow\\bigoplus_{e\\in E'} x_e$ для множества рёбер $E'$ размера $\\Theta(n)$ (например, граница большого прямоугольника).
     Если пытаться включить $p$ в ту же геометрию, естественно положить $\\mathrm{supp}(p):=\\bigcup_{e\\in E'}\\mathrm{supp}(x_e)$, что имеет размер $\\Theta(n)$.
     Тогда один запрос $p$ (глубина 1) уже порождает $|\\mathrm{supp}(\\alpha)|=\\Theta(n)$, и связка “глубина ⇒ малая поддержка” исчезает.
     Если же объявить $\\mathrm{supp}(p)=\\varnothing$ (чтобы сохранить $|\\mathrm{supp}(\\alpha)|\\le 2t$), то “locally consistent” перестаёт контролировать согласованность $p$ с рёбрами и extension‑аксиомами: значение $p$ можно выбирать независимо от $x$ без увеличения поддержки, что именно и даёт EF‑обход (§16.154).
- `Toy‑тест:` глобальная переменная $P$ из §16.88 (XOR всех вершинных $p_v$) в “поддержке‑по‑смыслу” затрагивает всю сетку, но как атомарная переменная имеет глубину 1; это несовместимо с инвариантом $|\\mathrm{supp}(\\alpha)|\\le 2t$.
- `Статус:` доказано как локализация: точка “fan‑out 1 / variables=edges” встроена в саму геометрию support/closure; потому Håstad‑LB не переносится на EF/circuit‑Frege без новой техники.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попробовать сформулировать промежуточную модель “local‑EF”: разрешать extension‑переменные только с $|\\mathrm{supp}(p)|\\le \\mathrm{polylog}(n)$, и проверить, остаётся ли возможным EF‑доказательство глубины $o(\\log n/\\log\\log n)$ или техника Håstad’20 начинает работать.

### 16.156. Исследовательский шаг: “local‑EF(s)” (extension‑переменные с ограниченной геометрической поддержкой) и факт: EF‑опровержение Tseitin через глобальный XOR неизбежно вводит переменную с поддержкой $\\Omega(|V|)$

- `Линза:` Инвариант (геометрическая поддержка).
- `Определение (support формулы):` Для Tseitin на графе $G=(V,E)$ и формулы $\\varphi$ над edge‑переменными $\\{x_e\\}_{e\\in E}$ положим
  $$\\mathrm{supp}(\\varphi):=\\bigcup\\{\\{u,v\\}: e=\\{u,v\\}\\in E\\text{ и }x_e\\text{ встречается в }\\varphi\\}\\ \\subseteq V.$$
- `Определение (local‑EF(s)):` Назовём EF‑доказательство $s$‑локальным, если для каждого extension‑шага $p\\leftrightarrow\\varphi$ выполняется
  $$|\\mathrm{supp}(\\varphi)|\\le s.$$
  (Т.е. сокращать разрешено только “локальные” подформулы по вершинам графа.)
- `Утверждение:` EF‑рефутация Tseitin(Grid) из §16.88/§16.154 **не** является $s$‑локальной ни для какого $s=o(|V|)$:
  в ней неизбежно появляется extension‑переменная $P$ с $|\\mathrm{supp}(P)|=\\Omega(|V|)$.
- `Доказательство:`
  1) В §16.88 вводится переменная $P\\leftrightarrow\\bigoplus_{v\\in V} p_v$, где каждое $p_v$ кодирует локальный паритет инцидентных рёбер вершины $v$.
  2) Для grid каждая вершина имеет константную степень, значит $|\\mathrm{supp}(p_v)|=O(1)$, но
     $$\\mathrm{supp}(P)=\\bigcup_{v\\in V}\\mathrm{supp}(p_v)=V,$$
     поскольку каждое $p_v$ зависит от рёбер, инцидентных $v$.
     Следовательно, $|\\mathrm{supp}(P)|=|V|=\\Theta(n^2)$.
  3) Значит для этого EF‑доказательства требуется $s\\ge |V|$; при $s=\\mathrm{polylog}(n)$ оно не попадает в local‑EF(s).
- `Toy‑тест:` для torus‑grid $|V|=n^2$: даже если все локальные $p_v$ имеют поддержку $\\le 5$, переменная $P$ имеет поддержку $n^2$.
- `Статус:` доказано (локальный вариант EF исключает “глобальный XOR”‑обход).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` понять, можно ли обойтись без глобальной переменной типа $P$ в local‑EF($\\mathrm{polylog}(n)$), или же любая poly‑size рефутация должна где‑то “раздуть” поддержку; попробовать адаптировать поддержку‑ориентированную версию evaluation‑метода Håstad’20 к local‑EF(s).

### 16.157. Исследовательский шаг: в local‑EF(s) локальность восстанавливается с потерей $\\times s$: decision tree глубины $t$ даёт присваивание с $|\\mathrm{supp}|\\le O(s\\,t)$ (если поддержка extension‑переменных определена через их формулы)

- `Линза:` Инвариант.
- `Утверждение:` Рассмотрим proof‑линию/формулу над edge‑переменными $\\{x_e\\}$ и extension‑переменными $\\{p_i\\}$, где каждый $p_i$ введён правилом extension $p_i\\leftrightarrow\\varphi_i(x)$ и $|\\mathrm{supp}(\\varphi_i)|\\le s$ (то есть мы находимся в local‑EF(s) по §16.156).
  Определим поддержку переменных как
  $$\\mathrm{supp}(x_{\\{u,v\\}}):=\\{u,v\\},\\qquad \\mathrm{supp}(p_i):=\\mathrm{supp}(\\varphi_i).$$
  Тогда любой decision tree $T$ глубины $t$, который спрашивает только переменные из $\\{x_e\\}\\cup\\{p_i\\}$, порождает по любому пути частичное присваивание $\\alpha$ с
  $$|\\mathrm{supp}(\\alpha)|\\le (2+s)\\,t.$$
  Следовательно, для $s=\\mathrm{polylog}(n)$ инвариант “малая глубина $\\Rightarrow$ малая геометрическая поддержка” (из Håstad’20/HR’22, §3) переносится на local‑EF(s) с потерей множителя $s$.
- `Доказательство:` Пусть путь в $T$ содержит $t$ запросов.
  Каждый запрос edge‑переменной $x_e$ добавляет в поддержку не более 2 вершин.
  Каждый запрос extension‑переменной $p_i$ по определению добавляет не более $|\\mathrm{supp}(\\varphi_i)|\\le s$ вершин.
  Поэтому суммарно по подаддитивности
  $$|\\mathrm{supp}(\\alpha)|\\le 2\\cdot(\\#\\text{edge‑запросов})+s\\cdot(\\#\\text{ext‑запросов})\\le (2+s)t.$$
- `Toy‑тест:` если $s=5$ и $t=100$, то $|\\mathrm{supp}(\\alpha)|\\le 700$, т.е. такая ветвь “видит” лишь локальный фрагмент grid и остаётся в режиме giant component/closure при больших $n$.
- `Статус:` доказано (это первый формальный мост “evaluation‑метод + локальные extension‑переменные”: локальность не исчезает, а деградирует на множитель $s$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться переписать Definition 2.11 (t‑evaluation) HR’22 с поддержкой, учитывающей extension‑переменные, и проверить, сохраняются ли ключевые леммы “locally consistent” при условии $|\\mathrm{supp}(\\varphi_i)|\\le s$ (параметры должны меняться как $t\\mapsto t\\cdot s$).

### 16.158. Исследовательский шаг: устранение запросов extension‑переменных в decision tree (local‑EF(s) ⇒ edge‑only DT с глубиной $O(s\\,t)$)

- `Линза:` Эквивалентность (модель запросов: $x$ vs $(x,p)$).
- `Утверждение:` Пусть $G=(V,E)$ — граф максимальной степени $\\Delta$ (для grid: $\\Delta\\le 4$).
  Рассмотрим переменные рёбер $\\{x_e\\}_{e\\in E}$ и extension‑переменные $\\{p_i\\}$, где для каждого $i$ задан extension‑шаг
  $$p_i\\leftrightarrow\\varphi_i(x)\\qquad\\text{и}\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s.$$
  Обозначим через $\\mathrm{vars}(\\varphi_i)$ множество **различных** edge‑переменных, встречающихся в $\\varphi_i$, и положим
  $$m:=\\max_i |\\mathrm{vars}(\\varphi_i)|\\le \\Delta s/2.$$
  Тогда для любого decision tree $T$ глубины $t$, который может спрашивать переменные из $\\{x_e\\}\\cup\\{p_i\\}$, существует decision tree $T_x$ над одними edge‑переменными $\\{x_e\\}$ глубины $\\le (1+m)\\,t$ такое, что для любого полного присваивания $a\\in\\{0,1\\}^E$ выполнено
  $$T_x(a)\\ =\\ T\\bigl(a,\\ (\\varphi_i(a))_i\\bigr),$$
  т.е. $T_x$ симулирует $T$ на **согласованных** присваиваниях, где $p_i=\\varphi_i(x)$.
  В частности, на grid глубина увеличивается не более чем до $(1+2s)\\,t=O(s\\,t)$.
- `Доказательство:`
  1) (Оценка $m$.) Каждая переменная $x_{\\{u,v\\}}$ добавляет в $\\mathrm{supp}(\\varphi_i)$ вершины $u,v$, поэтому все рёбра из $\\mathrm{vars}(\\varphi_i)$ лежат внутри индуцированного подграфа на $\\mathrm{supp}(\\varphi_i)$.
     При степени $\\le\\Delta$ число рёбер в таком подграфе не превосходит $\\Delta|\\mathrm{supp}(\\varphi_i)|/2\\le \\Delta s/2$, откуда $|\\mathrm{vars}(\\varphi_i)|\\le \\Delta s/2$.
  2) (Локальная замена запроса $p_i$.) Зафиксируем порядок переменных из $\\mathrm{vars}(\\varphi_i)$.
     Построим decision tree $D_i$ глубины $|\\mathrm{vars}(\\varphi_i)|$, который последовательно спрашивает эти edge‑переменные и в листе вычисляет значение булевой формулы $\\varphi_i$ на собранных значениях.
     Тогда запрос $p_i$ в $T$ (на согласованных присваиваниях) эквивалентен прохождению $D_i$ с последующим переходом в соответствующего сына (“$p_i=0$” или “$p_i=1$”).
  3) (Глобальная симуляция.) Заменим в $T$ каждый внутренний узел, спрашивающий $p_i$, на копию $D_i$ со склейкой листьев по предыдущему пункту.
     Получаем дерево $T_x$, спрашивающее только edge‑переменные. По глубине: каждый исходный запрос edge‑переменной даёт +1, каждый запрос $p_i$ даёт +$|\\mathrm{vars}(\\varphi_i)|\\le m$, значит для любого пути
     $$\\mathrm{depth}_{T_x}\\le (\\#\\text{edge‑запросов})+m\\cdot(\\#\\text{ext‑запросов})\\le (1+m)\\,t.$$
     Корректность на $a$ следует из индукции по структуре дерева: в узле $p_i$ новая развилка выбирает ветвь ровно по $\\varphi_i(a)$.
- `Toy‑тест:` если $p\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$ (локальный XOR на 3 рёбрах), то запрос $p$ заменяется тремя запросами $x_{e_1},x_{e_2},x_{e_3}$ и вычислением паритета в листе; это и есть $D_i$ при $|\\mathrm{vars}(\\varphi)|=3$.
- `Статус:` доказано (модель запросов к $p$ “сворачивается” в модель запросов к $x$ с мультипликативной потерей $O(s)$ на bounded‑degree графах).
- `Барьер‑чек:` r — применимо (чисто синтаксическая симуляция, релятивизируется), NP — неприменимо (не «natural property»), alg — неприменимо (нет арифметизации).
- `Следующий шаг:` применить это как технический лемматизатор при попытке перенести HR’22: разрешить в определении $t$‑evaluation запросы $p_i$ (для local‑EF(s)), затем заменить их на edge‑запросы и отследить, что все пороги в леммах “locally consistent/closure” сохраняются при $t\\mapsto O(s\\,t)$.

### 16.159. Исследовательский шаг: черновик “HR‑evaluation для local‑EF(s)” через расширенную поддержку и $s$‑стоимость запросов

- `Линза:` Инвариант (геометрическая поддержка = “видимая область”).
- `Утверждение (черновик‑патч к HR’22, §2.4–2.7):` Пусть $X=\\{x_e\\}$ — edge‑переменные $\\mathrm{Tseitin}(G_n)$ на grid, и в доказательстве разрешены extension‑переменные $P=\\{p_i\\}$ с аксиомами
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $\\mathrm{supp}(\\varphi)$ — множество вершин, инцидентных рёбрам, чьи переменные встречаются в $\\varphi$ (как в HR’22: $\\mathrm{supp}(x_{\\{u,v\\}})=\\{u,v\\}$).
  Тогда естественное обобщение HR’22 Definition 2.2 / Cor. 2.7 такое:

  1) (**Расширенная поддержка присваивания.**) Для частичного присваивания $\\alpha$ на $X\\cup P$ положим
     $$\\mathrm{supp}_s(\\alpha):=\\mathrm{supp}(\\alpha\\!\upharpoonright_X)\\ \\cup\\ \\bigcup_{p_i\\in\\mathrm{dom}(\\alpha)}\\mathrm{supp}(\\varphi_i).$$

  2) (**$s$‑локальная согласованность.**) $\\alpha$ называется $s$‑locally consistent, если при $U=\\mathrm{supp}_s(\\alpha)$ существует $\\beta$ на $X$, *complete on* $\\mathrm{closure}(U)$ (в смысле HR: присваивает все edge‑переменные, инцидентные $\\mathrm{closure}(U)$), такая что:
     (i) $\\beta$ расширяет $\\alpha\\!\upharpoonright_X$; (ii) удовлетворяет всем parity‑constraints на $\\mathrm{closure}(U)$; (iii) для всех присвоенных $p_i$ выполнено $\\alpha(p_i)=\\varphi_i(\\beta)$.

  3) (**Стоимость ветви/дерева.**) Для ветви $\\tau$ decision tree (на переменных $X\\cup P$) положим
     $$\\mathrm{cost}_s(\\tau):=2\\cdot\\#(x\\text{‑запросов в }\\tau)+\\sum_{p_i\\in\\mathrm{dom}(\\tau)}|\\mathrm{supp}(\\varphi_i)|,$$
     и $\\mathrm{cost}_s(T):=\\max_{\\tau\\in T}\\mathrm{cost}_s(\\tau)$, так что грубо $\\mathrm{cost}_s(T)\\le (s+2)\\,\\mathrm{depth}(T)$.

  4) (**Ожидаемый аналог HR Cor. 2.7.**) Если $\\alpha$ $s$‑locally consistent и
     $$|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2,$$
     то “trimmed restriction” $T\\lceil\\alpha$ (как у HR, но с pairwise $s$‑local consistency) корректен и снова $s$‑locally consistent.

  В таком виде можно попытаться перенести HR’22 Definition 2.11 (t‑evaluation) на local‑EF(s), при замене всех порогов вида
  $|\\mathrm{supp}(\\alpha)|+2\\,\\mathrm{depth}(T)\\le n/2$ на $|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2$ (или грубее $t\\mapsto O(s\\,t)$).
- `Toy‑тест:` если $p\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$, то запрос $p$ “стоит” 3 ребра/6 концов; это согласовано с §16.158 (запрос $p$ разворачивается в 3 edge‑запроса).
- `Статус:` черновик (нужна аккуратная проверка: где именно в доказательствах HR’22 используется, что переменные *именно edges*, и что добавление запроса $p_i$ корректно “оплачивается” локальным witness на $\\mathrm{closure}(\\mathrm{supp}_s)$).
- `Барьер‑чек:` r — применимо (вся схема support/closure/DT релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q41: (a) выбрать точную модель local‑EF(s) (запрещаем $\\varphi_i(P)$ или считаем $\\mathrm{supp}(p_i)$ как поддержку полностью развёрнутой формулы), (b) формально доказать (или найти контрпример) пункт (4) как аналог Cor. 2.7, и только после этого пытаться переносить Lemma 2.13 (порог $t\\le n/16$ станет $t\\le \\Theta(n/s)$).

### 16.160. Исследовательский шаг: контрпример — “nested extension” без полного разворачивания поддержки делает local‑EF(s) бессодержательной

- `Линза:` Модельный стресс‑тест.
- `Утверждение (контрпример к «naive nested‑locality»):`
  Пусть разрешены extension‑аксиомы вида $p\\leftrightarrow\\varphi(X,P_{<p})$, и “наивная поддержка” шага измеряется только по *синтаксически встречающимся edge‑переменным* в $\\varphi$ (extension‑переменные считаются атомами и не разворачиваются в $X$).
  Тогда существует цепочка extension‑шагов, где **каждый** шаг имеет поддержку $\\le 2$ (одна edge‑переменная), но итоговая переменная вычисляет XOR от $m$ edge‑переменных и потому имеет “истинную” поддержку $\\Theta(m)$.
  Следовательно, без запрета nesting или без разворачивания поддержки определение local‑EF(s) перестаёт контролировать геометрию (и не может служить базой для $\\mathrm{supp}_s/\\mathrm{cost}_s$‑версии Cor. 2.7).
- `Доказательство (явная конструкция):`
  Возьмём попарно различные edge‑переменные $x_{e_1},\\dots,x_{e_m}$ и введём extension‑переменные $p_1,\\dots,p_m$:
  $$p_1\\leftrightarrow x_{e_1},\\qquad p_i\\leftrightarrow (p_{i-1}\\oplus x_{e_i})\\ \\ (2\\le i\\le m).$$
  (Операция $\\oplus$ выражается формулой константного размера в базисе $\\vee,\\wedge,\\neg$.)
  Тогда по индукции $p_i\\equiv\\bigoplus_{j\\le i}x_{e_j}$.
  При наивном подсчёте поддержки каждый $\\varphi_i$ содержит **ровно одну** edge‑переменную $x_{e_i}$, поэтому $|\\mathrm{supp}(\\varphi_i)|=2$ для всех $i$.
  Но “развёрнутая” формула для $p_m$ содержит все $x_{e_1},\\dots,x_{e_m}$, так что
  $$\\mathrm{supp}(p_m)=\\bigcup_{j\\le m}\\mathrm{supp}(x_{e_j}).$$
  В частности, если выбрать рёбра $e_j$ попарно без общих концов, то $|\\mathrm{supp}(p_m)|=2m$.
- `Toy‑тест:` на $n\\times n$ grid можно взять $m=\\lfloor n^2/2\\rfloor$ попарно непересекающихся рёбер (matching); тогда “naive” $s=2$, но $|\\mathrm{supp}(p_m)|=\\Theta(n^2)$.
- `Статус:` контрпример (фиксирует выбор модели: либо flat $\\varphi_i(X)$, либо $\\mathrm{supp}(p_i)$ считается по полностью развёрнутой формуле в $X$).
- `Барьер‑чек:` r — применимо (чисто синтаксический трюк), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q41 принять “flat” (запрет $\\varphi_i(P)$) или “unfolded‑support” модель и уже в ней доказывать/опровергать аналог HR Cor. 2.7 для $\\mathrm{supp}_s/\\mathrm{cost}_s$.

### 16.161. Исследовательский шаг: доказательство аналога HR Cor. 2.7 для **flat** local‑EF(s) через $\\mathrm{supp}_s/\\mathrm{cost}_s$

- `Линза:` Инвариант.
- `Утверждение (Q41.S3-proof-cor27-analogue-flat):`
  Работаем в **flat**‑модели: extension‑аксиомы имеют вид
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $X$ — edge‑переменные Tseitin($G_n$), а $\\varphi_i$ не содержит extension‑переменных.
  Используем определения $\\mathrm{supp}_s(\\alpha)$, $s$‑local consistency и $\\mathrm{cost}_s(T)$ из §16.159.
  Тогда выполняется прямой аналог HR’22 Cor. 2.7 (p. 8; PDF p. 10) с заменой $|\\mathrm{supp}(\\alpha)|+2\\,\\mathrm{depth}(T)$ на
  $|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)$:
  если $T$ — (обычный) decision tree над переменными $X\\cup P$ и $\\alpha$ $s$‑locally consistent, и
  $$|\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2,$$
  то “trimmed restriction” $T\\lceil\\alpha$ (как у HR, но по pairwise $s$‑local consistency) корректен и является $s$‑locally consistent decision tree
  (в частности, $T\\lceil\\alpha\\ne\\varnothing$).
- `Доказательство:`
  Достаточно показать, что существует хотя бы одна ветвь $\\tau$ дерева $T$, такая что $\\alpha\\cup\\tau$ $s$‑locally consistent.
  Построим её жадно, спускаясь от корня к листу.
  На шаге имеем частичное присваивание
  $$\\gamma:=\\alpha\\cup\\tau_{\\le k}$$
  (префикс ветви), которое $s$‑locally consistent, и положим $U:=\\mathrm{supp}_s(\\gamma)$.
  Для любой вершины дерева $T$ любой префикс ветви имеет $\\mathrm{cost}_s(\\tau_{\\le k})\\le \\mathrm{cost}_s(T)$, поэтому по условию
  $$|U|\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(\\tau_{\\le k})\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(T)\\le n/2.$$
  Рассмотрим следующую переменную запроса в $T$ (в текущем узле) и выберем значение, сохраняющее $s$‑локальную согласованность.
  1) **Edge‑запрос $x_e$.**
     Из $s$‑local consistency для $\\gamma$ существует witness $\\beta$ на $X$, complete on $\\mathrm{closure}(U)$, удовлетворяющий parity‑constraints на $\\mathrm{closure}(U)$ и согласованный со всеми присвоенными $p_j$.
     Обозначим через $E_P$ множество edge‑переменных, встречающихся в $\\varphi_j$ для всех $p_j\\in\\mathrm{dom}(\\gamma)$.
     Расширим $\\gamma\\!\upharpoonright_X$ до частичного присваивания $\\delta$ на $X$, присвоив все переменные из $E_P$ так, как в $\\beta$.
     Тогда $\\mathrm{supp}(\\delta)\\subseteq U$, и $\\delta$ локально согласовано в смысле HR Definition 2.2 (witness — та же $\\beta$).
     По HR Lemma 2.3 (p. 6; PDF p. 8) существует локально согласованное $\\delta'\\supseteq\\delta$ с $x_e$ в домене.
     Пусть $b:=\\delta'(x_e)$. Тогда $\\gamma':=\\gamma\\cup\\{x_e\\mapsto b\\}$ $s$‑locally consistent:
     все ранее присвоенные $p_j$ остаются совместимыми, т.к. их формулы $\\varphi_j$ используют только переменные из $E_P$, уже зафиксированные в $\\delta$ и потому неизменные в $\\delta'$.
  2) **Extension‑запрос $p_i$.**
     Пусть $E_i:=\\mathrm{vars}(\\varphi_i)$ — множество edge‑переменных в $\\varphi_i$.
     Начнём с той же $\\delta$ (фиксирует $E_P$ по witness $\\beta$) и последовательно применим HR Lemma 2.3, добавляя в домен $\\delta$ переменные из $E_i$.
     По построению на каждом шаге поддержка остаётся в $U\\cup\\mathrm{supp}(\\varphi_i)$, а
     $$|U\\cup\\mathrm{supp}(\\varphi_i)|\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(\\tau_{\\le k})+|\\mathrm{supp}(\\varphi_i)|\\le |\\mathrm{supp}_s(\\alpha)|+\\mathrm{cost}_s(\\tau_{\\le k+1})\\le n/2,$$
     так что лемма применима.
     Получаем локально согласованное $\\delta'$ на $X$, которое присваивает все переменные из $E_P\\cup E_i$.
     Положим $b:=\\varphi_i(\\delta')$ и $\\gamma':=\\gamma\\cup\\{p_i\\mapsto b\\}$.
     Тогда $\\gamma'$ $s$‑locally consistent: witness задаётся completion’ом $\\delta'$ на $\\mathrm{closure}(U\\cup\\mathrm{supp}(\\varphi_i))$,
     а равенство $p_i=\\varphi_i(X)$ выполнено по определению $b$.
  В обоих случаях мы нашли значение для следующего запроса, сохранив $s$‑local consistency и инвариант $|\\mathrm{supp}_s(\\gamma')|\\le n/2$.
  Продолжая до листа, получаем ветвь $\\tau$ с $\\alpha\\cup\\tau$ $s$‑locally consistent.
  Значит множество ветвей, pairwise $s$‑locally consistent с $\\alpha$, непусто, и “trimmed restriction” $T\\lceil\\alpha$ определён и $s$‑locally consistent (по определению).
- `Toy‑тест:` если $p\\leftrightarrow x_e$ (поддержка 2), то случай “extension‑запрос” буквально сводится к HR Lemma 2.3 для $x_e$.
- `Статус:` доказано (в flat‑модели; снимает главный риск в §16.159: ограничение “ветка мала ⇒ closure‑witness существует” переносится на local‑EF(s) при замене $2\\,\\mathrm{depth}$ на $\\mathrm{cost}_s$).
- `Барьер‑чек:` r — применимо (аргумент целиком про support/closure/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` используя этот аналог Cor. 2.7, переписать HR Definition 2.11 (t‑evaluation) для flat local‑EF(s) и проверить, где в Lemma 2.13 требуется точнее контролировать порог (ожидаемо $t\\le\\Theta(n/s)$).

### 16.162. Исследовательский шаг: flat local‑EF(s) — “t‑evaluation” и перенос HR Lemma 2.13 с порогом $t\\le\\Theta(n/s)$

- `Линза:` Эквивалентность.
- `Определение (cost‑t evaluation, flat local‑EF(s)):` Зафиксируем $n\\times n$ grid $G_n$, edge‑переменные $X$ и extension‑переменные $P$ с аксиомами
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $\\varphi_i$ не содержит переменных из $P$ (flat).
  Скажем, что множество формул $\\Gamma$ имеет **cost‑$t$‑evaluation** $\\phi$, если $\\phi$ отображает каждую формулу $F\\in\\Gamma$ в $s$‑locally consistent decision tree $\\phi(F)$ с
  $$\\mathrm{cost}_s(\\phi(F))\\le t,$$
  и выполняются Properties 1–4 из HR’22 Definition 2.11 (PDF p. 11), но с “locally consistent” заменённым на “$s$‑locally consistent”.
- `Утверждение (аналог HR Lemma 2.13):`
  Пусть $t\\le n/16$ и существует Frege‑вывод формулы $A$ из Tseitin($G_n$) (и, при желании, flat extension‑аксиом) такой, что **каждая** строка имеет cost‑$t$‑evaluation, и все эти evaluations попарно функционально эквивалентны (как в HR’22 Definition 2.12).
  Тогда каждая строка вывода отображается в 1‑tree; в частности, нельзя вывести $\\bot$.
- `Доказательство (сведение к HR):`
  Доказательство HR’22 Lemma 2.13 (Appendix A.1, paper p. 47–48; PDF p. 50–51) переносится дословно, потому что использует только:
  (i) Properties 1–4 evaluation,
  (ii) функциональную эквивалентность evaluations,
  (iii) факт, что все ограничения вида $T\\lceil\\alpha$ и $T\\lceil(\\alpha\\cup\\tau)$ корректно определены и дают (s‑)locally consistent деревья.

  В HR пункт (iii) обеспечивается Cor. 2.7 при $t\\le n/16$; в flat local‑EF(s) он обеспечивается §16.161, поскольку для любой ветви $\\tau$ дерева $T$ имеем
  $$|\\mathrm{supp}_s(\\tau)|\\le \\mathrm{cost}_s(\\tau)\\le \\mathrm{cost}_s(T)\\le t,$$
  и потому для любого другого дерева $T'$ с $\\mathrm{cost}_s(T')\\le t$:
  $$|\\mathrm{supp}_s(\\tau)|+\\mathrm{cost}_s(T')\\le 2t\\le n/2.$$
  Аналогично, если в Cut‑случае нужно ограничивать по $\\tau\\cup\\tau'$, то
  $|\\mathrm{supp}_s(\\tau\\cup\\tau')|\\le |\\mathrm{supp}_s(\\tau)|+|\\mathrm{supp}_s(\\tau')|\\le 2t$ и
  $|\\mathrm{supp}_s(\\tau\\cup\\tau')|+\\mathrm{cost}_s(T'')\\le 3t\\le 3n/16<n/2$,
  так что §16.161 применим.
  Значит все restricted trees, используемые в индукции HR, корректны, и вывод “нельзя получить 0‑ветвь на новой строке” сохраняется.
- `Следствие (порог $t\\le\\Theta(n/s)$ в терминах глубины):`
  В flat‑модели любой decision tree глубины $d$ удовлетворяет $\\mathrm{cost}_s(T)\\le (s+2)\\,d$ (см. §16.159),
  поэтому “depth‑$d$ evaluation” имплицирует cost‑$t$ evaluation с $t:=(s+2)d$.
  В частности, условие $t\\le n/16$ эквивалентно $d\\le n/(16(s+2))=\\Theta(n/s)$.
- `Toy‑тест:` при $s=0$ (нет extension‑переменных) имеем $\\mathrm{cost}_0=2\\,\\mathrm{depth}$, так что условие $t\\le n/16$ соответствует $\\mathrm{depth}\\le n/32$ (константы не оптимизировались; важен масштаб $\\Theta(n)$).
- `Статус:` доказано (flat‑модель; даёт явный “gatekeeper”: весь evaluation‑каркас переносится с заменой $t\\mapsto (s+2)t$).
- `Барьер‑чек:` r — применимо (вся конструкция support/closure/DT релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если пытаться использовать это для lower bounds, нужно показать: (a) почему poly‑size flat local‑EF(s) вывод *индуцирует* depth‑$d$ evaluations с $d=\\mathrm{polylog}(n)$, или (b) где именно multi‑switching/representation ломается в присутствии extension‑переменных даже в flat‑режиме.

### 16.163. Исследовательский шаг: точная цитата — где HR’22 строят t‑evaluation индукцией по глубине (Proof of Thm. 4.1)

- `Линза:` Инвариант.
- `Утверждение:` В HR’22 явно выписано *индуктивное определение* t‑evaluation для всех подформул “короткого и мелкого” Frege‑доказательства (после применения последовательности full restrictions); единственное нетривиальное расширение домена происходит в случае дизъюнкции и делается через switching lemma.
- `Доказательство/ссылка:` Håstad–Risse, `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`:
  1) (paper p. 15; PDF p. 17) “For the total size lower bound we in fact do not create distinct t-evaluations per line but rather a single one, used on each line.”
  2) (paper p. 16; PDF p. 18) в доказательстве Theorem 4.1 после формулы (4) дано определение $\\phi_{i+1}$ по случаям (цитата):
     > “Consider any such formula $F\\in\\Gamma$. We define $\\phi_{i+1}$ as follows.
     > 1. If $F$ is of depth at most $\\mathrm{depth}(F)\\le i$, then we let $\\phi_{i+1}(F\\!\upharpoonright\\!\\sigma_i^*)=\\phi_i(F\\!\upharpoonright\\!\\sigma_i^{*\\! -1})\\!\upharpoonright\\!\\sigma_i$. By Lemma 3.4 the restricted $t_i$-evaluation $\\phi_i\\!\upharpoonright\\!\\sigma_i$ is defined on such formulas.
     > 2. If $F=\\neg F'$ is of depth $i+1$, then $\\phi_{i+1}(F\\!\upharpoonright\\!\\sigma_i^*)$ is defined in terms of $\\phi_{i+1}(F'\\!\\upharpoonright\\!\\sigma_i^*)$ by negating all the leaf labels.
     > 3. If $F=\\bigvee_j F_j$ is of depth $i+1$ and each $F_j$ is of depth at most $\\mathrm{depth}(F_j)\\le i$, then we appeal to Lemma 4.2 to obtain a decision tree $T$ … representing $\\bigvee_j T_j$ for $T_j=\\phi_i(F_j\\!\\upharpoonright\\!\\sigma_i^{*\\! -1})$.”
- `Toy‑тест:` извлечение текста `pdftotext -f 18 -l 18` показывает пункты 1–3 выше дословно (проверка “где именно строится evaluation”).
- `Статус:` известный факт (точная ссылка на конструкцию evaluations).
- `Барьер‑чек:` r — неприменимо (на этом шаге только локализация цитаты), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 локализовать аналогичное “построчное” построение (functionally equivalent $t(\\eta)$‑evaluations) в доказательстве Theorem 4.3/Lemma 4.5 и отметить, где в этом месте появление extension‑переменных может ломать switching/representation.

### 16.164. Исследовательский шаг: точная цитата — построчное построение functionally equivalent $t(\\eta)$‑evaluations (Theorem 4.3 / Lemma 4.5)

- `Линза:` Эквивалентность.
- `Утверждение:` В доказательстве HR’22 Theorem 4.3 явно поддерживаются (i) для каждой строки $\\nu$ доказательства — своё $t(\\eta)$‑evaluation $\\phi^\\eta_\\nu$ на множестве подформул $\\Gamma^\\eta_\\nu$, (ii) для каждой строки — “общий” partial decision tree $T_\\eta(\\nu)$, используемый для расширения evaluations на следующий уровень глубины. Индуктивный шаг зафиксирован как Lemma 4.5 и использует multi‑switching lemma (Lemma 4.4) на деревьях $\\phi^{\\eta-1}_\\nu(F)\\!\upharpoonright\\!\\tau$.
- `Доказательство/ссылка:` Håstad–Risse, `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`:
  1) (Theorem 4.3, PDF p. 19) “The main difference is that instead of creating a single t-evaluation for the entire proof we in fact independently create t-evaluations for each line. These t-evaluations turn out to be functionally equivalent…”.
  2) (после (6), PDF p. 19) для каждого $\\eta$ вводится
     $$\\Gamma^\\eta_\\nu:=\\{F\\!\upharpoonright\\!\\sigma^*_\\eta\\mid F\\in\\Gamma_\\nu\\ \\wedge\\ \\mathrm{depth}(F)\\le \\eta\\},\\tag{6}$$
     и требуется функциональная эквивалентность всех $\\phi^\\eta_\\nu$.
  3) (Lemma 4.5, PDF p. 20) индуктивный шаг (цитата из утверждения):
     > “Suppose that for every line $\\nu\\in[N]$ we have functionally equivalent $t(\\eta-1)$-evaluations $\\phi^{\\eta-1}_\\nu$ … Suppose that $t(\\eta)\\le n_\\eta/16$. For $\\sigma_\\eta\\sim D_k\\Sigma(n_{\\eta-1},n_\\eta)$ with probability $1-N^{-1}$, for every line $\\nu$ … there are functionally equivalent $t(\\eta)$-evaluations $\\phi^\\eta_\\nu$ … and a $t$-common partial decision tree $T_\\eta(\\nu)$ …”.
- `Toy‑тест:` `pdftotext -f 20 -l 20` показывает Lemma 4.5 и внутри доказательства явное определение $\\phi^\\eta_\\nu$ по случаям (depth<η / ¬ / ∨) с использованием построенного $T_\\eta(\\nu)$.
- `Статус:` известный факт (точная ссылка на “linewise evaluations” каркас HR’22).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 выделить в доказательстве Lemma 4.5 место, где используется, что деревья $\\phi^{\\eta-1}_\\nu(F)$ запрашивают *только edge‑переменные* и что full restrictions/локальная согласованность закрыты относительно этих запросов; затем проверить, сохраняется ли этот шаг при добавлении flat extension‑переменных (или зафиксировать точку поломки).

### 16.165. Исследовательский шаг: flat extensions — как убрать $P$‑запросы из decision trees (unfolding) ценой фактора $O(s)$ по глубине

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S3-check-lemma45-flat-ext-break):`
  Пусть работаем на $n\\times n$ grid и разрешены **flat** extension‑переменные $P$ с аксиомами
  $$p_i\\leftrightarrow\\varphi_i(X),\\qquad |\\mathrm{supp}(\\varphi_i)|\\le s,$$
  где $X$ — edge‑переменные.
  Тогда любой decision tree $T$ над переменными $X\\cup P$ можно преобразовать в decision tree $U$ над **только** edge‑переменными $X$ так, что:
  1) для любого присваивания $\\alpha:X\\to\\{0,1\\}$ значение $U(\\alpha)$ совпадает со значением $T(\\alpha, P=\\varphi(X))$;
  2) для любой ветви $\\tau$ дерева $T$ соответствующая ветвь $\\hat\\tau$ дерева $U$ имеет глубину
     $$\\mathrm{depth}(\\hat\\tau)\\le \\#(X\\text{‑запросов в }\\tau)+2s\\cdot\\#(P\\text{‑запросов в }\\tau)\\le (2s+1)\\,\\mathrm{depth}(\\tau).$$
  В частности, если в HR Lemma 4.5/Lemma 4.4 требуется “decision trees querying edges of the $n\\times n$ grid” глубины $\\le t$, то для flat local‑EF(s) достаточно заменить параметр $t$ на $t':=(2s+1)t$ после такого unfolding.
- `Доказательство:`
  Для каждого $p_i$ обозначим через $E_i\\subseteq X$ множество edge‑переменных, встречающихся в $\\varphi_i$.
  Так как grid имеет степень $\\le 4$, любой фиксированный набор вершин $S$ инцидентен не более чем $2|S|$ рёбрам, значит
  $$|E_i|\\le 2\\,|\\mathrm{supp}(\\varphi_i)|\\le 2s.$$
  Построим decision tree $D_i$ над $E_i$ глубины $|E_i|$ вычисляющее булеву функцию $\\varphi_i$ (например, запрашиваем все переменные из $E_i$ в фиксированном порядке и помечаем листья значением $\\varphi_i$ на соответствующем наборе).

  Теперь определим $U$ из $T$ рекурсивной заменой каждого узла‑запроса $p_i$ на дерево $D_i$:
  каждое листо $D_i$, помеченное $b\\in\\{0,1\\}$, перенаправляем в ребёнка исходного узла $p_i$ по ответу $b$.
  Тогда по индукции по структуре $T$ для любого $\\alpha$ деревья $T$ и $U$ вычисляют одно и то же значение при интерпретации $p_i:=\\varphi_i(\\alpha)$.

  По глубине: замена одного $p_i$‑запроса добавляет вдоль ветви не более $\\mathrm{depth}(D_i)=|E_i|\\le 2s$ edge‑запросов, а $X$‑запросы сохраняются.
  Отсюда
  $$\\mathrm{depth}(\\hat\\tau)\\le \\#X(\\tau)+\\sum_{p_i\\in\\mathrm{dom}_P(\\tau)}|E_i|\\le \\#X(\\tau)+2s\\cdot\\#P(\\tau).$$
- `Toy‑тест:` если $p\\leftrightarrow(x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3})$, то $|\\mathrm{supp}(\\varphi)|\\le 6$ и $|E|=3$; unfolding одного запроса $p$ даёт дерево глубины 3 на $\\{x_{e_1},x_{e_2},x_{e_3}\\}$.
- `Статус:` доказано (фиксирует, где именно в Lemma 4.5 “edge‑only” используется и как к нему вернуться ценой фактора $O(s)$ по глубине).
- `Барьер‑чек:` r — применимо (чисто комбинаторный аргумент про decision trees/поддержку и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить параметрический режим в HR Lemma 4.5: достаточно ли после замены $t\\mapsto (2s+1)t$ сохранить условия вида $t(\\eta)\\le n_\\eta/16$ и $t\\le s_\\eta\\le n' /32$; если нет — зафиксировать точную точку поломки как барьер.

### 16.166. Исследовательский шаг: параметр‑чек — как меняются условия HR Lemma 4.5 после unfolding $t\\mapsto t':=(2s+1)t$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S4-parameter-check-after-unfolding):`
  В HR’22 доказательство Theorem 4.3 использует параметры Lemma 4.4/4.5 только через величину
  $$t:=\\log M$$
  (глубина “остаточных” деревьев, уникальных для формулы после общего префикса $T_\\eta(\\nu)$).
  Поэтому после unfolding из §16.165, который заменяет каждый $P$‑запрос на $\\le 2s$ edge‑запросов и даёт
  $$t' := (2s+1)\\,t = (2s+1)\\log M,$$
  параметрическая часть HR Lemma 4.5 сохраняется *в той же форме* при замене $t\\rightsquigarrow t'$:
  - выбираем $\\ell:=t'$ в Lemma 4.4;
  - задаём рекурсию $n_\\eta:=\\lfloor n_{\\eta-1}/(A_1\\,t'\\,\\log^{c_1} n_{\\eta-1})\\rfloor$ как у HR (PDF p. 19–20), и $s_\\eta:=2^{\\eta-1}\\log N$;
  - итоговая достаточная проверка сводится к (HR, Proof of Thm. 4.3; PDF p. 19–20)
    $$t'(d)\\le 2^d\\log N + t'\\quad\\text{и}\\quad n_d\\ \\gtrsim\\ \\frac{n}{(\\log^{c_1} n\\cdot t')^d},$$
    а значит достаточно требовать
    $$\\log N\\ \\le\\ \\frac{n}{C\\,\\bigl(\\log^{c_1} n\\cdot t'\\bigr)^d}$$
    для достаточно большой абсолютной константы $C$.
  В частности, “цена” flat‑extensions в этом месте — замена $\\log M\\mapsto (2s+1)\\log M$ (то есть ухудшение нижней оценки на длину на фактор $(2s+1)^d$ в знаменателе экспоненты).
- `Доказательство:`
  Сравним с параметр‑блоком в HR’22 (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, Proof of Thm. 4.3; PDF p. 19–20):
  (i) HR выбирают $\\ell=t=\\log M$ и рекурсию $n_\\eta=\\lfloor n_{\\eta-1}/(A_1\\,t\\,\\log^{c_1} n_{\\eta-1})\\rfloor$, а также $s_\\eta=2^{\\eta-1}\\log N$ и $t(\\eta)=\\sum_{i\\le\\eta}s_i+\\log M$;
  (ii) единственная зависимость от $M$ в этом блоке проходит через $t=\\log M$ (см. строку “We choose $\\ell=t=\\log M$ …” и формулу $t(\\eta)=\\sum s_i+\\log M$);
  (iii) unfolding из §16.165 меняет глубину “уникальной части” дерева на множитель $2s+1$, то есть достаточно заменить $t$ на $t':=(2s+1)t$ во всех местах, где HR используют $t$ как bound на глубину входных decision trees в Lemma 4.4.
  Все оценки в HR для вероятности отказа/union bound используют только величины $t,\\ell,n_\\eta,s_\\eta$ (и константы), поэтому при замене $t,\\ell\\rightsquigarrow t'$ получаем те же неравенства с $t'$.
  Финальная проверка $t(d)\\le n_d/16$ в конце Proof of Thm. 4.3 (PDF p. 19) также зависит от $M$ лишь через добавку $+\\log M$, поэтому становится $t'(d)\\le n_d/16$ с $+t'$.
- `Toy‑тест:` если $M=\\mathrm{poly}(n)$ и $s=\\mathrm{polylog}(n)$, то $t'=(2s+1)\\log M=\\mathrm{polylog}(n)$, и замена $\\log M\\mapsto t'$ лишь усиливает polylog‑факторы в знаменателе экспоненты.
- `Статус:` доказано (параметрическая часть; точка, где flat‑extensions “платятся” множителем $(2s+1)$ по $t$).
- `Барьер‑чек:` r — применимо (switching‑леммы/DT‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 попытаться свести “poly‑size flat local‑EF(s) ⇒ существуют evaluations” к HR Lemma 4.5 с заменой $t\\mapsto t'$ и затем проверить, что требуемая локальная согласованность trees (для evaluation) действительно сохраняется в присутствии extension‑аксиом (или зафиксировать конкретный провал).

### 16.167. Исследовательский шаг: контрпример — наивный unfolding $P\\to X$ может нарушать локальную согласованность ветвей

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q43.S5-check-local-consistency-after-unfolding):`
  Даже в **flat**‑режиме $p\\leftrightarrow\\varphi(X)$ и при малой поддержке $|\\mathrm{supp}(\\varphi)|=O(1)$, наивная замена $P$‑запроса на “полное вычисление $\\varphi$ по edge‑переменным” может породить decision tree с **локально несогласованными** ветвями (в смысле HR’22 Def. 2.5), и потому такую замену нельзя напрямую подставлять в HR‑определение evaluation.
- `Контрпример:`
  Рассмотрим Tseitin($G_n$) на $n\\times n$ grid с зарядами $\\alpha_v=1$ для всех вершин (как в HR’22 основной случай), и выберем внутреннюю вершину $v$ степени 4 с инцидентными рёбрами $e_1,e_2,e_3,e_4$.
  Положим
  $$\\varphi(X):= (x_{e_1}\\wedge x_{e_2})\\ \\vee\\ (x_{e_3}\\wedge x_{e_4}),$$
  и введём flat extension‑переменную $p\\leftrightarrow\\varphi(X)$ (поддержка $\\mathrm{supp}(\\varphi)$ состоит из $v$ и 4 соседей, то есть $O(1)$).

  Рассмотрим “наивный unfolding” $P\\to X$ как decision tree $D$ глубины 4, который последовательно запрашивает
  $x_{e_1},x_{e_2},x_{e_3},x_{e_4}$ и в листе помечает значение $\\varphi$ на полученных 4 битах.
  Тогда $D$ содержит ветвь
  $$\\tau:\\ x_{e_1}=0,\\ x_{e_2}=0,\\ x_{e_3}=1,\\ x_{e_4}=1,$$
  для которой $\\varphi(\\tau)=1$, но паритет в вершине $v$ равен
  $$x_{e_1}\\oplus x_{e_2}\\oplus x_{e_3}\\oplus x_{e_4}=0\\ne 1=\\alpha_v.$$
  Поскольку ветвь $\\tau$ уже фиксирует **все** рёбра, инцидентные $v$, никакое продолжение присваивания не может исправить нарушение XOR‑ограничения в $v$.
  Значит $\\tau$ не является locally consistent assignment (HR’22 Def. 2.2), и потому $D$ не является locally consistent decision tree (HR’22 Def. 2.5).
- `Toy‑тест:` паритетная проверка в $v$ для ветви $(0,0,1,1)$ даёт 0, тогда как заряд $\\alpha_v=1$ требует 1.
- `Статус:` контрпример (фиксирует точку риска в Q43: edge‑only unfolding обязан избегать “локально подразумеваемых” запросов или применять aggressive trimming как у HR’22 перед Cor. 2.7).
- `Барьер‑чек:` r — применимо (контрпример полностью на уровне local consistency/closure/DT и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43: сформулировать и доказать правило построения edge‑only decision trees для формул $\\varphi(X)$ (с $|\\mathrm{supp}(\\varphi)|\\le s$), которое гарантирует локальную согласованность всех ветвей (например, “не запрашивать локально подразумеваемые рёбра”, HR’22 p. 7 после Def. 2.5) и оценить глубину в терминах $s$.

### 16.168. Исследовательский шаг: “locally consistent unfolding” для $\\varphi(X)$ — строим edge‑only decision tree без плохих ветвей

- `Линза:` Инвариант.
- `Утверждение (Q43.S6-construct-locally-consistent-unfolding):`
  Пусть $\\varphi$ — формула над edge‑переменными $E:=\\mathrm{vars}(\\varphi)\\subseteq X$ на $n\\times n$ grid, и $S:=\\mathrm{supp}(\\varphi)$ — множество вершин, инцидентных рёбрам из $E$ (так что $|S|\\le s$).
  Пусть $\\alpha$ — locally consistent частичное присваивание (HR’22 Def. 2.2) такое, что
  $$|\\mathrm{supp}(\\alpha)|+|S|\\le n/2.$$
  Тогда существует decision tree $T_{\\varphi,\\alpha}$, который
  1) запрашивает только переменные из $E$ и имеет глубину $\\le |E|\\le 2|S|\\le 2s$;
  2) является locally consistent (HR’22 Def. 2.5), т.е. каждая его ветвь $\\tau$ даёт locally consistent присваивание $\\alpha\\cup\\tau$;
  3) в каждом листе помечает значение $\\varphi$ на ветви (то есть $\\varphi\\!\upharpoonright\\!\\tau$ — $b$‑формула, где $b$ — метка листа).
- `Доказательство:`
  Заметим, что в $4$‑регулярном grid каждое ребро даёт две инцидентные вершины, и потому
  $$|E|\\le \\tfrac12\\sum_{v\\in S}\\deg(v)\\le 2|S|.$$
  Построим дерево по индукции, поддерживая инвариант: текущая ветвь $\\tau$ такова, что $\\beta:=\\alpha\\cup\\tau$ locally consistent и
  $|\\mathrm{supp}(\\beta)|\\le |\\mathrm{supp}(\\alpha)|+|S|\\le n/2$.
  Если $\\varphi\\!\upharpoonright\\!\\tau$ уже константа, останавливаемся и ставим соответствующую метку листа.
  Иначе выберем переменную $x_e\\in E\\setminus\\mathrm{dom}(\\tau)$, встречающуюся в $\\varphi\\!\upharpoonright\\!\\tau$.
  По HR’22 Lemma 2.3 (PDF p. 6) существует $b\\in\\{0,1\\}$, что $\\beta\\cup\\{x_e\\mapsto b\\}$ locally consistent.
  Если такой $b$ единственен, то $x_e$ locally implied by $\\beta$ (HR’22 Def. 2.4), и мы **не ветвим** по $x_e$ (как у HR’22: “disallow queries … if x is locally implied”, PDF p. 7),
  а добавляем это значение к $\\tau$ и продолжаем.
  Если же $x_e$ *не* locally implied, то из существования хотя бы одного $b$ следует, что локально согласованы обе ветви ($b=0$ и $b=1$), и мы ветвим по $x_e$ на два поддерева.
  В обоих случаях инвариант сохраняется, так как мы присваиваем лишь рёбра, инцидентные вершинам из $S$.
  Поскольку на каждом шаге мы фиксируем новую переменную из $E$, процесс завершается за $\\le |E|$ шагов, а глубина (число ветвлений) не превосходит $|E|$.
  По построению все ветви locally consistent и листья корректно помечены значением $\\varphi$ на ветви.
- `Toy‑тест:` в контрпримере §16.167, после присваиваний $x_{e_1}=x_{e_2}=0,\\ x_{e_3}=1$ ребро $e_4$ становится locally implied (иначе нарушится XOR‑ограничение в вершине $v$), поэтому ветвь $x_{e_4}=1$ отсекается и “плохая” ветвь $(0,0,1,1)$ не появляется.
- `Статус:` доказано (даёт корректный шаблон “unfolding без плохих ветвей”: строить/расширять деревья, запрещая запросы локально подразумеваемых рёбер и триммируя по local consistency).
- `Барьер‑чек:` r — применимо (вся конструкция про local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 попробовать встроить $T_{\\varphi,\\alpha}$ в замену $P$‑запросов внутри HR Lemma 4.5, проследив, что functional equivalence и multi‑switching остаются применимы при замене $t\\mapsto (2s+1)t$.

### 16.169. Исследовательский шаг: подстановка locally consistent unfolding в $P$‑запросы (путь к применению HR Lemma 4.5)

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S7-plug-lc-unfolding-into-lemma45):`
  Работая в flat‑модели $p_i\\leftrightarrow\\varphi_i(X)$ с $|\\mathrm{supp}(\\varphi_i)|\\le s$, можно заменить любой decision tree $T$ над переменными $X\\cup P$ на decision tree $U$ над **только** edge‑переменными $X$, так что:
  1) вдоль любой ветви $\\tau$ дерева $U$ значение каждого “встреченного” $p_i$ равно $\\varphi_i\\!\upharpoonright\\!\\tau$ (то есть $U$ реализует вычисление $T$ в семантике подстановки $p_i:=\\varphi_i(X)$);
  2) $U$ можно построить так, чтобы все ветви были locally consistent (HR’22 Def. 2.5), используя Lemma 2.3 + правило “не запрашивать локально подразумеваемые переменные” (HR’22, PDF p. 7);
  3) глубина увеличивается не более чем на фактор $(2s+1)$: для каждой ветви
     $$\\mathrm{depth}_X(U)\\le \\#X(\\tau_T)+2s\\cdot\\#P(\\tau_T)\\le (2s+1)\\,\\mathrm{depth}(T),$$
     где $\\tau_T$ — соответствующая ветвь в исходном дереве $T$.
  Следовательно, для использования HR multi‑switching (Lemma 4.4) внутри Lemma 4.5 достаточно заменить параметр $t=\\log M$ на $t'=(2s+1)\\log M$ *и* строить unfolding‑поддеревья локально согласованными.
- `Доказательство:`
  Строим $U$ сверху вниз, поддерживая инвариант: текущая ветвь даёт locally consistent присваивание $\\alpha$ на $X$ с $|\\mathrm{supp}(\\alpha)|\\le n/2$.
  - Если в $T$ запрашивается edge‑переменная $x_e$, то:
    *если* $x_e$ locally implied by $\\alpha$ (HR’22 Def. 2.4), то не ветвим и продолжаем по единственному locally consistent значению;
    иначе ветвим по $x_e$ на обе ветви (обе сохраняют local consistency, иначе была бы локальная импликация).
  - Если в $T$ запрашивается extension‑переменная $p_i$, то вставляем поддерево $T_{\\varphi_i,\\alpha}$ из §16.168 (глубины $\\le 2s$), которое (i) запрашивает только рёбра из $\\mathrm{vars}(\\varphi_i)$, (ii) по каждой ветви сохраняет local consistency, и (iii) в листе возвращает $b=\\varphi_i\\!\upharpoonright\\!\\tau$; затем продолжаем построение из соответствующего ребёнка узла $p_i$ (по ответу $b$).
  Повторяя рекурсивно, получаем edge‑only $U$ с locally consistent ветвями.
  Оценка глубины получается суммированием: каждый $X$‑запрос в $T$ даёт $\\le 1$ edge‑уровень в $U$, а каждый $P$‑запрос заменяется на поддерево глубины $\\le 2s$.
- `Toy‑тест:` контрпример §16.167 устраняется именно вставкой $T_{\\varphi,\\alpha}$: ветка $(0,0,1,1)$ не появляется, потому что $x_{e_4}$ locally implied после $x_{e_1}=x_{e_2}=0,\\ x_{e_3}=1$.
- `Статус:` доказано (локальная “прошивка” §16.168 в механизм HR’22: теперь остаётся проверить functional equivalence evaluations после этой замены).
- `Барьер‑чек:` r — применимо (аргумент на уровне local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить, что после такой замены сохраняется нужная функциональная эквивалентность evaluations (возможно, потребуется ослабить/переопределить её в flat local‑EF(s) контексте).

### 16.170. Исследовательский шаг: functional equivalence следует из семантической эквивалентности для locally consistent decision trees

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S8-functional-equivalence-after-unfolding):`
  Пусть $T_1,T_2$ — locally consistent decision trees (HR’22 Def. 2.5) над edge‑переменными Tseitin($G_n$) глубины $\\le n/8$.
  Если они вычисляют одну и ту же булеву функцию $f:X\\to\\{0,1\\}$ на всех полных присваиваниях $X$, то $T_1$ и $T_2$ **functionally equivalent** (HR’22 Def. 2.8).
  Следовательно, в Q43 после замены $P$‑запросов на edge‑only locally consistent unfolding (§16.169) функциональная эквивалентность evaluations сохраняется автоматически: изоморфные формулы задают одну и ту же функцию от $X$ (после подстановки $p_i:=\\varphi_i(X)$), а значит соответствующие деревья functionally equivalent.
- `Доказательство:`
  Возьмём ветвь $\\tau$ дерева $T_1$, заканчивающуюся листом с меткой $b$.
  Тогда на любом полном присваивании $\\rho:X\\to\\{0,1\\}$, согласованном с $\\tau$, имеем $T_1(\\rho)=b$, а значит по предположению $T_2(\\rho)=b$.

  Рассмотрим любую ветвь $\\tau'$ дерева $T_2$, которая pairwise locally consistent с $\\tau$ (HR’22 Def. 2.2).
  Тогда объединение $\\tau\\cup\\tau'$ — locally consistent частичное присваивание, и потому оно продолжимо до полного присваивания $\\rho$ на $X$ (вне $\\mathrm{closure}(\\mathrm{supp}(\\tau\\cup\\tau'))$ присваиваем произвольно).
  На этом $\\rho$ дерево $T_2$ проходит по ветви $\\tau'$, значит метка листа $\\tau'$ равна $T_2(\\rho)=b$.
  Следовательно, **все** ветви $T_2$, pairwise locally consistent с $\\tau$, имеют метку $b$, т.е. “trimmed restriction” $T_2\\!\upharpoonright\\!\\tau$ — $b$‑tree.
  Аналогично, для любой ветви $\\tau'$ дерева $T_2$ получаем, что $T_1\\!\upharpoonright\\!\\tau'$ — соответствующий $b$‑tree. Это и есть functional equivalence.
- `Toy‑тест:` для изоморфных $\\vee$‑формул $((A\\vee B)\\vee C)$ и $(A\\vee(B\\vee C))$ любая пара locally consistent деревьев, вычисляющих одну и ту же функцию $A\\vee B\\vee C$, автоматически functionally equivalent по лемме.
- `Статус:` доказано (functional equivalence в Q43 сводится к “вычисляют одну и ту же функцию” + local consistency).
- `Барьер‑чек:` r — применимо (аргумент на уровне local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43: после снятия functional‑equivalence риска проверить, что полученные edge‑only trees по‑прежнему удовлетворяют Properties 1–4 определения evaluation (и t‑common partial decision tree) в шаге Lemma 4.5.

### 16.171. Исследовательский шаг: “Property 1” в t‑evaluation не нужно для Lemma 2.13 (можно разрешить переменным деревья глубины $\\le t$)

- `Линза:` Инвариант.
- `Утверждение (Q43.S9-check-evaluation-properties-after-unfolding):`
  В доказательстве HR’22 Lemma 2.13 (Appendix A.1; PDF p. 50–51) не используется Property 1 из Definition 2.11 (т.е. что *переменные* обязаны отображаться в деревья глубины 1).
  Достаточно, чтобы (a) все деревья были locally consistent и глубины $\\le t$, (b) аксиомы были 1‑trees (Property 2), и выполнялись Properties 3–4 (¬ и ∨) плюс functional equivalence между строками.
  Следовательно, в Q43 можно после unfolding разрешить extension‑переменным $p_i$ отображаться в edge‑only деревья глубины $O(s)$ (например, $T_{\\varphi_i,\\alpha}$ из §16.168), не ломая “gatekeeper” Lemma 2.13.
- `Доказательство:`
  Просматриваем доказательство Lemma 2.13 у HR’22 (PDF p. 50–51): оно делает индукцию по строкам и во всех случаях использует только
  - “axioms are mapped to 1‑trees” (Property 2),
  - связь $T_{\\neg F}$ с $T_F$ (Property 3),
  - что $T_{F\\vee G}$ **represents** $T_F\\vee T_G$ (Property 4),
  - functional equivalence + Lemma 2.9,
  - и Corollary 2.7 (чтобы $T\\!\upharpoonright\\!\\tau$ был определён при глубинах $\\le n/16$).

  Нигде не требуется, чтобы дерево для атома $p$ было глубины 1: в “Excluded Middle” они обозначают $T_p:=\\phi_\\nu(p)$ и работают с ним только через Properties 3–4; в остальных правилах $p,q,r$ — произвольные формулы строк, а не обязательно атомы.
  Поэтому если заменить Property 1 на более слабое требование “каждый атом отображается в locally consistent decision tree глубины $\\le t$”, то весь вывод Lemma 2.13 остаётся дословным.
- `Toy‑тест:` если $p_i\\leftrightarrow\\varphi_i(X)$ и $|\\mathrm{supp}(\\varphi_i)|\\le s$, то после unfolding можно взять дерево для $p_i$ равным $T_{\\varphi_i,\\emptyset}$ глубины $\\le 2s$ (§16.168); при условии $2s\\le t\\le n/16$ лемма 2.13 применима без изменения.
- `Статус:` доказано (закрывает “проверку Property 1”: после unfolding не надо удерживать глубину 1 для extension‑переменных).
- `Барьер‑чек:` r — применимо (аргумент целиком про local consistency/decision trees и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить оставшуюся часть “evaluation properties” в шаге Lemma 4.5: что построенные edge‑only деревья действительно дают $t$‑common partial decision tree и удовлетворяют Property 4 (representation) для ∨‑формул после unfolding.

### 16.172. Исследовательский шаг: unfolding не ломает common partial decision tree и Property 4 (representation) — инвариантность под functional equivalence

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S10-common-partial-tree-after-unfolding):`
  Пусть $T_1,\\dots,T_m$ и $T'_1,\\dots,T'_m$ — locally consistent decision trees над edge‑переменными Tseitin($G_n$) глубины $\\le n/8$ такие, что для всех $i$ деревья $T_i$ и $T'_i$ functionally equivalent (HR’22 Def. 2.8).
  Тогда:
  1) (**representation стабилен**) если decision tree $R$ represents $\\bigvee_{i=1}^m T_i$ (HR’22, абзац перед Def. 2.10), то $R$ также represents $\\bigvee_{i=1}^m T'_i$;
  2) (**common partial tree стабилен**) если partial decision tree $S$ — $\\ell$‑common partial decision tree для $T_1,\\dots,T_m$ (HR’22 Def. 2.10), то тот же $S$ является $\\ell$‑common partial decision tree для $T'_1,\\dots,T'_m$.

  В частности, в Q43 после замены $P$‑запросов на edge‑only locally consistent unfolding из §16.169 (глубина $t\\mapsto t':=(2s+1)t$ и семантическая эквивалентность в смысле подстановки $p_i:=\\varphi_i(X)$) проверка в HR’22 Lemma 4.5, что $T_\\eta(\\nu)$ — $t'$‑common partial decision tree и что Property 4 (representation) выполняется для $\\vee$‑формул, переносится без изменений (проверка идёт «по ветвям» и использует только b‑tree факты для trimmed restriction).
- `Доказательство:`
  Ключевой факт: из HR’22 Lemma 2.9 следует, что для любых functionally equivalent $T,T'$ и любого locally consistent частичного присваивания $\\alpha$ (в режиме, где все trimmed restrictions определены) выполняется эквивалентность
  $$T\\!\upharpoonright\\!\\alpha\\text{ — $b$‑tree}\\ \\Longleftrightarrow\\ T'\\!\\upharpoonright\\!\\alpha\\text{ — $b$‑tree}.$$

  1) **Stability для representation.**
     Пусть $R$ represents $\\bigvee_i T_i$.
     Возьмём ветвь $\\tau$ дерева $R$, оканчивающуюся листом с меткой $b$.
     - Если $b=0$, то по определению “represents” имеем $T_i\\!\\upharpoonright\\!\\tau=0$ для всех $i$, а значит по ключевому факту $T'_i\\!\\upharpoonright\\!\\tau=0$ для всех $i$.
     - Если $b=1$, то по определению “represents” существует $i$ с $T_i\\!\\upharpoonright\\!\\tau=1$, а значит $T'_i\\!\\upharpoonright\\!\\tau=1$.
     Это ровно означает, что $R$ represents $\\bigvee_i T'_i$.

  2) **Stability для $\\ell$‑common partial decision tree.**
     Пусть $S$ — $\\ell$‑common partial decision tree для $T_1,\\dots,T_m$.
     Тогда по HR’22 Def. 2.10 для каждого $i$ и каждой ветви $\\tau\\in S$ существует decision tree $S^{(i,\\tau)}$ глубины $\\ell$, такой что если $\\widehat S_i$ получено из $S$ подстановкой $S^{(i,\\tau)}$ в лист $\\tau$, то для любой ветви $\\tau'\\in\\widehat S_i$, оканчивающейся листом $b$, выполнено $T_i\\!\\upharpoonright\\!\\tau'=b$.
     Применяя ключевой факт к каждому такому $\\tau'$, получаем $T'_i\\!\\upharpoonright\\!\\tau'=b$.
     Значит те же witness‑деревья $S^{(i,\\tau)}$ доказывают, что $S$ — $\\ell$‑common partial decision tree и для $T'_1,\\dots,T'_m$.

  Применение к Q43: деревья, полученные локально согласованным unfolding (§16.169), вычисляют ту же функцию от $X$ (в семантике $p_i:=\\varphi_i(X)$), а потому по §16.170 автоматически functionally equivalent любому другому locally consistent edge‑only представлению той же функции.
  Следовательно, любые trees/partial trees, построенные по HR’22 Lemma 4.4 внутри Lemma 4.5 для “наивного” edge‑only представления, остаются корректными и для locally consistent unfolding, и Property 4 + common partial tree переносятся (с единственной платой в параметре глубины $t\\mapsto t'$ из §16.166).
- `Toy‑тест:` пусть $T_1$ — 1‑tree для $x_e$, а $T'_1$ — дерево глубины 2, которое сначала спрашивает $x_e$, затем (локально подразумеваемую) переменную и не ветвится; тогда $T_1$ и $T'_1$ functionally equivalent, и любое $R$, представляющее $T_1\\vee 0$, автоматически представляет $T'_1\\vee 0$ по пункту (1).
- `Статус:` доказано (закрывает “common partial tree/representation” узел в Q43: после unfolding HR Lemma 4.5 можно применять дословно при замене $t\\mapsto t'$).
- `Барьер‑чек:` r — применимо (аргумент чисто про decision trees/trimmed restriction и релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 формализовать, как из poly‑size flat local‑EF(s)‑доказательства получить входные family of decision trees глубины $t'=\\mathrm{polylog}(n)$ для Lemma 4.5 (или зафиксировать, почему “индукция по строкам” не даёт таких trees без nesting/глобальной поддержки).

### 16.173. Исследовательский шаг: где именно “индуцируются” edge‑only деревья для Lemma 4.5 в flat local‑EF(s) (уникальная часть + locally consistent unfolding)

- `Линза:` Инвариант.
- `Утверждение (Q43.S11-induce-trees-from-proof):`
  Рассмотрим индуктивный шаг HR’22 Lemma 4.5 (PDF p. 20) для фиксированной строки $\\nu$ и уровня $\\eta$.
  В нём “входные” деревья, к которым применяется multi‑switching lemma (HR’22 Lemma 4.4), имеют вид
  $$\\bigl\\{\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau\\bigr\\}_i,$$
  где $\\tau$ — ветвь $t$‑common partial decision tree $T_{\\eta-1}(\\nu)$ глубины $\\sum_{j<\\eta}s_j$.

  В flat local‑EF(s) (переменные $P$ с аксиомами $p_i\\leftrightarrow\\varphi_i(X)$, $|\\mathrm{supp}(\\varphi_i)|\\le s$) эти restricted‑деревья могут запрашивать $P$.
  Тогда “индуцированные” edge‑only деревья для применения HR Lemma 4.4 получаются **точно** так:
  для каждого $i$ и каждой ветви $\\tau$ берём locally consistent unfolding
  $$U_{i,\\tau}:=\\mathrm{Unfold}_{\\varphi}(\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau)$$
  из §16.169, то есть заменяем каждый $P$‑запрос на поддерево $T_{\\varphi_j,\\alpha}$ (с текущим $\\alpha$ вдоль ветви), запрещая локально подразумеваемые edge‑запросы.
  Тогда:
  1) каждое $U_{i,\\tau}$ — locally consistent decision tree над **только** edge‑переменными $X$ (HR’22 Def. 2.5);
  2) глубина ограничена
     $$\\mathrm{depth}(U_{i,\\tau})\\le (2s+1)\\,t=:t',\\qquad t:=\\log M,$$
     поскольку в HR’22 для любой ветви $\\tau$ “общая часть” длины $\\sum_{j<\\eta}s_j$ уже зафиксирована, и остаётся только уникальная часть глубины $\\le t$ (а unfolding умножает глубину не более чем на $2s+1$, §16.165).

  Следовательно, в доказательстве Lemma 4.5 можно применять HR multi‑switching lemma (Lemma 4.4) к семействам $\\{U_{i,\\tau}\\}_i$ с параметром $t'$ вместо $t=\\log M$.
  Оставшаяся часть шага Lemma 4.5 (построение $T_\\eta(\\nu)$ и проверка Property 4 “representing $\\vee$” по ветвям $\\tau$) проходит дословно, так как использует только вывод Lemma 4.4 для этих входных деревьев.
  Это и есть формальная реализация пункта “poly‑size доказательство индуцирует нужные edge‑only деревья глубины $t'$” в Q43.
- `Доказательство:`
  В HR’22 Lemma 4.5 (PDF p. 20) к фиксированному $\\tau\\in T_{\\eta-1}(\\nu)$ применяют Lemma 4.4 к деревьям
  $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$ и используют, что их глубина $\\le t=\\log M$ (“unique part”).
  В flat local‑EF(s) мы заменяем каждое такое дерево на $U_{i,\\tau}$ по §16.169.
  По построению §16.169 ветви $U_{i,\\tau}$ locally consistent и запросы только edge‑переменные, значит $U_{i,\\tau}$ подходит под HR’22 Lemma 4.4.

  Оценка глубины: в §16.165 показано, что unfolding любого decision tree глубины $t$ (где каждый $P$‑запрос заменяется на дерево глубины $\\le 2s$) даёт edge‑only дерево глубины $\\le(2s+1)t$.
  Применяя это к $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$ глубины $\\le t$, получаем $\\mathrm{depth}(U_{i,\\tau})\\le (2s+1)t=t'$.

  Наконец, в HR’22 проверка Property 4 (и построение $T_\\eta(\\nu)$) делается **по каждой** ветви $\\tau$ отдельно:
  для фиксированного $\\tau$ именно Lemma 4.4 даёт common partial decision tree глубины $s_\\eta$, который представляет дизъюнкцию деревьев, ассоциированных с дисъюнктами.
  Поэтому если подставить в этом месте деревья $\\{U_{i,\\tau}\\}_i$ (вместо $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$), то весь шаг Lemma 4.5 проходит в той же форме при замене $t\\mapsto t'$.
- `Toy‑тест:` при $s=1$ каждый $P$‑запрос разворачивается в дерево глубины $\\le 2$, поэтому дерево уникальной части глубины $t=3$ после unfolding имеет глубину $\\le (2\\cdot 1+1)\\cdot 3=9$.
- `Статус:` доказано (закрывает “индукцию деревьев” в Q43: указано точное место в Lemma 4.5 и явная конструкция входных edge‑only деревьев глубины $t'$).
- `Барьер‑чек:` r — применимо (switching/decision trees релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 сформулировать итоговый corollary уровня HR Theorem 4.3 для depth‑$d$ flat local‑EF(s): как меняется нижняя оценка на длину/размер при подстановке $t'= (2s+1)\\log M$.

### 16.174. Исследовательский шаг: corollary — HR Theorem 4.3 переносится на depth‑$d$ flat local‑EF(s) с заменой $\\log M\\mapsto (2s+1)\\log M$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S12-corollary-thm43-flat-local-ef):`
  Пусть задана flat local‑EF(s)‑рефутация Tseitin($G_n$) на $n\\times n$ grid (odd charges в каждой вершине, как в HR’22),
  где все extension‑аксиомы имеют вид $p_i\\leftrightarrow\\varphi_i(X)$ с $|\\mathrm{supp}(\\varphi_i)|\\le s$ (flat),
  и каждая строка — формула глубины $\\le d$ и размера $\\le M$.
  Тогда число строк $N$ удовлетворяет той же форме нижней оценки, что и HR’22 Theorem 4.3, но с заменой
  $$\\log M\\ \\rightsquigarrow\\ t':=(2s+1)\\log M,$$
  то есть
  $$N\\ \\ge\\ \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{O(1)}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right).$$
- `Доказательство:`
  Повторяем доказательство HR’22 Theorem 4.3 (см. `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`, Thm. 4.3 + Proof; PDF p. 19–20), меняя ровно одно место:
  в Lemma 4.4/4.5 вместо “decision trees querying edges … of depth $t:=\\log M$” используем edge‑only locally consistent деревья глубины
  $$t':=(2s+1)\\log M.$$

  Корректность этой замены обеспечивают предыдущие шаги:
  - §16.169+§16.173: restricted уникальные части $\\phi^{\\eta-1}_\\nu(F_i)\\!\upharpoonright\\!\\tau$ в Lemma 4.5 разворачиваются в edge‑only locally consistent деревья глубины $\\le t'$;
  - §16.166: параметрический блок Proof of Thm. 4.3 зависит от $M$ только через $t=\\log M$, значит все оценки/union bound переносятся с $t\\rightsquigarrow t'$;
  - §16.162: получив в конце $t'(d)$‑evaluation с $t'(d)\\le n_d/16$, применяем (flat) аналог HR Lemma 2.13 и получаем, что рефутации быть не может.

  Следовательно, чтобы избежать противоречия с Lemma 2.13, длина $N$ должна удовлетворять указанной экспоненциальной нижней оценке с $\\log M$ заменённым на $t'$.
- `Toy‑тест:` при $s=0$ (нет extension‑переменных) имеем $t'=\\log M$, и формула совпадает с HR’22 Theorem 4.3.
- `Статус:` доказано (условный перенос HR’22 нижней оценки на depth‑$d$ flat local‑EF(s), цена — множитель $(2s+1)^d$ в знаменателе экспоненты).
- `Барьер‑чек:` r — применимо (switching‑леммы/decision trees релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить “почти tightness”: при каких режимах $s$ и $M$ нижняя оценка остаётся $\\exp(n^{1-o(1)})$ и сравнить с известным upper $2^{O(n)}$ (резолюция).

### 16.175. Исследовательский шаг (toy computation): режимы “почти tightness” для corollary при $t'=(2s+1)\\log M$

- `Линза:` Инвариант.
- `Утверждение (Q43.S13-tightness-regime):`
  Пусть выполняется lower bound из §16.174:
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{C}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right)$$
  для некоторой абсолютной константы $C\\ge 1$.
  Тогда:
  1) если
     $$d\\cdot\\log\\bigl((\\log n)^{C}(2s+1)\\log M\\bigr)=o(\\log n),\\tag{*}$$
     то показатель экспоненты равен $n^{1-o(1)}$, то есть
     $$N\\ge \\exp\\bigl(n^{1-o(1)}\\bigr);$$
  2) в частности, если $(2s+1)\\log M\\le \\log^{O(1)}n$ и $d=o(\\log n/\\log\\log n)$, то условие $(*)$ выполнено и снова $N\\ge \\exp(n^{1-o(1)})$;
  3) при фиксированной глубине $d=O(1)$ и $(2s+1)\\log M\\le \\log^{O(1)}n$ получаем $N\\ge \\exp(\\Omega(n/\\log^{O(1)}n))$, что согласуется с известным upper $2^{O(n)}$ (резолюция).
- `Toy‑вычисление:`
  Из $(*)$ следует
  $$\\bigl((\\log n)^{C}(2s+1)\\log M\\bigr)^d=\\exp\\bigl(o(\\log n)\\bigr)=n^{o(1)}.$$
  Тогда показатель экспоненты равен
  $$\\Omega\\Bigl(\\frac{n}{n^{o(1)}}\\Bigr)=n^{1-o(1)}.$$
  Пункт (2) — частный случай, т.к. при $(2s+1)\\log M\\le \\log^{K}n$ имеем $\\log((\\log n)^C(2s+1)\\log M)=O(\\log\\log n)$, и потому
  $d\\cdot O(\\log\\log n)=o(\\log n)$ при $d=o(\\log n/\\log\\log n)$.
- `Статус:` проверено (явный критерий, когда corollary даёт $\\exp(n^{1-o(1)})$).
- `Барьер‑чек:` r — применимо (это лишь алгебра над параметрами + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 оценить “порог по $s$”: при каких $s=s(n)$ (при $M=\\mathrm{poly}(n)$ и $d=o(\\log n/\\log\\log n)$) условие $(*)$ перестаёт быть верным.

### 16.176. Исследовательский шаг (toy computation): порог по $s$ при $M=\\mathrm{poly}(n)$ и $d=o(\\log n/\\log\\log n)$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S14-threshold-in-s):`
  В режиме $M=\\mathrm{poly}(n)$ (то есть $\\log M=O(\\log n)$) и $d=o(\\log n/\\log\\log n)$ условие $(*)$ из §16.175 эквивалентно
  $$d\\cdot\\log(2s+1)=o(\\log n).\\tag{**}$$
  В частности, lower bound из §16.174 даёт $N\\ge\\exp(n^{1-o(1)})$ при любом $s$ таком, что
  $$\\log s=o(\\log n/d)\\quad\\text{(то есть)}\\quad s\\le \\exp\\bigl(o(\\log n/d)\\bigr).$$
- `Toy‑вычисление:`
  При $\\log M=O(\\log n)$ имеем $\\log\\log M=O(\\log\\log n)$, и потому
  $$\\log\\bigl((\\log n)^C(2s+1)\\log M\\bigr)=\\log(2s+1)+O(\\log\\log n).$$
  Подставляя в $(*)$ из §16.175 получаем
  $$d\\cdot\\log(2s+1)+d\\cdot O(\\log\\log n)=o(\\log n).$$
  Но при $d=o(\\log n/\\log\\log n)$ второй член автоматически $o(\\log n)$, так что остаётся ровно $(**)$.
- `Статус:` проверено (явный порог по $s$ в subcritical‑глубине).
- `Барьер‑чек:` r — применимо (чистая параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 подставить $s=n^{\\varepsilon}$ и выписать, при каких $d$ показатель в §16.174 остаётся $n^{1-o(1)}$ или хотя бы $n^{\\Omega(1)}$ (где lower bound ещё нетривиален).

### 16.177. Исследовательский шаг (toy computation): режим $s=n^{\\varepsilon}$ — когда bound из §16.174 нетривиален по глубине $d$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S15-poly-s-depth-regime):`
  Пусть $M=\\mathrm{poly}(n)$, $s=n^{\\varepsilon}$ для фиксированного $\\varepsilon\\in(0,1)$, и применим corollary §16.174:
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{O(1)}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right).$$
  Тогда показатель экспоненты имеет порядок
  $$\\Omega\\Bigl(\\frac{n^{1-\\varepsilon d}}{\\log^{O(d)} n}\\Bigr).\\tag{***}$$
  Отсюда:
  1) (**почти tightness**) $N\\ge \\exp(n^{1-o(1)})$ возможно только при $\\varepsilon d=o(1)$ (т.е. $d=o(1/\\varepsilon)$);
  2) (**нетривиальность**) $N\\ge \\exp(n^{\\Omega(1)})$ сохраняется для любой константной глубины $d$ с $\\varepsilon d<1$;
  3) при $d\\ge 1/\\varepsilon$ показатель в $(***)$ становится $n^{o(1)}$, и bound перестаёт давать сверхполиномиальную нижнюю оценку на $N$.
- `Toy‑вычисление:`
  При $s=n^{\\varepsilon}$ имеем $2s+1=\\Theta(n^{\\varepsilon})$ и при $M=\\mathrm{poly}(n)$ также $\\log M=\\Theta(\\log n)$.
  Тогда знаменатель в §16.174 равен
  $$\\bigl((\\log n)^{O(1)}(2s+1)\\log M\\bigr)^d\\ =\\ \\bigl(n^{\\varepsilon}\\,\\log^{O(1)}n\\bigr)^d\\ =\\ n^{\\varepsilon d}\\,\\log^{O(d)}n,$$
  и получаем $(***)$.
  Пункты (1)–(3) следуют из сравнения $n^{1-\\varepsilon d}$ с $n^{1-o(1)}$, $n^{\\Omega(1)}$ и $n^{o(1)}$ соответственно.
- `Статус:` проверено (явный “depth‑порог” при полиномиальных flat‑extensions).
- `Барьер‑чек:` r — применимо (параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 рассмотреть промежуточные режимы $s=\\exp((\\log n)^\\alpha)$ и сравнить порог $d\\log(2s+1)=o(\\log n)$ с $d=o(\\log n/\\log\\log n)$.

### 16.178. Исследовательский шаг (toy computation): режим $s=\\exp((\\log n)^\\alpha)$ — depth‑порог $d\\approx \\log^{1-\\alpha}n$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S16-subexp-s-regime):`
  Пусть $M=\\mathrm{poly}(n)$ и $s=\\exp((\\log n)^\\alpha)$ для некоторого $\\alpha>0$.
  Тогда показатель экспоненты в corollary §16.174 имеет вид
  $$\\Omega\\Bigl(\\frac{n\\,\\exp(-d\\,(\\log n)^\\alpha)}{\\log^{O(d)}n}\\Bigr).\\tag{****}$$
  В частности:
  1) если $0<\\alpha<1$ и $d=o(\\log^{1-\\alpha}n)$, то $N\\ge\\exp(n^{1-o(1)})$;
  2) если $0<\\alpha<1$ и $d=c\\,\\log^{1-\\alpha}n$ для константы $c\\in(0,1)$, то $N\\ge\\exp(n^{1-c-o(1)})$;
  3) если $\\alpha>1$, то уже при $d\\ge 1$ выражение $(****)$ стремится к 0, и corollary §16.174 перестаёт давать сверхполиномиальную нижнюю оценку на $N$.
- `Toy‑вычисление:`
  При $s=\\exp((\\log n)^\\alpha)$ имеем $2s+1=\\exp((\\log n)^\\alpha+O(1))$, а при $M=\\mathrm{poly}(n)$ также $\\log M=\\Theta(\\log n)$.
  Тогда знаменатель в §16.174 равен
  $$\\bigl((\\log n)^{O(1)}(2s+1)\\log M\\bigr)^d\\ =\\ \\exp(d(\\log n)^\\alpha)\\cdot\\log^{O(d)}n,$$
  что даёт $(****)$.
  Пункт (1): из $d=o(\\log^{1-\\alpha}n)$ следует $d(\\log n)^\\alpha=o(\\log n)$, а также автоматически $d=o(\\log n/\\log\\log n)$, так что $\\log^{O(d)}n=\\exp(o(\\log n))=n^{o(1)}$.
  Пункт (2): при $d=c\\log^{1-\\alpha}n$ имеем $\\exp(d(\\log n)^\\alpha)=\\exp(c\\log n)=n^c$, а $\\log^{O(d)}n=\\exp(o(\\log n))=n^{o(1)}$.
  Пункт (3): при $\\alpha>1$ уже $\\exp(d(\\log n)^\\alpha)\\gg n$, поэтому $n\\exp(-d(\\log n)^\\alpha)=o(1)$.
- `Статус:` проверено (явный “phase transition”: при $\\alpha>1$ bound тривиализируется уже на глубине 1).
- `Барьер‑чек:` r — применимо (параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 выделить “максимально допустимый” рост $s(n)$ из условия $d\\log(2s+1)=o(\\log n)$ при $d=\\Theta(\\log n/\\log\\log n)$ (граница между нетривиальным и тривиальным lower bound).

### 16.179. Исследовательский шаг (toy computation): критическая глубина $d\\asymp \\log n/\\log\\log n$ ⇒ $s=(\\log n)^{o(1)}$ для “почти tightness”

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S17-max-s-critical-depth):`
  В режиме $M=\\mathrm{poly}(n)$ и “критической” глубины
  $$d=\\Theta\\left(\\frac{\\log n}{\\log\\log n}\\right),$$
  условие $(**)$ из §16.176 (эквивалентное “почти tightness” $N\\ge\\exp(n^{1-o(1)})$) равносильно
  $$\\log(2s+1)=o(\\log\\log n),$$
  то есть
  $$s=\\exp(o(\\log\\log n))=(\\log n)^{o(1)}.$$
- `Toy‑вычисление:`
  Подставим $d=\\Theta(\\log n/\\log\\log n)$ в $(**)$ из §16.176:
  $$d\\log(2s+1)=o(\\log n)\\ \\Longleftrightarrow\\ \\frac{\\log n}{\\log\\log n}\\cdot\\log(2s+1)=o(\\log n)\\ \\Longleftrightarrow\\ \\log(2s+1)=o(\\log\\log n).$$
  Отсюда $2s+1=\\exp(o(\\log\\log n))$ и потому $s=\\exp(o(\\log\\log n))$.
  Равенство $\\exp(o(\\log\\log n))=(\\log n)^{o(1)}$ следует из $\\exp(a\\log\\log n)=(\\log n)^a$.
- `Статус:` проверено (явный максимальный рост $s(n)$ при критической глубине для сохранения $\\exp(n^{1-o(1)})$).
- `Барьер‑чек:` r — применимо (чистая параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 оценить “границу нетривиальности” при $d=\\Theta(\\log n/\\log\\log n)$: если $s=(\\log n)^c$, какой показатель $n^{1-\\Theta(1)}$ даёт corollary §16.174 (вместо $n^{1-o(1)}$).

### 16.180. Исследовательский шаг (toy computation): при $d=\\Theta(\\log n/\\log\\log n)$ и $s=(\\log n)^c$ показатель экспоненты = $n^{1-\\Theta(1)}$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S18-polylog-s-critical-depth-exponent):`
  Предположим $M=\\mathrm{poly}(n)$ и $s=(\\log n)^c$ для фиксированного $c\\ge 0$.
  Пусть глубина строк
  $$d=\\left(\\kappa+o(1)\\right)\\frac{\\log n}{\\log\\log n}$$
  для некоторой константы $\\kappa>0$.
  Тогда lower bound из §16.174 имеет показатель экспоненты вида
  $$\\Omega\\bigl(n^{1-\\kappa(C+1+c)-o(1)}\\bigr),$$
  где $C=O(1)$ — абсолютная константа из polylog‑фактора $(\\log n)^{O(1)}$ в §16.174 (унаследованного от HR’22 Thm. 4.3).
  В частности, при $\\kappa(C+1+c)<1$ получаем нетривиальный bound
  $$N\\ge \\exp\\bigl(n^{\\Omega(1)}\\bigr),$$
  а при $\\kappa(C+1+c)\\ge 1$ этот bound перестаёт давать сверхполиномиальную нижнюю оценку на $N$.
- `Toy‑вычисление:`
  В §16.174 оценка имеет вид
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^{C}\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right)$$
  для некоторой фиксированной $C\\ge 1$.
  При $M=\\mathrm{poly}(n)$ имеем $\\log M=\\Theta(\\log n)$, а при $s=(\\log n)^c$ имеем $2s+1=\\Theta((\\log n)^c)$.
  Тогда
  $$((\\log n)^{C}(2s+1)\\log M)^{d}=\\bigl((\\log n)^{C+1+c}\\bigr)^{d}.$$
  Подставляя $d=(\\kappa+o(1))\\log n/\\log\\log n$, получаем
  $$\\bigl((\\log n)^{C+1+c}\\bigr)^{d}=\\exp\\bigl((\\kappa+o(1))(C+1+c)\\log n\\bigr)=n^{\\kappa(C+1+c)+o(1)}.$$
  Поэтому показатель экспоненты равен
  $$\\Omega\\Bigl(\\frac{n}{n^{\\kappa(C+1+c)+o(1)}}\\Bigr)=\\Omega\\bigl(n^{1-\\kappa(C+1+c)-o(1)}\\bigr).$$
- `Статус:` проверено (критическая глубина превращает polylog‑$s$ в константную потерю в степени $n$).
- `Барьер‑чек:` r — применимо (чистая параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 извлечь/зафиксировать явную константу $C$ (в $(\\log n)^C$) из Proof of HR’22 Thm. 4.3 и сравнить порог $\\kappa<1/(C+1+c)$ с реальным диапазоном глубин.

### 16.181. Исследовательский шаг: $C$ в $(\\log n)^C$ из HR’22 Thm. 4.3 = константа $c_1$ из multi‑switching (Lemma 4.4)

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S19-pin-down-constant-C):`
  В формулировке HR’22 Theorem 4.3 polylog‑фактор $(\\log n)^{O(1)}$ можно взять равным $\\log^{c_1}n$, где $c_1$ — константа из HR’22 Lemma 4.4 (Multi-switching Lemma).
  Следовательно, в corollary §16.174 для flat local‑EF(s) можно считать
  $$C=c_1$$
  (а все остальные потери учтены отдельно через $t'=(2s+1)\\log M$).
- `Доказательство/точная ссылка:`
  В HR’22 Lemma 4.4 (PDF p. 19; `../../resources/downloads/hastad_risse_2022_tseitin_grid_revisited.pdf`) параметрическая предпосылка содержит
  $$\\frac{n}{n'}\\ge A\\,t\\,\\log^{c_1}n.$$
  В Proof of Theorem 4.3 (PDF p. 19–20) они затем выбирают $\\ell=t=\\log M$ и задают рекурсию
  $$n_\\eta=\\Bigl\\lfloor\\frac{n_{\\eta-1}}{A_1\\,t\\,\\log^{c_1}n_{\\eta-1}}\\Bigr\\rfloor\\qquad(\\eta\\in[d]).$$
  Иначе говоря, единственный источник “$(\\log n)^{O(1)}$” в знаменателе экспоненты — именно множитель $\\log^{c_1}n$ из multi‑switching lemma (Lemma 4.4).
- `Toy‑тест:` если бы в Lemma 4.4 можно было взять $c_1=4$, то формула Thm. 4.3 стала бы с $(\\log n)^4$ (как в Lemma 4.2/Thm. 4.1); в тексте HR’22 $c_1$ оставлена как “absolute constant”.
- `Статус:` точная локализация константы (используем в Q43 как явный $C=c_1$).
- `Барьер‑чек:` r — применимо (switching‑леммы/decision trees релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43: в Proof of Lemma 4.4 (Section 7) попытаться извлечь явное значение/upper bound для $c_1$ (или зафиксировать, что текст не даёт численного $c_1$ без повторного анализа доказательства).

### 16.182. Исследовательский шаг (exact citation): в HR’22 Lemma 4.4 константа $c_1$ (в $\\log^{c_1}n$) не фиксируется явно

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S20-bound-c1):`
  В HR’22 Lemma 4.4 константа $c_1$ вводится только как “absolute constant” и в proof (Section 7.3) не выводится в явном виде: дополнительные издержки в инверсии отображения “absorbed by the constants $c_1$ and $c_2$”.
  Поэтому из текста HR’22 нельзя извлечь численное значение/upper bound для $c_1$ без самостоятельного трекинга констант (или замены леммы на источник с явными параметрами).
- `Точная ссылка (HR’22, text cache):`
  1) формулировка Lemma 4.4: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2570–2571` (“There are absolute constants A, c1, c2, n0 > 0 … n/n′ ≥ At log^{c1} n”);
  2) proof, Section 7.3: `…:2776–2777` (“the cost is absorbed by the constants c1 and c2”) и `…:2787–2790` (“only the index j cannot be absorbed by the constants A, c1 and c2”).
- `Toy‑тест:` поиск по шаблонам `c1=`/`choose c1` в text cache не находит явного выбора $c_1$ (только использование как “absolute constant”).
- `Статус:` exact citation (попытка “оценить $c_1$ из текста” упирается в неявные константы).
- `Барьер‑чек:` r — применимо (switching‑леммы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` либо перепройти proof Lemma 4.4 с трекингом констант и получить явный $c_1$, либо найти источник multi‑switching lemma с явно выписанным показателем у $\\log n$.

### 16.183. Исследовательский шаг (proof): PARITY имеет полиномиальные формулы глубины $O(\\log m/\\log\\log m)$ (снятие «глубинного» барьера для XOR‑строки)

- `Линза:` Трейд‑офф.
- `Утверждение (Q39.S2-parity-depth-loglog):`
  Для каждого $m\\ge 2$ существует булева формула над базисом $\\{\\wedge,\\vee,\\neg\\}$, вычисляющая $\\mathrm{PARITY}_m(x_1,\\dots,x_m)$, глубины
  $$O\\Bigl(\\frac{\\log m}{\\log\\log m}\\Bigr)$$
  и размера $\\mathrm{poly}(m)$ (например, $O(m^2)$).
  Следовательно, при глубине $d=\\Theta(\\log m/\\log\\log m)$ **само представление** большого XOR‑линейного условия (как одной строки Frege) не упирается в «нужно $\\Theta(\\log m)$ по глубине»; узел Q39 остаётся в **синтаксическом выводе** такого XOR‑шагa из предыдущих строк.
- `Доказательство (конструкция):`
  1) Для $k\\ge 1$ зададим depth‑2 DNF‑формулу паритета
  $$\\mathrm{PARITY}^{\\mathrm{DNF}}_k(x_1,\\dots,x_k)\\;:=\\;\\bigvee_{S\\subseteq[k],\\ |S|\\text{ odd}}\\ \\Bigl(\\bigwedge_{i\\in S} x_i\\ \\wedge\\ \\bigwedge_{i\\notin S}\\neg x_i\\Bigr).$$
  Она вычисляет $\\mathrm{PARITY}_k$ и имеет размер $O(k\\,2^k)$ и глубину 2.
  2) Пусть $b:=\\lceil\\log_2 m\\rceil$. Разобьём $x_1,\\dots,x_m$ на блоки длины $b$ (последний дополним константами 0).
  Пусть $y_1,\\dots,y_{\\lceil m/b\\rceil}$ — формулы, где $y_j$ есть $\\mathrm{PARITY}^{\\mathrm{DNF}}_b$ от переменных $j$‑го блока.
  Тогда
  $$\\mathrm{PARITY}_m(x)=\\mathrm{PARITY}_{\\lceil m/b\\rceil}(y_1,\\dots,y_{\\lceil m/b\\rceil}).$$
  3) Итерация: повторяем тот же шаг для $\\mathrm{PARITY}_{\\lceil m/b\\rceil}$, снова группируя входы по $b$ и применяя $\\mathrm{PARITY}^{\\mathrm{DNF}}_b$ на каждом блоке, пока число входов не станет $\\le b$ (тогда завершаем одной $\\mathrm{PARITY}^{\\mathrm{DNF}}_{\\le b}$).

  Глубина: каждый уровень добавляет 2, а число уровней $t$ удовлетворяет $m/b^t\\le b$, т.е.
  $$t\\le \\left\\lceil\\log_b(m/b)\\right\\rceil=O\\Bigl(\\frac{\\log m}{\\log\\log m}\\Bigr),$$
  значит глубина $\\le 2t+2=O(\\log m/\\log\\log m)$.
  Размер: так как $2^b\\le 2m$, имеем $|\\mathrm{PARITY}^{\\mathrm{DNF}}_b|=O(b\\,2^b)=O(m\\log m)$.
  На уровне $i$ блоков $\\le m/b^{i+1}$, поэтому вклад размера
  $$O\\Bigl(\\frac{m}{b^{i+1}}\\cdot m\\log m\\Bigr)=O\\Bigl(\\frac{m^2\\log m}{b^{i+1}}\\Bigr).$$
  Суммируя геометрический ряд по $i=0,1,\\dots,t-1$ и учитывая $b=\\Theta(\\log m)$, получаем общий размер $O(m^2)$.
- `Toy‑тест:` при $m=2^{16}$ имеем $b=16$ и уровней $t=3$ (так как $2^{16}/16^3<16$), то есть глубина $\\le 8$ при размере $O(m^2)$.
- `Статус:` доказано (явная конструкция формулы).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` найти/зафиксировать, существует ли **полиномиальный bounded‑depth Frege‑вывод** одной XOR‑операции (сложения двух линейных форм над $\\mathbb F_2$) при глубине $\\Theta(\\log n/\\log\\log n)$, или известен барьер/эквивалентность с моделями типа $\\mathrm{AC}^0$‑Frege с MOD2.

### 16.184. Исследовательский шаг (exact citation): GIRS’19 дают bounded‑depth вывод XOR‑шага (сложение $\\mathbb F_2$‑уравнений) для “compact representation” паритета

- `Линза:` Эквивалентность.
- `Утверждение (Q39.S3-cite-xor-step-bdfrege):`
  В Galesi–Itsykson–Riazanov–Sofronova’19 вводится “compact representation” $\\Phi^a(S,U)$ для уравнения паритета
  $$\\bigoplus_{i\\in S} x_i = a$$
  относительно фиксированного refinement $U$ множества $[n]$.
  В Section 4.2 (“Summation of linear equations”) они доказывают, что из двух таких представлений относительно **одного и того же** $U$
  можно синтаксически вывести их сумму над $\\mathbb F_2$, т.е. XOR‑шаг
  $$\\Phi^a(S,U),\\ \\Phi^b(T,U)\\ \\vdash\\ \\Phi^{a\\oplus b}(S\\triangle T, U)$$
  в bounded‑depth Frege с глубиной $3d+O(1)$ и полиномиальным (по размеру представлений) overhead.
  Это даёт положительный “XOR‑step”‑факт в литературе (но только в режиме compact‑representation+общий refinement).
- `Точная ссылка:`
  `../../resources/downloads/galesi_itsykson_riazanov_sofronova_2019_bounded_depth_frege_tseitin_all_graphs.pdf`, p. 11,
  Section 4.2, **Lemma 24**: “Let $U$ be a $(t_1,\\dots,t_d)$‑refinement … there exist a constant $c$ and a derivation
  $\\Phi^a(S,U),\\Phi^b(T,U)\\vdash_{3d+O(1)}\\Phi^{a\\oplus b}(S\\triangle T,U)$ of size at most $c\\cdot|\\Phi^1(\\emptyset,U)|^6$.”
- `Toy‑тест:` при $S=\\{1,2\\}$, $T=\\{2,3\\}$ получаем $S\\triangle T=\\{1,3\\}$ и именно $x_1\\oplus x_3=(x_1\\oplus x_2)\\oplus(x_2\\oplus x_3)$.
- `Статус:` exact citation (XOR‑сложение уравнений известно для compact‑representation).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо (локальный факт о bounded‑depth Frege‑выводе).
- `Следующий шаг:` сопоставить HR’22 “representing parity” (формулы depth $d$, size $M$) с compact‑representation $\\Phi^a(S,U)$: можно ли в bounded‑depth Frege переводить/поддерживать единый refinement $U$ для нужных промежуточных уравнений без blow‑up, или именно здесь “missing Gauss step” у HR остаётся.

### 16.185. Исследовательский шаг (toy computation): GIRS‑compact XOR‑step даёт лишь quasi‑poly размер в режиме глубины $\\Theta(\\log m/\\log\\log m)$

- `Линза:` Трейд‑офф.
- `Утверждение (Q39.S4-compare-hr-vs-girs-repr):`
  Если пытаться реализовать “XOR‑step” в bounded‑depth Frege через **GIRS’19 compact representation** $\\Phi^a(S,U)$ и их Lemma 24,
  то при глубине строк $D=\\Theta(\\log m/\\log\\log m)$ (где $m$ — ширина линейного уравнения) получается лишь квазиполиномиальная
  верхняя оценка на размер вывода, а не $\\mathrm{poly}(m)$.
  Поэтому наличие Lemma 24 само по себе не закрывает Q39: остаётся разрыв между “XOR‑step существует для compact‑representation” и
  “XOR‑step polynomial‑size в требуемом depth‑режиме для естественных паритет‑формул (HR §1.2)”.
- `Toy‑вычисление (по GIRS’19 Lemma 20/21/24):`
  В GIRS’19 (p. 10) Lemma 20: если $t_1\\cdots t_d\\ge m$, то существует $(t_1,\\dots,t_d)$‑refinement $U$ множества $[m]$.
  По Lemma 21 (p. 10) соответствующая compact‑формула паритета имеет глубину $\\le 3d+1$ и размер
  $$|\\Phi^1(\\emptyset,U)|\\ \\le\\ \\prod_{i=1}^d 2^{t_i+1}t_i\\ =\\ 2^{d+\\sum_i t_i}\\cdot\\prod_i t_i.$$
  Если хотим уложиться в глубину $D$, то берём $d:=\\lfloor (D-1)/3\\rfloor$.
  Чтобы минимизировать грубую оценку на размер, можно взять все $t_i$ одинаковыми: $t:=\\lceil m^{1/d}\\rceil$, тогда $t^d\\ge m$.
  Из Lemma 21 получаем
  $$|\\Phi^1(\\emptyset,U)|\\ \\le\\ (2^{t+1}t)^d\\ =\\ \\exp\\bigl(O(d\\,t)\\bigr).$$
  В режиме $D\\asymp \\log m/\\log\\log m$ имеем $d\\asymp \\log m/\\log\\log m$ и
  $$t=m^{1/d}=\\exp\\bigl(\\Theta(\\log m/d)\\bigr)=\\exp\\bigl(\\Theta(\\log\\log m)\\bigr)=\\log^{\\Theta(1)}m,$$
  так что $d\\,t=\\log^{\\Theta(1)}m$ и потому $|\\Phi^1(\\emptyset,U)|=\\exp(\\log^{\\Theta(1)}m)$ (quasi‑poly bound).
  Наконец, Lemma 24 (p. 11) даёт вывод XOR‑шага размера $\\le c\\cdot|\\Phi^1(\\emptyset,U)|^6$, то есть по этой оценке также quasi‑poly при таком $D$.
- `Статус:` проверено (параметрический разрыв: GIRS‑compact не даёт $\\mathrm{poly}(m)$ при $D\\asymp\\log m/\\log\\log m$).
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q39 нужно либо (a) другая “компактная” репрезентация паритета, совместимая с depth $\\Theta(\\log m/\\log\\log m)$ и $\\mathrm{poly}(m)$‑размером, для которой XOR‑step выводим, либо (b) барьер/негативный результат, что XOR‑step не может быть poly‑size в этом depth‑режиме.

### 16.186. Исследовательский шаг (proof): Håstad’20 Thm. 6.5 + XOR‑каркас ⇒ “универсальный poly XOR‑step” исключается лишь при $d=o(\\log n/\\log\\log n)$

- `Линза:` Модельный стресс‑тест.
- `Утверждение (Q39.S5-lb-xor-step-hastad20):`
  Пусть $d\\le 59\\,\\frac{\\log n}{\\log\\log n}$ (как в Håstad’20, Thm. 6.5) и рассмотрим Tseitin(Grid$_n$) с нечётной суммой зарядов.
  Если бы существовала процедура, которая для каждого XOR‑шагa, возникающего в стандартном гауссовом/column‑summing каркасе (суммирование $\\mathbb F_2$‑уравнений на границах регионов),
  строила depth‑$d$ Frege‑вывод этого шага размера $\\mathrm{poly}(n)$, то существовала бы depth‑$d$ Frege‑рефутация Tseitin(Grid$_n$) размера $\\mathrm{poly}(n)$.
  Сравнивая с Håstad’20 Thm. 6.5 (любой depth‑$d$ refutation имеет размер $\\ge \\exp(\\Omega(n^{1/(58(d+1))}))$) получаем противоречие **лишь в тех режимах $d$, где эта нижняя оценка сверхполиномиальна** (т.е. $n^{1/(58(d+1))}=\\omega(\\log n)$, эквивалентно $d=o(\\log n/\\log\\log n)$).
  В режиме $d=\\Theta(\\log n/\\log\\log n)$ сама по себе Thm. 6.5 не запрещает polynomial‑size (см. контрпример‑проверку §16.187).
- `Доказательство:`
  1) (Нижняя оценка.) По Håstad’20, Thm. 6.5 (`../../resources/downloads/hastad_2020_small_depth_frege_tseitin_grids.pdf`, p. 17 в тексте pdf‑to‑text)
  при $d\\le 59\\,\\frac{\\log n}{\\log\\log n}$ любая depth‑$d$ Frege‑рефутация Tseitin(Grid$_n$) имеет размер
  $$\\ge \\exp\\bigl(\\Omega(n^{1/(58(d+1))})\\bigr).$$
  2) (Каркас по XOR‑суммированию.) В гауссовом/column‑summing рассуждении противоречие $0=1$ получается как $\\mathbb F_2$‑линейная комбинация вершинных уравнений
  (сумма всех вершинных уравнений даёт $0=\\bigoplus_v \\chi(v)=1$).
  Любой такой вывод можно разложить на $T=\\mathrm{poly}(n)$ локальных XOR‑шагов вида
  $$E(S_1,b_1),\\ E(S_2,b_2)\\ \\vdash\\ E(S_1\\triangle S_2,\\ b_1\\oplus b_2)$$
  (см. редукцию «XOR‑шаг ↔ 3‑вершинный Tseitin» в §16.126).
  3) (Склейка.) Если каждый из этих $T$ шагов имеет depth‑$d$ Frege‑вывод размера $\\mathrm{poly}(n)$, то их конкатенация даёт depth‑$d$ refutation размера $T\\cdot\\mathrm{poly}(n)=\\mathrm{poly}(n)$.
  4) (Когда возникает противоречие.) Конкатенация даёт refutation размера $\\mathrm{poly}(n)$, что противоречит пункту (1) **только если**
  $$\\exp\\bigl(\\Omega(n^{1/(58(d+1))})\\bigr)\\ \\text{сверхполиномиальна по }n.$$
  В этом случае в XOR‑каркасе действительно есть “плохой шаг” размера
  $$\\exp\\bigl(\\Omega(n^{1/(58(d+1))})\\bigr)/\\mathrm{poly}(n).$$
- `Toy‑тест:` если $d=o(\\log n/\\log\\log n)$, то $n^{1/(58(d+1))}=\\omega(\\log n)$ и lower bound в (1) сверхполиномиален; значит “универсальный poly XOR‑step” в таком depth‑режиме невозможен.
- `Статус:` доказано (корректная формулировка: аргумент даёт барьер лишь в режиме $d=o(\\log n/\\log\\log n)$).
- `Барьер‑чек:` r — применимо (LB Håstad’20 через switching‑лемму релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q39 уточнить класс “XOR‑шагов каркаса”: найти, можно ли держать special‑форму представления (общий partition/blocks) так, чтобы *все* шаги попадали в лёгкий режим §16.130 без base‑change, или доказать, что это невозможно.

### 16.187. Исследовательский шаг (counterexample): Thm. 6.5 не запрещает polynomial‑size при $d=\\Theta(\\log n/\\log\\log n)$

- `Линза:` Трейд‑офф.
- `Утверждение (Q39.S6-block-carcas-or-impossibility):`
  Утверждение вида «Håstad’20 Thm. 6.5 запрещает polynomial‑size refutation при $d=\\Theta(\\log n/\\log\\log n)$» неверно:
  при $d=(\\kappa+o(1))\\frac{\\log n}{\\log\\log n}$ нижняя оценка Thm. 6.5 даёт лишь
  $$\\mathrm{size}\\ \\ge\\ \\exp\\bigl(\\Omega(\\log^{1/(58\\kappa)}n)\\bigr)=n^{o(1)},$$
  что совместимо с polynomial‑size.
  Поэтому из Thm. 6.5 нельзя вывести, что “универсальный poly XOR‑step” невозможен на *критической* глубине; нужен структурный аргумент про base‑change/blocks.
- `Toy‑вычисление:`
  Подставим $d=(\\kappa+o(1))\\frac{\\log n}{\\log\\log n}$ в экспоненту Thm. 6.5:
  $$n^{1/(58(d+1))}=\\exp\\Bigl(\\frac{\\log n}{58(d+1)}\\Bigr)=\\exp\\Bigl(\\Theta\\bigl(\\tfrac{\\log\\log n}{58\\kappa}\\bigr)\\Bigr)=\\log^{\\Theta(1)}n.$$
  Отсюда $\\exp(\\Omega(n^{1/(58(d+1))}))=\\exp(\\Omega(\\log^{\\Theta(1)}n))=n^{o(1)}\\le n$ (например, при $\\kappa\\ge 1/58$).
  Следовательно, наличие refutation размера $n^{10}$ при такой глубине **не** противоречило бы Thm. 6.5.
- `Статус:` контрпример‑проверка (уточняет, где именно “LB ⇒ тяжёлый XOR‑шаг” работает).
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q39: либо найти реальный “hard” XOR‑шаг (где неизбежен base‑change между несовместимыми блок‑разбиениями), либо построить последовательность блок‑разбиений, в которой все шаги остаются в лёгком режиме §16.130.

### 16.188. Исследовательский шаг (exact citation): у HR’22 single switching‑леммы показатель polylog фиксирован (=4), а в multi‑слое новая “непоглощаемая” цена — только $M^{s/\\ell}$

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S21-cite-log4-and-Mfactor):`
  В HR’22 единственный *явно зафиксированный* polylog‑показатель в switching‑каркасе равен 4 (Lemma 4.2: предпосылка $n/n'\\ge A\\,t\\,\\log^4 n$ и хвост $(A t\\log^4 n'/(n/n'))^{s/64}$).
  Для multi‑switching (Lemma 4.4) в Proof/§7.3 авторы явно утверждают, что из “дополнительной информации” по сравнению со стандартным switching‑случаем **только** индекс $j\\in[M]$ “не поглощается” абсолютными константами и именно он порождает множитель $M^{s/\\ell}$.
  Следовательно, чтобы сделать показатель $c_1$ в Lemma 4.4 явным, достаточно трекать только места, где в §7.3 “absorbed by $c_1,c_2$” (например, идентификация доп. chosen centers на расстоянии 1), а не заново пересобирать весь single‑switching (где показатель уже равен 4).
- `Точная ссылка (HR’22, text cache):`
  1) Lemma 4.2 (Switching Lemma): `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:950–961`.
  2) Proof of Lemma 4.4, §7.3 (что именно даёт $M^{s/\\ell}$ и что “absorbed”): `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777` и `…:2787–2790`.
- `Toy‑тест:` проверка по text cache: в (1) действительно стоит $\\log^4$, а в (2) дословно выделен единственный “не‑absorbed” вклад — индекс $j$, порождающий $M^{s/\\ell}$.
- `Статус:` exact citation (локализация источников явных/неявных констант в HR’22).
- `Барьер‑чек:` r — применимо (switching/encoding‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` для Q43 проверить, что “identity of additional chosen centers” из §7.3 реально укладывается в прежний $b\\log\\Delta$‑терм (как в Lemma 6.9) и не требует увеличивать показатель у $\\log n$ сверх 4; иначе выписать явный upper bound на $c_1$ (пусть и грубый).

### 16.189. Исследовательский шаг (toy computation): доп. идентификация chosen centers в multi‑switching даёт множитель $(n/n')^{O(s)}$ и влияет только на $c_2$ (а не на $\\log^4$)

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S22-check-c1-vs-log4):`
  В HR’22 Proof of Lemma 4.4 (Multi-switching) указано, что для восстановления “additional chosen centers” на расстоянии $\\le1$ от новых exposed centers читается $\\le\\log\\Delta$ бит на центр и таких центров “at most linear in $s$”.
  Поэтому весь этот вклад даёт лишь дополнительный множитель
  $$2^{O(s\\log\\Delta)}=\\Delta^{O(s)}=(n/n')^{O(s)}$$
  в энкодинге (при $\\Delta=\\Theta(n/n')$).
  Такой множитель естественно “прячется” в константу $c_2$ в хвосте Lemma 4.4 вида
  $$(At\\,\\log^{c_1}n\\,/(n/n'))^{s/c_2},$$
  т.е. меняет только коэффициент при $\\log(n/n')$ в экспоненте, но **не порождает** нового polylog‑показателя сверх $\\log^4$ из single‑switching (Lemma 4.2).
- `Точная ссылка (HR’22, text cache):` `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777`.
- `Toy‑тест:` $\\log\\Delta$ бит на центр и $O(s)$ центров ⇒ $O(s\\log\\Delta)$ бит ⇒ $2^{O(s\\log\\Delta)}=\\Delta^{O(s)}$.
- `Статус:` toy computation (локализует, что именно может “раздуть” только $c_2$, но не показатель у $\\log n$).
- `Барьер‑чек:` r — применимо (вся энкодинг‑оценка релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` если нужен *численный* $c_2$, оценить константу в “linear in $s$” для числа таких centers из конструкции common partial decision tree (HR’22 §7.2) и подставить в энкодинг.

### 16.190. Исследовательский шаг (toy computation): явная константа в “linear in $s$” для additional chosen centers в HR’22 Lemma 4.4 (≤ $2s$)

- `Линза:` Инвариант.
- `Утверждение (Q43.S23-bound-linear-centers):`
  В HR’22 (Lemma 4.4 / §7.2–§7.3) число chosen centers $v$, для которых в §7.3 нужно “recover the chosen centers $v$ at distance at most 1 from the newly exposed chosen centers”, можно взять не просто “$O(s)$”, а **явно** $\\le 2s$ для ветви глубины $s$ в common partial decision tree.
  Следовательно, соответствующая цена идентификации ограничена сверху $\\le 2s\\log\\Delta$ бит.
- `Доказательство (заряд по запросам):`
  Возьмём фиксированную ветвь $\\tau$ common partial decision tree $T$ глубины $s$.
  По построению (HR’22 §7.2) на каждом раунде для long branch $\\lambda^j$ вводится множество $S_{\\lambda^j}$ и $T$ расширяется запросами “all variables incident to $S_{\\lambda^j}$”.
  Поэтому для каждого chosen center $v\\in\\bigcup_j S_{\\lambda^j}$ существует хотя бы один запрос переменной на ветви $\\tau$, инцидентной $v$.
  Для каждого такого $v$ выберем **первый** (по порядку на $\\tau$) запрос переменной, инцидентной $v$.
  Но каждая переменная $y_P$ соответствует chosen path $P$, соединяющему **две** chosen centers (HR’22 §3), т.е. один запрос может быть инцидентен не более чем двум chosen centers.
  Значит, отображение $v\\mapsto$ “первый инцидентный запрос” является $\\le2$‑к‑$1$, и
  $$\\Bigl|\\bigcup_j S_{\\lambda^j}\\Bigr|\\le 2\\cdot |\\text{queries on }\\tau|=2s.$$
  Отсюда цена идентификации $\\le (2s)\\log\\Delta$ бит.
- `Точная ссылка (HR’22, text cache):`
  1) Определение $S_{\\lambda^j}$ и “querying all variables incident to $S_{\\lambda^j}$”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2724–2729`.
  2) Место, где говорится “linear in $s$”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777`.
  3) “chosen path connects two chosen centers” и ввод $y_P$: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:733–735`.
- `Toy‑тест:` при $s$ запросах можно достигать $2s$ distinct chosen centers (каждый запрос касается двух “новых” центров), так что константа 2 оптимальна для такого счёта.
- `Статус:` toy computation (явная константа для hidden “linear in $s$”).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (комбинаторный энкодинг‑аргумент релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` подставить $2s\\log\\Delta$ в оценку “absorbed by $c_2$” в proof of Lemma 4.4 (§7.3) и выписать грубый численный $c_2$ (с учётом базового $s/64$ из single‑switching).

### 16.191. Исследовательский шаг (toy computation): грубый явный $c_2$ для HR’22 Lemma 4.4 из bound $|\\bigcup_j S_{\\lambda^j}|\\le 2s$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S24-derive-numeric-c2):`
  Если в proof‑схеме HR’22 Lemma 4.4 (Multi-switching) использовать тот же “заряд по стадиям”, что и в single‑switching (Lemma 4.2 через Lemma 6.8–6.9), то можно взять **$c_2=64$** (т.е. тот же знаменатель, что в хвосте $(\\cdot)^{s/64}$), а вклад “additional chosen centers” из §7.3 лишь раздувает polylog‑часть: грубо достаточно $c_1\\le 132$.
- `Вывод (как в Lemma 6.8–6.9, с подстановкой 16.190):`
  1) В single‑switching имеем $a\\ge s/64$ (HR’22 Lemma 6.8) и оценку числа bad‑ограничений через $a\\log t+b\\log\\Delta+O(s)$ бит (HR’22 Lemma 6.9), где $b\\le 3a$ (Lemma 6.8), откуда получается $\\log^{4a}$ и хвост $(At\\,\\log^4(\\cdot)/(n/n'))^{s/64}$ (Lemma 4.2).
  2) В multi‑switching дополнительно нужно идентифицировать chosen centers из $\\bigcup_j S_{\\lambda^j}$; по §16.190 их не больше $2s$, значит вклад в энкодинг не превосходит $2s\\log\\Delta$ бит.
  3) Заряд Lemma 6.8 даёт $s\\le 64a$, поэтому $2s\\le 128a$. Следовательно, можно просто увеличить “$b$‑часть” на $128a$ и получить грубую оценку $a+b\\le a+(3a+128a)=132a$, т.е. заменить $\\log^4$ на $\\log^{132}$, сохранив знаменатель 64 в экспоненте.
- `Toy‑тест:` арифметика: $a\\ge s/64\\Rightarrow 2s\\le 128a$; при $b\\le 3a$ получаем $a+b+128a\\le 132a$.
- `Статус:` toy computation (явный, хотя и грубый, upper на константы).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (switching/encoding релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` уточнить, действительно ли “additional chosen centers” из §7.3 можно зарядить в тот же $b\\log\\Delta$‑терм с коэффициентом $O(1)$ (тогда $c_1$ может остаться $\\approx 4$), и отдельно проверить вклад “differences in values” (тоже заявлен как absorbed).

### 16.192. Исследовательский шаг (exact citation): HR’22 §7.3 — “additional chosen centers” и “differences in values” поглощаются; только индекс $j$ даёт фактор $M^{s/\\ell}$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S25-tighten-c1-charge):`
  В доказательстве Multi-switching Lemma 4.4 (HR’22) в §7.3 явно перечислены дополнительные данные, читаемые на каждом раунде инверсии:
  (i) индекс $j\\in[M]$ (log $M$ бит),
  (ii) идентичность дополнительных chosen centers на расстоянии $\\le 1$ от новых exposed centers (log $\\Delta$ бит на центр),
  (iii) “differences in values” между ответами в деревьях $T^j$ и $T$.
  HR’22 прямо утверждают, что **только** (i) не поглощается константами $A,c_1,c_2$ и именно он порождает множитель $M^{s/\\ell}$ в оценке Lemma 4.4; пункты (ii)–(iii) поглощаются константами.
- `Точная ссылка (HR’22, text cache):`
  1) (ii) + “absorbed by $c_1,c_2$”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2777`.
  2) (iii) “differences in values”: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2778–2783`.
  3) “only index $j$ cannot be absorbed” ⇒ фактор $M^{s/\\ell}$: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2787–2790`.
- `Toy‑тест:` проверено по text cache, что формулировки (ii)–(iii) и вывод “only the index $j$” действительно записаны в §7.3.
- `Статус:` точная ссылка (закрывает подпункт “differences in values absorbed”; остаётся распаковать “absorbed” в явные константы для $c_1$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (encoding‑аргумент релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` выписать явный верхний bound на число “differences in values” бит на раунд (в терминах $s$ или $a,b$ из Lemma 6.9) и тем самым отделить вклад, который меняет только $A$ (а не $c_1$).

### 16.193. Исследовательский шаг (toy computation): “differences in values” в HR’22 §7.3 стоят ≤ 1 бит на запрос и меняют только константу $A$

- `Линза:` Инвариант.
- `Утверждение (Q43.S26-bound-diff-values-bits):`
  В схеме инверсии Multi-switching Lemma 4.4 (HR’22, §7.3) дополнительная информация “differences in values” кодируется ≤ 1 битом на каждую булеву переменную, запрошенную на рассматриваемой ветви common decision tree $T$; следовательно, на ветви глубины $s$ суммарная цена ≤ $s$ бит.
  Так как в single‑switching имеем $a\\ge s/64$ (HR’22 Lemma 6.8), то $s\\le 64a$ и вклад ≤ $64a$ бит лишь умножает счётчик кодировок на $2^{64a}=(2^{64})^a$, т.е. поглощается увеличением константы $A$ и **не** меняет $c_1,c_2$.
- `Доказательство (счёт бит):`
  На каждом раунде HR’22 читают “difference in values of variables queried in the decision tree $T^j$ and the same variables in the common decision tree $T$” (§7.3).
  Для каждой такой переменной значение в $T^j$ и в $T$ — два бита, значит их разность определяется одним битом (XOR).
  На фиксированной ветви $\\tau$ common decision tree $T$ глубины $s$ запрошено ровно $s$ переменных, поэтому даже в худшем случае достаточно ≤ $s$ бит, чтобы задать разности для всех этих запросов (по раундам это просто разбиение запросов ветви $\\tau$).
  Используя $s\\le 64a$ (Lemma 6.8), получаем ≤ $64a$ бит сверх энкодинга Lemma 6.9; это даёт множитель $2^{64a}=(2^{64})^a$, который поглощается заменой $A\\leftarrow 2^{64}A$ в финальной оценке вероятности.
- `Toy‑тест:` на ветви из $s$ булевых запросов вектор разностей может быть произвольным в $\\{0,1\\}^s$, так что линейный по $s$ upper (и “1 бит на запрос”) асимптотически точен.
- `Статус:` toy computation (явный bound на “differences in values”, отделяющий вклад в $A$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (счёт кодировок релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` так же “раздуть” в явные константы пункт (ii) про additional chosen centers, но попытаться зарядить его в тот же $b\\log\\Delta$‑терм без роста показателя логарифма (чтобы удержать $c_1\\approx 4$).

### 16.194. Исследовательский шаг (toy computation): “additional chosen centers” в HR’22 §7.3 дают ≤ $5a$ центров (а не ≤ $2s$), улучшая грубый bound на $c_1$

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S27-charge-centers-into-b):`
  В HR’22 §7.3 (Multi-switching Lemma 4.4) дополнительная информация (ii) “identity of additional chosen centers” может быть ограничена не через глубину ветви $s$ common tree, а через параметр $a$ из single‑switching энкодинга (HR’22 Lemma 6.8): на всей ветви глубины $s$ достаточно восстановить не более чем $5a$ chosen centers из объединения $S_{\\lambda^j}$ по раундам $j$.
  Следовательно, цена пункта (ii) составляет ≤ $5a\\log\\Delta$ бит, и грубый переход “≤$2s$ центров ⇒ $c_1\\le 132$” (§16.191) можно заменить на “≤$5a$ центров ⇒ $b$ эффективно меняется на $b+5a\\le 8a$”, т.е. $c_1$ можно взять порядка 9 (в той же схеме оценки).

- `Доказательство (счёт центров):`
  В HR’22 §7.2 множество $S_{\\lambda^j}$ определяется как chosen centers на расстоянии ≤1 от *новых* exposed chosen centers на длинной ветви $\\lambda^j$ (см. `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2720–2726`).
  Пусть
  $$U_j:=(S(\\lambda^j,\\sigma)\\setminus S(\\tau,\\sigma))\\cap C_\\sigma$$
  — эти “newly exposed chosen centers”. Тогда по определению $S_{\\lambda^j}\\subseteq N_{\\le 1}(U_j)$, где соседство берётся по “adjacent sub-squares” (HR’22: “neighbors … in adjacent sub-squares”; `…:1573–1574`), и потому на решётке под‑квадратов
  $$|S_{\\lambda^j}|\\le |U_j|+4|U_j|=5|U_j|.$$
  Далее, каждый новый exposed chosen center из $U_j$ появляется в стадии $j$ как associated center некоторой переменной на соответствующей 1‑ветви (это ровно то, что считает $a_j$ в HR’22 Lemma 6.8; `…:2078–2086`), откуда $|U_j|\\le a_j$.
  Суммируя по раундам,
  $$\\Bigl|\\bigcup_j S_{\\lambda^j}\\Bigr|\\le \\sum_j |S_{\\lambda^j}|\\le 5\\sum_j a_j=5a.$$
  В §7.3 HR’22 указывают, что на восстановление каждого такого chosen center читается ≤$\\log\\Delta$ бит (`…:2774–2777`), значит общий бюджет на (ii) ≤ $5a\\log\\Delta$ бит.

- `Toy‑тест:` worst‑case на решётке: если $U_j$ — множество попарно “разнесённых” новых exposed centers, то их соседства почти не пересекаются и $|S_{\\lambda^j}|\\approx 5|U_j|$, т.е. константа 5 по порядку точна.
- `Статус:` toy computation (улучшенный счёт “additional chosen centers” через $a$, без фактора 64).
- `InfoGain:` 2.
- `Барьер‑чек:` r — применимо (encoding‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` попытаться усилить $|U_j|\\le a_j$ до “$S_{\\lambda^j}$ уже входит в $b$ из Lemma 6.9” (т.е. показать, что (ii) вообще не увеличивает показатель polylog), или найти точную точку, где это невозможно.

### 16.195. Исследовательский шаг (proof): (ii) “identity of additional chosen centers” в HR’22 §7.3 не увеличивает polylog‑показатель — она уже покрывается $b\\log\\Delta$ из Lemma 6.9

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S28-centers-already-in-b):`
  В proof of HR’22 Lemma 4.4 (Multi-switching, §7.3) дополнительный пункт (ii) “identity of additional chosen centers” для множеств $S_{\\lambda^j}$ можно зарядить в тот же $b\\log\\Delta$‑терм, что и в single‑switching Lemma 6.9: центры $v\\in S_{\\lambda^j}$ уже восстанавливаются стандартной инверсией как “неэкспонированные соседи” новых exposed chosen centers, а случаи, где нужен $\\log\\Delta$, совпадают с “other disappearing centers”, считаемыми в $b$.

- `Доказательство (по тексту HR’22):`
  В раунде $j$ multi-switching задана длинная ветвь $\\lambda^j$ и
  $$U:=(S(\\lambda^j,\\sigma)\\setminus S(\\tau,\\sigma))\\cap C_\\sigma$$
  — множество “newly exposed chosen centers” (HR’22: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2724–2729`).
  По определению $S_{\\lambda^j}$ каждый $v\\in S_{\\lambda^j}$ лежит в под‑квадрате, соседнем (в $n'\\times n'$‑решётке) некоторому $u\\in U$.
  Так как при построении $T^j$ “maintain the same invariants as in Invariants 6.1” (HR’22: `…:2698–2699`), то для каждого exposed chosen center $u$ на ветви $\\lambda^j$ запрошены **все** инцидентные переменные $y_P$ (Invariant 6.1(5); `…:1858–1861`).
  В частности, запрошена переменная выбранного пути между $u$ и соседним $v$, и в восстановимом information set присутствует information piece $\\{u,v\\}$.
  Ровно такие ситуации (edge/non-edge между exposed chosen center $u$ и неэкспонированным chosen center $v$) разбираются в proof of Lemma 6.9: Case 1–3 при восстановлении $I_j$ (`…:2518–2534`).
  В Case 1 $v$ восстанавливается позже, в Case 3 — бесплатно как alive chosen center, а в Case 2 $v$ идентифицируется за $\\log\\Delta$ бит и при этом **не** является associated center (по Property 2, Definition 6.2), то есть относится к “other disappearing centers”, оплачиваемым $b\\log\\Delta$ (`…:2531–2534`, `…:2547–2548`).
  Следовательно, (ii) не требует добавлять новый $\\log\\Delta$‑бюджет поверх Lemma 6.9 и не увеличивает polylog‑показатель по сравнению с single‑switching (за исключением отдельного фактора по индексу $j\\in[M]$).

- `Toy‑тест:` локально на решётке каждый новый exposed chosen center $u$ имеет ≤4 соседних chosen centers; по Invariant 6.1(5) они неизбежно появляются как вторые концы queried variables, а Lemma 6.9 Case 1–3 даёт готовую схему их восстановления без нового polylog.
- `Статус:` доказано (на уровне схемы инверсии HR’22; пункт (ii) не увеличивает polylog‑показатель).
- `InfoGain:` 2.
- `Барьер‑чек:` r — применимо (энкодинг‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обновить §16.191–§16.194: убрать добавку “$+5a$” как обязательную для $c_1$, зафиксировать $c_1\\approx 4$ (и отдельно вынести единственный непоглощаемый вклад $\\log M$), либо указать точное место, где “forgotten answers” ломают прямой перенос Case 1–3.

### 16.196. Исследовательский шаг (proof): в HR’22 Lemma 4.4 можно взять $c_1=4$; непоглощаемый вклад §7.3 — только индекс $j$ (даёт фактор $M^{s/\\ell}$)

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S29-propagate-c1-back-to-4):`
  В вероятностной оценке HR’22 Lemma 4.4 (Multi-switching) показатель $c_1$ при $\\log^{c_1}n$ можно выбрать равным $4$ (как в single-switching Lemma 4.2), т.е. без роста polylog‑показателя по сравнению с single‑switching.
  Все дополнительные данные, перечисленные в HR’22 §7.3, кроме индекса $j\\in[M]$, поглощаются константами $A,c_2$; единственный непоглощаемый вклад даёт фактор $M^{s/\\ell}$ (эквивалентно чтению $(s/\\ell)\\log M$ бит).

- `Доказательство (сведение к single-switching):`
  В HR’22 §7.3 на каждом раунде инверсии перечислены дополнительные данные (i)–(iii); при этом в тексте прямо сказано, что **только** (i) “cannot be absorbed by the constants $A,c_1,c_2$” и именно он порождает фактор $M^{s/\\ell}$ (см. `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2774–2790`).
  Для (iii) “differences in values” достаточно ≤ $s$ бит на ветвь глубины $s$, значит при $a\\ge s/64$ (HR’22 Lemma 6.8) имеем $s\\le 64a$ и этот вклад даёт множитель $2^{O(a)}$, поглощаемый увеличением $A$ (см. §16.193).
  Для (ii) “identity of additional chosen centers” по §16.195 не требуется добавлять новый $\\log\\Delta$‑бюджет сверх Lemma 6.9: соответствующие центры уже восстанавливаются в Case 1–3 и (в единственном месте, где нужен $\\log\\Delta$) относятся к “other disappearing centers”, оплачиваемым тем же $b\\log\\Delta$.
  Следовательно, в части, отвечающей за polylog‑показатель $\\log^{c_1}n$, multi-switching использует тот же single‑switching энкодинг, где $c_1=4$ (Lemma 4.2), а все отличия сводятся к фактору $M^{s/\\ell}$ и перенормировке $A$.

- `Toy‑тест:` если бы (ii) или (iii) требовали увеличивать $b$ сверх $3a$ или добавлять $\\log\\Delta$‑терм “поверх” Lemma 6.9, это проявилось бы как рост показателя у $\\log n$ в предпосылке $n/n'\\ge A t\\log^{c_1}n$; после §16.193 и §16.195 остаётся только (i), дающий множитель $M^{s/\\ell}$ без изменения $c_1$.
- `Статус:` доказано (получено явное $c_1=4$ и изолирован единственный вклад $\\log M$).
- `InfoGain:` 2.
- `Барьер‑чек:` r — применимо (switching/encoding релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` в corollary‑оценках для Q43 заменить “$(\\log n)^C$ из Thm. 4.3” на явное $\\log^4 n$, оставив $\\log M$ только в параметре $t$ (и факторе $M^{s/\\ell}$), и перепроверить порог нетривиальности при $d=\\Theta(\\log n/\\log\\log n)$.

### 16.197. Исследовательский шаг (proof): явный corollary с $\\log^4 n$ при $c_1=4$ и зависимостью от $M$ только через $t'$ и $M^{s/\\ell}$

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S30-log4-into-corollary):`
  Пусть есть flat local‑EF(s)‑рефутация Tseitin($G_n$) на $n\\times n$ grid (odd charges, как в HR’22),
  и каждая строка — формула глубины $\\le d$ и размера $\\le M$.
  Тогда число строк $N$ удовлетворяет явной нижней оценке
  $$N\\ \\ge\\ \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^4\\,(2s+1)\\,\\log M\\bigr)^{d}}\\right)\\right).$$
  При этом зависимость от $M$ в доказательстве проходит **только** через $t'=(2s+1)\\log M$ и через фактор $M^{s/\\ell}$ из multi‑switching (индекс $j\\in[M]$); других $\\log M$‑вкладов в polylog‑показатель нет.
- `Доказательство:`
  По §16.174 имеем corollary HR’22 Thm. 4.3 с заменой $t=\\log M\\mapsto t'=(2s+1)\\log M$ и polylog‑фактором $(\\log n)^{O(1)}$.
  По §16.181 этот показатель равен $\\log^{c_1}n$, где $c_1$ — константа из HR’22 Lemma 4.4,
  а по §16.196 можно взять $c_1=4$ (как в single‑switching).
  Подставляя $c_1=4$ в corollary §16.174, получаем указанную формулу с $(\\log n)^4$.

  Зависимость от $M$: параметрический блок Proof of Thm. 4.3 использует $M$ только через $t=\\log M$ (§16.166),
  а единственный непоглощаемый вклад §7.3 HR’22 — индекс $j\\in[M]$, дающий фактор $M^{s/\\ell}$ (§16.196).
  Следовательно, после unfolding зависимость от $M$ идёт лишь через $t'$ и $M^{s/\\ell}$, как утверждается.
- `Toy‑тест:` при $s=0$ получаем исходный HR’22 Thm. 4.3 с $(\\log n)^4$ (single‑switching Lemma 4.2).
- `Статус:` доказано (явная подстановка $c_1=4$ в corollary).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (switching/DT‑аргументы релятивизируются), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` при $M=\\mathrm{poly}(n)$ и $s=(\\log n)^c$ пересчитать показатель при критической глубине $d=(\\kappa+o(1))\\log n/\\log\\log n$ с явной константой $4$ (Q43.S31-critical-depth-kappa).

### 16.198. Исследовательский шаг (toy computation): критическая глубина $d=(\\kappa+o(1))\\log n/\\log\\log n$ при $s=(\\log n)^c$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S31-critical-depth-kappa):`
  Пусть $M=\\mathrm{poly}(n)$, $s=(\\log n)^c$ для фиксированного $c\\ge 0$, и
  $$d=\\left(\\kappa+o(1)\\right)\\frac{\\log n}{\\log\\log n}.$$
  Тогда corollary §16.197 даёт
  $$N\\ge\\exp\\bigl(\\Omega(n^{1-\\kappa(5+c)-o(1)})\\bigr).$$
  В частности, lower bound нетривиален ($N\\ge\\exp(n^{\\Omega(1)})$) тогда и только тогда, когда
  $$\\kappa<\\frac{1}{5+c}.$$
- `Toy‑вычисление:`
  В §16.197 имеем
  $$N\\ge \\exp\\!\\left(\\Omega\\left(\\frac{n}{\\bigl((\\log n)^4(2s+1)\\log M\\bigr)^d}\\right)\\right).$$
  При $M=\\mathrm{poly}(n)$ получаем $\\log M=\\Theta(\\log n)$, а при $s=(\\log n)^c$ имеем $2s+1=\\Theta((\\log n)^c)$.
  Тогда
  $$\\bigl((\\log n)^4(2s+1)\\log M\\bigr)^d=\\bigl((\\log n)^{5+c}\\bigr)^d.$$
  Подставляя $d=(\\kappa+o(1))\\log n/\\log\\log n$, получаем
  $$\\bigl((\\log n)^{5+c}\\bigr)^d=\\exp\\bigl((\\kappa+o(1))(5+c)\\log n\\bigr)=n^{\\kappa(5+c)+o(1)},$$
  и потому показатель экспоненты равен $n^{1-\\kappa(5+c)-o(1)}$.
- `Toy‑тест:` при $c=0$, $M=n^2$, $\\kappa=1/6$ имеем
  $$\\bigl((\\log n)^5\\bigr)^d=\\exp\\bigl((5/6+o(1))\\log n\\bigr)=n^{5/6+o(1)},$$
  значит $N\\ge\\exp(\\Omega(n^{1/6}))$.
- `Статус:` проверено (явный $\\kappa$‑порог при критической глубине с $c_1=4$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (параметрика + switching‑каркас релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оценить вклад фактора $M^{s/\\ell}$ при естественном выборе $\\ell:=t'=(2s+1)\\log M$ и проверить, остаётся ли он $\\exp(\\Theta(1))$ (Q43.S32-m-factor-ell-constant).

### 16.199. Исследовательский шаг (toy computation): константность фактора $M^{s/\\ell}$ при $\\ell=t'$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S32-m-factor-ell-constant):`
  Пусть $s\\ge 0$, $M>1$ и
  $$\\ell:=t':=(2s+1)\\log M.$$
  Тогда
  $$M^{s/\\ell}=\\exp\\!\\left(\\frac{s}{2s+1}\\right)\\le e^{1/2},$$
  то есть фактор $M^{s/\\ell}$ — абсолютная константа и поглощается в $A$.
- `Toy‑вычисление:`
  $$M^{s/\\ell}=\\exp\\!\\left(\\frac{s}{\\ell}\\cdot\\log M\\right)=\\exp\\!\\left(\\frac{s}{(2s+1)\\log M}\\cdot\\log M\\right)=\\exp\\!\\left(\\frac{s}{2s+1}\\right).$$
  Так как $s/(2s+1)\\le 1/2$ при $s\\ge 0$, получаем $M^{s/\\ell}\\le e^{1/2}$.
  (Если $\\log$ берётся по основанию $2$, то $M^{s/\\ell}=2^{s/(2s+1)}\\le\\sqrt{2}$.)
- `Toy‑тест:` при $s=1$, $M=2$ имеем $2^{1/(3\\log 2)}=e^{1/3}<e^{1/2}$.
- `Статус:` проверено (фактор $M^{s/\\ell}$ константен при $\\ell=t'$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (чистая арифметика в параметрах), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить допустимость выбора $\\ell=t'$ в Lemma 4.4/Def. “$\\ell$‑common” (есть ли ограничение $\\ell\\le s$ или иное) — Q43.S33-ell-admissibility-check.

### 16.200. Исследовательский шаг (exact citation): допустимость $\\ell=t'$ в Def. 2.10 / Lemma 4.4

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S33-ell-admissibility-check):`
  В HR’22 Def. 2.10 и Lemma 4.4 параметр $\\ell$ не ограничен сверху (нет условий вида $\\ell\\le t$ или $\\ell\\le s$);
  значит выбор $\\ell=t'$ допустим на уровне формулировок (при сохранении условий на $t,s$ из Lemma 4.4).
- `Exact citation:`
  Def. 2.10: “for every $T_i$ and branch $\\tau\\in T$ there are decision trees $T^{(i,\\tau)}$ of depth $\\ell$ …”
  без дополнительных условий на $\\ell$ (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:574–582`).
  Lemma 4.4: параметры $k,M,n',s,t\\in\\mathbb N^+$ с условиями $t\\le s\\le n'/32$ и $\\mathrm{depth}(T_i)\\le t$,
  а $\\ell$ появляется только в требовании “represented by an $\\ell$‑common partial decision tree of depth $s$”
  и в множителе $M^{s/\\ell}$ (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1073–1084`).
- `Toy‑тест:` при дереве глубины $t$ и частичном дереве глубины $0$ Def. 2.10 допускает любой $\\ell$,
  так что выбор $\\ell>t$ не вызывает противоречия в определении.
- `Статус:` подтверждено (ограничения на $\\ell$ в формулировках отсутствуют).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (цитата/формулировка), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, не используется ли в доказательстве Lemma 4.4 скрытое условие $\\ell\\le t$ или $\\ell\\le s$ (Q43.S35-ell-vs-t-constraint).

### 16.201. Исследовательский шаг (toy computation): скрытое $\\ell\\le s$ в подсчёте раундов Lemma 4.4

- `Линза:` Инвариант.
- `Утверждение (Q43.S35-ell-vs-t-constraint):`
  В доказательстве Lemma 4.4 фактор $M^{s/\\ell}$ получается из “по одному индексу $j\\in[M]$ на раунд”
  (HR’22 §7.3: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2784–2790`).
  Это требует верхней оценки на число раундов вдоль ветви глубины $s$; в §7.2 раунд завершается,
  когда добавлено $\\ge\\ell/4$ центров, и затем в $T$ запрашиваются все переменные, инцидентные $S_{\\lambda_j}$
  (HR’22 §7.2: `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2718–2732`).
  Поэтому без явного округления получается неявное ограничение $\\ell\\le s$ (иначе число раундов
  может быть $1$, тогда как $s/\\ell<1$).
- `Toy‑тест:` пусть $s=2$, $t=1$, $\\ell=5$. В каждом раунде добавляется $\\ge\\ell/4>1$ центров и
  запрашиваются инцидентные переменные, значит одна итерация уже даёт глубину $\\ge s$ и требует один
  индекс $j$ (cost $\\log M$). Но $s/\\ell=0.4$, и множитель $M^{s/\\ell}$ даёт $<M$; это несовместимо с
  “по одному индексу на раунд”, если не вводить явное $\\lceil s/\\ell\\rceil$ или условие $\\ell\\le s$.
- `Статус:` контрпример‑toy к гипотезе “нет скрытого ограничения”; нужна явная оговорка $\\ell\\le s$
  (или округление числа раундов).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (локальная проверка proof), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить в оригинальном PDF/доказательстве, как фиксируется число раундов
  (округление/транкция) и можно ли заменить $M^{s/\\ell}$ на $M^{\\lceil s/\\ell\\rceil}$ без изменения остального.

### 16.202. Исследовательский шаг (proof): округление числа раундов по глубине

- `Линза:` Инвариант.
- `Утверждение (Q43.S36-round-count-from-depth):`
  В §7.2 каждый раунд добавляет к ветви $T$ по крайней мере $\\ell$ **новых** запросов,
  поэтому префикс длины $s$ на любой ветви может пересекать не более $\\lceil s/\\ell\\rceil$ раундов.
  Следовательно, “по одному индексу $j$ на раунд” даёт фактор $M^{\\lceil s/\\ell\\rceil}$ (при $s<\\ell$ это даёт $M$).
- `Доказательство:`
  В §7.2 раунд выбирает ветвь $\\lambda$ длины $\\ge\\ell$ в $T^j$ и **расширяет** $T$ в листе $\\tau$
  запросами “всех переменных на $\\lambda$” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2671–2684`).
  По определению дерева решений внутренняя разметка на любой ветви использует **различные** переменные
  (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:489–494`),
  а при расширении листа запрещены запросы к переменным, локально имплицированным $\\tau$
  (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:532–535`),
  поэтому $\\lambda$ добавляет $\\ge\\ell$ новых запросов к текущей ветви.
  Значит префикс длины $s$ может включать не более $\\lceil s/\\ell\\rceil$ раундов
  (каждый раунд даёт минимум $\\ell$ новых запросов), и индекс $j\\in[M]$ кодируется
  не более чем $\\lceil s/\\ell\\rceil$ раз.
- `Toy‑тест:` $s=2$, $\\ell=5$: первый раунд уже добавляет $\\ge 5$ запросов, значит префикс длины $2$
  использует $\\le 1$ раунд; $M^{\\lceil 2/5\\rceil}=M$.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (локальная оценка в доказательстве), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить альтернативный bound по числу centers (Q43.S37-round-count-from-centers).

### 16.203. Исследовательский шаг (counterexample): из “$\\ge\\ell/4$ центров за раунд” не следует $\\le\\lceil 4a/\\ell\\rceil$

- `Линза:` Инвариант.
- `Утверждение (Q43.S37-rounds-via-uj):`
  В §7.2 “$\\ge\\ell/4$ центров за раунд” относится к **всем** exposed centers в $S(\\lambda^j,\\sigma)$, а не к associated centers.
  Поэтому утверждение “в каждом раунде добавляется $\\ge\\ell/4$ associated centers” (и, следовательно, bound $\\#\\text{rounds}\\le\\lceil 4a/\\ell\\rceil$) неверно без дополнительной структуры.
  В общем виде из Lemma 6.5–6.8 следует лишь
  $$\\#\\text{rounds}\\le\\Bigl\\lceil\\frac{64a}{\\ell}\\Bigr\\rceil.$$
- `Контрпример (структурный разрыв):`
  В §7.2 раунд заканчивается, когда “at least $\\ell/4$ centers have been added … to $S(\\lambda^j,\\sigma)$” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2718–2722`).
  Но в одной стадии центры добавляются как $\\mathrm{supp}(J)\\cup S_J$, и Lemma 6.5 даёт верхний bound “at most $4|\\mathrm{supp}(J)|$ centers are added” (там же: `…:2013–2022`).
  Далее Lemma 6.8 утверждает $|\\mathrm{supp}(J)|\\le 4a_j$ (там же: `…:2081–2086`), поэтому одна стадия может добавить до $16a_j$ центров.
  Следовательно, раунд может достичь порога $\\ell/4$ при $a_j\\ge \\ell/64$, так что вывод $a_j\\ge\\ell/4$ (и bound $\\lceil 4a/\\ell\\rceil$) не проходит; корректный общий upper — $\\lceil 64a/\\ell\\rceil$.
- `Toy‑тест:` локальная конфигурация, где каждый associated center даёт 3 соседних chosen centers в $\\mathrm{supp}(J)$, а каждый из них имеет ещё 3 новых соседних chosen centers в $S_J\\setminus\\mathrm{supp}(J)$, реализует фактор 16 между $a_j$ и числом новых центров.
- `Статус:` контрпример (гипотеза “$\\ge\\ell/4$ associated centers за раунд” не следует из §7.2).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (комбинаторный счёт релятивизируется), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить в оригинальном PDF, что “centers” в §7.2 не означает “chosen centers”; если нет, встроить константу $64$ в фактор $M^{s/\\ell}$ и оценить, даёт ли это что‑то лучшее, чем bound через $\\lceil s/\\ell\\rceil$.

### 16.204. Исследовательский шаг (exact citation): “centers” в §7.2 — это exposed centers (подмножество alive centers)

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S38-quote-centers-exposed):`
  В HR’22 “центры” в остановке раунда §7.2 — это именно exposed centers $S(\\lambda^j,\\sigma)$, а exposed centers определены как подмножество alive centers.
- `Exact citation:`
  Определение exposed centers: “1. a subset of the alive centers $S = S(\\tau,\\sigma)$ called the exposed centers” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1841`).
  Остановка раунда: “We continue with the next stage until at least $\\ell/4$ centers have been added in this round to the set of exposed centers $S(\\lambda^j,\\sigma)$ …” (HR’22, `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2718–2719`).
- `Toy‑тест:` подстановка определений: слово “centers” в §7.2 прямо отсылает к “set of exposed centers”, без упоминания chosen centers.
- `Статус:` подтверждено (точная цитата).
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сравнить верхнюю оценку числа раундов через $\\lceil 64a/\\ell\\rceil$ с фактором $M^{\\lceil s/\\ell\\rceil}$ и показать, что константа 64 не ухудшает итог (Q43.S39-compare-round-bounds).

### 16.205. Исследовательский шаг (proof): 64 поглощается рескейлом $\\ell$ ($\\ell\\ge t$ ⇒ t‑common)

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S39-absorb-64-rescale-ell):`
  В HR’22 Lemma 4.4 параметр $\\ell$ свободен (без условий $\\ell\\le t$ или $\\ell\\le s$), и если входные деревья имеют глубину $\\le t'$,
  то $\\ell$‑common partial decision tree при $\\ell\\ge t'$ автоматически является $t'$‑common.
  Поэтому можно выбрать $\\ell:=64t'$ и получить
  $$M^{\\lceil 64a/\\ell\\rceil}=M^{\\lceil a/t'\\rceil},$$
  а множитель $M^{s/\\ell}$ в Lemma 4.4 только уменьшается.
- `Доказательство:`
  1) Def. 2.10 и Lemma 4.4 не накладывают ограничений на $\\ell$; $\\ell$ входит только как глубина локальных деревьев и в фактор $M^{s/\\ell}$
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:574–582`, `…:1073–1084`).
  2) Пусть все $T_i$ имеют глубину $\\le t'$, а $T$ — $\\ell$‑common partial tree с $\\ell\\ge t'$. Для каждой ветви $\\tau$ ограничение
     $T_i\\!\\upharpoonright\\!\\tau$ — decision tree глубины $\\le t'$ (глубина не возрастает при ограничении), а корректность/локальная согласованность
     обеспечивает факт, что $T$ — $\\ell$‑common. Тогда, выбирая $T^{(i,\\tau)}:=T_i\\!\\upharpoonright\\!\\tau$, получаем $t'$‑common partial tree.
  3) Подстановка $\\ell:=64t'$ преобразует $M^{\\lceil 64a/\\ell\\rceil}$ в $M^{\\lceil a/t'\\rceil}$, а $M^{s/\\ell}\\le M^{s/t'}$,
     поэтому коэффициент 64 поглощается без ухудшения вероятностной оценки.
- `Toy‑тест:` при $s=2$, $M=n^k$, $t'=(2s+1)\\log M$ и $\\ell=64t'$ условия Lemma 4.4
  ($t'\\le s_\\eta\\le n'/32$) остаются прежними, а фактор по $M$ становится $M^{\\lceil a/t'\\rceil}$.
- `Статус:` доказано.
- `InfoGain:` 1.
- `Барьер‑чек:` r — неприменимо (перемасштабирование параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, можно ли связать $a$ с $s$ (например $a\\le s$) или иначе пересчитать corollary с фактором $M^{\\lceil a/t'\\rceil}$ — Q43.S40-bound-a-by-s.

### 16.206. Исследовательский шаг (counterexample): non-chosen associated centers не инъектируются в запросы, $a\\le s$ не следует

- `Линза:` Инвариант.
- `Утверждение (Q43.S40-inject-a-to-queries):`
  Каждый disappearing center, учтённый в $a$, соответствует хотя бы одному запросу на ветви $\\tau$,
  разные центры дают разные запросы, значит $a\\le s$.
- `Контрпример (структурный):`
  В построении HR’22 ветвь $\\tau$ запрашивает **только** переменные, инцидентные chosen центрам:
  $S_J$ определяется как множество chosen центров на расстоянии $\\le 1$ от $\\mathrm{supp}(J)\\cap C_\\sigma$,
  и $T$ расширяется запросами всех переменных, инцидентных $S_J$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1943–1947`);
  Invariant 6.1(5) фиксирует, что запросы появляются только из exposed chosen centers
  (`…:1858–1860`).
  Но на forceable branch $\\psi$ могут стоять переменные с non-chosen associated center:
  Cor. 6.6 прямо различает случаи “associated center chosen/non-chosen”
  (`…:2024–2026`), а Def. 6.2(2) требует закрывать $J$ на таких центрах
  (`…:1886–1888`).
  Такие non-chosen центры входят в $\\mathrm{supp}(J)\\setminus S^*_{j-1}$ и учитываются в $a_j$,
  но не попадают в $S_J$, поэтому **не создают запросов** на $\\tau$.
  Следовательно, инъекция “$a$ → запросы” не работает, и $a\\le s$ не обосновано.
- `Toy‑тест:` пусть $T_i$ имеет 1‑ветвь из одного ребра $x_e$, чья associated center $u$ — non-chosen.
  Выберем $\\sigma$ так, что pairing $\\pi$ фиксирует соответствующий non-chosen path
  (Eq. (11), `…:1456–1467`), тогда $\\psi$ pairwise locally consistent с $\\sigma$.
  По Def. 6.2(2) $J$ закрыт на $u$, значит $a_j=1$, но $\\mathrm{supp}(J)\\cap C_\\sigma=\\varnothing$
  и $S_J=\\varnothing$, т.е. на $\\tau$ не добавляется ни одного запроса.
- `Статус:` контрпример (инъекция ломается на non-chosen центрах).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` разделить $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$ и проверить,
  можно ли bound’ить $a_{\\mathrm{ch}}$ через $s$, а вклад $a_{\\mathrm{nch}}$ переформулировать в параметрах,
  не требующих $a\\le s$ (или перейти к оптимизации суммы по $a$ без этого шага).

### 16.207. Исследовательский шаг (proof): $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$, раунд‑фактор зависит только от $a_{\\mathrm{ch}}$

- `Линза:` Инвариант.
- `Утверждение (Q43.S41-split-a-ch-nch):`
  Пусть $a_{j,\\mathrm{ch}}$ — число **chosen** associated centers среди переменных на $\\psi_j$,
  лежащих в $\\mathrm{supp}(J_j)\\setminus S^*_{j-1}$, и $a_{\\mathrm{ch}}:=\\sum_j a_{j,\\mathrm{ch}}$.
  Тогда $s\\le 64a_{\\mathrm{ch}}$, а значит фактор по раундам можно оценивать как
  $$M^{\\lceil s/\\ell\\rceil}\\le M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}.$$
  Вклад $a_{\\mathrm{nch}}$ кодируется через $\\pi$ и не порождает новых запросов.
- `Доказательство:`
  1) Non‑chosen информация определяется pairing $\\pi$ и не требует запросов в $T$
     (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1854–1866`), при этом
     $I$ не содержит путей между chosen и non‑chosen центрами
     (`…:1869–1870`). Следовательно, только exposed **chosen** centers создают запросы.
  2) Пусть $S_{\\mathrm{ch}}(\\tau,\\sigma):=S(\\tau,\\sigma)\\cap C_\\sigma$.
     Из §6.4: “only variables incident to exposed chosen centers are queried and each exposed center causes at most 4 queries”
     (`…:2049–2051`), значит существует стадия $g$ с $|S^*_g\\cap C_\\sigma|\\ge s/4$.
  3) В стадии $j$ множество новых chosen центров лежит в $\\mathrm{supp}(J_j)\\cap C_\\sigma$ и $S_J$.
     По аргументу Lemma 6.5 (ограниченному на chosen‑центры) каждый chosen центр в $\\mathrm{supp}(J_j)$
     имеет chosen‑соседа в $\\mathrm{supp}(J_j)$, поэтому
     $$|\\mathrm{supp}(J_j)\\cap C_\\sigma\\cup S_J|\\le 4|\\mathrm{supp}(J_j)\\cap C_\\sigma|.$$
     Кроме того, из минимальности $J_j$ и запрета chosen–non‑chosen путей следует, что каждый chosen центр
     в $\\mathrm{supp}(J_j)$ либо сам является associated center переменной на $\\psi_j$,
     либо соседствует с таким chosen associated center; значит
     $$|\\mathrm{supp}(J_j)\\cap C_\\sigma|\\le 4a_{j,\\mathrm{ch}}.$$
     Следовательно, на стадии $j$ добавляется не более $16a_{j,\\mathrm{ch}}$ chosen‑центров, и
     $|S^*_g\\cap C_\\sigma|\\le 16a_{\\mathrm{ch}}$.
  4) Совмещая с п.2, получаем $s\\le 4|S^*_g\\cap C_\\sigma|\\le 64a_{\\mathrm{ch}}$ и требуемый bound на
     $M^{\\lceil s/\\ell\\rceil}$.
- `Toy‑тест:` $s=1$, $\\psi$ содержит переменную с non‑chosen associated center $u$.
  По Def. 6.2(2) $J$ закрыт на $u$, а Invariant 6.1(4) + ремарка про $\\pi$ дают,
  что нужная информация уже в $\\pi$ и не требует запросов (`…:1854–1866`);
  при $\\mathrm{supp}(J)\\cap C_\\sigma=\\varnothing$ имеем $S_J=\\varnothing$, поэтому
  depth ветви не увеличивается и раунд‑счёт не растёт.
- `Статус:` доказано (для раунд‑фактора; $a\\log t$ в Lemma 6.9 по‑прежнему зависит от $a$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (encoding/center‑счёт), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оптимизировать суммирование по $a$ без предположения $a\\le s$ (Q43.S42-optimise-a-sum).

### 16.208. Исследовательский шаг (proof): $\\log t$ в Lemma 6.9 нужен только для chosen associated centers

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S42-encode-nch-no-logt):`
  В доказательстве Lemma 6.9 log t-биты используются только для **chosen** associated centers,
  тогда как non-chosen associated centers восстанавливаются из pairing $\\pi$ с постоянным числом бит
  на структуру компоненты и $O(\\log \\Delta)$ на идентификацию узлов.
  Следовательно, в оценке кодирования можно заменить $t^{a}$ на $t^{a_{\\mathrm{ch}}}$, а вклад
  $a_{\\mathrm{nch}}$ переносится в $\\Delta$-часть.
- `Доказательство:`
  В реконструкции $J_j$ из подписей: для каждого associated center $u$,
  который **chosen**, читаются (до 3) инцидентные центры, и если такой центр уже определен,
  он выбирается по "first bit in the signature is 1" с ценой $\\log t$ (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2468-2475`).
  После этого "structure of $J_j$ on the chosen centers" фиксирована (`…:2474-2476`).
  Для non-chosen центров затем "complete some connected components from the pairing $\\pi$",
  структура компоненты кодируется константным числом бит, и каждый узел восстанавливается
  с ценой не более $\\log \\Delta$ (`…:2476-2480`).
  Значит, log t участвует только при идентификации chosen центров, тогда как non-chosen
  оплачиваются лишь $\\log \\Delta$.
- `Toy‑тест:` один раунд, одна переменная на $\\psi_j$ с non-chosen associated center.
  По тексту реконструкции $J_j$ для non-chosen используется только pairing $\\pi$ и
  $\\log \\Delta$ на узлы, без упоминания $\\log t$ (`…:2476-2480`).
- `Статус:` доказано (точная цитата в доказательстве Lemma 6.9).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (encoding), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` переписать сумму по $a_{\\mathrm{ch}},a_{\\mathrm{nch}}$ в Eq. (18) и проверить геометрию (Q43.S42-sum-split-geometric).

### 16.209. Исследовательский шаг (proof): геометрия суммы после разбиения $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S43-sum-split-geometric):`
  В Eq. (18) HR’22 (сумма $\\sum_a A_2^s(4t\\log n'/\\Delta)^a$) после замены $t^a\\rightsquigarrow t^{a_{\\mathrm{ch}}}$
  и разбиения $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$ получается факторизация в два геометрических ряда.
  При $\\ell\\ge 64t'$ раунд‑фактор удовлетворяет $M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}\\le M^{a_{\\mathrm{ch}}/t'}$,
  поэтому
  $$
  \\sum_{a_{\\mathrm{ch}},a_{\\mathrm{nch}}\\ge 0}
  A_2^s\\Bigl(\\frac{4t'\\log n'}{\\Delta}\\Bigr)^{a_{\\mathrm{ch}}}
  \\Bigl(\\frac{4\\log n'}{\\Delta}\\Bigr)^{a_{\\mathrm{nch}}}
  M^{a_{\\mathrm{ch}}/t'}
  =
  A_2^s\\Bigl(\\sum_{a_{\\mathrm{ch}}\\ge 0} r_{\\mathrm{ch}}^{a_{\\mathrm{ch}}}\\Bigr)
  \\Bigl(\\sum_{a_{\\mathrm{nch}}\\ge 0} r_{\\mathrm{nch}}^{a_{\\mathrm{nch}}}\\Bigr),
  $$
  где $r_{\\mathrm{ch}}:=(4t'\\log n'/\\Delta)\\cdot M^{1/t'}$ и $r_{\\mathrm{nch}}:=4\\log n'/\\Delta$.
  В режиме HR (выбор $n_\\eta$ даёт $t'\\log n'/\\Delta\\le c<1$) оба отношения $<1$, значит сумма ограничена константой.
- `Доказательство:`
  Из Eq. (18) HR’22 имеем сумму $\\sum_a A_2^s(4t\\log n'/\\Delta)^a$ (см. PDF, Eq. (18)). По §16.208
  можно заменить $t^a$ на $t^{a_{\\mathrm{ch}}}$, то есть
  $$(4t\\log n'/\\Delta)^a=(4t\\log n'/\\Delta)^{a_{\\mathrm{ch}}}(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}.$$
  После переноса на $t'= (2s+1)\\log M$ и учёта раунд‑множителя (из §16.207) получаем указанную двойную сумму.
  При $\\ell\\ge 64t'$ имеем $M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}\\le M^{a_{\\mathrm{ch}}/t'}$, поэтому
  ряд по $a_{\\mathrm{ch}}$ имеет отношение $r_{\\mathrm{ch}}$, а по $a_{\\mathrm{nch}}$ — $r_{\\mathrm{nch}}$.
  В HR‑параметрах $\\Delta=\\Theta(n/n')$ и рекурсия $n_\\eta$ обеспечивает $t'\\log n'/\\Delta<1$,
  значит оба ряда геометрические и сходятся к константе.
- `Toy‑тест:` $s=2$, $\\ell=5$, $t'=5$; возьмём $n'=2$ (так что $\\log n'=1$), $M=2$ (тогда $t'=(2s+1)\\log M=5$)
  и $\\Delta=32$.
  Тогда $r_{\\mathrm{ch}}=(4\\cdot5/32)\\cdot 2^{1/5}\\approx 0.72$ и $r_{\\mathrm{nch}}=4/32=0.125$.
  Сумма начинается как $1+r_{\\mathrm{ch}}+r_{\\mathrm{nch}}+\\cdots$ и равна
  $1/\\bigl((1-r_{\\mathrm{ch}})(1-r_{\\mathrm{nch}})\\bigr)=O(1)$.
- `Статус:` доказано (факторизация и геометричность после разбиения $a$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка вероятности/счёт), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` оценить связь $a_{\\mathrm{nch}}$ с $a_{\\mathrm{ch}}$ или $s$ (например через pairing $\\pi$),
  чтобы убрать зависимость от $a_{\\mathrm{nch}}$ в основной сумме (Q43.S44-bound-anonch).

### 16.210. Исследовательский шаг (proof): Eq. (18) после $t^a\\to t^{a_{\\mathrm{ch}}}$ не содержит $a_{\\mathrm{nch}}$ вне $\\Delta$‑части

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S45-audit-eq18-anonch-free):`
  После замены $t^a\\rightsquigarrow t^{a_{\\mathrm{ch}}}$ и при $\\ell\\ge 64t'$ вся зависимость от
  $a_{\\mathrm{nch}}$ в сумме Eq. (18) HR’22 остаётся только в множителе
  $(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$; ни $A_2^s$, ни раунд‑фактор
  $M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}$ от $a_{\\mathrm{nch}}$ не зависят.
  Следовательно, суммирование по $a_{\\mathrm{nch}}$ — чисто геометрическое и не требует
  доп. оценки $a_{\\mathrm{nch}}$ через $a_{\\mathrm{ch}}$ или $s$.
- `Доказательство:`
  В HR Eq. (18) стоит сумма вида $\\sum_a A_2^s(4t\\log n'/\\Delta)^a$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:2125-2134`).
  По §16.208 можно заменить $t^a$ на $t^{a_{\\mathrm{ch}}}$ и разложить
  $a=a_{\\mathrm{ch}}+a_{\\mathrm{nch}}$, откуда
  $(4t\\log n'/\\Delta)^a=(4t'\\log n'/\\Delta)^{a_{\\mathrm{ch}}}(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$.
  Раунд‑множитель в flat local‑EF(s) зависит только от chosen‑центров
  ($M^{\\lceil 64a_{\\mathrm{ch}}/\\ell\\rceil}$ из §16.207), поскольку non‑chosen centers
  не создают запросов. Поскольку $A_2^s$ зависит только от $s$, единственный источник
  зависимости от $a_{\\mathrm{nch}}$ — это $(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$,
  а значит суммирование по $a_{\\mathrm{nch}}$ геометрично.
- `Toy‑тест:` возьмём $a_{\\mathrm{ch}}=0$. Тогда вклад равен
  $A_2^s(4\\log n'/\\Delta)^{a_{\\mathrm{nch}}}$, без $t'$ и без $M$,
  что подтверждает отсутствие скрытых зависимостей.
- `Статус:` доказано (audit Eq. (18): $a_{\\mathrm{nch}}$ только в $\\Delta$‑части).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо, NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` проверить, что в HR‑параметрах гарантированно $4\\log n'/\\Delta<1$
  (после подстановки $\\Delta=\\Theta(n/n')$) и зафиксировать это в основном bound (Q43.S46-check-rnch-params).

### 16.211. Исследовательский шаг (proof): $r_{\\mathrm{nch}}<1$ из HR‑оценок на $\\Delta$

- `Линза:` Эквивалентность.
- `Утверждение (Q43.S48-delta-constant-bridge):`
  В HR‑параметрах при условии $n\\ge 20 C n'\\log n'$ имеем $\\Delta\\ge 2C\\log n'$,
  а также $\\Delta\\ge n/(6n')$. Тогда
  $$
  r_{\\mathrm{nch}}=\\frac{4\\log n'}{\\Delta}\\le \\frac{2}{C}<1 \\quad (C\\ge 3),
  $$
  так что сумма по $a_{\\mathrm{nch}}$ в §16.210 ограничена константой.
- `Доказательство:`
  В HR после (14) явно сказано: из предположения $n\\ge 20 n' C\\log n'$ следует
  $\\Delta\\ge 2C\\log n'$, и далее «claimed bound follows from the fact $\\Delta\\ge n/6 n'$»
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1567-1568`).
  По §16.209–§16.210 $r_{\\mathrm{nch}}=4\\log n'/\\Delta$, поэтому
  $r_{\\mathrm{nch}}\\le 4\\log n'/(2C\\log n')=2/C<1$ для $C\\ge 3$.
- `Toy‑тест:` минимальный случай $n=20 C n'\\log n'$ даёт $\\Delta\\ge 2C\\log n'$ и
  $r_{\\mathrm{nch}}\\le 2/C$; при $C=4$ получаем $r_{\\mathrm{nch}}\\le 1/2$.
- `Статус:` доказано (константное $r_{\\mathrm{nch}}$ из HR‑оценок на $\\Delta$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` подставить $r_{\\mathrm{nch}}<1$ в итоговый bound Eq. (18)
  и зафиксировать константу в основном резюме Q43 (Q43.S49-finalize-geo-constant).

### 16.212. Исследовательский шаг (proof): $r_{\\mathrm{ch}}<1$ из HR‑параметров

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S50-bound-rch-constant):`
  В режиме HR при $t':=(2s+1)\\log M$ и $s\\ge 1$ имеем
  $$r_{\\mathrm{ch}}=\\Bigl(\\frac{4t'\\log n'}{\\Delta}\\Bigr)\\cdot M^{1/t'}\\le \\kappa<1$$
  для всех достаточно больших $n$. Более точно, из условий
  $n/n'\\ge A t'\\log^4 n$ (Lemma 4.2) и $\\Delta\\ge n/(6n')$ следует
  $$r_{\\mathrm{ch}}\\le \\frac{24e^{1/2}}{A\\,\\log^3 n},$$
  так что при $\\log^3 n\\ge 48e^{1/2}/A$ можно взять $\\kappa=1/2$.
- `Доказательство:`
  Из $t'=(2s+1)\\log M$ получаем
  $$M^{1/t'}=\\exp\\!\\left(\\frac{1}{2s+1}\\right)\\le e^{1/2}$$
  при $s\\ge 1$. По HR Lemma 4.2 выполняется $n/n'\\ge A t'\\log^4 n$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:950-952`),
  а после (14) имеем $\\Delta\\ge n/(6n')$
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:1567-1568`).
  Тогда
  $$r_{\\mathrm{ch}}\\le \\frac{4t'\\log n'}{\\Delta}\\,e^{1/2}
  \\le \\frac{24t'\\log n'}{n/n'}\\,e^{1/2}
  \\le \\frac{24e^{1/2}}{A}\\cdot\\frac{\\log n'}{\\log^4 n}.$$
  Используя $\\log n'\\le\\log n$, получаем указанную оценку
  $r_{\\mathrm{ch}}\\le 24e^{1/2}/(A\\log^3 n)$ и, следовательно, $r_{\\mathrm{ch}}<1$
  при $n\\ge n_0(A)$.
- `Toy‑тест:` $s=2$, $M=2$ дают $t'=5$ и $M^{1/t'}=2^{1/5}\\approx 1.15$.
  Если $A=1$ и $\\log n=32$, то
  $$r_{\\mathrm{ch}}\\le \\frac{24e^{1/2}}{32^3}\\approx 1.2\\cdot 10^{-3}<1.$$
- `Статус:` доказано (явная константа для $r_{\\mathrm{ch}}$ при HR‑параметрах).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` подставить $r_{\\mathrm{ch}}<1$ и $r_{\\mathrm{nch}}<1$ в Eq. (18)
  и зафиксировать константу в основном резюме Q43 (Q43.S49-finalize-geo-constant).

### 16.213. Исследовательский шаг (proof): явная константа из геометрической суммы

- `Линза:` Инвариант.
- `Утверждение (Q43.S51-geo-constant-explicit):`
  Из факторизации §16.209 имеем
  $$
  \\sum_{a_{\\mathrm{ch}},a_{\\mathrm{nch}}\\ge 0}
  A_2^s\\,r_{\\mathrm{ch}}^{a_{\\mathrm{ch}}}\\,r_{\\mathrm{nch}}^{a_{\\mathrm{nch}}}
  =\\frac{A_2^s}{(1-r_{\\mathrm{ch}})(1-r_{\\mathrm{nch}})}.
  $$
  При условиях HR (C\\ge 3 и $n\\ge n_0(A)$) можно взять
  $r_{\\mathrm{ch}}\\le 1/2$ (§16.212) и $r_{\\mathrm{nch}}\\le 2/3$ (§16.211), поэтому
  сумма в Eq. (18) ограничена $6\\,A_2^s$.
- `Доказательство:`
  Геометрическая сумма по $a_{\\mathrm{ch}}$ равна $1/(1-r_{\\mathrm{ch}})$,
  по $a_{\\mathrm{nch}}$ — $1/(1-r_{\\mathrm{nch}})$ (§16.209). В §16.212 получено
  $r_{\\mathrm{ch}}\\le 24e^{1/2}/(A\\log^3 n)$, так что при $\\log^3 n\\ge 48e^{1/2}/A$
  можно взять $r_{\\mathrm{ch}}\\le 1/2$. В §16.211 имеем $r_{\\mathrm{nch}}\\le 2/C$,
  и при $C\\ge 3$ получаем $r_{\\mathrm{nch}}\\le 2/3$. Тогда
  $1/((1-r_{\\mathrm{ch}})(1-r_{\\mathrm{nch}}))\\le 1/((1-1/2)(1-2/3))=6$.
- `Toy‑тест:` подставляя $r_{\\mathrm{ch}}=1/2$, $r_{\\mathrm{nch}}=2/3$ получаем множитель 6.
  Для чисел из §16.209 ($s=2$, $M=2$, $\\Delta=32$) имеем
  $r_{\\mathrm{ch}}\\approx 0.72$, $r_{\\mathrm{nch}}=0.125$ и итоговый множитель
  $1/((1-0.72)(1-0.125))\\approx 4.1\\le 6$.
- `Статус:` доказано (явная константа в сумме Eq. (18)).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (суммирование), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` вывести явное $n_0(A)$ для условия $r_{\\mathrm{ch}}\\le 1/2$
  и сопоставить с требованием $n\\ge 20Cn'\\log n'$ (Q43.S52-explicit-n0).

### 16.214. Исследовательский шаг (proof): явный $n_0(A)$ для $r_{\\mathrm{ch}}\\le 1/2$

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S52-explicit-n0-closedform):`
  Пусть $A>0$ из условий HR Lemma 4.2 и выполнена оценка
  $$r_{\\mathrm{ch}}\\le \\frac{24e^{1/2}}{A\\log^3 n}$$
  (§16.212). Тогда
  $$n_0(A):=\\left\\lceil \\exp\\!\\left(\\left(\\frac{48e^{1/2}}{A}\\right)^{1/3}\\right)\\right\\rceil$$
  гарантирует $r_{\\mathrm{ch}}\\le 1/2$ для всех $n\\ge n_0(A)$.
- `Доказательство:`
  Из $r_{\\mathrm{ch}}\\le 24e^{1/2}/(A\\log^3 n)$ следует, что $r_{\\mathrm{ch}}\\le 1/2$
  достаточно при $\\log^3 n\\ge 48e^{1/2}/A$, т.е.
  $$\\log n\\ge \\left(\\frac{48e^{1/2}}{A}\\right)^{1/3}.$$
  Экспоненцируя, получаем $n\\ge \\exp\\!\\left((48e^{1/2}/A)^{1/3}\\right)$; для целых $n$
  это эквивалентно $n\\ge n_0(A)$.
- `Toy‑тест:` при $A=1$ имеем $n_0=\\lceil e^{(48e^{1/2})^{1/3}}\\rceil=74$ и
  $r_{\\mathrm{ch}}\\le 24e^{1/2}/\\log^3 74\\approx 0.496<1/2$.
  При $A=10$ получаем $n_0=8$ и $r_{\\mathrm{ch}}\\le 0.440<1/2$.
- `Статус:` доказано (явная замкнутая формула $n_0(A)$).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка параметров), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` сравнить условие $n\\ge 20Cn'\\log n'$ с $n\\ge n_0(A)$
  (Q43.S53-compare-20cnlogn).

### 16.215. Исследовательский шаг (exact citation): константа $A$ в Lemma 6.9/4.2 не раскрыта численно

- `Линза:` Трейд‑офф.
- `Утверждение (Q43.S53-extract-a-bound):`
  В HR'22 константа $A$ в Lemma 6.9/4.2 вводится как "some constant" без численного значения;
  в доказательстве появляются дополнительные константы $A_1,A_2,A_3,A_4$ также без оценок.
  Поэтому явный нижний bound $A_{\\min}$ нельзя извлечь из текста без подробного подсчёта битов
  в алгоритмах восстановления (§6.5/Appendix B), и сравнение $n\\ge 20Cn'\\log n'$ с $n\\ge n_0(A)$
  требует отдельного вычисления констант.
- `Доказательство (exact citation):`
  В `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt` Lemma 6.9 формулируется
  как "There is a constant A > 0 ... a log t + b log \\Delta + s * A many bits suffice to encode ρ"
  (строки 2096-2101). В конце доказательства перечисляются дополнительные "some constant"
  величины: "A1 |S*_g| ... for some constant A1", "another A2 |S*_g| ... for some constant A2",
  "There is a constant A3 > 0 ...", "some other constant A4" (строки 2551-2562). Численных
  оценок для этих констант не приводится.
- `Toy-тест:` из $t\\le s$ следует $s+16t+s/4\\le (69/4)s$, так что можно взять
  $A_3,A_4\\le 69/4$, но $A_1,A_2$ остаются неявными, и потому $A_{\\min}$ не фиксируется.
- `Статус:` частично (константа $A$ существует, но неявная).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (оценка констант), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` пройти Appendix B / Algorithms 2–7 и выписать явный верхний bound
  на $A_1,A_2$ (сколько бит на центр/ребро), затем получить явный $A$ и сравнить $n_0(A)$
  с $20Cn'\\log n'$ (Q43.S54-bound-a1a2-bits).

### 16.216. Исследовательский шаг (toy computation): toy‑bound для $A_1$ из Algorithms 2–4

- `Линза:` Сжатие/канонизация.
- `Утверждение (Q43.S54-bound-a1-from-alg2-4):`
  В toy‑случае $|S^{*}_g|=1$, $s=2$, $\\ell=5$ (одна стадия) псевдокод Algorithms 2–4
  читает не более 18 константных бит из $X$ сверх терминов $a\\log t$, $b\\log\\Delta$
  и $9|S^{*}_g|$. Следовательно, для этого случая можно взять $A_1\\le 18$.
- `Toy‑тест:` при $|S^{*}_g|=1$ имеем $g=1$ (так как $|S^{*}_g|\\ge s/4$). В Algorithm 2
  внутренний цикл читает ровно один бит `discover=1` для единственного ассоц. центра
  и один бит `discover=0` для завершения стадии (2 бита;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3119-3127`).
  Рассматривая худший по константным битам вариант (центр выбранный),
  Algorithm 3 вызывает `GetPossiblyDeadCenter` не более 4 раз по направлениям
  подписи (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3166-3173`),
  давая 4 бита `known` (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3304`).
  Далее `RecoverExposed` даёт ещё ≤4 вызова (4 бита `known`;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3259-3264`)
  и `RecoverNonExposed` даёт ≤4 бита `recover` плюс ≤4 бита `known`
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3283-3286,3304`).
  Итого $2+4+4+8=18$ константных бит. В альтернативе (центр не выбранный)
  читаются $\\log 20\\le 5$ бит `cc` и ≤8 бит `known`
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3182-3193,3304`),
  что даёт ≤15, поэтому 18 остаётся верхней оценкой.
- `Статус:` частично (toy‑случай; общий bound на $A_1$ ещё не выведен).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (подсчёт констант), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` обобщить подсчёт константных бит на произвольный $|S^{*}_g|$
  и выписать явный $A_1$ (с отделением вкладов $\\log t$, $\\log\\Delta$ и 9‑битных подписей).

### 16.217. Исследовательский шаг (toy computation): $|S^{*}_g|=2$ (один chosen + один non‑chosen)

- `Линза:` Инвариант.
- `Утверждение (Q43.S55-count-a1-per-center):`
  В toy‑сценарии $|S^{*}_g|=2$ с одним chosen и одним non‑chosen центром при $s=2$, $\\ell=5$
  Algorithms 2–4 читают не более 32 константных бит сверх $a\\log t$, $b\\log\\Delta$
  и $9|S^{*}_g|$. Следовательно, линейный bound $A_1|S^{*}_g|$ выполняется уже с $A_1=18$.
- `Toy‑тест:` здесь $g=1$ (так как $|S^{*}_g|\\ge s/4$). Пусть оба центра обнаружены как ассоц.
  центры на ветви $\\psi$ (худший случай для константных битов). Тогда Algorithm 2 читает
  два бита `discover=1` и один бит `discover=0` (итого 3 бита;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3119-3127`).
  В Algorithm 3 для chosen‑центра возможно до 4 вызовов `GetPossiblyDeadCenter`, каждый даёт
  один бит `known` (4 бита; `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3166-3173,3304`).
  Для non‑chosen‑центра: в первом цикле ≤4 бита `known` (те же строки), затем читается
  $\\log 20\\le 5$ бит `cc` и ещё ≤4 бита `known` для восстановления компонент (всего 13 бит;
  `resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3182-3193,3304`).
  Далее `RecoverExposed` для единственного chosen‑центра даёт ≤4 бита `known`, а
  `RecoverNonExposed` даёт ≤4 бита `recover` и ≤4 бита `known`
  (`resources/text_cache/hastad_risse_2022_tseitin_grid_revisited.txt:3259-3264,3283-3286,3304`).
  Суммарно $3+4+13+12=32$ константных бита; так как $32\\le 18\\cdot 2$, линейность по
  $|S^{*}_g|$ сохраняется на этом toy‑уровне.
- `Статус:` доказано (toy‑случай; линейное масштабирование подтверждено).
- `InfoGain:` 1.
- `Барьер‑чек:` r — применимо (подсчёт констант), NP — неприменимо, alg — неприменимо.
- `Следующий шаг:` перейти к общему $|S^{*}_g|$: вывести per‑center bound, аккуратно учесть
  единственный `discover=0` на стадию и получить явный $A_1$.
