## 11. От глубины 2 к AC⁰: switching lemma (цитируется) → PARITY ∉ AC⁰

Нижняя оценка из Раздела 10 относится к глубине 2 (DNF/CNF).
Для произвольной постоянной глубины $d$ ключевой инструмент — переключательная лемма Хастада.
Здесь фиксируем формальный «скелет» доказательства: какие определения/леммы нужны
и где применяется switching lemma.

### 11.0. Ограничения и decision trees

**Определение (ограничение).** Ограничение $\rho$ на переменные $x_1,\dots,x_n$ —
это вектор из $\{0,1,*\}^n$.
Координата $\rho_i\in\{0,1\}$ означает фиксацию $x_i=\rho_i$,
а $\rho_i=*\,$ означает «свободно».
Обозначим через $m(\rho)$ число свободных переменных.

Для булевой функции $f:\{0,1\}^n\to\{0,1\}$ ограниченная функция
$f\upharpoonright\rho$ получается подстановкой фиксированных значений
и рассматривается как функция от $m(\rho)$ свободных переменных.

**Определение (decision tree).** Decision tree для $f$ — адаптивный алгоритм,
который на входе $x$ последовательно запрашивает значения отдельных $x_i$
и в листе выдаёт 0/1.
*Глубина* — максимальное число запросов на пути корень→лист.
Обозначим минимальную возможную глубину через $\mathrm{DT}(f)$.

**Факт 11.6.** Если $\mathrm{DT}(f)\le d$, то $f$ имеет DNF ширины $\le d$ и CNF ширины $\le d$.

*Доказательство.* Возьмём decision tree глубины $d$ для $f$.
Каждый путь, ведущий к листу со значением 1, задаёт терм
(конъюнкцию запрошенных литералов) длины $\le d$;
OR всех таких термов вычисляет $f$, давая DNF ширины $\le d$.
Для CNF применяем тот же аргумент к $\neg f$ и затем де Моргана. $\square$

### 11.1. PARITY под ограничениями (полное доказательство)

**Лемма 11.3.** Для любого ограничения $\rho$ функция
$\mathrm{PARITY}_n\upharpoonright\rho$ равна $\mathrm{PARITY}_{m(\rho)}$
или $\neg\mathrm{PARITY}_{m(\rho)}$ (то есть $\mathrm{PARITY}_{m(\rho)}\oplus c$
для некоторой константы $c\in\{0,1\}$).

*Доказательство.* Паритет есть XOR всех битов.
После подстановки фиксированных переменных их вклад становится константой
$c\in\{0,1\}$, а оставшиеся $m(\rho)$ свободных переменных остаются под XOR.
Значит $\mathrm{PARITY}_n\upharpoonright\rho = \mathrm{PARITY}_{m(\rho)}\oplus c$;
при $c=0$ это паритет, при $c=1$ — его отрицание. $\square$

### 11.2. PARITY требует полной decision-tree глубины (полное доказательство)

**Лемма 11.4.** $\mathrm{DT}(\mathrm{PARITY}_m)=m$.

*Доказательство.* Верхняя оценка $\le m$ очевидна: запросить все $m$ переменных и вычислить XOR.

Для нижней оценки предположим, что существует decision tree глубины $<m$,
вычисляющее $\mathrm{PARITY}_m$. Тогда на любом пути к листу запрашивается
$<m$ переменных, значит в листе остаётся хотя бы одна свободная переменная.
Но лист соответствует подкубу, заданному фиксацией запрошенных переменных, и по
Лемме 10.1 паритет на таком подкубе не может быть константой, тогда как
decision tree в листе выдаёт константу. Противоречие. $\square$

**Следствие 11.5.** Для любого $\rho$ с $m(\rho)=m$ имеем
$\mathrm{DT}(\mathrm{PARITY}_n\upharpoonright\rho)=m$
(в частности, если $m\ge 1$, то $\mathrm{PARITY}_n\upharpoonright\rho$ не константа).

*Доказательство.* По Лемме 11.3 ограничение паритета — это
$\mathrm{PARITY}_m$ или $\neg\mathrm{PARITY}_m$, а инверсия выхода не меняет
decision-tree глубину. Применяем Лемму 11.4. $\square$

### 11.3. Switching lemma → PARITY $\notin$ AC⁰

Далее даём доказательство Теоремы 11.2, принимая switching lemma (Теорема 11.1).

**Теорема 11.1 (Håstad switching lemma, цитируется; форма с явными константами).**
Пусть $F$ — DNF (или CNF) ширины не более $w$ над $n$ переменными.
Пусть $\rho$ — случайное ограничение, выбираемое равномерно среди ограничений
с ровно $s=\sigma n$ свободными переменными, где $\sigma\le 1/5$.
Тогда для любого $t\le s$
$$\Pr\big[\mathrm{DT}(F\upharpoonright\rho)>t\big] \le (10\sigma w)^t.$$

Источник: O’Donnell, Lecture 14 (The Switching Lemma), Theorem 1.8; исходный результат — Håstad (1986).

**Теорема 11.2 (PARITY $\notin$ AC⁰, доказательство при Теореме 11.1).**
Для любого фиксированного $k\ge 2$ любая глубины-$k$ AC⁰‑схема,
вычисляющая $\mathrm{PARITY}_n$, имеет размер $S\ge 2^{\Omega(n^{1/(k-1)})}$.

*Доказательство.* Пусть $C$ — глубины-$k$ схема размера $S$, вычисляющая $\mathrm{PARITY}_n$.

1) *(Нормализация, цитируется.)* Можно считать, что схема «слоистая»
(уровни чередуют AND/OR), входы — литералы, а fan-out равен 1 (формула).
При фиксированном $k$ это увеличивает размер лишь до $S^{O(1)}$;
переобозначим его снова через $S$.

2) Положим $w:=20\log_2 S$.
Далее (также стандартно) сведёмся к случаю, когда fan-in всех нижних гейтов
не превосходит $w$; это делается дополнительным случайным ограничением, которое
с положительной вероятностью убивает все нижние гейты ширины $>w$
(O’Donnell, Lecture 14, конец доказательства Теоремы 3.1).
Снова переобозначим полученную схему через $C$.

3) Предположим без потери общности, что нижний слой — AND. Тогда каждый гейт следующего слоя вычисляет DNF ширины $\le w$.

Возьмём $\sigma:=1/(20w)$ и применим случайное ограничение $\rho_1$
с ровно $\sigma n$ свободными переменными. По Теореме 11.1
для фиксированного такого DNF вероятность события $\mathrm{DT}(\cdot)>w$
не превосходит $(10\sigma w)^w=(1/2)^w=S^{-20}$.

По объединённой оценке (union bound) по всем $\le S$ гейтам этого слоя
существует ограничение $\rho_1$, при котором *каждый* из них после ограничения
имеет $\mathrm{DT}\le w$. По Факту 11.6 каждый такой гейт эквивалентен
CNF ширины $\le w$, и потому два соседних слоя схемы становятся одного типа
и могут быть слиты. В результате получаем схему глубины $k-1$ с тем же
ограничением fan-in $\le w$ на нижнем уровне.

4) Повторяем шаг (3) ещё $k-3$ раза (каждый раз оставляя долю $\sigma$
свободных переменных). Пусть $\rho$ — композиция полученных ограничений.
Через $k-2$ таких шагов получаем глубину 2 и число свободных переменных
$$m := n\cdot \sigma^{k-2} = \frac{n}{(20w)^{k-2}} = \frac{n}{(400\log_2 S)^{k-2}}.$$

По Лемме 11.3 ограничение $\mathrm{PARITY}_n\upharpoonright\rho$ — это $\mathrm{PARITY}_m$ или его отрицание.

5) Но по Теореме 10.3 любая глубины‑2 DNF/CNF для $\mathrm{PARITY}_m$
требует размера $\ge 2^{m-1}$. Размер нашей формулы после ограничений
не превосходит $S$, значит $S\ge 2^{m-1}$ и, следовательно, $m=O(\log_2 S)$.

Подставляя $m=\Theta\big(n/(\log_2 S)^{k-2}\big)$, получаем
$(\log_2 S)^{k-1}=\Omega(n)$, то есть $\log_2 S=\Omega(n^{1/(k-1)})$.
Следовательно, $S\ge 2^{\Omega(n^{1/(k-1)})}$. $\square$

**Цель на продолжение:** либо выписать доказательство Теоремы 11.1
(switching lemma), либо зафиксировать одну выбранную ссылку как «доверенную»
и дальше двигаться к другим моделям/функциям.
