# Q39.S159 nonrelativizing gadget implementation plan
Goal: explain how the gadget sketched in S158 is filled in with concrete oracle-sensitive data so that the contiguous-alt orbit requires global support information; outline what to prove in `formal/WIP/Verified/Q39.lean` before re-running `scripts/toy_q39_rank2.py`.
Dependencies: `docs/q39_s158.md`, `formal/WIP/Verified/Q39.lean`, `scripts/toy_q39_rank2.py`.
Exact citations:
- Baker, Gill, Solovay (1975), *Relativizations of the P = ? NP Question* (Thm. 1, p.15) — a gadget that remains oracle-independent keeps the contiguous sequence fully relativizing; the new gadget must violate that criterion.
- Katz (2005), *Relativizing the P vs. NP Question* (Claim 1, p.1) — preserving rank-2 witnesses under arbitrary oracles demands the gadget be oracle-aware or advice-dependent.
- Aaronson, Wigderson (2008), *Algebrization: A New Barrier in Complexity Theory* (Thm. 5.3, p.23) — algebraic extensions only see the usual XOR arithmetic unless oracle-specific bits are introduced.
Notes:
- Implement the gadget by introducing a global support bit (or advice string index) that depends on the oracle / per-instance advice and gates whether the next contiguous shift is attempted.
- In Lean, add definitions that read the gadget bit (a parameter that cannot be computed from arithmetic/log2 alone) before the shift; the toy script will then report rank 2 only if the gadget matches the current oracle choice.
- After defining the gadget, run `scripts/toy_q39_rank2.py` with the gadget enabled to see whether the rank-2 witness still holds, and if the entropy-stopper allows it rerun the contiguous series with the gadget enforced.
BarrierCheck:
- Relativization:
  - Relativizes?: no (by design the gadget depends on oracle/advice data).
  - If yes: the gadget must be provably oracle-dependent; otherwise the barrier remains.
  - Exit point: the shift now requires oracle-specific bits, so the mapping is not purely arithmetic/log2 and the barrier is broken unless the gadget is neutralized.
- NaturalProofs:
  - Applicable?: no (still about syntactic mapping invariants).
- Algebrization:
  - Applicable?: yes (AW08 shows algebraic extensions preserve XOR arithmetic, so the gadget must break that symmetry too).
- Citations: [BGS75], [Katz05], [AW08]
